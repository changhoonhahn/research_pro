<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.1//EN"
     "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>IDL Help for impro</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
<h1>IDL Help for impro</h1>
<h2>Overview</h2>
<p>This page was created by the IDL library routine
<code>make_html_help</code> (from version trunk 150936 of
idlutils).  For more information on this routine,
refer to the IDL Online Help Navigator or type: </p>
<pre>IDL&gt; ? make_html_help</pre>
<p>at the IDL command line prompt.</p>
<p><strong>Last modified: </strong>Fri Oct 18 08:24:39 2013.</p>
<hr />
<h2 id="ROUTINELIST">List of Routines</h2>
<ul>
<li><a href="#"></a> : </li>
<li><a href="#AIRMASS_PLOTS">AIRMASS_PLOTS</a> : 
Plot of airmass versus time for astronomical observations.</li>
<li><a href="#ANGSTROM_F">ANGSTROM()</a> : Render the Angstrom symbol on a plot.
</li>
<li><a href="#ASINH_RANDOM_F">ASINH_RANDOM()</a> : 
Draw a random variate from an arc sine distribution.</li>
<li><a href="#ASTROCONST_F">ASTROCONST()</a> : 
Return a large number of astrophysics-related constants.</li>
<li><a href="#AYTRIANGLE_F">AYTRIANGLE()</a> : 
Calculate zenith distance, hour angle, altitude, azimuth and</li>
<li><a href="#BALMER_TEMPERATURE_F">BALMER_TEMPERATURE()</a> : 
Compute the temperature dependence of the Balmer decrement, as</li>
<li><a href="#BC03_GRID2FITS">BC03_GRID2FITS</a> : 
Convert BC03 data structures to individual FITS files with the</li>
<li><a href="#BC03_MASSNORM_TEST">BC03_MASSNORM_TEST</a> : 
Build a QAplot to determine whether the BC03 templates need to be</li>
<li><a href="#BELL_MASS_F">BELL_MASS()</a> : 
Compute stellar mass-to-light ratios and stellar masses using</li>
<li><a href="#BESSELL_FILTERLIST_F">BESSELL_FILTERLIST()</a> : 
Return the Bessell filters.</li>
<li><a href="#BPT_DPHI_F">BPT_DPHI()</a> : 
Compute the BPT classification &quot;D&quot; and &quot;phi&quot; parameters of
</li>
<li><a href="#BUILD_BASTI_SSP">BUILD_BASTI_SSP</a> : 
Generate a grid of BaSTI simple stellar populations (SSPs) to be</li>
<li><a href="#BUILD_BC03_SSP">BUILD_BC03_SSP</a> : 
Generate a grid of BC03 simple stellar populations (SSPs) to be</li>
<li><a href="#BUILD_FSPS_SSP">BUILD_FSPS_SSP</a> : 
Generate a grid of FSPS simple stellar populations (SSPs)</li>
<li><a href="#BUILD_IGMTAU_GRID">BUILD_IGMTAU_GRID</a> : 
Build a lookup table of IGM attenuation as a function of</li>
<li><a href="#BUILD_MARASTON05_SSP">BUILD_MARASTON05_SSP</a> : 
Generate a grid of Maraston+05 simple stellar populations (SSPs)</li>
<li><a href="#BUILD_PEGASE_SSP">BUILD_PEGASE_SSP</a> : 
Generate a grid of PEGASE simple stellar populations (SSPs)</li>
<li><a href="#CLASS_FLAGNAME">CLASS_FLAGNAME</a> : 
Return bitmask labels corresponding to bit numbers in support of</li>
<li><a href="#CLASS_FLAGVAL">CLASS_FLAGVAL</a> : 
Return bitmask values corresponding to labels in support of</li>
<li><a href="#CLS">CLS</a> : Spawn the unix 'clear' command.</li>
<li><a href="#CMSET_OP">CMSET_OP</a> : 
Performs an AND, OR, or XOR operation between two sets</li>
<li><a href="#COMPUTE_AIRMASS_F">COMPUTE_AIRMASS()</a> : 
Compute the airmass of an observation.</li>
<li><a href="#COMPUTE_INCLINATION_F">COMPUTE_INCLINATION()</a> : 
Derive the inclination angle from the major-to-minor axis ratio of</li>
<li><a href="#COMPUTE_PARANGLE_F">COMPUTE_PARANGLE()</a> : 
Compute the parallactic angle.</li>
<li><a href="#COMPUTE_REFRACTION_F">COMPUTE_REFRACTION()</a> : 
Compute the atmospheric refraction with respect to a reference</li>
<li><a href="#COMPUTE_SFRS_F">COMPUTE_SFRS()</a> : 
Compute emission-line star-formation rates.  This routine must</li>
<li><a href="#CONVERT_TO_MAGGIES_F">CONVERT_TO_MAGGIES()</a> : 
Convert magnitudes stored in a data structure to &quot;maggies&quot; for use
</li>
<li><a href="#COVAR2ELLIPSE_F">COVAR2ELLIPSE()</a> : 
Given a 2D covariance matrix, compute the parameters of the</li>
<li><a href="#CREATE_PEGASE_SSPS">CREATE_PEGASE_SSPS</a> : 
Pegase does not come with any SSPs, so build a standard set for a</li>
<li><a href="#CWD_F">CWD()</a> : Return the current working directory.</li>
<li><a href="#DEEP2_FILTERLIST_F">DEEP2_FILTERLIST()</a> : 
Return the DEEP2 filters in the extended photometric catalog of</li>
<li><a href="#DEEP2_TO_MAGGIES">DEEP2_TO_MAGGIES</a> : 
Convert the DEEP2 extended galaxy photometry (from Matthews et</li>
<li><a href="#DISPLAY_DSS">DISPLAY_DSS</a> : 
Bone-simple script to render an image.</li>
<li><a href="#DKBOXSTATS_F">DKBOXSTATS()</a> : 
To take a one or two dimensional array and return each pixel</li>
<li><a href="#DS9POLYGON_INDICES_F">DS9POLYGON_INDICES()</a> : 
Convert a ds9 &quot;polygon&quot; regions file into a list of pixel indices</li>
<li><a href="#DUST_CORRECT_F">DUST_CORRECT()</a> : 
Correct a line flux measurement for dust extinction.</li>
<li><a href="#EMISSION_MASK_F">EMISSION_MASK()</a> : 
Mask optical nebular emission lines.</li>
<li><a href="#FINDEX">FINDEX</a> : 
Compute &quot;floating point index&quot; into a table for use with</li>
<li><a href="#FIND_DIFFS_F">FIND_DIFFS()</a> : 
Find all differences of a vector X, or between two vectors X and</li>
<li><a href="#FITS2IMH">FITS2IMH</a> : 
Convert a list of fits files to IRAF format.</li>
<li><a href="#FITSDATE2JD_F">FITSDATE2JD()</a> : 
Convert FITS format date to Julian date.</li>
<li><a href="#FLAM_UNITS_F">FLAM_UNITS()</a> : 
Return a clean title for flux density.</li>
<li><a href="#FLOW_DISTANCE_F">FLOW_DISTANCE()</a> : 
Return Virgo-centric infall galaxy distances based on both the</li>
<li><a href="#FNU_UNITS_F">FNU_UNITS()</a> : 
Return a clean title for flux density.</li>
<li><a href="#FORMAT_FLUX_ERROR">FORMAT_FLUX_ERROR</a> : 
Silly routine to truncate a vector to the correct number of</li>
<li><a href="#GALEX_FILTERLIST_F">GALEX_FILTERLIST()</a> : 
Return the GALEX filters.</li>
<li><a href="#GANG_PLOT_POS">GANG_PLOT_POS</a> : 
Simplify abutting multiple plots.</li>
<li><a href="#GAUSSCONV">GAUSSCONV</a> : 
Convolve an image with a Gaussian kernal using Fourier</li>
<li><a href="#GETCR_F">GETCR()</a> : Return a string carriage return.</li>
<li><a href="#GET_EBV_F">GET_EBV()</a> : 
Get E(B-V) from the Balmer decrement and an extinction curve.</li>
<li><a href="#GET_ELEMENT">GET_ELEMENT</a> : 
Compute the index of a value, given an input array.</li>
<li><a href="#GET_ELLIPSE_INDICES_F">GET_ELLIPSE_INDICES()</a> : 
Identify the elements lying inside a given ellipse.</li>
<li><a href="#GET_LUNAR_BRIGHTNESS_F">GET_LUNAR_BRIGHTNESS()</a> : 
Compute the surface brightness of the Moon [mag/arcsec2] as a</li>
<li><a href="#GET_MANGLE_AREA_F">GET_MANGLE_AREA()</a> : 
Compute the total area of a set of mangle polygons.</li>
<li><a href="#GET_MJDSTR_F">GET_MJDSTR()</a> : 
Return the current modified Julian date (MJD).</li>
<li><a href="#GET_PWD_F">GET_PWD()</a> : Return the present working directory.
</li>
<li><a href="#GET_SERSICB_F">GET_SERSICB()</a> : 
Compute the Sersic bn parameter.</li>
<li><a href="#GRAPHSELECT">GRAPHSELECT</a> : 
Select points within an area of a graph defined by the cursor.</li>
<li><a href="#HB_SFR_F">HB_SFR()</a> : 
Estimate the star-formation rate (SFR) from the B-band</li>
<li><a href="#HDR2STRUCT">HDR2STRUCT</a> : 
Convert a string array with the format of a FITS header</li>
<li><a href="#HIST_ND">HIST_ND</a> : 
Perform an N-dimensional histogram, also known as the joint</li>
<li><a href="#IABSLINEEW_F">IABSLINEEW()</a> : 
Measure absorption-line equivalent widths or continuum indices</li>
<li><a href="#ICLASSIFICATION_F">ICLASSIFICATION()</a> : 
Classify galaxies into starburst or AGN based on their</li>
<li><a href="#IFORAGE_F">IFORAGE()</a> : 
Retrieve useful header information from 1D or 2D spectra.</li>
<li><a href="#IMATCH_TEMPLATES_F">IMATCH_TEMPLATES()</a> : 
Match a set of templates to a data spectrum in terms of</li>
<li><a href="#IMH2FITS">IMH2FITS</a> : 
Convert a list of IRAF format images to fits files.</li>
<li><a href="#IM_ABSOLUTE_MAGNITUDES_F">IM_ABSOLUTE_MAGNITUDES()</a> : 
Given an apparent magnitude and luminosity distance, compute</li>
<li><a href="#IM_ABUNDANCE_F">IM_ABUNDANCE()</a> : 
Compute empirical abundances and various relevant line-ratios</li>
<li><a href="#IM_ANGLE_FORMAT_F">IM_ANGLE_FORMAT()</a> : 
Place an angle in the interval [0-180].</li>
<li><a href="#IM_ATVCUBE">IM_ATVCUBE</a> : 
This routine acts as a wrapper to Aaron Barth's image display</li>
<li><a href="#IM_BEST_SYMBOLS_F">IM_BEST_SYMBOLS()</a> : 
Return a priority-sorted list of the 22 &quot;best&quot; SYMCAT() symbols.</li>
<li><a href="#IM_BINSPEC_F">IM_BINSPEC()</a> : Bin a spectrum.</li>
<li><a href="#IM_BRANCH_RATIOS_F">IM_BRANCH_RATIOS()</a> : 
Compute and return the branching ratios among various</li>
<li><a href="#IM_CALC_VMAX">IM_CALC_VMAX</a> : 
Calculate Vmax, given the flux and redshift limits of the sample.</li>
<li><a href="#IM_CALL_MANGLE_F">IM_CALL_MANGLE()</a> : 
Simple wrapper on various mangle scripts.</li>
<li><a href="#IM_COLOR_F">IM_COLOR()</a> : 
Trivial wrapper on CGCOLOR() to access all the colors in 'rgb.txt'.</li>
<li><a href="#IM_COMPUTE_ERROR_F">IM_COMPUTE_ERROR()</a> : 
Perform propagation of errors with one or two variables.</li>
<li><a href="#IM_COMPUTE_OH12TE_F">IM_COMPUTE_OH12TE()</a> : 
Compute electron-temperature abundances.</li>
<li><a href="#IM_COMPUTE_TE_F">IM_COMPUTE_TE()</a> : 
Compute the nebular electron temperature based on various</li>
<li><a href="#IM_CONSTRUCT_ESPECTRUM_F">IM_CONSTRUCT_ESPECTRUM()</a> : 
Construct a model emission-line spectrum.</li>
<li><a href="#IM_CONVERT_IMF_F">IM_CONVERT_IMF()</a> : 
Return the conversion factor between various IMFs and the</li>
<li><a href="#IM_CONVERT_INDEX">IM_CONVERT_INDEX</a> : 
Converts a one dimensional array index into a vector of indices, whose</li>
<li><a href="#IM_CONVOLVE_SFH_F">IM_CONVOLVE_SFH()</a> : 
Convolve an SSP with an arbitrary star formation history.</li>
<li><a href="#IM_D4000_F">IM_D4000()</a> : 
Compute the Balogh+99 definition of the 4000-A break.</li>
<li><a href="#IM_DIRECT_ABUNDANCE_F">IM_DIRECT_ABUNDANCE()</a> : 
Given the relevant physical conditions (temperature and</li>
<li><a href="#IM_DMOD2D_F">IM_DMOD2D()[1]</a> : 
Convert from distance in Mpc to distance modulus.</li>
<li><a href="#IM_DMOD2D_F">IM_DMOD2D()[2]</a> : 
Convert from distance modulus to distance in Mpc.</li>
<li><a href="#IM_DOUBLE">IM_DOUBLE</a> : 
Convert a float to double-precision avoiding roundoff issues.</li>
<li><a href="#IM_EMPTY_STRUCTURE_F">IM_EMPTY_STRUCTURE()</a> : 
Empty a data structure.</li>
<li><a href="#IM_EVOLVE_F">IM_EVOLVE()</a> : 
Compute a simple evolution model to apply to a measured absolute</li>
<li><a href="#IM_F24TOLIR_F">IM_F24TOLIR()</a> : 
Given a redshift and an observed 24-micron flux, compute the total</li>
<li><a href="#IM_FF_ABUNDANCE_F">IM_FF_ABUNDANCE()</a> : 
Compute abundances using Pilyugin's &quot;ff&quot; method.</li>
<li><a href="#IM_FILE_TEST_F">IM_FILE_TEST()</a> : 
Check if a file exists before overwriting, unless /CLOBBER.</li>
<li><a href="#IM_FILTERMAG_F">IM_FILTERMAG()</a> : 
Compute the AB mag of a spectrum in a given filter.</li>
<li><a href="#IM_FILTERSPECS_F">IM_FILTERSPECS()</a> : 
Compute and return useful filter specifications.</li>
<li><a href="#IM_FITCONTINUUM_F">IM_FITCONTINUUM()</a> : 
Fit a spectral continuum using a variety of methods.</li>
<li><a href="#IM_FITEXY">IM_FITEXY</a> : 
Calls FITEXY (linear least squares with errors in both axes) with</li>
<li><a href="#IM_FITS_CUBE_F">IM_FITS_CUBE()</a> : 
Rad many FITS images into a structure cube.</li>
<li><a href="#IM_GALEX_TO_MAGGIES">IM_GALEX_TO_MAGGIES</a> : 
Convert an input GALEX photometric catalog to Galactic</li>
<li><a href="#IM_GAUSS_BROADEN_F">IM_GAUSS_BROADEN()</a> : 
Degrade the spectral resolution of a spectrum.</li>
<li><a href="#IM_GETMATRIX_F">IM_GETMATRIX()</a> : 
Returns the energy levels, Einstein A-values, and the matrix</li>
<li><a href="#IM_GETPOSITION_F">IM_GETPOSITION()</a> : 
Compute the position coordinates of one or more plots (without</li>
<li><a href="#IM_HDA_EMCOR_F">IM_HDA_EMCOR()</a> : 
Given an H-alpha flux and a Ha/Hb Balmer decrement, compute the</li>
<li><a href="#IM_HEADERFORAGE_F">IM_HEADERFORAGE()</a> : 
Return the contents of a FITS file header as a structure.</li>
<li><a href="#IM_HESSPLOT">IM_HESSPLOT</a> : Generate a Hess diagram.</li>
<li><a href="#IM_HIST1D">IM_HIST1D</a> : 
Returns the weighted histogram of a 1D array.</li>
<li><a href="#IM_HOGG_SCATTERPLOT">IM_HOGG_SCATTERPLOT</a> : 
plot greyscale scatterplot with contours</li>
<li><a href="#IM_HYPERFIT_F">IM_HYPERFIT()</a> : 
Fit a hyperbola to data with the option of constraining any of</li>
<li><a href="#IM_IMAGECOMPARE">IM_IMAGECOMPARE</a> : 
Interactively compare two images in a single graphics window.</li>
<li><a href="#IM_IMGSCL_F">IM_IMGSCL()</a> : Scale/stretch an image for display.
</li>
<li><a href="#IM_INTEGRAL_F">IM_INTEGRAL()</a> : 
Routine to perform trapezoidal integration in X,Y between</li>
<li><a href="#IM_IONSPEC">IM_IONSPEC</a> : 
Calculates the emission-line spectrum of an ion from an N-level</li>
<li><a href="#IM_IS_IN_WINDOW_F">IM_IS_IN_WINDOW()</a> : 
Much faster alternative to IS_IN_WINDOW() that relies on the</li>
<li><a href="#IM_IZOTOV_TE_F">IM_IZOTOV_TE()</a> : 
Compute the nebular electron temperature from the [O III] flux</li>
<li><a href="#IM_KCORRECT_F">IM_KCORRECT()</a> : 
Wrapper on Blanton's KCORRECT to compute K-corrections from</li>
<li><a href="#IM_LEGEND">IM_LEGEND</a> : Create an annotation legend for a plot.
</li>
<li><a href="#IM_LF_FIT_SCHECHTER_F">IM_LF_FIT_SCHECHTER()</a> : 
Fit a binned luminosity function using a Schechter model.</li>
<li><a href="#IM_LF_SCHECHTER_F">IM_LF_SCHECHTER()</a> : 
Generate a Schechter model given the relevant parameters.</li>
<li><a href="#IM_LIGHT_F">IM_LIGHT()</a> : 
Return the speed of light in various units.</li>
<li><a href="#IM_LINEAR_REBIN_F">IM_LINEAR_REBIN()</a> : 
Rebin a spectrum linearly in wavelength.</li>
<li><a href="#IM_LINEFIT_F">IM_LINEFIT()</a> : 
Fit a line to data with the option of constraining any of the</li>
<li><a href="#IM_LINEID_PLOT">IM_LINEID_PLOT</a> : 
Plot spectrum with specified line identifications annotated at the</li>
<li><a href="#IM_LOG_REBIN_F">IM_LOG_REBIN()</a> : 
Rebin a spectrum logarithmically (natural log) in wavelength.</li>
<li><a href="#IM_LSUN_F">IM_LSUN()</a> : Return the solar luminosity in erg/s.
</li>
<li><a href="#IM_MANYD_SCATTERPLOT">IM_MANYD_SCATTERPLOT</a> : 
plot N-dimensional data sets</li>
<li><a href="#IM_MAX_F">IM_MAX()</a> : 
Simple wrapper on DJS_ITERSTAT to compute a maximum value.</li>
<li><a href="#IM_MEAN_F">IM_MEAN()</a> : 
Simple wrapper on DJS_ITERSTAT to compute the mean value.</li>
<li><a href="#IM_MEASURE_PEG_F">IM_MEASURE_PEG()</a> : 
Given a Pegase data structure (read by IM_READ_PEG), measure some</li>
<li><a href="#IM_MEDIAN_F">IM_MEDIAN()</a> : 
Simple wrapper on DJS_ITERSTAT to compute the median value.</li>
<li><a href="#IM_MEDXBIN_F">IM_MEDXBIN()</a> : 
Compute various statistical quantities in bins of fixed width.</li>
<li><a href="#IM_MF_VMAX_F">IM_MF_VMAX()</a> : 
Compute a 1/Vmax-weighted mass *or* luminosity function.</li>
<li><a href="#IM_MIN_F">IM_MIN()</a> : 
Simple wrapper on DJS_ITERSTAT to compute the minimum value.</li>
<li><a href="#IM_MWRFITS">IM_MWRFITS</a> : 
Simple wrapper on MWRFITS with some bells and whistles.</li>
<li><a href="#IM_NLEVEL">IM_NLEVEL</a> : 
Calculates the relative populations and emissivities for the lines</li>
<li><a href="#IM_NORMALIZE_F">IM_NORMALIZE()</a> : 
Normalize a spectrum or data array.</li>
<li><a href="#IM_OFFSET_AND_ROTATE_F">IM_OFFSET_AND_ROTATE()</a> : 
Apply an arbitrary offset and rotation to a position.</li>
<li><a href="#IM_OPENCLOSE">IM_OPENCLOSE</a> : 
Simple wrapper for opening and closing a postscript file</li>
<li><a href="#IM_OPLOT_BOX">IM_OPLOT_BOX</a> : 
Overplot an arbitrarily positioned (and rotated) box on an</li>
<li><a href="#IM_PLANEFIT_F">IM_PLANEFIT()</a> : 
Fit a plane to data with the option of constraining any of the</li>
<li><a href="#IM_PLOTCONFIG">IM_PLOTCONFIG</a> : 
High-level wrapper on IM_GETPOSITION() for generating multi-panel</li>
<li><a href="#IM_PLOTFAVES">IM_PLOTFAVES</a> : 
Load &quot;favorite&quot; settings for generating plots.</li>
<li><a href="#IM_PLOTHIST">IM_PLOTHIST</a> : 
Generate a histogram plot with optional weights.</li>
<li><a href="#IM_PNG2HTML">IM_PNG2HTML</a> : 
Render a web page from a list of PNG (or JPG) files.</li>
<li><a href="#IM_POISSON_LIMITS_F">IM_POISSON_LIMITS()</a> : 
For a given number of events, calculate the Poisson upper and</li>
<li><a href="#IM_POLYFIT_F">IM_POLYFIT()</a> : 
Fit a polynomial to data with the option of constraining any</li>
<li><a href="#IM_POLY_ITER">IM_POLY_ITER</a> : 
Calls IDL poly_fit iteratively with outlier rejection</li>
<li><a href="#IM_PREDICT_TNII_F">IM_PREDICT_TNII()</a> : 
Predict T(N+) given T(O+).</li>
<li><a href="#IM_PREDICT_TOII_F">IM_PREDICT_TOII()</a> : 
Predict T(O+) given T(O++).</li>
<li><a href="#IM_PREDICT_TSIII_F">IM_PREDICT_TSIII()</a> : 
Predict T(S++) given T(O++).</li>
<li><a href="#IM_PS2HTML">IM_PS2HTML</a> : 
Convert all PS and EPS files in a directory to PNG files and</li>
<li><a href="#IM_PSFEX">IM_PSFEX</a> : 
Run PSFEx on a suitably prepared SExtractor catalog.</li>
<li><a href="#IM_READ_BASTI_F">IM_READ_BASTI()</a> : 
Read a BaSTI SSP into a structure.</li>
<li><a href="#IM_READ_BC03_F">IM_READ_BC03()</a> : 
Read the Bruzual &amp; Charlot (2003) binary format population</li>
<li><a href="#IM_READ_FSPS_F">IM_READ_FSPS()</a> : 
Read an FSPS SSP into a structure.</li>
<li><a href="#IM_READ_MARASTON05_F">IM_READ_MARASTON05()</a> : 
Read a Maraston+05 SSP into a structure.</li>
<li><a href="#IM_READ_MARASTON11_F">IM_READ_MARASTON11()</a> : 
Read a Maraston &amp; Stromback (2011) SSPs into a structure.</li>
<li><a href="#IM_READ_PEG_F">IM_READ_PEG()</a> : 
Read PEGASE.2 or PEGASE-HR style SSPs into a structure.</li>
<li><a href="#IM_READ_PEGASE_F">IM_READ_PEGASE()</a> : 
Read the output of CREATE_PEGASE_SSPs into a structure.</li>
<li><a href="#IM_READ_SOLAR_F">IM_READ_SOLAR()</a> : 
Read the solar spectrum provided by the CALSPEC database.</li>
<li><a href="#IM_READ_STARBURST99_F">IM_READ_STARBURST99()</a> : 
Read the Starburst99 spectra and data files into a structure.</li>
<li><a href="#IM_READ_TBL_F">IM_READ_TBL()</a> : 
Read 2MASS style table into IDL structure</li>
<li><a href="#IM_READ_VEGA_F">IM_READ_VEGA()</a> : 
Read the Kurucz (1995) model of Vega (alpha-Lyrae) included</li>
<li><a href="#IM_READ_VIZIER_TSV_F">IM_READ_VIZIER_TSV()</a> : 
Read &quot;|&quot; separated ASCII files downloaded from Vizier and</li>
<li><a href="#IM_ROBUST_SIGMA">IM_ROBUST_SIGMA</a> : 
Calculate a resistant estimate of the dispersion of a distribution.</li>
<li><a href="#IM_SCAMP">IM_SCAMP</a> : Run SCAMP given a list of SE catalogs.
</li>
<li><a href="#IM_SEX">IM_SEX</a> : 
Run SExtractor on one or more images (also optionally in</li>
<li><a href="#IM_SIGFIGS_F">IM_SIGFIGS()</a> : 
Convert a number to a string with a fixed number of significant digits.</li>
<li><a href="#IM_SIMPLE_KCORRECT_F">IM_SIMPLE_KCORRECT()</a> : 
Compute K-corrections from and to an arbitrary set of bandpasses,</li>
<li><a href="#IM_SNR_SPEC_F">IM_SNR_SPEC()</a> : 
Compute the exposure time to achieve a given S/N for</li>
<li><a href="#IM_SPECRES_LAMP_F">IM_SPECRES_LAMP()</a> : 
Measure the instrumental resolution from a 2D arc lamp image.</li>
<li><a href="#IM_SPHEREMATCH_F">IM_SPHEREMATCH()</a> : 
Simple iterative wrapper on spherematch.</li>
<li><a href="#IM_SPLOTEW_F">IM_SPLOTEW()</a> : 
Measure the equivalent width of emission or absorption lines</li>
<li><a href="#IM_STATS_F">IM_STATS()</a> : 
Compute some basic statistics and pack into a structure.</li>
<li><a href="#IM_STRING_STATS_F">IM_STRING_STATS()</a> : 
Compute statistics on an array and build a string that looks nice</li>
<li><a href="#IM_STRSPLIT_F">IM_STRSPLIT()</a> : 
Simple vectorized version of STRSPLIT().</li>
<li><a href="#IM_STRUCT_ASSIGN_F">IM_STRUCT_ASSIGN()</a> : 
Simple wrapper on struct_assign to get around the</li>
<li><a href="#IM_STRUCT_TRIMTAGS">IM_STRUCT_TRIMTAGS</a> : 
Trim a structure to a list of selected and/or excluded tags</li>
<li><a href="#IM_SWARP">IM_SWARP</a> : Run SWARP given a list of images.</li>
<li><a href="#IM_SYMBOLS">IM_SYMBOLS</a> : 
Define a variety of user plot symbols.</li>
<li><a href="#IM_TEMDEN_F">IM_TEMDEN()</a> : 
Given one or more appropriate line-ratios, compute the</li>
<li><a href="#IM_TODAY_F">IM_TODAY()</a> : Return today's date</li>
<li><a href="#IM_TOTAL_FIR_F">IM_TOTAL_FIR()</a> : 
Compute the FAR-infrared luminosity given the IRAS fluxes at</li>
<li><a href="#IM_TOTAL_IR_F">IM_TOTAL_IR()</a> : 
Compute the total infrared luminosity given the IRAS fluxes at</li>
<li><a href="#IM_WEIGHTED_MEAN_F">IM_WEIGHTED_MEAN()</a> : 
Compute the weighted mean, standard deviations, and error in the</li>
<li><a href="#IM_WINDOW">IM_WINDOW</a> : 
Open up an IDL window appropriate to the user's screen size.</li>
<li><a href="#IM_WISE2LIR_F">IM_WISE2LIR()[1]</a> : 
Given a redshift and 24-, 70-, and 160-micron *observed*</li>
<li><a href="#IM_WISE2LIR_F">IM_WISE2LIR()[2]</a> : 
Given a redshift and 12- and 22-micron *observed* WISE photometry,</li>
<li><a href="#IM_WPARSE_F">IM_WPARSE()</a> : 
reads the files with input spectra into the structure used in</li>
<li><a href="#IM_XYOUTS_TITLE">IM_XYOUTS_TITLE</a> : 
Flexibly render a plot title on an existing plot using XYOUTS.</li>
<li><a href="#IM_ZMINZMAX_F">IM_ZMINZMAX()</a> : 
Compute the minimum and maximum redshift at which an object</li>
<li><a href="#IM_ZTWEAK_F">IM_ZTWEAK()</a> : 
Compute a small radial velocity shift via cross-correlation</li>
<li><a href="#INIT_ISEDFIT_SSP_F">INIT_ISEDFIT_SSP()</a> : 
Initialize a structure for the various BUILD_*_SSP routines.</li>
<li><a href="#INIT_PSFEX_CONFIG_F">INIT_PSFEX_CONFIG()</a> : 
Initialize a PSFEx configuration structure.</li>
<li><a href="#INIT_SCAMP_CONFIG_F">INIT_SCAMP_CONFIG()</a> : 
Initialize a scamp configuration structure.</li>
<li><a href="#INIT_SEX_CONFIG_F">INIT_SEX_CONFIG()</a> : 
Initialize a sex configuration structure.</li>
<li><a href="#INIT_SWARP_CONFIG_F">INIT_SWARP_CONFIG()</a> : 
Initialize a swarp configuration structure.</li>
<li><a href="#INTEGRATE_LF_F">INTEGRATE_LF()</a> : 
Integrate a 1/Vmax-weighted luminosity function and, optionally,</li>
<li><a href="#INTEGRATE_MF_F">INTEGRATE_MF()</a> : 
Integrate a 1/Vmax-weighted stellar mass function and, optionally,</li>
<li><a href="#INVCT">INVCT</a> : Invert the current and original color tables.
</li>
<li><a href="#IRAC_FILTERLIST_F">IRAC_FILTERLIST()</a> : 
Return the IRAC filters.</li>
<li><a href="#IREDSHIFT_F">IREDSHIFT()</a> : 
Derive the redshift of a galaxy using PCA eigentemplates and</li>
<li><a href="#ISEDFIT">ISEDFIT</a> : 
Infer the physical properties of galaxies (probabalistically) by</li>
<li><a href="#ISEDFIT_AGEGRID_F">ISEDFIT_AGEGRID()</a> : 
Build an age (time) grid that deals with bursts correctly.</li>
<li><a href="#ISEDFIT_CHI2_F">ISEDFIT_CHI2()</a> : 
Compute chi^2 and the best-fitting scale factor given a grid of</li>
<li><a href="#ISEDFIT_CONVOLVE_SFH_F">ISEDFIT_CONVOLVE_SFH()</a> : 
iSEDfit-specific convolution code (see IM_CONVOLVE_SFH for a</li>
<li><a href="#ISEDFIT_FILEPATHS_F">ISEDFIT_FILEPATHS()</a> : 
Given a parameters structure (see READ_ISEDFIT_PARAMFILE), pack</li>
<li><a href="#ISEDFIT_KCORRECT">ISEDFIT_KCORRECT</a> : 
Compute K-corrections from the best-fitting iSEDfit model.</li>
<li><a href="#ISEDFIT_MODELS">ISEDFIT_MODELS</a> : 
Synthesize photometry on a grid of redshift for all the</li>
<li><a href="#ISEDFIT_MONTEGRIDS">ISEDFIT_MONTEGRIDS</a> : 
Build the Monte Carlo star formation history grids.</li>
<li><a href="#ISEDFIT_NEBULAR_F">ISEDFIT_NEBULAR()</a> : 
Compute the nebular continuum and emission-line spectrum given the</li>
<li><a href="#ISEDFIT_POSTERIOR_F">ISEDFIT_POSTERIOR()</a> : 
Compute the posterior probability distribution.  This routine is</li>
<li><a href="#ISEDFIT_QAPLOT_MODELS">ISEDFIT_QAPLOT_MODELS</a> : 
Generate color-color and redshift-color QAplots to help assess the</li>
<li><a href="#ISEDFIT_QAPLOT_SED">ISEDFIT_QAPLOT_SED</a> : 
Generate spectral energy distribution (SED) quality-assurance (QA)</li>
<li><a href="#ISEDFIT_RECONSTRUCT_POSTERIOR_F">ISEDFIT_RECONSTRUCT_POSTERIOR()
</a> : Reconstruct the posterior distribution(s) of the output</li>
<li><a href="#ISEDFIT_SFH_F">ISEDFIT_SFH()</a> : 
Generate an iSEDfit-compatible star formation history including</li>
<li><a href="#IUNRED_LINEDUST_F">IUNRED_LINEDUST()</a> : 
Correct emission-line fluxes for dust extinction using the</li>
<li><a href="#JD2FITSDATE_F">JD2FITSDATE()</a> : 
Convert a Julian date to a FITS format date.</li>
<li><a href="#KCORRECT_QAPLOT">KCORRECT_QAPLOT</a> : 
Build a QAplot of the K-correct SED fitting.</li>
<li><a href="#KEWLEY_BTP_LINES_F">KEWLEY_BTP_LINES()</a> : 
Return the Kewley et al 2001 theoretical starburst</li>
<li><a href="#K_LAMBDA_F">K_LAMBDA()</a> : 
Return a variety of extinction curves.</li>
<li><a href="#L">L</a> : Spawn the unix command 'ls -l | more'.</li>
<li><a href="#LF_DOUBLE_POWERLAW_F">LF_DOUBLE_POWERLAW()</a> : 
Generate a double power-law luminosity function given the relevant</li>
<li><a href="#LF_FIT_DOUBLE_POWERLAW_F">LF_FIT_DOUBLE_POWERLAW()</a> : 
Fit a binned luminosity function using a double power-law model.</li>
<li><a href="#LINERATIO">LINERATIO</a> : Compute emission-line ratios.</li>
<li><a href="#LM_IGMTAU_F">LM_IGMTAU()</a> : 
For a given wavelength and redshift, compute the effective</li>
<li><a href="#LM_IGMTAUDA_F">LM_IGMTAUDA()</a> : 
Compute IGM depression in the Lyman alpha forest at 1050-1170.</li>
<li><a href="#LM_IGMTAUDB_F">LM_IGMTAUDB()</a> : 
Compute IGM depression in the Lyman beta forest at 920-1015.</li>
<li><a href="#LOGLEVELS_F">LOGLEVELS()</a> : 
Compute default values for logarithmic axis labeling</li>
<li><a href="#MAG2MAGGIES_F">MAG2MAGGIES()</a> : 
Convert from magnitudes to maggies.</li>
<li><a href="#MAGGIES2MAG_F">MAGGIES2MAG()</a> : 
Convert from maggies to AB magnitude.</li>
<li><a href="#MAKE_BOK_CATALOG">MAKE_BOK_CATALOG</a> : 
Generate a catalog that for the Bok/90-inch.</li>
<li><a href="#MAKE_IMPRO_HELP">MAKE_IMPRO_HELP</a> : 
Build the help HTML code for impro.</li>
<li><a href="#MAKE_LNWAVE_F">MAKE_LNWAVE()</a> : 
Calculate a natural-log wavelength vector of a one-dimensional</li>
<li><a href="#MAKE_WAVE_F">MAKE_WAVE()</a> : 
Calculate a wavelength vector of a one-dimensional spectrum</li>
<li><a href="#MATCH_STRING_F">MATCH_STRING()</a> : 
Matches strings one letter at a time.</li>
<li><a href="#MF_DOUBLE_SCHECHTER_F">MF_DOUBLE_SCHECHTER()</a> : 
Generate a double Schechter model given the relevant parameters.</li>
<li><a href="#MF_FIT_DOUBLE_SCHECHTER_F">MF_FIT_DOUBLE_SCHECHTER()</a> : 
Fit a binned stellar mass function using a double Schechter model.</li>
<li><a href="#MF_FIT_MODIFIED_SCHECHTER_F">MF_FIT_MODIFIED_SCHECHTER()</a> : 
Fit a binned stellar mass function using a modified Schechter</li>
<li><a href="#MF_FIT_SCHECHTER_F">MF_FIT_SCHECHTER()</a> : 
Fit a binned stellar mass function using a Schechter model.</li>
<li><a href="#MF_FIT_SCHECHTER_PLUS_F">MF_FIT_SCHECHTER_PLUS()</a> : 
Fit a binned stellar mass function using a double Schechter model.</li>
<li><a href="#MF_FIT_TRIPLE_SCHECHTER_F">MF_FIT_TRIPLE_SCHECHTER()</a> : 
Fit a binned stellar mass function using a triple Schechter model.</li>
<li><a href="#MF_MODIFIED_SCHECHTER_F">MF_MODIFIED_SCHECHTER()</a> : 
Generate a modified Schechter model given the relevant parameters.</li>
<li><a href="#MF_SCHECHTER_F">MF_SCHECHTER()</a> : 
Generate a Schechter model given the relevant parameters.</li>
<li><a href="#MF_SCHECHTER_PLUS_F">MF_SCHECHTER_PLUS()</a> : 
Generate a Schechter plus additional low-mass component model</li>
<li><a href="#MF_SCHECHTER_PLUS_RANDOM_F">MF_SCHECHTER_PLUS_RANDOM()</a> : 
Draw random numbers from a (specified) double Schechter function.</li>
<li><a href="#MF_SCHECHTER_RANDOM_F">MF_SCHECHTER_RANDOM()</a> : 
Draw random numbers from a (specified) Schechter function.</li>
<li><a href="#MF_TRIPLE_SCHECHTER_F">MF_TRIPLE_SCHECHTER()</a> : 
Generate a triple Schechter model given the relevant parameters.</li>
<li><a href="#MIPS_FILTERLIST_F">MIPS_FILTERLIST()</a> : 
Return the MIPS filters.</li>
<li><a href="#MONOTONIC_F">MONOTONIC()</a> : 
Determine whether a vector is monotonically increasing or</li>
<li><a href="#MONTE_LOG12OH_KK04">MONTE_LOG12OH_KK04</a> : 
Compute oxygen abundances using the KK04 calibration, with</li>
<li><a href="#MONTE_LOG12OH_M91">MONTE_LOG12OH_M91</a> : 
Compute oxygen abundances using the M91 calibration, with</li>
<li><a href="#MONTE_LOG12OH_PT05">MONTE_LOG12OH_PT05</a> : 
Compute oxygen abundances using the PT05 calibration, with</li>
<li><a href="#MONTE_LOG12OH_T04">MONTE_LOG12OH_T04</a> : 
Compute oxygen abundances using the T04 calibration, with</li>
<li><a href="#MONTE_LOG12OH_ZHK94">MONTE_LOG12OH_ZHK94</a> : 
Compute oxygen abundances using the ZHK94 calibration, with</li>
<li><a href="#MOULD_DISTANCE_F">MOULD_DISTANCE()</a> : 
Compute the Hubble-flow velocity and luminosity distance of an</li>
<li><a href="#MULTI_AIRMASS_F">MULTI_AIRMASS()</a> : 
Generate a multi-page plot of airmass and PA versus time.</li>
<li><a href="#NED_WEBGET_BASIC">NED_WEBGET_BASIC</a> : 
Collects basic data from NED.</li>
<li><a href="#NED_WEBGET_DIAMETERS">NED_WEBGET_DIAMETERS</a> : 
Collect size and position angle information from NED.</li>
<li><a href="#NED_WEBGET_PHOTOMETRY">NED_WEBGET_PHOTOMETRY</a> : 
Collects photometry data from NED.</li>
<li><a href="#NEW_IMATCH_TEMPLATES_F">NEW_IMATCH_TEMPLATES()</a> : 
Match a set of templates to a galaxy spectrum in terms of</li>
<li><a href="#NICEPRINT">NICEPRINT</a> : 
Write out an arrays of numbers in a nice column format.</li>
<li><a href="#NICEPRINTF">NICEPRINTF</a> : 
Write to an existing LUN arrays of numbers in a nice column</li>
<li><a href="#NINTERPOLATE">NINTERPOLATE</a> : 
Perform n-dimensional linear interpolation on arrays of</li>
<li><a href="#ODD_F">ODD()</a> : Returns 0 if number if even, 1 if odd.</li>
<li><a href="#OII_SFR_F">OII_SFR()</a> : 
Estimate the star-formation rate (SFR) from the B-band</li>
<li><a href="#ONEDCENTER_F">ONEDCENTER()</a> : 
Find the intensity-weighted (partial-pixel) center of a 1D array.</li>
<li><a href="#PAD_EXTRAPOLATE_F">PAD_EXTRAPOLATE()</a> : 
Pad and extrapolate a two-dimensional spectrum in the spatial</li>
<li><a href="#PAGEMAKER">PAGEMAKER</a> : 
Returns plotting positions for desired page specifications,</li>
<li><a href="#PARSE_NED_BYNAME">PARSE_NED_BYNAME</a> : 
Parse basic galaxy properties from a NED batch request.</li>
<li><a href="#PARSE_NED_LITERATURE">PARSE_NED_LITERATURE</a> : 
Parse the output of a NED literature search.</li>
<li><a href="#PARSE_NED_PHOTOMETRY">PARSE_NED_PHOTOMETRY</a> : 
Parse galaxy photometry from a NED batch request.</li>
<li><a href="#PEG2ISEDFIT_F">PEG2ISEDFIT()</a> : 
Convert the output from IM_READ_PEG() to an iSEDfit compatible</li>
<li><a href="#PWD_F">PWD()</a> : Return the present working directory.</li>
<li><a href="#RANDOM_INDICES_F">RANDOM_INDICES()</a> : 
Return a random index array.</li>
<li><a href="#RANGE">RANGE</a> : 
RANGE(x1,x2) = x1,x1+1,...,x2. In this case x1, x2 should be integers.</li>
<li><a href="#READFAST">READFAST</a> : 
Routine to read in column-formated data very quickly.</li>
<li><a href="#READ_ISEDFIT_F">READ_ISEDFIT()</a> : 
Restore the ISEDFIT fitting results and, optionally, the posterior</li>
<li><a href="#READ_ISEDFIT_PARAMFILE_F">READ_ISEDFIT_PARAMFILE()</a> : 
Read the iSEDFIT parameter file.</li>
<li><a href="#READ_WITT_DUSTMODELS_F">READ_WITT_DUSTMODELS()</a> : 
Read the Witt &amp; Gordon (2000) dust models.</li>
<li><a href="#REBINW">REBINW</a> : 
rebins the input array on a new grid and returns the output array.</li>
<li><a href="#REFRACTION_PLOT">REFRACTION_PLOT</a> : 
Generate a plot of atmospheric refraction with respect to 5000 a</li>
<li><a href="#RETURN_TBALMER_F">RETURN_TBALMER()</a> : 
Return the Balmer decrement corresponding to a particular</li>
<li><a href="#RSEX_F">RSEX()</a> : 
Read in arbitrary SExtractor format catalogs, using native</li>
<li><a href="#SCAN_RATES_F">SCAN_RATES()</a> : 
Compute drift scan rates and offsets for integrated long-slit</li>
<li><a href="#SDSS_FILTERLIST_F">SDSS_FILTERLIST()</a> : 
Return the SDSS filters.</li>
<li><a href="#SEEING_WAVELENGTH">SEEING_WAVELENGTH</a> : 
Plot the variation of the seeing disk with wavelength.</li>
<li><a href="#SFR_09RIEKE_F">SFR_09RIEKE()</a> : 
Compute the SFR from the observed 24-micron *flux* density.</li>
<li><a href="#SFR_UNITS_F">SFR_UNITS()</a> : 
Return a clean title for star formation rate.</li>
<li><a href="#SIGFIG">SIGFIG</a> : 
SIGFIG is a function which returns an input value (INFIG) as</li>
<li><a href="#SIM_RVSHIFT">SIM_RVSHIFT</a> : 
A simulation to test the accuracy of solving for a velocity</li>
<li><a href="#SINT">SINT</a> : Sinc interpolation of a 1-D vector of data.</li>
<li><a href="#SKYVIEW_BATCH">SKYVIEW_BATCH</a> : 
Retrieve images and data from SKYVIEW.</li>
<li><a href="#SORT_ND">SORT_ND</a> : 
Efficiently perform an N-dimensional sort along any dimension</li>
<li><a href="#SPECTRAL_INDICES_F">SPECTRAL_INDICES()</a> : 
Measure a variety of spectral indices from a composite stellar</li>
<li><a href="#SSTRETCH">SSTRETCH</a> : 
To return the median, standard deviation, minimum and maximum</li>
<li><a href="#STARLIGHTLOSS">STARLIGHTLOSS</a> : 
Compute light losses from slit spectra as a function of seeing,</li>
<li><a href="#STERN_IRAC_AGN_F">STERN_IRAC_AGN()</a> : 
Identify AGN using the Stern wedge.</li>
<li><a href="#TELLURIC_MASK_F">TELLURIC_MASK()</a> : 
Mask telluric absorption features and flag wavelengths that</li>
<li><a href="#TEXSTRINGS">TEXSTRINGS</a> : 
Returns a structure of string fields containing simplified</li>
<li><a href="#TWOMASS_FILTERLIST_F">TWOMASS_FILTERLIST()</a> : 
Return the 2MASS filters.</li>
<li><a href="#VERIFY_SPECTRAL_INDICES">VERIFY_SPECTRAL_INDICES</a> : 
Compare the output of SPECTRAL_INDICES() against BC03.</li>
<li><a href="#WISE_FILTERLIST_F">WISE_FILTERLIST()</a> : 
Return the WISE filters.</li>
<li><a href="#WKILL">WKILL</a> : Delete all open windows.</li>
<li><a href="#WRITE_BC03_TEMPLATES">WRITE_BC03_TEMPLATES</a> : 
Write the BC03 spectra as galaxy templates.</li>
<li><a href="#WRITE_DS9_REGIONFILE">WRITE_DS9_REGIONFILE</a> : 
Write out a DS9 region file.</li>
<li><a href="#WRITE_DUMMY_CONFIG">WRITE_DUMMY_CONFIG</a> : 
Write a dummy (temporary) configuration file (for use with</li>
<li><a href="#WRITE_ISEDFIT_PARAMFILE_F">WRITE_ISEDFIT_PARAMFILE()</a> : 
Build the global parameter file for iSEDfit.</li>
<li><a href="#WRITE_PEGASE_IMF">WRITE_PEGASE_IMF</a> : 
Write a Pegase-compatible IMF file.</li>
<li><a href="#WRITE_SCAMP_CATALOG">WRITE_SCAMP_CATALOG</a> : 
Write a SCAMP-compatible (in FITS_LDAC format) astrometric</li>
<li><a href="#WRITE_TEMDEN_LOOKUP_TABLE">WRITE_TEMDEN_LOOKUP_TABLE</a> : 
Write a look-up table for use with IM_TEMDEN().</li>
<li><a href="#WSEX">WSEX</a> : 
Write out arbitrary SExtractor format catalogs, using native</li>
<li><a href="#XREBIN">XREBIN</a> : Rebin a vector.</li>
<li><a href="#XY2IMAGE">XY2IMAGE</a> : 
Populate an image with the coordinates given by (x,[y]).</li>
</ul>
<hr />
<h2>Routine Descriptions</h2>
<h3 id=""></h3>
<p><a href="#AIRMASS_PLOTS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:

  QUICKCV

 PURPOSE:

   calculate cosmic variance for some geometry

 CATEGORY:

   cosmic variance


 CALLING SEQUENCE:

   fracerror=quickcv(side1,side2 [zarr,deltaz,sig8=sig8,npoints=npoints]) 

 INPUTS:

   side1: length of 1 side of field on sky, in degrees (rect. geom)
   side2: length of other side of field on sky, in degrees

 OPTIONAL INPUTS:
   zarr: array of z's for which cosmic variance will be calculated; default:1
   deltaz: total length of volume in z direction; default: 0.1

 KEYWORD PARAMETERS:
   sig8: desired value of sigma_8; default: 0.77
   npoints: desired number of integration points for first part of 
     integration; default: 200


 OUTPUTS:

  fracerror: array containing the fractional error in a count,
  sigma/N, due to cosmic variance for objects with bias b=1 
  in a volume side1 x side2 degrees x delta_z centered at redshifts
  zarr.  NOTE THIS IS SIGMA, NOT VARIANCE!!!!

 RESTRICTIONS:

  uses power spectrum in pofk.pro (gamma=0.1872, omega0=0.26), distance
  relation in rz.pro 


 MODIFICATION HISTORY:
 modified by rss july 2006 to include Dlin scaling with z
 modified by bpm sep  2009 to wmap3 cosmology
</pre>
<p><strong>(See pro/galaxy/quickcv.pro)</strong></p>
<hr />
<h3 id="AIRMASS_PLOTS">AIRMASS_PLOTS</h3>
<p><a href="#">[Previous Routine]</a></p>
<p><a href="#ANGSTROM_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   AIRMASS_PLOTS

 PURPOSE:
   Plot of airmass versus time for astronomical observations. 

 INPUTS:
   date - date of the observations in FITS standard string
          format, [YYYY-MM-DD] (e.g., date = '2002-02-10')
   ra   - right ascension in H:M:S or decimal degrees [NOBJECT] 
   dec  - declination in D:M:S or decimal degrees [NOBJECT]

 OPTIONAL INPUTS:
   object  - name of object [NOBJECT]
   obsname - observatory name [default: KPNO]
   
 KEYWORD PARAMETERS:
   postscript    - generate postscript output for each object 
   bigpostscript - generate a single, large postscript file

 OUTPUTS:

 OPTIONAL OUTPUTS:

 COMMENTS:

 TODO:
   [1] Add an epoch keyword and to allow precession of
       coordinates.

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Nov 2, U of A - written
   jm02feb04uofa - generalized and documented
   jm04mar01uofa - cleaned up; OBJECT is now an optional input;
                   gzip postscript output 
   jm04nov07uofa - added PSNAME and BIGPOSTSCRIPT keywords;
                   documentation cleaned up
   jm05mar01uofa - added a check to see if the PS device has been
                   opened; this allows an airmass postscript file
                   to be opened by another routine
   jm09apr21nyu  - checks whether RA and DEC are already in degrees 

 Copyright (C) 2001-2002, 2004-2005, 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/airmass_plots.pro)</strong></p>
<hr />
<h3 id="ANGSTROM_F">ANGSTROM()</h3>
<p><a href="#AIRMASS_PLOTS">[Previous Routine]</a></p>
<p><a href="#ASINH_RANDOM_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ANGSTROM()
 PURPOSE:
   Render the Angstrom symbol on a plot.
 MODIFICATION HISTORY:
   J. Moustakas ???
</pre>
<p><strong>(See pro/plot/angstrom.pro)</strong></p>
<hr />
<h3 id="ASINH_RANDOM_F">ASINH_RANDOM()</h3>
<p><a href="#ANGSTROM_F">[Previous Routine]</a></p>
<p><a href="#ASTROCONST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ASINH_RANDOM()

 PURPOSE:
   Draw a random variate from an arc sine distribution.

 INPUTS: 
   x1, x2 - minimum, maximum values of the distribution 
   num - number of variates desired

 OPTIONAL INPUTS: 
   soft - softening parameter; describes the position at which the
     asinh() distribution transitions from linear to logarithmic

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   out - random variates [NUM]

 COMMENTS:
   Deals with multidimensional arrays, although it's pretty
   slow.  Could use better error checking.
 
 MODIFICATION HISTORY:
   J. Moustakas, 2011 Mar 08, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/asinh_random.pro)</strong></p>
<hr />
<h3 id="ASTROCONST_F">ASTROCONST()</h3>
<p><a href="#ASINH_RANDOM_F">[Previous Routine]</a></p>
<p><a href="#AYTRIANGLE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ASTROCONST()

 PURPOSE:
   Return a large number of astrophysics-related constants. 

 KEYWORD PARAMETERS: 
   mks - default is to return cgs units unless /MKS

 OUTPUTS: 
   c - data structure with all the constants you need

 COMMENTS:
   A_c	speed of light in a vacuum
   A_k	Boltzmann's constant
   A_G	universal gravitational constant
   A_me	mass of electron
   A_mp	mass of proton
   A_amu	atomic mass unit
   A_eV	electron volt
   A_h	Planck's constant
   A_hbar	Planck's constant /2pi
   A_e	electron charge (defined positive)
   A_mn	neutron mass
   A_mH	mass of Hydrogen atom
   A_pc	parsec
   A_msun	solar mass
   A_rsun	solar radius
   A_AU	astronomical unit
   A_ly	light year
   A_Lsun	solar luminosity
   A_mearth	mass of Earth
   A_rearth	radius of Earth
   A_AA	Angstrom
   A_Jy	Jansky
   A_rhoc	critical density /h^2
   A_sigma	Stefan-Boltzmann constant
   A_arad	radiation density constant
   A_sigmaT	Thomson cross-section
   A_re	classical electron radius
   A_a0	Bohr radius
   A_Wien	Wien displacement law constant
   A_alpha	fine structure constant
   A_NA	Avogadro's number
   A_yr	year
   A_tH	Hubble time *h
   A_Tsun	surface temperature of sun
   A_TCMB	cosmic microwave background temperature
   A_pi	trig constant pi
   A_exp	base of natural logarithm
   A_dsun	mean solar density
   A_dearth	mean Earth density
   A_gsun	solar surface gravity
   A_gearth	Earth surface gravity
   A_Vsun	solar V magnitude
   A_MVsun	solar absolute V magnitude
   A_Z0	characteristic impedance of vacuum
   A_eps0	permittivity of free space
   A_mu0	permeability of free space
   A_rmoon	lunar radius
   A_mmoon	lunar mass
   A_amoon	lunar orbital semi-major axis
   A_emoon	lunar orbital eccentricity

 MODIFICATION HISTORY:
   J. Moustakas, 2002 Aug 1, U of A - based almost entirely on
     Jeremy Bailin's astroconst.idl
</pre>
<p><strong>(See pro/misc/astroconst.pro)</strong></p>
<hr />
<h3 id="AYTRIANGLE_F">AYTRIANGLE()</h3>
<p><a href="#ASTROCONST_F">[Previous Routine]</a></p>
<p><a href="#BALMER_TEMPERATURE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   AYTRIANGLE()

 PURPOSE:
   Calculate zenith distance, hour angle, altitude, azimuth and
   parallactic angle for an object of a given RA and DEC on a given
   DATE at a known OBSERVATORY.    

 INPUTS:
   date - date of the observations in FITS standard string
     format, [YYYY-MM-DD] (e.g., date = '2002-02-10')
   ra - right ascension [decimal hours]
   dec - declination [decimal degrees]
   obs - observatory name (e.g., 'KPNO')

 OUTPUTS:
   The output data structure will contain
     .lst - local siderial time during the night [decimal hours]
     .ha  - hour angle [decimal hours]
     .alt - altitude [decimal degrees]
     .zd  - zenith distance [decimal degrees]
     .az  - azimuth [decimal degrees]
     .pangle - parallactic angle [decimal degrees]

 COMMENTS
   See Computational Spherical Astronomy (Taff, p.13-15). 

 MODIFICATION HISTORY
   John Moustakas, 2001 July 6, U of A
   jm09dec09ucsd - changed to a function and cleaned up

 Copyright (C) 2001, 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/aytriangle.pro)</strong></p>
<hr />
<h3 id="BALMER_TEMPERATURE_F">BALMER_TEMPERATURE()</h3>
<p><a href="#AYTRIANGLE_F">[Previous Routine]</a></p>
<p><a href="#BC03_GRID2FITS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       BALMER_TEMPERATURE()

 PURPOSE:
       Compute the temperature dependence of the Balmer decrement, as
       implemented in RETURN_TBALMER().

 CALLING SEQUENCE:
       data - balmer_temperature(npoly=,coeff_data=,/doplot)

 INPUTS:

 OPTIONAL INPUTS:
       npoly - order of the polynomial fit between temperature and
               the various Balmer decrements (default 2, quadratic) 

 KEYWORD PARAMETERS:
       doplot - generate debugging plots and wait for a keystroke 

 OUTPUTS:
       data - output data structure giving the interpolated Balmer
              decrements at the grid of temperatures

 OPTIONAL OUTPUTS:
       coeff_data - coefficients of the polynomial fits

 PROCEDURES USED:
       PLOTSYM, LEGEND, 

 COMMENTS:
       References: Storey &amp; Hummer (1995); Hummer &amp; Storey (1987);
       Brocklehurst (1971); Caplan &amp; Deharveng (1986)
    
       Coefficients from Brocklehurst (1971):    

          temp = [0.5,1.0,2.0]*1E4
          log_temp = alog(temp/1E4)
          
          hahb = [3.032,2.859,2.744]    ; [Ha/Hb]
          hghb = [0.4585,0.4685,0.4755] ; [Hg/Hb]
          hbhg = 1.0/hghb               ; [Hb/Hg]
          hahg = hahb/hghb              ; [Ha/Hg]
          hdhb = [0.2516,0.2591,0.2643] ; [Hd/Hb]
          hahd = hahb/hdhb              ; [Ha/Hd]

       Coefficients are from Storey &amp; Hummer (1995) for n_e =
       100/cm3. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 Aug 06 - written
       jm04jan22uofa - updated and generalized, converted to a
                       function
       jm04nov03uofa - documented and cleaned up

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/balmer_temperature.pro)</strong></p>
<hr />
<h3 id="BC03_GRID2FITS">BC03_GRID2FITS</h3>
<p><a href="#BALMER_TEMPERATURE_F">[Previous Routine]</a></p>
<p><a href="#BC03_MASSNORM_TEST">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       BC03_GRID2FITS

 PURPOSE:
       Convert BC03 data structures to individual FITS files with the
       option of writing error spectra.

 CALLING SEQUENCE:
       bc03_grid2fits, grid, fitsgrid, mgalaxy=, redshift=, $
          fwhmres=, starvdisp=, minwave=, maxwave=, specsnr=, snrwave=, $
          hbeta_ew=, ebv_gas=, dustratio=, outfile=, outpath=, /espectrum, $
          /wfits, _extra=extra

 INPUTS:
       grid - input data structure from IM_READ_BC03()

 OPTIONAL INPUTS:
       mgalaxy   - galaxy mass (default 1 M_sun) [M_sun]
       redshift  - galaxy redshift (default 0.0)
       fwhmres   - *observed* FWHM spectral resolution; must be
                   greater than or equal to 3*(1+redshift) [Angstrom] 
       starvdisp - stellar velocity dispersion (default 120) [km/s] 
       minwave   - *rest-frame* minimum wavelength [Angstrom]
       maxwave   - *rest-frame* maximum wavelength [Angstrom]
       specsnr   - *observed* signal-to-noise per resolution element; 
                   if provided then construct an error spectrum; in
                   addition, SNRWAVE must be specified 
       snrwave   - *observed* wavelength corresponding to SPECSNR
                   [Angstrom]
       hbeta_ew  - if ESPECTRUM=1 then scale the emission-line
                   spectrum to this EW(H-beta) (default 10.0); NB:
                   H-beta must be within the interval
                   [MINWAVE,MAXWAVE] +/- 50 Angstroms
       ebv_gas   - redden the emission-line spectrum (if ESPECTRUM=1)
                   by this amount [mag]
       dustratio - E(B-V)_stars/E(B-V)_gas; must be in the interval
                   [0,1], inclusive (default 1.0)
       outfile   - output file name (default
                   'bc03_'+AGESUFFIX+'.fits') 
       outpath   - output path name (default CWD)
       extra     - inputs for IM_CONSTRUCT_ESPECTRUM() and K_LAMBDA()

 KEYWORD PARAMETERS:
       espectrum - superpose a model emission-line spectrum (keywords
                   must be passed via _EXTRA)

 OUTPUTS:
       fitsgrid - output informational data structure

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       DLUMINOSITY(), IM_GAUSS_BROADEN(), GCONVOLVE(), MKHDR,
       SXDELPAR, SXADDPAR, IM_CONSTRUCT_ESPECTRUM(), MWRFITS, SPLOG,
       SPECTRAL_INDICES(), STRUCT_ADDTAGS(), K_LAMBDA() 

 COMMENTS:
    The wavelength vector is re-gridded to a uniform 1 Angstrom per
    pixel.  

 EXAMPLES:


 MODIFICATION HISTORY:
       J. Moustakas, 2004 Mar 01 - written
       jm04oct26uofa - totally re-written and expanded 
       jm05apr13uofa - various bug fixes; added DUSTRATIO optional
                       input 
       jm05may05uofa - also return the emission-line and continuum
                       spectra 

 Copyright (C) 2004-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/bc03_grid2fits.pro)</strong></p>
<hr />
<h3 id="BC03_MASSNORM_TEST">BC03_MASSNORM_TEST</h3>
<p><a href="#BC03_GRID2FITS">[Previous Routine]</a></p>
<p><a href="#BELL_MASS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BC03_MASSNORM_TEST

 PURPOSE:
   Build a QAplot to determine whether the BC03 templates need to be
   divided by the mstar in the .4color file.

 INPUTS: 

 KEYWORD PARAMETERS: 
   makemodels - build the BC03 models we need

 OUTPUTS: 
   The models and QAplot are written to the ${bc03_dir}/massnorm_test
   directory. 

 MODIFICATION HISTORY:
   J. Moustakas, 2004 Nov 16, U of A

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/bc03_massnorm_test.pro)</strong></p>
<hr />
<h3 id="BELL_MASS_F">BELL_MASS()</h3>
<p><a href="#BC03_MASSNORM_TEST">[Previous Routine]</a></p>
<p><a href="#BESSELL_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BELL_MASS()

 PURPOSE:
   Compute stellar mass-to-light ratios and stellar masses using
   the Bell et al. color-based method. 

 INPUTS:
   color  - photometric color (see METHOD)
   absmag - absolute magnitude (see METHOD)

 OPTIONAL INPUTS:
   method - technique to use, which also specifies COLOR and ABSMAG 
     1: B-V color, V-band luminosity
     2: B-R color, R-band luminosity
     3: ....

   color_err - uncertainty in COLOR
   absmag_err - uncertainty in ABSMAG

 KEYWORD PARAMETERS:
   log - return the logarithmic mass and error
   salpeter - convert the output to a Salpeter (1955) IMF (default is
     to use the diet Salpeter IMF)

 OUTPUTS:
   mass - stellar mass (M_sun)

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Jan 27, NYU - based on a earlier, crappy piece
     of code 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/bell_mass.pro)</strong></p>
<hr />
<h3 id="BESSELL_FILTERLIST_F">BESSELL_FILTERLIST()</h3>
<p><a href="#BELL_MASS_F">[Previous Routine]</a></p>
<p><a href="#BPT_DPHI_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BESSELL_FILTERLIST()
 PURPOSE:
   Return the Bessell filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Aug 14, UCSD
</pre>
<p><strong>(See pro/galaxy/bessell_filterlist.pro)</strong></p>
<hr />
<h3 id="BPT_DPHI_F">BPT_DPHI()</h3>
<p><a href="#BESSELL_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#BUILD_BASTI_SSP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BPT_DPHI()

 PURPOSE:
   Compute the BPT classification &quot;D&quot; and &quot;phi&quot; parameters of
   Kauffmann+03. 

 INPUTS: 
   niiha - logarithmic [NII]/Ha ratio
   oiiihb - logarithmic [OIII]/Hb ratio

 OUTPUTS: 
   d - Kauffmann's &quot;D&quot; parameter
   phi - Kauffmann's &quot;phi&quot; parameter

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Feb 24, NYU

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/bpt_dphi.pro)</strong></p>
<hr />
<h3 id="BUILD_BASTI_SSP">BUILD_BASTI_SSP</h3>
<p><a href="#BPT_DPHI_F">[Previous Routine]</a></p>
<p><a href="#BUILD_BC03_SSP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BUILD_BASTI_SSP

 PURPOSE:
   Generate a grid of BaSTI simple stellar populations (SSPs) to be
   to be used by ISEDFIT_MONTEGRIDS.

 INPUTS:

 KEYWORD PARAMETERS:
   enhanced - write out the alpha-enhanced models (default is to
     write out the solar-scaled models)
   doitall - generate all the combinations of IMFs and SSPs

 OUTPUTS:
   An information structure is written to getenv('ISEDFIT_SSP_DIR')
   and the models themselves are written to the appropriate 'basti'
   subdirectory. 

 COMMENTS:
   See http://albione.oa-teramo.inaf.it for additional relevant
   details.  The models downloaded are as of 2010-Nov.
 
   Only the Kroupa+01 IMF is available. 
   
   Uses the recommended default models with mass-loss parameter
   eta=0.4.  Also uses the low-resolution theoretical models, which
   have greater wavelength coverage, although in principle the
   high-resolution theoretical models could be incorporated as well.

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 24, UCSD
   jm13aug01siena - compute the number of Lyman continuum photons;
     added DOITALL keyword; additional minor tweaks

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/build_basti_ssp.pro)</strong></p>
<hr />
<h3 id="BUILD_BC03_SSP">BUILD_BC03_SSP</h3>
<p><a href="#BUILD_BASTI_SSP">[Previous Routine]</a></p>
<p><a href="#BUILD_FSPS_SSP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BUILD_BC03_SSP

 PURPOSE:
   Generate a grid of BC03 simple stellar populations (SSPs) to be
   to be used by ISEDFIT_MONTEGRIDS.

 INPUTS:

 KEYWORD PARAMETERS:
   chabrier - use the Chabrier+03 IMF (default is the Salpeter+55 IMF) 
   basel - use the low-resolution BC03 models based on the BaSeL
     stellar library (default is to use the high-resolution STELIB
     models) 
   doitall - generate all the combinations of IMFs and SSPs

 OUTPUTS:
   An information structure is written to getenv('ISEDFIT_SSP_DIR')
   and the models themselves are written to the appropriate 'bc03'
   subdirectory. 

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan  22, UCSD
   jm13aug01siena - compute the number of Lyman continuum photons;
     added DOITALL keyword; additional minor tweaks

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/build_bc03_ssp.pro)</strong></p>
<hr />
<h3 id="BUILD_FSPS_SSP">BUILD_FSPS_SSP</h3>
<p><a href="#BUILD_BC03_SSP">[Previous Routine]</a></p>
<p><a href="#BUILD_IGMTAU_GRID">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BUILD_FSPS_SSP

 PURPOSE:
   Generate a grid of FSPS simple stellar populations (SSPs)
   to be used by ISEDFIT_MONTEGRIDS.

 INPUTS:

 KEYWORD PARAMETERS:
   kroupa - use the Kroupa+01 IMF (default is the Salpeter IMF) 
   chabrier - use the Chabrier+03 IMF
   miles - read the MILES+BaSeL SSPs in lieu of the pure BaSeL SSPs
   doitall - generate all the combinations of IMFs and SSPs

 OUTPUTS:
   An information structure is written to getenv('ISEDFIT_SSP_DIR')
   and the models themselves are written to the appropriate 'fsps'
   subdirectory. 

 COMMENTS:
   If there are any updates to the FSPS models all you have to do is
   run this code with the /DOITALL keyword.

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 23, UCSD
   jm13aug01siena - added the FSPS version number and the SSP names
     to the output files since FSPS is under development; compute the
     number of Lyman continuum photons; added DOITALL keyword

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/build_fsps_ssp.pro)</strong></p>
<hr />
<h3 id="BUILD_IGMTAU_GRID">BUILD_IGMTAU_GRID</h3>
<p><a href="#BUILD_FSPS_SSP">[Previous Routine]</a></p>
<p><a href="#BUILD_MARASTON05_SSP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BUILD_IGMTAU_GRID

 PURPOSE:
   Build a lookup table of IGM attenuation as a function of
   wavelength and redshift. 

 INPUTS: 

 OUTPUTS: 
   Lookup table written to ${IMPRO_DIR}/etc

 EXAMPLES:
   Example of how to use the output:

      grid = mrdfits($IMPRO_DIR/etc/igmtau_grid.fits.gz',1)
      mywave = findgen(6000)+2000.0 ; [3000-8000 A]
      myz = [1.5,2.5,3.5,4.5]
      for jj = 0L, n_elements(myz)-1L do begin
         plot, mywave, interpolate(grid.igm,findex(grid.wave,mywave),$
           findex(grid.zgrid,myz[jj]),/grid), xsty=3, ysty=3
         cc = get_kbrd(1)
      endfor

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Feb 11, NYU
   jm09aug18ucsd - use a finer redshift and wavelength grid spacing 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/build_igmtau_grid.pro)</strong></p>
<hr />
<h3 id="BUILD_MARASTON05_SSP">BUILD_MARASTON05_SSP</h3>
<p><a href="#BUILD_IGMTAU_GRID">[Previous Routine]</a></p>
<p><a href="#BUILD_PEGASE_SSP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BUILD_MARASTON05_SSP

 PURPOSE:
   Generate a grid of Maraston+05 simple stellar populations (SSPs)
   to be used by ISEDFIT_MONTEGRIDS.

 INPUTS:

 KEYWORD PARAMETERS:
   kroupa - use the Kroupa+01 IMF (default is the Salpeter+05 IMF) 
   doitall - generate all the combinations of IMFs and SSPs

 OUTPUTS:
   An information structure is written to getenv('ISEDFIT_SSP_DIR')
   and the models themselves are written to the appropriate
   'maraston05' subdirectory.

 COMMENTS:
   Adopt the 'red horizontal branch' (rhb) morphology models. 

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 23, UCSD
   jm13aug01siena - compute the number of Lyman continuum photons;
     added DOITALL keyword; additional minor tweaks

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/build_maraston05_ssp.pro)</strong></p>
<hr />
<h3 id="BUILD_PEGASE_SSP">BUILD_PEGASE_SSP</h3>
<p><a href="#BUILD_MARASTON05_SSP">[Previous Routine]</a></p>
<p><a href="#CLASS_FLAGNAME">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   BUILD_PEGASE_SSP

 PURPOSE:
   Generate a grid of PEGASE simple stellar populations (SSPs)
   to be used by ISEDFIT_MONTEGRIDS.

 INPUTS:

 KEYWORD PARAMETERS:
   kroupa - use the Kroupa+01 IMF (default is the Salpeter IMF) 
   cosmic_imf - generate SSPs for my PRIMUS cosmic-IMF project 
   doitall - generate all the combinations of IMFs and SSPs

 OUTPUTS:
   An information structure is written to getenv('ISEDFIT_SSP_DIR')
   and the models themselves are written to the appropriate 'pegase'
   subdirectory. 

 COMMENTS:
   The code CREATE_PEGASE_SSPS needs to have been run.  The SSPs have
   been built using the BaSeL stellar library (without emission
   lines) with the additional free parameters in Pegase set to their 
   fiducial recommended values.  The highest stellar metallicity
   value (Z=0.01) is ignored.

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Mar 29, UCSD
   jm13aug01siena - compute the number of Lyman continuum photons;
     added DOITALL keyword; additional minor tweaks

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/build_pegase_ssp.pro)</strong></p>
<hr />
<h3 id="CLASS_FLAGNAME">CLASS_FLAGNAME</h3>
<p><a href="#BUILD_PEGASE_SSP">[Previous Routine]</a></p>
<p><a href="#CLASS_FLAGVAL">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   class_flagname

 PURPOSE:
   Return bitmask labels corresponding to bit numbers in support of
   ICLASSIFICATION. 

 CALLING SEQUENCE:
   label = class_flagname(flagprefix, flagvalue, [ /concat, /silent ] )

 INPUTS:
   flagprefix - Flag name (scalar string).  The following are supported:
                PIXMASK
   flagvalue  - Signed long with any number of its bits set.

 OPTIONAL KEYWORDS:
   concat     - If set, then concatenate all of the output labels in
                LABEL into a single whitespace-separated string.
   silent     - If set, then don't print a warning when there is no bit label
                corresponding to one of the bit values.

 OUTPUTS:
   label      - String name(s) corresponding to each non-zero bit in FLAGVALUE.

 OPTIONAL OUTPUTS:

 COMMENTS:
   This function is the inverse of CLASS_FLAGVAL().

 EXAMPLES:

 BUGS:

 PROCEDURES CALLED:
   splog
   yanny_free
   yanny_read

 DATA FILES:
   $IMPRO_DIR/etc/class_maskbits.par

 REVISION HISTORY:
   01-Apr-2002 Written by D. Schlegel, Princeton.
   29-Jul-2008 imported into IMPRO, Moustakas
</pre>
<p><strong>(See pro/metallicity/class_flagname.pro)</strong></p>
<hr />
<h3 id="CLASS_FLAGVAL">CLASS_FLAGVAL</h3>
<p><a href="#CLASS_FLAGNAME">[Previous Routine]</a></p>
<p><a href="#CLS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   class_flagval

 PURPOSE:
   Return bitmask values corresponding to labels in support of
   ICLASSIFICATION. 

 CALLING SEQUENCE:
   value = class_flagval(flagprefix, label)

 INPUTS:
   flagprefix - Flag name (scalar string)
   label      - String name(s) corresponding to each non-zero bit in FLAGVALUE.

 OPTIONAL KEYWORDS:
   /check     - checking if a good flag name, so don't abort if not

 OUTPUTS:
   value      - Signed long with any number of its bits set.

 COMMENTS:
   This function is the inverse of CLASS_FLAGNAME().

 PROCEDURES CALLED:
   splog
   yanny_free
   yanny_read

 DATA FILES:
   $IMPRO_DIR/etc/class_maskbits.par

 REVISION HISTORY:
   02-Apr-2002 Written by D. Schlegel, Princeton.
   29-Jul-2008 imported into IMPRO, Moustakas
</pre>
<p><strong>(See pro/metallicity/class_flagval.pro)</strong></p>
<hr />
<h3 id="CLS">CLS</h3>
<p><a href="#CLASS_FLAGVAL">[Previous Routine]</a></p>
<p><a href="#CMSET_OP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   CLS
 PURPOSE:
   Spawn the unix 'clear' command.
 MODIFICATION HISTORY:
   J. Moustakas, 2000 Sep 14, U of A
</pre>
<p><strong>(See pro/misc/cls.pro)</strong></p>
<hr />
<h3 id="CMSET_OP">CMSET_OP</h3>
<p><a href="#CLS">[Previous Routine]</a></p>
<p><a href="#COMPUTE_AIRMASS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   CMSET_OP

 AUTHOR:
   Craig B. Markwardt, NASA/GSFC Code 662, Greenbelt, MD 20770
   craigm@lheamail.gsfc.nasa.gov

 PURPOSE:
   Performs an AND, OR, or XOR operation between two sets

 CALLING SEQUENCE:
   SET      = CMSET_OP(A, OP, B)

 DESCRIPTION: 

   SET_OP performs three common operations between two sets.  The
   three supported functions of OP are:

        OP          Meaning
      'AND' - to find the intersection of A and B;
      'OR'  - to find the union of A and B;
      'XOR' - to find the those elements who are members of A or B 
              but not both;

   Sets as defined here are one dimensional arrays composed of
   numeric or string types.  Comparisons of equality between elements
   are done using the IDL EQ operator.

   The complements of either set can be taken as well, by using the
   NOT1 and NOT2 keywords.  For example, it may be desireable to find
   the elements in A but not B, or B but not A (they are different!).
   The following IDL expressions achieve each of those effects:

      SET = CMSET_OP(A, 'AND', /NOT2, B)   ; A but not B
      SET = CMSET_OP(/NOT1, A, 'AND', B)   ; B but not A

   Note the distinction between NOT1 and NOT2.  NOT1 refers to the
   first set (A) and NOT2 refers to the second (B).  Their ordered
   placement in the calling sequence is entirely optional, but the
   above ordering makes the logical meaning explicit.

   NOT1 and NOT2 can only be set for the 'AND' operator, and never
   simultaneously.  This is because the results of an operation with
   'OR' or 'XOR' and any combination of NOTs -- or with 'AND' and
   both NOTs -- formally cannot produce a defined result.

   The implementation depends on the type of operands.  For integer
   types, a fast technique using HISTOGRAM is used.  However, this
   algorithm becomes inefficient when the dynamic range in the data
   is large.  For those cases, and for other data types, a technique
   based on SORT() is used.  Thus the compute time should scale
   roughly as (A+B)*ALOG(A+B) or better, rather than (A*B) for the
   brute force approach.  For large arrays this is a significant
   benefit.

 INPUTS:

   A, B - the two sets to be operated on.  A one dimensional array of
          either numeric or string type.  A and B must be of the same
          type.  Empty sets are permitted, and are either represented
          as an undefined variable, or by setting EMPTY1 or EMPTY2.

   OP - a string, the operation to be performed.  Must be one of
        'AND', 'OR' or 'XOR' (lower or mixed case is permitted).
        Other operations will cause an error message to be produced.

 KEYWORDS:

   NOT1, NOT2 - if set and OP is 'AND', then the complement of A (for
                NOT1) or B (for NOT2) will be used in the operation.
                NOT1 and NOT2 cannot be set simultaneously.

   EMPTY1, EMPTY2 - if set, then A (for EMPTY1) or B (for EMPTY2) are
                    assumed to be the empty set.  The actual values
                    passed as A or B are then ignored.

   INDEX - if set, then return a list of indices instead of the array
           values themselves.  The &quot;slower&quot; set operations are always
           performed in this case.

           The indices refer to the *combined* array [A,B].  To
           clarify, in the following call: I = CMSET_OP(..., /INDEX);
           returned values from 0 to NA-1 refer to A[I], and values
           from NA to NA+NB-1 refer to B[I-NA].

   COUNT - upon return, the number of elements in the result set.
           This is only important when the result set is the empty
           set, in which case COUNT is set to zero.

 RETURNS:

   The resulting set as a one-dimensional array.  The set may be
   represented by either an array of data values (default), or an
   array of indices (if INDEX is set).  Duplicate elements, if any,
   are removed, and element order may not be preserved.

   The empty set is represented as a return value of -1L, and COUNT
   is set to zero.  Note that the only way to recognize the empty set
   is to examine COUNT.

 SEE ALSO:

   SET_UTILS.PRO by RSI

 MODIFICATION HISTORY:
   Written, CM, 23 Feb 2000
   Added empty set capability, CM, 25 Feb 2000
   Documentation clarification, CM 02 Mar 2000
   Incompatible but more consistent reworking of EMPTY keywords, CM,
     04 Mar 2000
   Minor documentation clarifications, CM, 26 Mar 2000
   Corrected bug in empty_arg special case, CM 06 Apr 2000
   Add INDEX keyword, CM 31 Jul 2000
   Clarify INDEX keyword documentation, CM 06 Sep 2000
   Made INDEX keyword always force SLOW_SET_OP, CM 06 Sep 2000
   Added CMSET_OP_UNIQ, and ability to select FIRST_UNIQUE or
     LAST_UNIQUE values, CM, 18 Sep 2000
   Removed FIRST_UNIQUE and LAST_UNIQUE, and streamlined
     CMSET_OP_UNIQ until problems with SORT can be understood, CM, 20
     Sep 2000 (thanks to Ben Tupper)
   Still trying to get documentation of INDEX and NOT right, CM, 28
     Sep 2000 (no code changes)
   Correct bug for AND case, when input sets A and B each only have
     one unique value, and the values are equal.  CM, 04 Mar 2004
     (thanks to James B. jbattat at cfa dot harvard dot edu)
   Add support for the cases where the input data types are mixed,
      but still compatible; also, attempt to return the same data
      type that was passed in; CM, 05 Feb 2005
   Fix bug in type checking (thanks to &quot;marit&quot;), CM, 10 Dec 2005
   Work around a stupidity in the built-in IDL HISTOGRAM routine,
      which tries to &quot;help&quot; you by restricting the MIN/MAX to the
      range of the input variable (thanks to Will Maddox), CM, 16 Jan 2006

  $Id: cmset_op.pro,v 1.6 2006/01/16 19:45:22 craigm Exp $

</pre>
<p><strong>(See pro/misc/cmset_op.pro)</strong></p>
<hr />
<h3 id="COMPUTE_AIRMASS_F">COMPUTE_AIRMASS()</h3>
<p><a href="#CMSET_OP">[Previous Routine]</a></p>
<p><a href="#COMPUTE_INCLINATION_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	COMPUTE_AIRMASS()

 PURPOSE:
	Compute the airmass of an observation.

 INPUTS:
	latitude - observatory latitude [decimal degrees]
	dec      - declination [decimal degrees]
	ha       - hour angle [decimal degrees]

 OUTPUTS:
	airmass  - airmass of the observation

 OPTIONAL OUTPUTS:
	zd       - zenith distance of the observation [degrees]

 COMMENTS:

 PROCEDURES USED:

 MODIFICATION HISTORY:
	J. Moustakas, 2002 Feb 13, U of A

 Copyright (C) 2002, 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/compute_airmass.pro)</strong></p>
<hr />
<h3 id="COMPUTE_INCLINATION_F">COMPUTE_INCLINATION()</h3>
<p><a href="#COMPUTE_AIRMASS_F">[Previous Routine]</a></p>
<p><a href="#COMPUTE_PARANGLE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   COMPUTE_INCLINATION()

 PURPOSE:
   Derive the inclination angle from the major-to-minor axis ratio of
   a galaxy.  

 INPUTS: 
   diam - input structure as returned by NED_WEBGET_DIAMETERS 

 KEYWORD PARAMETERS: 
   twomass - use the 2MASS diameters (default is to use RC3) 

 OUTPUTS: 
   incl - inclination angle, measured positive from North to East
     (degrees) 

 MODIFICATION HISTORY:
   J. Moustakas, 2006 Feb 16, U of A

 Copyright (C) 2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/compute_inclination.pro)</strong></p>
<hr />
<h3 id="COMPUTE_PARANGLE_F">COMPUTE_PARANGLE()</h3>
<p><a href="#COMPUTE_INCLINATION_F">[Previous Routine]</a></p>
<p><a href="#COMPUTE_REFRACTION_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	COMPUTE_PARANGLE()

 PURPOSE:
	Compute the parallactic angle.

 CALLING SEQUENCE:
	pa = compute_parangle(latitude,dec,ha)

 INPUTS:
	latitude - observatory latitude [decimal degrees]
	dec      - declination [decimal degrees]
	ha       - hour angle [decimal degrees]

 OUTPUTS:
	parangle - parallactic angle [degrees]

 COMMENTS:
	The parallactic angle is returned in the range [0-180]
	degrees. 

 EXAMPLE:

 PROCEDURES USED:

 MODIFICATION HISTORY:
	J. Moustakas, 2002 Feb 13, U of A
</pre>
<p><strong>(See pro/sky/compute_parangle.pro)</strong></p>
<hr />
<h3 id="COMPUTE_REFRACTION_F">COMPUTE_REFRACTION()</h3>
<p><a href="#COMPUTE_PARANGLE_F">[Previous Routine]</a></p>
<p><a href="#COMPUTE_SFRS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	COMPUTE_REFRACTION()

 PURPOSE:
	Compute the atmospheric refraction with respect to a reference
	wavelength at a given airmass.

 CALLING SEQUENCE:

 INPUTS:
	airmass - airmass of the observation

 OPTIONAL INPUTS:
	refwave - reference wavelength [Angstrom; default 5000]
	
 KEYWORD PARAMETERS:

 OUTPUTS:
	deltar  - predicted atmospheric refraction at AIRMASS relative
                 to REFWAVE over the wavelength range [3000,10000]
                 Angstrom

 OPTIONAL OUTPUTS:
	lambda  - wavelength vector at which the refraction was
                 computed

 COMMENTS:
	Reference: Filippenko 1982, PASP, 94, 715

 EXAMPLE:

 PROCEDURES USED:

 MODIFICATION HISTORY:
	J. Moustakas, 2002 Feb 18, U of A
</pre>
<p><strong>(See pro/sky/compute_refraction.pro)</strong></p>
<hr />
<h3 id="COMPUTE_SFRS_F">COMPUTE_SFRS()</h3>
<p><a href="#COMPUTE_REFRACTION_F">[Previous Routine]</a></p>
<p><a href="#CONVERT_TO_MAGGIES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       COMPUTE_SFRS()

 PURPOSE:
       Compute emission-line star-formation rates.  This routine must
       be called after COMPUTE_LINELUMS().  

 CALLING SEQUENCE:
       sfrs = compute_sfrs(linefit)

 INPUTS:
       linefit - can be a structure of either raw or
                 reddening-corrected fluxes

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:

 OUTPUTS:
       sfrs - 

 OPTIONAL OUTPUTS:

 PROCEDURES USED:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2005 Jan 07, U of A, excised from
          COMPUTE_LINELUMS() 
</pre>
<p><strong>(See pro/galaxy/compute_sfrs.pro)</strong></p>
<hr />
<h3 id="CONVERT_TO_MAGGIES_F">CONVERT_TO_MAGGIES()</h3>
<p><a href="#COMPUTE_SFRS_F">[Previous Routine]</a></p>
<p><a href="#COVAR2ELLIPSE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   CONVERT_TO_MAGGIES()

 PURPOSE:
   Convert magnitudes stored in a data structure to &quot;maggies&quot; for use
   with K-correct.

 INPUTS: 
   data - data structure containing the observed photometry and
          errors; for example, the structure might look like: [NGAL] 
      .B - B-band magnitude
      .V - V-band magnitude
      .R - R-band magnitude
      .B_err - corresponding uncertainty
      .V_err - corresponding uncertainty
      .R_err - corresponding uncertainty

   bands - tag names in DATA corresponding to the observed photometry
     (e.g., ['B','V','R']) [NBAND]

 OPTIONAL INPUTS: 
   vega2ab - conversion from Vega to AB (default 0.0); note that
     unless the photometry is already in AB, then you *must* give
     VEGA2AB values [NBAND]
   err_suffix - suffix to append to BANDS indicating the tag names of
     the magnitude *errors* (default '_err')

 KEYWORD PARAMETERS: 
   nanomaggies - convert the output 'maggies' and errors to
     nanomaggies 

 OUTPUTS: 
   maggies - maggies [NBAND,NGAL]

 OPTIONAL OUTPUTS:
   maggies_invvar - inverse variance corresponding to MAGGIES [NBAND,NGAL]
   mags           - input magnitudes [NBAND,NGAL]
   err_mags       - corresponding uncertainties [NBAND,NGAL]
   ivar_mags      - corresponding inverse variances [NBAND,NGAL]
   badvalue       - value indicating a null measurement on input and
     output; for some stupid reason this should be a negative value;
     (default -999.0) 

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Aug 04, U of A - written
   jm06sep15nyu - added MAGS (AB) and ERR_MAGS outputs
   jm08aug11nyu - documented

 Copyright (C) 2005, 2006, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/convert_to_maggies.pro)</strong></p>
<hr />
<h3 id="COVAR2ELLIPSE_F">COVAR2ELLIPSE()</h3>
<p><a href="#CONVERT_TO_MAGGIES_F">[Previous Routine]</a></p>
<p><a href="#CREATE_PEGASE_SSPS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   COVAR2ELLIPSE()

 PURPOSE:
   Given a 2D covariance matrix, compute the parameters of the
   confidence ellipse.

 INPUTS: 
   covar - 2D covariance matrix

 OPTIONAL INPUTS: 
   nsigma - desired confidence interval; default is 1-sigma 

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   ellipse - data structure containing the parameters of the ellipse 

 OPTIONAL OUTPUTS:

 COMMENTS:
   Based entirely on D. Coe's beautiful Fisher-matrix
   write-up, astro-ph/0906.3123. 

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Jul 09, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/covar2ellipse.pro)</strong></p>
<hr />
<h3 id="CREATE_PEGASE_SSPS">CREATE_PEGASE_SSPS</h3>
<p><a href="#COVAR2ELLIPSE_F">[Previous Routine]</a></p>
<p><a href="#CWD_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   CREATE_PEGASE_SSPS

 PURPOSE:
   Pegase does not come with any SSPs, so build a standard set for a
   variety of IMFs.  Use IM_READ_PEGASE() to read these files. 

 INPUTS: 

 KEYWORD PARAMETERS: 
   cosmic_imf - generate SSPs for my PRIMUS cosmic-IMF project 

 OUTPUTS: 

 COMMENTS:
   To change the ages.dat file (must be integers!)
      pushd, '$PEGASE_HR_DIR/data/user_defined/'
      ages = round([0D,range(1D,15D3,149,/log)])
      ages = ages[uniq(ages)]
      openw, lun, 'ages.dat', /get_lun
      for ii = 0, n_elements(ages)-1 do printf, lun, ages[ii]
      free_lun, lun
 
   For now do not include nebular emission, but that is on my ToDo
   list. 

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Mar 29, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/create_pegase_ssps.pro)</strong></p>
<hr />
<h3 id="CWD_F">CWD()</h3>
<p><a href="#CREATE_PEGASE_SSPS">[Previous Routine]</a></p>
<p><a href="#DEEP2_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   CWD()
 PURPOSE:
   Return the current working directory.
 MODIFICATION HISTORY:
   J. Moustakas, 2002 Jan 21, U of A
</pre>
<p><strong>(See pro/misc/cwd.pro)</strong></p>
<hr />
<h3 id="DEEP2_FILTERLIST_F">DEEP2_FILTERLIST()</h3>
<p><a href="#CWD_F">[Previous Routine]</a></p>
<p><a href="#DEEP2_TO_MAGGIES">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   DEEP2_FILTERLIST()
 PURPOSE:
   Return the DEEP2 filters in the extended photometric catalog of
   Matthews et al. (2013).
 MODIFICATION HISTORY:
   J. Moustakas, 2013 Jul 14, Siena
</pre>
<p><strong>(See pro/galaxy/deep2_filterlist.pro)</strong></p>
<hr />
<h3 id="DEEP2_TO_MAGGIES">DEEP2_TO_MAGGIES</h3>
<p><a href="#DEEP2_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#DISPLAY_DSS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   DEEP2_TO_MAGGIES

 PURPOSE:
   Convert the DEEP2 extended galaxy photometry (from Matthews et
   al. 2013) to AB maggies. 

 INPUTS: 
   cat - input photometric catalog [NGAL] 

 KEYWORD PARAMETERS:

 OUTPUTS: 
   maggies - output maggies [8,NGAL]
   ivarmaggies - corresponding inverse variance array [8,NGAL]  

 COMMENTS:
   A minimum error of 0.02 mag is applied to every bandpass. 

 MODIFICATION HISTORY:
   J. Moustakas, 2013 Jul 14, Siena

 Copyright (C) 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/deep2_to_maggies.pro)</strong></p>
<hr />
<h3 id="DISPLAY_DSS">DISPLAY_DSS</h3>
<p><a href="#DEEP2_TO_MAGGIES">[Previous Routine]</a></p>
<p><a href="#DKBOXSTATS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   DISPLAY_DSS

 PURPOSE:
   Bone-simple script to render an image.

 INPUTS: 
   image - input FITS file name *or* input 2D image 

 OPTIONAL INPUTS: 
   heaader - corresponding image header
   outfile - output file name (default 'dss_object.png')
   title - image title

 KEYWORD PARAMETERS: 
   write - screen capture the result and write out a PNG file 

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:
   Only works on one image at a time.

 MODIFICATION HISTORY:
   J. Moustakas, 2002 Dec 11, U of A
   jm11aug08ucsd - documented

 Copyright (C) 2002, 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/display_dss.pro)</strong></p>
<hr />
<h3 id="DKBOXSTATS_F">DKBOXSTATS()</h3>
<p><a href="#DISPLAY_DSS">[Previous Routine]</a></p>
<p><a href="#DS9POLYGON_INDICES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	DKBOXSTATS()

 PURPOSE:
	To take a one or two dimensional array and return each pixel
	by either the minimum, maximum, mean, median, total (sum), or
	product of the pixels in a rectangular box of size
	[XWIDTH,YWIDTH] centered on that pixel.

 CALLING SEQUENCE:
	outarray = dkboxstats(array,[xwidth=],[ywidth=],[boxstat=])

 INPUTS:
	array   - one or two dimensional array

 OPTIONAL INPUTS:
	xwidth  - 
	ywidth  - 
	boxstat - 
       extra   - rejection parameter keywords for DJSIG() 
	
 KEYWORD PARAMETERS:

 OUTPUTS:
	outarray - output array

 COMMENTS:
	Edges are not handled correctly (add a MISSING keyword?).

       Assume that when computing the median statistics that the
       array has been passed as sorted.

 EXAMPLE:

 PROCEDURES USED:
	MIN(), MAX(), DJS_MEAN(), DJS_MEDIAN(), TOTAL(), PRODUCT(),
	DJSIG()

 MODIFICATION HISTORY:
	J. Moustakas, 2001 October 29, U of A
       jm02nov15uofa - added TOTAL and PRODUCT statistics
       jm04jan22uofa - added SIGMA statistics
       jm04jul13uofa - when computing the median in one dimension
                       also return the lower and upper one-sigma 

 Copyright (C) 2001-2002, 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/dkboxstats.pro)</strong></p>
<hr />
<h3 id="DS9POLYGON_INDICES_F">DS9POLYGON_INDICES()</h3>
<p><a href="#DKBOXSTATS_F">[Previous Routine]</a></p>
<p><a href="#DUST_CORRECT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   DS9POLYGON_INDICES()

 PURPOSE:
   Convert a ds9 &quot;polygon&quot; regions file into a list of pixel indices
   enclosed by that polygon; basically a wrapper on POLYFILLV.
   Handles both image and celestial coordinates.

 INPUTS:
   regionsfile - ds9 style polygon region file (.reg)

 OPTIONAL INPUTS:
   [x,y]size - size of the image from which REGIONSFILE was produced
     along the x- and y-dimensions [pixels] 
                      OR
   header - FITS header corresponding to the image from which
     REGIONSFILE was produced 
	
 KEYWORD PARAMETERS:
   inverse - return the indices of the pixels *outside* the mask 

 OUTPUTS:
   indices - indices of the pixels enclosed by the polygon

 OUTPUTS:
   xvert, yvert - X and Y vertices (pixels)

 COMMENTS:
   If the regions file is in celestial (ra,dec) coordinates then the
   (astrometrically complete) FITS header is REQUIRED.  
 
   If both [X,Y]SIZE and HEADER are given then HEADER takes
   precedence.  

  The regions file should contain just one polygon.  (Multiple
  polygons are not supported because each would in principle contain
  a different number of indices; better to just call this routine
  repeatedly.) 

 EXAMPLE:

 MODIFICATION HISTORY:
   John Moustakas, 2013 May 29, Siena

 Copyright (C) 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/ds9polygon_indices.pro)</strong></p>
<hr />
<h3 id="DUST_CORRECT_F">DUST_CORRECT()</h3>
<p><a href="#DS9POLYGON_INDICES_F">[Previous Routine]</a></p>
<p><a href="#EMISSION_MASK_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   DUST_CORRECT()

 PURPOSE:
   Correct a line flux measurement for dust extinction.  

 INPUTS:
   lineflux  - emission line flux [NFLUX]
   linewave  - emission line wavelength (scalar or [NFLUX] array)

 OPTIONAL INPUTS:
   decrement     - Balmer decrement (H-alpha/H-beta or
                   H-alpha/H-gamma) [NFLUX]
   err_decrement - corresponding error in DECREMENT [NFLUX]
   ebv           - color excess E(B-V) [NFLUX]
   err_ebv       - corresponding error in EBV [NFLUX]

 KEYWORD PARAMETERS:
   extra         - keywords for GET_EBV() and K_LAMBDA() 

 OUTPUTS:
   newflux       - extinction-corrected LINEFLUX [NFLUX]

 OPTIONAL OUTPUTS:
   err_newflux   - if either ERR_DECREMENT or ERR_EBV are passed 
                   then compute the error in NEWFLUX [NFLUX]

 COMMENTS:
   If both DECREMENT and EBV are passed then DECREMENT is used to
   calculate and overwrite EBV.

 PROCEDURES USED:
   GET_EBV(), K_LAMBDA(), SPLOG

 EXAMPLE:

 MODIFICATION HISTORY:
   J. Moustakas, 2002 May 28, U of A
   jm04jul08uofa - bug fix in returning EBV_ERR from GET_EBV();
                   variable name shuffle

 Copyright (C) 2002, 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/dust_correct.pro)</strong></p>
<hr />
<h3 id="EMISSION_MASK_F">EMISSION_MASK()</h3>
<p><a href="#DUST_CORRECT_F">[Previous Routine]</a></p>
<p><a href="#FINDEX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       EMISSION_MASK()

 PURPOSE:
       Mask optical nebular emission lines.

 INPUTS:
       wave  - wavelength vector [Angstrom]

 OPTIONAL INPUTS:
       z         - dimensionless redshift
       width     - width of the mask around each emission line
                   [Angstrom] (default 15.0)
       bluewidth - width of the mask around each blue emission line  
                   [Angstrom] (default 5.0); only used if BLUEMASK=1 
       abswidth  - width of the mask around strong absorption lines
                   [Angstrom] (default 10.0); only used if ABSMASK=1 
       spectrum  - spectrum corresponding to WAVE
       ivarspectrum - inverse variance spectrum corresponding to WAVE
       linelist  - *rest* wavelengths of nebular lines to mask 
       sigrej_cosmic - rejection threshold if COSMIC=1
       extra     - keywords for DJS_ITERSTAT

 KEYWORD PARAMETERS:
       telluric  - flag wavelengths corresponding to telluric
                   absorption lines in MASK
       cosmic    - attempt to identify and flag cosmic rays (deviant
                   pixels) in SPECTRUM and add them to MASK 
       negative  - mask pixels that are negative
       bluemask  - mask the high-order Balmer lines in the blue part
                   of the optical spectrum
       absmask   - mask strong absorption lines
       noskymask - do not mask sky wavelengths 
       qsomask   - mask QSO lines
       gauss     - fit a Gaussian to each nebular line and mask
                   within 3-sigma (overides WIDTH and requires
                   SPECTRUM and IVARSPECTRUM)

 OUTPUTS:
       mask  - pixel mask for WAVE (1B is good and 0B is bad)

 OPTIONAL OUTPUTS:
       good  - indices in WAVE that have not been masked
       bad   - indices in WAVE that have been masked

 COMMENTS:

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 April 8, U of A
       jm03nov27uofa - made TELLURIC_MASK() its own function 
       jm04jan05uofa - added NEGATIVE keyword
       jm04jan14uofa - also mask sky wavelengths
       jm04may13uofa - added BLUEMASK keyword
       jm05jan28uofa - added BLUEWIDTH optional input; mask the blue
                       lines by a smaller amount relative to the
                       other lines
       jm05aug02uofa - added NOSKYMASK keyword
       jm06feb08uofa - added SIGREJ_COSMIC optional input
       jm06feb16uofa - added QSOMASK keyword
       jm07mar02nyu  - added QMASK optional output and added more QSO
                       emission-line wavelengths 
       jm07sep29nyu  - added ABSMASK and ABSWIDTH keywords 
       jm09jan24nyu  - added LINELIST and IVARSPECTRUM optional
                       inputs and GAUSS keyword 

 Copyright (C) 2002-2005, 2007, 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/emission_mask.pro)</strong></p>
<hr />
<h3 id="FINDEX">FINDEX</h3>
<p><a href="#EMISSION_MASK_F">[Previous Routine]</a></p>
<p><a href="#FIND_DIFFS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:  
   findex

 PURPOSE:  
   Compute &quot;floating point index&quot; into a table for use with
   INTERPOLATE.

 USEAGE:   
   result = findex(u,v)

 INPUT:    
   u       a monitically increasing or decreasing 1-D grid
   v       a scalor, or array of values

 OUTPUT:
   result  Floating point index. Integer part of RESULT(i) gives
           the index into to U such that V(i) is between
           U(RESULT(i)) and U(RESULT(i)+1).  The fractional part
           is the weighting factor

                          V(i)-U(RESULT(i))
                          ---------------------
                     U(RESULT(i)+1)-U(RESULT(i))


 DISCUSSION: 
           This routine is used to expedite one dimensional
           interpolation on irregular 1-d grids.  Using this routine
           with INTERPOLATE is much faster then IDL's INTERPOL
           procedure because it uses a binary instead of linear
           search algorithm.  The speedup is even more dramatic when
           the same independent variable (V) and grid (U) are used
           for several dependent variable interpolations.

  
 EXAMPLE:  

; In this example I found the FINDEX + INTERPOLATE combination
; to be about 60 times faster then INTERPOL.

  u=randomu(iseed,200000) &amp; u=u(sort(u))
  v=randomu(iseed,10)     &amp; v=v(sort(v))
  y=randomu(iseed,200000) &amp; y=y(sort(y))

  t=systime(1) &amp; y1=interpolate(y,findex(u,v)) &amp; print,systime(1)-t
  t=systime(1) &amp; y2=interpol(y,u,v)            &amp; print,systime(1)-t
  print,f='(3(a,10f7.4/))','findex:   ',y1,'interpol: ',y2,'diff:     ',y1-y2

 AUTHOR:   Paul Ricchiazzi                        21 Feb 97
           Institute for Computational Earth System Science
           University of California, Santa Barbara
           paul@icess.ucsb.edu

 REVISIONS:
</pre>
<p><strong>(See pro/misc/findex.pro)</strong></p>
<hr />
<h3 id="FIND_DIFFS_F">FIND_DIFFS()</h3>
<p><a href="#FINDEX">[Previous Routine]</a></p>
<p><a href="#FITS2IMH">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   FIND_DIFFS()

 PURPOSE:
   Find all differences of a vector X, or between two vectors X and
   Y. 

 INPUTS: 
   x - input vector

 OPTIONAL INPUTS: 
   y - optional second input vector

 OUTPUTS: 
   diffs - differences within X or between X and Y

 COMMENTS:
   Slow and dumb; should use HISTOGRAM().

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Jul 23, U of A

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/find_diffs.pro)</strong></p>
<hr />
<h3 id="FITS2IMH">FITS2IMH</h3>
<p><a href="#FIND_DIFFS_F">[Previous Routine]</a></p>
<p><a href="#FITSDATE2JD_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	FITS2IMH

 PURPOSE:
	Convert a list of fits files to IRAF format.

 INPUTS:
	file_list : text file with the files, one per line, to be
		    converted 

 KEYWORD PARAMETERS:

 OUTPUTS:

 PROCEDURES USED:
	RDTXT(), READFITS(), IRAFWRT

 MODIFICATION HISTORY:
	John Moustakas, 2000 February 8, UCB

 Copyright (C) 2000, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/fits2imh.pro)</strong></p>
<hr />
<h3 id="FITSDATE2JD_F">FITSDATE2JD()</h3>
<p><a href="#FITS2IMH">[Previous Routine]</a></p>
<p><a href="#FLAM_UNITS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   FITSDATE2JD()

 PURPOSE:
   Convert FITS format date to Julian date.

 INPUTS: 
   date - FITS-format date (YYYY-MM-DD)

 OUTPUTS: 
   jd - input Julian date

 MODIFICATION HISTORY:
   J. Moustakas, 2003 Apr 23, U of A

 Copyright (C) 2002, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/fitsdate2jd.pro)</strong></p>
<hr />
<h3 id="FLAM_UNITS_F">FLAM_UNITS()</h3>
<p><a href="#FITSDATE2JD_F">[Previous Routine]</a></p>
<p><a href="#FLOW_DISTANCE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   FLAM_UNITS()
 PURPOSE:
   Return a clean title for flux density.
 MODIFICATION HISTORY:
   J. Moustakas ???
</pre>
<p><strong>(See pro/plot/flam_units.pro)</strong></p>
<hr />
<h3 id="FLOW_DISTANCE_F">FLOW_DISTANCE()</h3>
<p><a href="#FLAM_UNITS_F">[Previous Routine]</a></p>
<p><a href="#FNU_UNITS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       FLOW_DISTANCE()

 PURPOSE:
       Return Virgo-centric infall galaxy distances based on both the
       Tully (1988) calculations and the Kraan-Korteweg (1986)
       calculations. 

 CALLING SEQUENCE:
       result = flow_distance(ra,dec,H0=,searchradius=,$
          galaxy=,/silent)

 INPUTS:
       ra     - right ascension (J2000) [NOBJ]
       dec    - declination (J2000) [NOBJ]

 OPTIONAL INPUTS:
       H0           - Hubble constant (default 70) [km/s/Mpc]
       searchradius - search radius (default: 60) [arcsec]
       galaxy       - galaxy name (copied into RESULT)

 KEYWORD PARAMETERS:
       silent - do not print messages to STDOUT

 OUTPUTS:
       result - data structure with the following fields:
          galaxy:        input galaxy name (if provided)
          ra:            input RA
          dec:           input DEC
          tully_galaxy:  galaxy name in the Tully catalog
          tully_dist:    distance in the Tully catalog [Mpc]
          tully_match:   matching distance [arcsec]
          kraan_galaxy:  galaxy name in the Kraan-Korteweg catalog 
          kraan_dist:    distance in the Kraan-Korteweg catalog [Mpc] 
          kraan_match:   matching distance [arcsec]

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       IM_HMS2DEC(), READ_88TULLY(), READ_KRAAN(), IM_DJS_ANGLE_MATCH() 

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 December 10, U of A
       jm05feb24uofa - cleaned up the code and documentation 

 Copyright (C) 2002-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/flow_distance.pro)</strong></p>
<hr />
<h3 id="FNU_UNITS_F">FNU_UNITS()</h3>
<p><a href="#FLOW_DISTANCE_F">[Previous Routine]</a></p>
<p><a href="#FORMAT_FLUX_ERROR">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   FNU_UNITS()
 PURPOSE:
   Return a clean title for flux density.
 MODIFICATION HISTORY:
   J. Moustakas ???
</pre>
<p><strong>(See pro/plot/fnu_units.pro)</strong></p>
<hr />
<h3 id="FORMAT_FLUX_ERROR">FORMAT_FLUX_ERROR</h3>
<p><a href="#FNU_UNITS_F">[Previous Routine]</a></p>
<p><a href="#GALEX_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   FORMAT_FLUX_ERROR

 PURPOSE:
   Silly routine to truncate a vector to the correct number of
   significant digits, given the uncertainty on that measurement. 

 INPUTS: 
   flux - input vector (of any kind, not necessarily flux)
   ferr - error on FLUX

 OPTIONAL INPUTS: 
   sigfigs - if the uncertainty is identically zero (e.g., a tied
     parameter) then format FLUX to have SIGFIGS significant digits
     (e.g., 10.65362 with SIGFIGS=4 becomes '10.65') (default 4)

 OUTPUTS: 
   newflux - string output with correct number of significant digits 
   newferr - corresponding string error on NEWFLUX

 COMMENTS:
   This should be generalized and expanded, but it's right and
   it works. 

 MODIFICATION HISTORY:
   J. Moustakas, 2004 Apr 22, U of A
   jm05jul26uofa - vectorized
   jm12jan12ucsd - added SIGFIGS optional input

 Copyright (C) 2004-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/format_flux_error.pro)</strong></p>
<hr />
<h3 id="GALEX_FILTERLIST_F">GALEX_FILTERLIST()</h3>
<p><a href="#FORMAT_FLUX_ERROR">[Previous Routine]</a></p>
<p><a href="#GANG_PLOT_POS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GALEX_FILTERLIST()
 PURPOSE:
   Return the GALEX filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Oct 30, UCSD
</pre>
<p><strong>(See pro/galaxy/galex_filterlist.pro)</strong></p>
<hr />
<h3 id="GANG_PLOT_POS">GANG_PLOT_POS</h3>
<p><a href="#GALEX_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#GAUSSCONV">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
  GANG_PLOT_POS

 PURPOSE:
  Simplify abutting multiple plots.

 CATEGORY:

  Plotting.

 CALLING SEQUENCE:

  struct=gang_plot_pos(nrow,ncol,col,row, [XTICKFORMAT=,YTICKFORMAT=,
                       OFFSET=,SIZE=, /POSITION_ONLY]

 INPUTS:

  nrow: The number of rows of plots to abut.

  ncol: The number of columns of plots to abut.

  col_ind: The column index starting at 0, or, if row isn't passed,
    the 1D index in the grid [0 .. ncol*nrow-1].

 OPTIONAL INPUTS:

  row: The row index starting at 0.

 KEYWORD PARAMETERS:

  (X|Y)TICKFORMAT: Format of tick labeling used (if different from
    IDL's default).  Note that tick labels will be placed on the
    bottom and left of the plot only.

  OFFSET: The normalized offset of the lower left plot ([0.1,0.1] by default)

  SIZE: The normalized x and y size of the region in which the plots
    should be positioned. (default [0.8,0.85] for default offset).

  POSITION_ONLY: If set, the position will be returned rather than a
    full _EXTRA structure.

 OUTPUTS:

  struct: A structure in the form of EXTRA structure for keyword
    inheritence, which can be passed directly to plot and will set
    the tick labelling correctly (see example).

 RESTRICTIONS: 
 
  With the _EXTRA type format, the plot is not erased, so may need
  to issue ERASE beforehand to clean the screen.

 EXAMPLE:
   
  Gang two plots vertically:
  plot,findgen(10),  _EXTRA=gang_plot_pos(2,1,0)
  plot,findgen(10)^2,_EXTRA=gang_plot_pos(2,1,1)

  Gang 3x3 plots:

   for c=0,2 do for r=0,2 do $
     plot,findgen(10)^(float(c+3*r)/5),YRANGE=[0,9.^(((r+1)*3-1)/5.)],
          _EXTRA=gang_plot_pos(3,3,c,r)

 MODIFICATION HISTORY:

  Feb 7, 2006, J.D. Smith: Written

</pre>
<p><strong>(See pro/plot/gang_plot_pos.pro)</strong></p>
<hr />
<h3 id="GAUSSCONV">GAUSSCONV</h3>
<p><a href="#GANG_PLOT_POS">[Previous Routine]</a></p>
<p><a href="#GETCR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	GAUSSCONV

 PURPOSE:
	Convolve an image with a Gaussian kernal using Fourier
	transforms. 

 INPUTS:
	img - two-dimensional image

 OPTIONAL INPUTS:
	fwhm - FWHM (= 2.35*sigma) of the Gaussian kernal (default: 3
              pixels) 
	npix - size of the Gaussian kernal in one dimension (default:
              5*FWHM) 

 OUTPUTS:
	An image of the same dimensions as img.

 PROCEDURES USED:
	CONVOLVE() (Goddard library - uses Fourier convolution)

 MODIFICATION HISTORY:
	lam98nov01ucb
	jm01may25uofa - documented and changed to Fourier-transform
                       convolution 
</pre>
<p><strong>(See pro/image/gaussconv.pro)</strong></p>
<hr />
<h3 id="GETCR_F">GETCR()</h3>
<p><a href="#GAUSSCONV">[Previous Routine]</a></p>
<p><a href="#GET_EBV_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GETCR()
 PURPOSE:
   Return a string carriage return.
 MODIFICATION HISTORY:
   J. Moustakas ???
</pre>
<p><strong>(See pro/plot/getcr.pro)</strong></p>
<hr />
<h3 id="GET_EBV_F">GET_EBV()</h3>
<p><a href="#GETCR_F">[Previous Routine]</a></p>
<p><a href="#GET_ELEMENT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       GET_EBV()

 PURPOSE:
       Get E(B-V) from the Balmer decrement and an extinction curve. 

 INPUTS:
       decrement - the observed Balmer decrement, for example,
                   F(H-alpha)/F(H-beta)  

 OPTIONAL INPUTS:
       decrement_err - error in DECREMENT
       temperature   - temperature used to derive the intrinsic
                       Balmer decrement [K] (default 10000)
       use_hahb      - instead of the default 2.86, use this
                       intrinsic Ha/Hb ratio; useful for, e.g., AGN,
                       for which Ha/Hb is 3.1

 KEYWORD PARAMETERS:
       HaHb  - de-redden using the H-alpha/H-beta line ratio
               (default) 
       HbHg  - de-redden using the H-beta/H-gamma line ratio
       HaHg  - de-redden using the H-alpha/H-gamma line ratio
       extra - keywords for K_LAMBDA()

 OUTPUTS:
       ebv - color excess E(B-V) [mag]

 OPTIONAL OUTPUTS:
       ebv_err   - error in EBV [mag]
       color     - color excess = -2.5 log (R_int/R_obs), computed
                   directly from the observed and intrinsic decrement
                   [mag] 
       err_color - error in COLOR [mag]

 COMMENTS:

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 May 28, U of A - written
       jm02nov6uofa  - added K_LAMBDA() compatibility
       jm03jun13uofa - added HGAMMA keyword
       jm03aug06uofa - added temperature dependence on the Balmer
                       decrement and HBETA keyword
       jm04nov03uofa - removed HGAMMA and HBETA keywords in favor of
                       HaHb, HaHg, and HbHg keywords
       jm05feb03uofa - if no temperature is given, then compute the
                       error in R_int, otherwise assume the error is
                       zero; return COLOR and ERR_COLOR keywords 
       jm08feb06nyu  - added USE_HAHB optional input

 Copyright (C) 2002-2005, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/get_ebv.pro)</strong></p>
<hr />
<h3 id="GET_ELEMENT">GET_ELEMENT</h3>
<p><a href="#GET_EBV_F">[Previous Routine]</a></p>
<p><a href="#GET_ELLIPSE_INDICES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_ELEMENT

 PURPOSE:
   Compute the index of a value, given an input array.

 INPUTS: 
   x - input vector
   value - input value (can be an array)

 OUTPUTS: 
   position - index or indices of VALUE in X

 COMMENTS:
   This routine is pretty silly.

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Jan 28, U of A

 Copyright (C) 2001, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/get_element.pro)</strong></p>
<hr />
<h3 id="GET_ELLIPSE_INDICES_F">GET_ELLIPSE_INDICES()</h3>
<p><a href="#GET_ELEMENT">[Previous Routine]</a></p>
<p><a href="#GET_LUNAR_BRIGHTNESS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_ELLIPSE_INDICES()

 PURPOSE:
   Identify the elements lying inside a given ellipse.

 INPUTS: 
   x, y - input values

 OPTIONAL INPUTS: 
   major, minor - axis lengths in the same units as X,Y (default 1.0) 
   angle - angle of the ellipse, measured counter-clockwise from the
     X axis (default 0)
   xcenter, ycenter - origin of the ellipse (default 0)

 KEYWORD PARAMETERS: 
   debug - make a simple debugging plot

 OUTPUTS: 
   indx - indices of X,Y values lying inside the specified ellipse 

 COMMENTS:
   This routine can be used in tandem with the output of
   COVAR2ELLIPSE(). 

   The angle is defined as in TVELLIPSE.  Portions of the algorithm
   were taken from DIST_ELLIPSE.

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Jul 09, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/get_ellipse_indices.pro)</strong></p>
<hr />
<h3 id="GET_LUNAR_BRIGHTNESS_F">GET_LUNAR_BRIGHTNESS()</h3>
<p><a href="#GET_ELLIPSE_INDICES_F">[Previous Routine]</a></p>
<p><a href="#GET_MANGLE_AREA_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_LUNAR_BRIGHTNESS()

 PURPOSE:
   Compute the surface brightness of the Moon [mag/arcsec2] as a
   function of lunar age.

 INPUTS: 
   age - lunar age (days)

 OUTPUTS: 
   lunar - output data structure with the UBVRI surface brightness 

 COMMENTS:
   Based on http://www.astro.utoronto.ca/~patton/astro/mags.html

 MODIFICATION HISTORY:
   J. Moustakas, 2004 Mar 04, U of A

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/get_lunar_brightness.pro)</strong></p>
<hr />
<h3 id="GET_MANGLE_AREA_F">GET_MANGLE_AREA()</h3>
<p><a href="#GET_LUNAR_BRIGHTNESS_F">[Previous Routine]</a></p>
<p><a href="#GET_MJDSTR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_MANGLE_AREA()

 PURPOSE:
   Compute the total area of a set of mangle polygons. 

 INPUTS: 
   polyfile - polygon file name

 KEYWORD PARAMETERS: 
   deg - convert AREA to deg^2

 OUTPUTS: 
   area - total area in steradians, unless /DEG 

 COMMENTS:
   Loosely based on K. Wong's PRIMUS_SURVEY_AREA.

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Sep 10, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/get_mangle_area.pro)</strong></p>
<hr />
<h3 id="GET_MJDSTR_F">GET_MJDSTR()</h3>
<p><a href="#GET_MANGLE_AREA_F">[Previous Routine]</a></p>
<p><a href="#GET_PWD_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_MJDSTR()
 PURPOSE:
   Return the current modified Julian date (MJD).
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 11, NYU
</pre>
<p><strong>(See pro/misc/get_mjdstr.pro)</strong></p>
<hr />
<h3 id="GET_PWD_F">GET_PWD()</h3>
<p><a href="#GET_MJDSTR_F">[Previous Routine]</a></p>
<p><a href="#GET_SERSICB_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_PWD()
 PURPOSE:
   Return the present working directory.
 MODIFICATION HISTORY:
   J. Moustakas, 2013 Aug 11, Siena
</pre>
<p><strong>(See pro/misc/get_pwd.pro)</strong></p>
<hr />
<h3 id="GET_SERSICB_F">GET_SERSICB()</h3>
<p><a href="#GET_PWD_F">[Previous Routine]</a></p>
<p><a href="#GRAPHSELECT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   GET_SERSICB()

 PURPOSE:
   Compute the Sersic bn parameter.

 INPUTS: 
   sersicn - Sersic &quot;n&quot; value

 COMMENTS:
   See Graham &amp; Driver (2005), equations 1 and 4.

 MODIFICATION HISTORY:
   J. Moustakas ???
</pre>
<p><strong>(See pro/galaxy/get_sersicb.pro)</strong></p>
<hr />
<h3 id="GRAPHSELECT">GRAPHSELECT</h3>
<p><a href="#GET_SERSICB_F">[Previous Routine]</a></p>
<p><a href="#HB_SFR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	GRAPHSELECT
 PURPOSE:
	Select points within an area of a graph defined by the cursor.

 CALLING SEQUENCE:
	GRAPHSELECT, x, y, indx, _extra=extra

 INPUTS:
	x: the array of x-values on the plot.
	y: the array of y-values on the plot.

 OPTIONAL INPUTS:
       extra - keywords for DEFROI

 OUTPUTS:
       indx - the indices of x and y that lie within the selected
              area.  indx is equivalent to what you get with the
              &quot;where&quot; function.

 RESTRICTIONS:
       You cannot use this on any plot except for the most recently
       defined plot. That is, if you made a plot (nr 1) and then
       another one (nr 2), you can use it on nr 2 but not on nr 1. 

 EXAMPLE:
	Define x=findgen(100) and y=2*x; plot, x, y. Type 

	GRAPHSELECT, X, Y, INDX, /nofill

	and this routine prompts you to define an area with the cursor.
	When you are finished, the valuies of INDX are returned. You can
	overplot the selected points to check it:

	OPLOT, x[indx], y[indx], psym=2, color=128

 RELATED PROCEDURES:
	IDL'S DEFROI

 MODIFICATION HISTORY:
	Written by Carl Heiles. 12 Sep 1998.
	jm02may20uofa - error checking
       jm03jul24uofa - added EXTRA keyword
</pre>
<p><strong>(See pro/plot/graphselect.pro)</strong></p>
<hr />
<h3 id="HB_SFR_F">HB_SFR()</h3>
<p><a href="#GRAPHSELECT">[Previous Routine]</a></p>
<p><a href="#HDR2STRUCT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       HB_SFR()

 PURPOSE:
       Estimate the star-formation rate (SFR) from the B-band
       luminosity and the observed H-beta luminosity according to
       Moustakas, Kennicutt, &amp; Tremonti (2006).

 INPUTS:
       loglb  - B-band luminosity [L(B)_sun]
       loglhb - observed (stellar-absorption corrected, but not
                reddening-corrected) H-beta luminosity [erg/s]

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:
       log - return the log-base-10 SFR and error

 OUTPUTS:
       sfr - star-formation rate [M_sun/yr]

 OPTIONAL OUTPUTS:
       sfr_err - uncertainty in SFR based on the standard-deviation
                 of the empirical calibration [M_sun/yr]

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2005 Aug 26, U of A - written
       jm06apr10uofa - also return SFR_ERR; documented

 Copyright (C) 2005-2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/hb_sfr.pro)</strong></p>
<hr />
<h3 id="HDR2STRUCT">HDR2STRUCT</h3>
<p><a href="#HB_SFR_F">[Previous Routine]</a></p>
<p><a href="#HIST_ND">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   hdr2struct

 PURPOSE:
   Convert a string array with the format of a FITS header 
       into a single structure

 CALLING SEQUENCE:
   struct = hdr2struct(hdr)

 INPUTS:
   hdr:        FITS-(like) header (array of strings)

 OUTPUTS:
   struct:     Single structure with keyword(s) and comment(s)

 OPTIONAL INPUTS:

 COMMENTS:
   Only passes back anonymous structures as it appends as it works
    through all the header keywords.  Use struct_append to make an
    array from an array of headers.

 PROCEDURES CALLED:
   headfits()

 REVISION HISTORY:
   17-Jul-2001 Written by Burles
   15-Jan-2004 - added IDL_VALIDNAME() and strcompress blank lines in
                 the header
</pre>
<p><strong>(See pro/image/im_hdr2struct.pro)</strong></p>
<hr />
<h3 id="HIST_ND">HIST_ND</h3>
<p><a href="#HDR2STRUCT">[Previous Routine]</a></p>
<p><a href="#IABSLINEEW_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       HIST_ND

 PURPOSE:
       Perform an N-dimensional histogram, also known as the joint
       density function of N variables, ala HIST_2D.

 CALLING SEQUENCE:
       hist=HIST_ND(V,[BINSIZE,MIN=,MAX=,NBINS=,REVERSE_INDICES=])

 INPUTS:

       V: A NxP array representing P data points in N dimensions.  

       BINSIZE: The size of the bin to use. Either an N point vector
         specifying a separate size for each dimension, or a scalar,
         which will be used for all dimensions.  If BINSIZE is not
         passed, NBINS must be.

 OPTIONAL INPUTS: 

       MIN: The minimum value for the histogram.  Either a P point
         vector specifying a separate minimum for each dimension, or
         a scalar, which will be used for all dimensions.  If
         omitted, the natural minimum within the dataset will be
         used.

       MAX: The maximum value for the histogram.  Either a P point
         vector specifying a separate maximmum for each dimension, or
         a scalar, which will be used for all dimensions. If omitted,
         the natural maximum within the dataset will be used.

       NBINS: Rather than specifying the binsize, you can pass NBINS,
         the number of bins in each dimension, which can be a P point
         vector, or a scalar.  If BINSIZE it also passed, NBINS will
         be ignored, otherwise BINSIZE will then be calculated as
         binsize=(max-min)/nbins.  Note that *unlike* RSI's version
         of histogram as of IDL 5.4, this keyword actually works as
         advertised, giving you NBINS bins over the range min to max.

 KEYWORD PARAMETERS:
       
       MIN,MAX,NBINS: See above
       
       REVERSE_INDICES: Set to a named variable to receive the
         reverse indices, for mapping which points occurred in a
         given bin.  Note that this is a 1-dimensional reverse index
         vector (see HISTOGRAM).  E.g., to find the indices of points
         which fell in a histogram bin [i,j,k], look up:

             ind=[i+nx*(j+ny*k)]
             ri[ri[ind]:ri[ind+1]-1]

         See also ARRAY_INDICES for converting in the other
         direction.

 OUTPUTS:

       hist: The N-Dimensional histogram, an array of size
         N1xN2xN3x...xND where the Ni's are the number of bins
         implied by the data, and/or the optional inputs min, max and
         binsize.

 OPTIONAL OUTPUTS:

       The reverse indices.

 EXAMPLE:
       
       v=randomu(sd,3,100)
       h=hist_nd(v,.25,MIN=0,MAX=1,REVERSE_INDICES=ri)

 SEE ALSO:

       HISTOGRAM, HIST_2D

 MODIFICATION HISTORY:

       Wed Nov 3 17:40:21 2010, J.D. Smith 
               
               Handle 1D input with out of range elements.
		

       Mon Mar 5 09:45:53 2007, J.D. Smith &lt;jdsmith@as.arizona.edu&gt;

               Correctly trim out of range elements from the
               histogram, when MIN/MAX are specified. Requires IDL
               v6.1 or later.

       Tue Aug 19 09:13:43 2003, J.D. Smith &lt;jdsmith@as.arizona.edu&gt;

               Slight update to BINSIZE logic to provide consistency
               with HIST_2D.

       Fri Oct 11 10:10:01 2002, J.D. Smith &lt;jdsmith@as.arizona.edu&gt;

               Updated to use new DIMENSION keyword to MAX/MIN.

       Fri Apr 20 12:57:34 2001, JD Smith &lt;jdsmith@astro.cornell.edu&gt;

               Slight update to NBINS logic.  More aggressive keyword
               checking.

       Wed Mar 28 19:41:10 2001, JD Smith &lt;jdsmith@astro.cornell.edu&gt;

               Written, based on HIST_2D, and suggestions of CM.

</pre>
<p><strong>(See pro/math/hist_nd.pro)</strong></p>
<hr />
<h3 id="IABSLINEEW_F">IABSLINEEW()</h3>
<p><a href="#HIST_ND">[Previous Routine]</a></p>
<p><a href="#ICLASSIFICATION_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IABSLINEEW()

 PURPOSE:
   Measure absorption-line equivalent widths or continuum indices
   using pseudo-continuum side-bands. 

 INPUTS:
   wave     - wavelength vector [NPIX]
   flux     - data spectrum [NPIX]
   linewave - line wavelengths [NLINE]; if NOLINE=1 then 
              LINEWAVE can be an array of zeros

 OPTIONAL INPUTS:
   ivar      - corresponding inverse variance spectrum [NPIX] (set
     IVAR=0 for crummy pixels)
   llimit   - central wavelength of the lower continuum window
              (default LINEWAVE minus 20 Angstrom)
   lwidth   - full width of LLIMIT (default 15 Angstrom) 
   ulimit   - central wavelength of the upper continuum window
              (default LINEWAVE plus 20 Angstrom)
   uwidth   - full width of ULIMIT (default 15 Angstrom) 
   lline    - wavelength of the lower (left) part of the line
              (default LINEWAVE minus 5 Angstrom) 
   uline    - wavelength of the upper (right) part of the line
              (default LINEWAVE plus 5 Angstrom)
   ncoeff   - number of coefficients of the fit between the two
              continuum side-bands (default 2, linear)
   label    - title for the plot if DEBUG=1

 KEYWORD PARAMETERS:
   noline     - do not compute the absorption-line EW (just
                compute the continuum side-bands and their ratio)  
   debug      - generate a diagnostic plot and wait for a
                keystroke 
   magnitude  - compute the magnitude of the absorption-line EW 
   fnu        - FLUX is in units of [erg/s/cm2/Hz]
   postscript - if set then do not open a window and suppress
                waiting for a keystroke between plots
   keystroke  - wait for a keystroke
   silent     - do not print warning messages to STDOUT 

 OUTPUTS:
   absline   - output data structure

 OPTIONAL OUTPUTS:
   absplot   - data structure with parameters used in the
               plotting

 COMMENTS:

 PROCEDURE:
   The continuum windows are defined by LLIMIT, ULIMIT, LWIDTH,
   and UWIDTH.  The mean continuum in each window is computed and
   an NCOEFF function is fitted between the points.  The
   continnum is interpolated at the central wavelength of the
   line. 

 EXAMPLE:

 PROCEDURES USED:
   PARTIAL_PIXEL_SUM(), GET_ELEMENT, DJS_PLOT, DJS_OPLOT, SPLOG,
   FLAM_UNITS(), FNU_UNITS()

 MODIFICATION HISTORY:
   J. Moustakas, 2003 November 26, U of A
   jm03dec1uofa - added POSTSCRIPT keyword
   jm04jan5uofa - additional error checking; added FNU keyword 
   jm04apr22uofa - plotting improvements
   jm04oct25uofa - added SILENT keyword
   jm05jul28uofa - added ALLOW_PARTIAL keyword 
   jm09dec08ucsd - changed FERR optional input to IVAR (inverse
     variance), so that bad pixels could be tracked (IVAR=0)

 Copyright (C) 2003-2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/iabslineew.pro)</strong></p>
<hr />
<h3 id="ICLASSIFICATION_F">ICLASSIFICATION()</h3>
<p><a href="#IABSLINEEW_F">[Previous Routine]</a></p>
<p><a href="#IFORAGE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ICLASSIFICATION()

 PURPOSE:
   Classify galaxies into starburst or AGN based on their
   emission-line ratios.

 INPUTS:
   line - ispec-style emission-line data structure

 OPTIONAL INPUTS:
   snrcut_class - minimum S/N to apply to each emission line; can be
     a scalar or a 4-element array corresponding to each emission
     line: H-alpha, H-beta, [OIII] 5007, and [NII] 6584, in that
     order (default is 1.0 for all lines)
   niihacut - classify objects with log([NII]/Ha)&gt;NIIHACUT as AGN
     (default -0.3) 

 KEYWORD PARAMETERS:
   noniihaclass - do not classify using *just* the [NII]/Ha ratio
     (NIIHACUT is ignored)
   doplot - generate a diagnostic plot
   silent - suppress messages to STDOUT

 OUTPUTS:
   bptclass - bit mask indicating the cumulative classification
     results (see COMMENTS)

 OPTIONAL OUTPUTS:
   ratios - emission-line ratios used in the classification as well
     as the final classifications (NOCLASS, UNKNOWN, AGN, SF, and
     SF/AGN) 

 COMMENTS:
   Write this!

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2003 June 13, U of A
   jm04may13uofa - added new physical criteria for classifying
                   ambigious objects
   jm05jun09uofa - require a 1-sigma detection on each line-ratio 
   jm05nov02uofa - error checking for GALAXY tag in LINE 
   jm06feb08uofa - compute the MIXTURE class (see below); on
                   error, return BPTCLASS rather than -1
   jm06oct14nyu  - added SNRCUT_CLASS and NIIHACUT optional
                   inputs 
   jm07aug10nyu  - minor code improvements
   jm08feb10nyu  - return the errors in the RATIOS structure;
                   added SNRCUT_NII optional input; improved
                   plotting 
   jm08feb25nyu  - added BPT_D and BPT_PHI output
   jm08aug26nyu  - added additional quality cuts, requiring that the
                   flux *error* be positive; documentation tweaks;
                   added CHI2CUT and SIGMACUT optional inputs
   jm08sep26nyu  - bit of a major rewrite; streamlined to just use
     the [NII]/Ha vs [OIII]/Hb diagram; now uses bits to store the
     classifications 
   jm10jan21ucsd - removed CHI2CUT and SIGMACUT: the user is
     responsible for inputting reasonable line-measurements; also
     removed SNRCUT_NII and allowed SNRCUT_CLASS to be a 4-element
     array for each of the four emission lines 

 Copyright (C) 2003-2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/iclassification.pro)</strong></p>
<hr />
<h3 id="IFORAGE_F">IFORAGE()</h3>
<p><a href="#ICLASSIFICATION_F">[Previous Routine]</a></p>
<p><a href="#IMATCH_TEMPLATES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IFORAGE()

 PURPOSE:
       Retrieve useful header information from 1D or 2D spectra. 

 INPUTS:
       speclist - list of FITS spectra

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:

 OUTPUTS:
       forage   - data structure

 OPTIONAL OUTPUTS:

 EXAMPLE:
       IDL&gt; help, forage('spec2d.fits'), /str
       IDL&gt; help, forage('spec1d.fits'), /str

 MODIFICATION HISTORY:
       J. Moustakas, 2002 November 25, U of A - written
       jm03apr11uofa - checked out ISPEC v1.0.0
       jm03sep11uofa - replaced FINDFILE() with FILE_SEARCH()
       jm05jun17uofa - also read the MJD-OBS keyword; improved error
                       checking; associate POSANGLE not PA as the
                       slit position angle
       jm05jul26uofa - bug fix
       jm07nov29nyu  - got rid of DATAPATH
       jm09jan19nyu  - added EXPTYPE, ENOISE, and EGAIN header tags
         (e.g., for Magellan/MIKE data)

 Copyright (C) 2003, 2005, 2007, 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/iforage.pro)</strong></p>
<hr />
<h3 id="IMATCH_TEMPLATES_F">IMATCH_TEMPLATES()</h3>
<p><a href="#IFORAGE_F">[Previous Routine]</a></p>
<p><a href="#IMH2FITS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IMATCH_TEMPLATES()

 PURPOSE:
       Match a set of templates to a data spectrum in terms of
       wavelength spacing and spectral resolution.

 CALLING SEQUENCE:
          newflux = imatch_templates(starflux,starwave,$
             newwave,starres=,newres=)

 INPUTS:
       starflux - stellar template flux array [NSTARFLUX,NSTAR] 
       starwave - wavelength vector corresponding to STARFLUX
                  [NSTARFLUX]
       newwave  - desired output wavelength spacing (i.e., of the
                  data spectrum)

 OPTIONAL INPUTS:
       starres  - FWHM spectral resolution of STARFLUX [Angstrom] 
       newres   - FWHM spectral resolution of NEWFLUX [Angstrom]

 KEYWORD PARAMETERS:

 OUTPUTS:
       newflux  - resampled and broadened STARFLUX

 OPTIONAL OUTPUTS:


 COMMENTS:
       The templates will be padded with zeros where there is no
       wavelength overlap.  

       This routine currently only supports a single Gaussian sigma
       as the broadening kernel.  The slow-down is significant for a
       wavelength-varying kernel. 

 PROCEDURES USED:
       COMBINE1FIBER, IM_GAUSS_BROADEN()

 EXAMPLE:


 MODIFICATION HISTORY:
       J. Moustakas, 2003 May 8, U of A
       jm03jun6uofa - excised from IFITSPEC()
       jm03sep15uofa - bug fix on the broadening resolution thanks to
                       C. Tremonti
       jm04jan14uofa - if STARRES is negative then do not convolve
       jm04feb04uofa - broaden *then* interpolate
       jm04mar02uofa - allow COMBINE1FIBER to determine the inverse
                       variance from the data themselves
       jm04may09uofa - crop the wavelength range before broadening to
                       gain speed

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/imatch_templates.pro)</strong></p>
<hr />
<h3 id="IMH2FITS">IMH2FITS</h3>
<p><a href="#IMATCH_TEMPLATES_F">[Previous Routine]</a></p>
<p><a href="#IM_ABSOLUTE_MAGNITUDES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IMH2FITS

 PURPOSE:
	Convert a list of IRAF format images to fits files.

 INPUTS:
	file_list : text file with the files, one per line, to be
		    converted 

 KEYWORD PARAMETERS:

 OUTPUTS:

 PROCEDURES USED:
	RDTXT(), IRAFRD(), WRITEFITS

 MODIFICATION HISTORY:
	John Moustakas, 2000 February 8, UCB

 Copyright (C) 2000, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/imh2fits.pro)</strong></p>
<hr />
<h3 id="IM_ABSOLUTE_MAGNITUDES_F">IM_ABSOLUTE_MAGNITUDES()</h3>
<p><a href="#IMH2FITS">[Previous Routine]</a></p>
<p><a href="#IM_ABUNDANCE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_ABSOLUTE_MAGNITUDES()

 PURPOSE:
       Given an apparent magnitude and luminosity distance, compute
       the absolute magnitude and luminosity.

 INPUTS:
       band     - scalar string specifying the bandpass (e.g., 'U')  
       mag      - apparent magnitude in BAND [NOBJECT, mag] 
       distance - luminosity distance [NOBJECT, Mpc]

 OPTIONAL INPUTS:
       mag_err      - error in MAG [NOBJECT, mag]
       distance_err - error in DISTANCE [NOBJECT, Mpc]

 KEYWORD PARAMETERS:

 OUTPUTS:
       result - 

 OPTIONAL OUTPUTS:

 COMMENTS:
       This routine could be generalized to take a vector BAND.  

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2005 Jun 02, U of A

 Copyright (C) 2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_absolute_magnitudes.pro)</strong></p>
<hr />
<h3 id="IM_ABUNDANCE_F">IM_ABUNDANCE()</h3>
<p><a href="#IM_ABSOLUTE_MAGNITUDES_F">[Previous Routine]</a></p>
<p><a href="#IM_ANGLE_FORMAT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_ABUNDANCE()

 PURPOSE:
   Compute empirical abundances and various relevant line-ratios
   from strong emission lines. 

 INPUTS:
   line   - input structure of de-reddened line fluxes

 OPTIONAL INPUTS:
   snrcut_abundance - require that individual emission lines have
                      a signal-to-noise ratio greater than
                      SNRCUT_ABUNDANCE 
   ewalpha          - alpha parameter for Kobulnicky &amp; Phillips
                      (2003) EW abundances
   nmonte           - number of Monte Carlo realizations; note
                      that if NMONTE=0 then the abundance
                      uncertainties for some calibrations will
                      not be computed 

 KEYWORD PARAMETERS:
   use_4959  - use the measured 4959 emission-line flux; the
               default is to assume 4959 = 5007/2.984; note that
               if LINE has not been reddening-corrected, then the
               assumption of the intrinsic ratio will be wrong by
               a little bit 
   getdensity - compute electron densities (slow!)
   silent    - do not print messages to STDOUT

 OUTPUTS:
   abund - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2004 Feb 8, U of A, written
   jm04jul06uofa - added empirical Te-based abundances 
   jm04jul22uofa - added SILENT and COMBINATION keywords 
   jm04jul27uofa - added a warning flag if R23&gt;1.1; added
                   ELECTRONDENSITY keyword
   jm04nov03uofa - documentation updated; HBETA keyword replaced
                   with HbHg keyword for consistency with
                   IUNRED_LINEDUST() 
   jm04dec08uofa - general development of various empirical
                   diagnostics; remove objects with log R23 &gt; 1 
   jm05jan01uofa - compute EW line-ratios and abundances
   jm05jan06uofa - do not require reddening-corrected line
                   fluxes
   jm05feb08uofa - added NOTSTRICT keyword
   jm05mar31uofa - cleaned up the structure field names
   jm05sep05uofa - removed NOTSTRICT keyword in favor of
                   R23STRICT keyword
   jm06mar10uofa - added EWALPHA and NMONTE parameters 
   jm07dec10nyu  - added S23
   jm08feb06nyu  - somewhat major overhaul; cleaned up and
                   streamlined; removed NORMALIZE and
                   ELECTRONDENSITY keywords; added JUSTEW and
                   JUSTFLUX keywords; KK04, M91, and PT05
                   abundances now computed formally using their
                   own routines
   jm08mar20nyu - added NODENSITY and USE_4959 keywords; allow
                  NMONTE=0 
   jm08aug21nyu - compute the T04 calibration using EWs
   jm08oct01nyu - added JUSTRATIOS keyword
   jm10jul23ucsd - NODENSITY keyword changed to GETDENSITY; CL01 and
     KD02/combined abundances removed since I never use them

 Copyright (C) 2004-2008, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/im_abundance.pro)</strong></p>
<hr />
<h3 id="IM_ANGLE_FORMAT_F">IM_ANGLE_FORMAT()</h3>
<p><a href="#IM_ABUNDANCE_F">[Previous Routine]</a></p>
<p><a href="#IM_ATVCUBE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_ANGLE_FORMAT()
 PURPOSE:
   Place an angle in the interval [0-180].
 MODIFICATION HISTORY:
   J. Moustakas, 2005 Apr 05, U of A
</pre>
<p><strong>(See pro/sky/im_angle_format.pro)</strong></p>
<hr />
<h3 id="IM_ATVCUBE">IM_ATVCUBE</h3>
<p><a href="#IM_ANGLE_FORMAT_F">[Previous Routine]</a></p>
<p><a href="#IM_BEST_SYMBOLS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_ATVCUBE

 PURPOSE:
	This routine acts as a wrapper to Aaron Barth's image display
	program, ATV.  An array of filenames or an image data cube
	(and optionally an image header cube) can be displayed one at a
	time with ATV via a simple widget interface.  The routine can
	be thought of as a generalized BLINK function.

 INPUTS:
	imlist - either an array of filenames or a three-dimensional
                image data cube whose third dimension is the image
                index

 OPTIONAL INPUTS:
	headcube - if imlist is passed as an image cube, then the
                  headers of the images can be passed *as a pointer
                  array* (see EXAMPLE, below) via this keyword 

 OUTPUTS:
	None.

 COMMON BLOCKS:
	atv_state - see the ATV documentation

 EXAMPLE:
	In this first example ATVCUBE will be passed an image and
	header data cube.  Imagine that the variable imlist contains a
	list of 10 FITS files of size (xsize,ysize).  The image and
	header cube might be created in the following way:
 
		IDL&gt; imcube = fltarr(xsize,ysize,10)
		IDL&gt; headcube = ptrarr(10)
		IDL&gt; for i = 0L, 9L do begin 
		IDL&gt;    imcube[*,*,i] = readfits(imlist[i],h)
		IDL&gt;    headcube[i] = ptr_new(h)
		IDL&gt; endfor

	Then we would call ATVCUBE with

		IDL&gt; atvcube, imcube, headcube=headcube

	Note that headcube must be a pointer array because in general
	the header lengths of different files are not the same.
	Alternatively, we can create a list of FITS files we want to
	examine one at a time and call ATVCUBE directly:

		IDL&gt; imlist = ['im1.fits','im2.fits','im3.fits']
		IDL&gt; atvcube, imlist

 COMMENTS:
	The stretch and alignment of subsequent images are carried
	over from the previous image displayed.

	For the most recent version of ATV go to Aaron's webpage at 
       http://cfa-www.harvard.edu/~abarth/atv/atv.html.

 WARNINGS:
	If a file list is passed then the first image is read in to
	create the image cube array.  This procedure assumes that all
	the subsequent FITS files are the same x- and y-size.

 PROCEDURES USED:
	ATV

 MODIFICATION HISTORY:
	John Moustakas, 2001 February 13, University of Arizona

 Copyright (C) 2001, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 

</pre>
<p><strong>(See pro/image/im_atvcube.pro)</strong></p>
<hr />
<h3 id="IM_BEST_SYMBOLS_F">IM_BEST_SYMBOLS()</h3>
<p><a href="#IM_ATVCUBE">[Previous Routine]</a></p>
<p><a href="#IM_BINSPEC_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_BEST_SYMBOLS()
 PURPOSE:
   Return a priority-sorted list of the 22 &quot;best&quot; SYMCAT() symbols.
 OPTIONAL INPUTS:
   fill - fill array (defaults to reasonable values)
   psize - symsize array (defaults to reasonable values)
 OUTPUT:
   psym - plot symbol to use in PLOT (i.e., psym=psym)
 MODIFICATION HISTORY:
   J. Moustakas, 2004 Jul 13, U of A
   jm05jun22uofa - the priority of the symbols was improved 
</pre>
<p><strong>(See pro/plot/im_best_symbols.pro)</strong></p>
<hr />
<h3 id="IM_BINSPEC_F">IM_BINSPEC()</h3>
<p><a href="#IM_BEST_SYMBOLS_F">[Previous Routine]</a></p>
<p><a href="#IM_BRANCH_RATIOS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_BINSPEC()

 PURPOSE:
       Bin a spectrum.

 CALLING SEQUENCE:


 INPUTS:
       spec - one-dimensional spectrum or array
       wave - corresponding wavelength vector or index number 

 OPTIONAL INPUTS:
       spec_err  - error spectrum for SPEC.  if it exists then
                   compute BINSPEC_ERR
       binsize   - sum the flux in bins of width BINSIZE
       bandstart - central wavelength or pixel number of the first bin
       bandend   - central wavelength or pixel number of the last bin
       finerpix  - over-sampling factor at the bandpass edges
                   (default 10)

 KEYWORD PARAMETERS:
       abmag  - assume that SPEC is in [erg/s/cm2/Hz] and convert to
                AB magnitude 
       doplot - generate a plot of the input and the binned spectrum 

 OUTPUTS:
       binspec - binned spectrum

 OPTIONAL OUTPUTS:
       binwave     - central bandpass wavelengths or pixel numbers 
       binspec_err - the error spectrum for BINSPEC if SPEC_ERR was
                     passed (not supported yet!)

 COMMENTS:
       Although this routine was written with spectra in mind, it
       should be general enough to bin any one-dimensional array. 

 PROCEDURES USED:
       LEGEND

 EXAMPLE:


 MODIFICATION HISTORY:
       J. Moustakas, 2003 May 13, U of A, based on earlier codes 

 Copyright (C) 2003, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_binspec.pro)</strong></p>
<hr />
<h3 id="IM_BRANCH_RATIOS_F">IM_BRANCH_RATIOS()</h3>
<p><a href="#IM_BINSPEC_F">[Previous Routine]</a></p>
<p><a href="#IM_CALC_VMAX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_BRANCH_RATIOS()

 PURPOSE:
       Compute and return the branching ratios among various
       collisionally excited emission lines, in the low-density
       limit. 

 INPUTS: 

 OPTIONAL INPUTS: 
       dens - electron density (default 100 cm^-3); note that if the
              density is made too large this program does not account
              for collisional de-excitation 
       temp - electron temperature (default 10,000 K)

 KEYWORD PARAMETERS: 

 OUTPUTS: 
       branch - structure with the various branching ratios (see code
                for details)

 OPTIONAL OUTPUTS:

 COMMENTS:
       From B. Moore: &quot;Many of the temperature diagnostic
       ratios follow the form 

         [F(Lower line #1) + F(Lower line #2)] / F(Upper line)

       It is possible to calculate a diagnostic ratio with only one
       of the lower lines present, but only if the program can be
       made aware of the missing line.  Since the diagnostic ratios
       are initialized, the alternate ratios are not easily accounted
       for.  Instead, this procedure makes it possible to account for
       the missing line by assuming its flux from the flux of the
       other lower line scaled by the ratio of the lines given by the
       atomic data.  This is done by calling the nlevel program for
       default values of the density and temperature, and passing
       these values back out in a structure.

       Note that the fluxes are pulled out of the results from
       IM_NLEVEL() by index, NOT wavelength.  Therefore, the user
       must be diligent in checking the results if they change any
       aspect of IM_NLEVEL().&quot;

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2007-Nov-26, NYU: based almost entirely on
          B. Moore's BRANCHCALC.

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_branch_ratios.pro)</strong></p>
<hr />
<h3 id="IM_CALC_VMAX">IM_CALC_VMAX</h3>
<p><a href="#IM_BRANCH_RATIOS_F">[Previous Routine]</a></p>
<p><a href="#IM_CALL_MANGLE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_CALC_VMAX

 PURPOSE:
   Calculate Vmax, given the flux and redshift limits of the sample. 

 INPUTS: 
   appm - apparent magnitude of each object in the selection band [N] 
   vmax_coeffs - [NT, N] K-correction coeffs for each object
   select_filter - selection filter name (e.g., sdss_r0.par)
   marea  - area of mag limit region [NA]
   mmin - minimum apparent mag for each mag limit region [NA]
   mmax - maximum apparent mag for each mag limit region [NA]
   sample_zmin - minimum redshift of the sample
   sample_zmax - maximum redshift of the sample
   actual_z - actual redshift of each object [N]

 OPTIONAL INPUTS:
   q0, q1, qz0 - evolutionary parameters (see K_EVOLVE)
   omega0 - omega_matter (default: 0.3)
   omegal0 - omega_lambda (default: 0.7)
   h100 - Hubble constant divided by 100; Vmax is scaled to this
     value (default 0.7)
   im - index of magnitude limit region (default 0) [N]
   vname - templates used when computing K-corrections (default
     'default') 
   magoffset - 
 
 KEYWORD PARAMETERS:
   silent - suppress messages to STDOUT
   smoothhr - 

 OPTIONAL OUTPUTS:
   zmin - local zmin of each [N]
   zmax - local zmax of each [N]
   vmax - Vmax of each integrated over all mag limit regions [N]

 COMMENTS:
   VMAX is returned in h^{-3} Mpc^3 comoving

 COMMENTS:
   Shamelessly hacked version of M. Blanton's LF_CALC_VMAX! 

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2009-Nov-11, UCSD - written

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_calc_vmax.pro)</strong></p>
<hr />
<h3 id="IM_CALL_MANGLE_F">IM_CALL_MANGLE()</h3>
<p><a href="#IM_CALC_VMAX">[Previous Routine]</a></p>
<p><a href="#IM_COLOR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_CALL_MANGLE()

 PURPOSE:
   Simple wrapper on various mangle scripts.

 INPUTS: 
   polyfiles - one or more polygon files to process using mangle
   outfile - output file name (required)

 OPTIONAL INPUTS: 
   tolerance - intersection tolerance (default 1D-8 arcsec)
   scheme - pixelization scheme (note the native SDSS scheme is
     -Pd0,6)  
   minarea - discard polygons with area&lt;MINAREA using poly2poly
     (default 1D-13 sr)
   tmpdir - output directory for temporary, junk files (default /tmp) 

 KEYWORD PARAMETERS: 
   Optional mangle commands (see COMMENTS):
     selfsnap
     snap
     pizelize
     balkanize
     unify
     poly2poly
   silent - suppress messages to STDOUT

 OUTPUTS: 
   Mangled polygon file is written to OUTFILE.

 COMMENTS:
   See http://space.mit.edu/~molly/mangle for lots of handy info.  
 
   This routine is a simple wrapper on mangle, (very!) loosely based
   on K. Wong's CALL_MANGLE.  It basically just does 'snap -S', 
   'pixelize', 'snap', 'balkanize', 'unify' (optional), and finally
   'poly2poly'.  

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Sep 09, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/im_call_mangle.pro)</strong></p>
<hr />
<h3 id="IM_COLOR_F">IM_COLOR()</h3>
<p><a href="#IM_CALL_MANGLE_F">[Previous Routine]</a></p>
<p><a href="#IM_COMPUTE_ERROR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_COLOR()
 PURPOSE:
   Trivial wrapper on CGCOLOR() to access all the colors in 'rgb.txt'.  
 INPUTS: 
   colorname - color name (see ${IMPRO_DIR}/etc/rgb.txt)
 OPTIONAL INPUTS: 
   colorindx - color table index number (default 100)
   extra - additional inputs to CGCOLOR()
 MODIFICATION HISTORY:
   J. Moustakas, 2011 Aug 16, UCSD
</pre>
<p><strong>(See pro/plot/im_color.pro)</strong></p>
<hr />
<h3 id="IM_COMPUTE_ERROR_F">IM_COMPUTE_ERROR()</h3>
<p><a href="#IM_COLOR_F">[Previous Routine]</a></p>
<p><a href="#IM_COMPUTE_OH12TE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_COMPUTE_ERROR()

 PURPOSE:
   Perform propagation of errors with one or two variables. 

 INPUTS: 
   x1 - first variable
   x1err - corresponding error

 OPTIONAL INPUTS: 
   x2 - second variable
   x2err - corresponding error
   
 KEYWORD PARAMETERS: 
   log - assume:
     x = alog10(x1/x2) = alog10(x1) - alog10(x2) or 
     x = alog10(x1*x2) = alog10(x1) + alog10(x2) 
   quotient - assume x = x1/x2
   product - assume x = x1*x2 (default)

 OUTPUTS: 
   xerr - quadrature sum 

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2002 Jul 22, U of A
   jm02nov8uofa - added log keyword; also can be passed just x1 and
     x1err (no x2 information) 

 Copyright (C) 2002, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/im_compute_error.pro)</strong></p>
<hr />
<h3 id="IM_COMPUTE_OH12TE_F">IM_COMPUTE_OH12TE()</h3>
<p><a href="#IM_COMPUTE_ERROR_F">[Previous Routine]</a></p>
<p><a href="#IM_COMPUTE_TE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_COMPUTE_OH12TE()

 PURPOSE:
   Compute electron-temperature abundances.

 CALLING SEQUENCE:
   result = im_compute_oh12te(data)

 INPUTS:
   data - output from COMPUTE_TE() 

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:

 OUTPUTS:
   result - results

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
   IDL_FIVEL(), IM_COMPUTE_ERROR()

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2004 July 5, U of A - written

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_compute_oh12te.pro)</strong></p>
<hr />
<h3 id="IM_COMPUTE_TE_F">IM_COMPUTE_TE()</h3>
<p><a href="#IM_COMPUTE_OH12TE_F">[Previous Routine]</a></p>
<p><a href="#IM_CONSTRUCT_ESPECTRUM_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_COMPUTE_TE()

 PURPOSE:
   Compute the nebular electron temperature based on various
   temperature-sensitive line-ratios and, if available, the
   electron density from [S II]. 

 INPUTS:
   data - linefit data structure

 OPTIONAL INPUTS:
   snrcut - S/N cut on the emission lines (default 3)

 KEYWORD PARAMETERS:

 OUTPUTS:
   result - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2004 July 5, U of A - written
   jm06may01uofa - added SNRCUT
   jm07nov26nyu - rewritten to use IM_TEMDEN()
   jm07dec11nyu - additional ions included 

 Copyright (C) 2004, 2006-2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_compute_te.pro)</strong></p>
<hr />
<h3 id="IM_CONSTRUCT_ESPECTRUM_F">IM_CONSTRUCT_ESPECTRUM()</h3>
<p><a href="#IM_COMPUTE_TE_F">[Previous Routine]</a></p>
<p><a href="#IM_CONVERT_IMF_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_CONSTRUCT_ESPECTRUM()

 PURPOSE:
   Construct a model emission-line spectrum.

 CALLING SEQUENCE:
   espectrum = im_construct_espectrum(wave,sfr=,redshift=,$
      oiiha=,oiiihb=,niiha=,ebv=,lineres=,linewidth=,$
      linefit=,/debug,_extra=extra)

 INPUTS:
   wave - *observed* wavelength vector [Angstrom]
   sfr  - star-formation rate [M_sun/yr]

 OPTIONAL INPUTS:
   redshift  - object redshift (default 0.0)
   oiiha     - intrinsic [O II] 3727 / H-alpha ratio (1.0)  
   oiiihb    - intrinsic [O III] 5007 / H-beta ratio (0.8)  
   niiha     - intrinsic [N II] 6584 / H-alpha ratio (0.5)
   ebv       - reddening (default 0.0) [mag]
   lineres   - *observed* FWHM instrumental line-width (default
               3.0) [Angstrom] 
   linewidth - intrinsic line-width (default 100) [km/s]
   extra     - keywords for K_LAMBDA()

 KEYWORD PARAMETERS:
   debug - debug the emission-line spectrum

 OUTPUTS:
   espectrum - final emission-line spectrum [erg/s/cm2/A]; if
               REDSHIFT=0 then the units are [erg/s/A]

 OPTIONAL OUTPUTS:
   linefit - if DEBUG=1 then return the line-fitting structure
             results 

 PROCEDURES USED:
   DLUMINOSITY(), RETURN_TBALMER(), MANYGAUSS(), K_LAMBDA(),
   ILINEFIT(), SPLOG

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2004 Feb 07, U of A - written
   jm04apr07uofa - extensively tested
   jm04oct15uofa - added many new inputs; more testing;
                   documentation added
   jm05apr13uofa - added EXTRA optional input

 Copyright (C) 2004-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_construct_espectrum.pro)</strong></p>
<hr />
<h3 id="IM_CONVERT_IMF_F">IM_CONVERT_IMF()</h3>
<p><a href="#IM_CONSTRUCT_ESPECTRUM_F">[Previous Routine]</a></p>
<p><a href="#IM_CONVERT_INDEX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_CONVERT_IMF()

 PURPOSE:
       Return the conversion factor between various IMFs and the
       Salpeter IMF between 0.1-100 M_sun.

 INPUTS: 

 OPTIONAL INPUTS: 

 KEYWORD PARAMETERS: 
       from_chabrier      - 
       from_kroupa01      - 
       from_baldry03      - 
       from_diet_salpeter - 

 OUTPUTS: 
       The value that must be *added* to convert *to* Salpeter
       (1955), unless LINEAR=1, in which case the value returned must
       be multiplied.

 OPTIONAL OUTPUTS:

 COMMENTS:
       * Chabrier (2003) - See end of Section 3.2 in Gallazzi et
                           al. (2008).  I have also checked this
                           value by comparing the BC03 models for
                           each IMF, obtaining 0.25 dex.
       * Kroupa (2001)   - See Brinchmann et al. (2004).  Note that
                           Bell et al. (2003) gives 0.3 dex!!
       * Baldry &amp; Glazebrook (2003) - See also Savaglio et
                                      al. (2005). 
       * Diet Salpeter   - See Bell et al. (2003).
       
       Note that a variety of conversion factors are also given in
       Wilkins et al. 2008.

 MODIFICATION HISTORY:
       J. Moustakas, 2008, Apr 05, NYU - written

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_convert_imf.pro)</strong></p>
<hr />
<h3 id="IM_CONVERT_INDEX">IM_CONVERT_INDEX</h3>
<p><a href="#IM_CONVERT_IMF_F">[Previous Routine]</a></p>
<p><a href="#IM_CONVOLVE_SFH_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_CONVERT_INDEX
 PURPOSE:
       Converts a one dimensional array index into a vector of indices, whose
       length is equal to the number of dimensions of the array. This is
       useful when wanting to know, for instance, what row and column element
       10034 corresponds to in a 200x150 2-D array. The routine is general and
       can handle arrays with any number of array dimensions, up to the IDL
       maximum of 7.
 CALLING SEQUENCE:
       new_index = CONVERT_INDEX(index, array)
 INPUTS:
   INDEX
       A 1 dimensional array index to be converted. IDL can reference
       multidimensional arrays using a simple 1 dimensional index.
       Such an index is obtained, for instance from functions such as
       MAX, MIN and WHERE.
   ARRAY
       The array to which this index applies. This routine only uses this
       parameter to determine the array dimensions, it does not actually use
       the data stored in the array.
 OUTPUTS:
   NEW_INDEX
       The function returns an array of indices, in increasing array index
       order. NEW_INDEX has a maximum lenght of 7, since IDL arrays are limited
       to 7 dimensions.
 EXAMPLE:
       If ARRAY is a 4x3 array and INDEX=7 then this function will return
       [3,1], since array element 7 (when ARRAY is viewed as a
       one-dimensional array) is actually column 3, row 1 when ARRAY is viewed
       as a 2-dimensional array.
 MODIFICATION HISTORY:
       Created October 1990 by Mark Rivers
       J. Moustakas, 2005 Jun 22, U of A - vectorized
</pre>
<p><strong>(See pro/misc/im_convert_index.pro)</strong></p>
<hr />
<h3 id="IM_CONVOLVE_SFH_F">IM_CONVOLVE_SFH()</h3>
<p><a href="#IM_CONVERT_INDEX">[Previous Routine]</a></p>
<p><a href="#IM_D4000_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_CONVOLVE_SFH()

 PURPOSE:
   Convolve an SSP with an arbitrary star formation history.

 INPUTS: 
   ssp - structure describing the SSP grid:
     age  - age vector (yr) [NSSP]
     wave - wavelength vector [NPIX]
     flux - flux vector [NPIX,NSSP]

 OPTIONAL INPUTS:
   tau - characteristic time for exponentially declining star
     formation (Gyr) (stronger than SFH and TIME)
   mstar - stellar mass of the SSP with time [NSSP]
   nsamp - time oversampling factor (default 2)
 
 OPTIONAL INPUTS/OUTPUTS (see COMMENTS):
   sfh - star formation rate at each TIME (Msun/yr) [NSFH]
   time - time vector corresponding to SFH (Gyr) [NSFH] 

 OPTIONAL OUTPUTS:
   cspmstar - stellar mass of the CSP with time [NSFH]

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   cspflux - time-dependent spectra of the composite stellar
     population (CSP) [NPIX,NSFH]

 COMMENTS:
   The star formation history can be specified using *either* TAU,
   *or* SFH and TIME.  If TAU is specified then we assume a standard
   star formation history of the form SFR=exp(-TIME/TAU)/TAU
   (corresponding to one solar mass of stars formed after infinite
   time).  

   Alternatively, an arbitrary star formation history can be passed
   using SFH and TIME.  Note that the input history should have good
   time resolution during rapid variations in the star formation
   rate, otherwise significant inaccuracies could occur.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 20, UCSD - written, with input from
     C. Tremonti and A. Diamond-Stanic
   jm11mar04ucsd - various bug fixes; better handing of the time
     vector 

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_convolve_sfh.pro)</strong></p>
<hr />
<h3 id="IM_D4000_F">IM_D4000()</h3>
<p><a href="#IM_CONVOLVE_SFH_F">[Previous Routine]</a></p>
<p><a href="#IM_DIRECT_ABUNDANCE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_D4000()

 PURPOSE:
   Compute the Balogh+99 definition of the 4000-A break. 

 INPUTS: 
   wave - input wavelength vector [NPIX, Angstroms]
   flux - corresponding flux density [NPIX, erg/s/cm/A]

 OPTIONAL INPUTS: 
   ferr - 1-sigma error array for FLUX [NPIX, erg/s/cm/A]

 KEYWORD PARAMETERS: 
   bruzual83 - compute the Bruzual (1983) definition of the 4000-A
     break

 OUTPUTS: 
   d4000 - the 4000-A break strength (dimensionless)

 OPTIONAL OUTPUTS:
   d4000_err - uncertainty on D4000 (if FERR is given)

 COMMENTS:
   Basically wraps on IABSLINEEW()

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Feb 27, NYU

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_d4000.pro)</strong></p>
<hr />
<h3 id="IM_DIRECT_ABUNDANCE_F">IM_DIRECT_ABUNDANCE()</h3>
<p><a href="#IM_D4000_F">[Previous Routine]</a></p>
<p><a href="#IM_DMOD2D_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_DIRECT_ABUNDANCE()

 PURPOSE:
       Given the relevant physical conditions (temperature and
       density), and the appropriate emission-line ratio (relative to
       H-beta), compute the total elemental abundance.

 INPUTS:
       data - ispec1d type structure with the necessary emission-line
              ratios (assumed relative to H-beta) [see
              INIT_HII_LINEFIT_STRUCTURE] 

 OPTIONAL INPUTS:
       oii_ion  - (default 3727)
       oiii_ion - (default 5007)
       nii_ion  - (default 6584)
       nmonte   - number of Monte Carlo iterations; if NMONTE=0
                  then don't do the Monte Carlo bit

 KEYWORD PARAMETERS:

 OUTPUTS:
       result - data structure with lots of goodies

 COMMENTS:
       Currently only computes the oxygen abundance and the N/O
       ratio. 

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Dec 4, NYU - written

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_direct_abundance.pro)</strong></p>
<hr />
<h3 id="IM_DMOD2D_F">IM_DMOD2D()[1]</h3>
<p><a href="#IM_DIRECT_ABUNDANCE_F">[Previous Routine]</a></p>
<p><a href="#IM_DMOD2D_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_DMOD2D()

 PURPOSE:
   Convert from distance in Mpc to distance modulus.

 INPUTS: 
   dist - input distance in Mpc

 OPTIONAL INPUTS: 
   err_dist - uncertainty on DIST [Mpc]

 OUTPUTS: 
   dmod - distance modulus

 OPTIONAL OUTPUTS:
   err_dmod - uncertainty on DMOD

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Jun 06, NYU

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_d2dmod.pro)</strong></p>
<hr />
<h3 id="IM_DMOD2D_F">IM_DMOD2D()[2]</h3>
<p><a href="#IM_DMOD2D_F">[Previous Routine]</a></p>
<p><a href="#IM_DOUBLE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_DMOD2D()

 PURPOSE:
   Convert from distance modulus to distance in Mpc.

 INPUTS: 
   dmod - input distance modulus

 OPTIONAL INPUTS: 
   sigdmod - uncertainty on DMOD
   a_lambda - foreground Galactic extinction

 OUTPUTS: 
   distance - distance in Mpc

 OPTIONAL OUTPUTS:
   sigdistance - uncertainty on DISTANCE in Mpc

 MODIFICATION HISTORY:
   J. Moustakas, 2003 May 01, UofA

 Copyright (C) 2003, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_dmod2d.pro)</strong></p>
<hr />
<h3 id="IM_DOUBLE">IM_DOUBLE</h3>
<p><a href="#IM_DMOD2D_F">[Previous Routine]</a></p>
<p><a href="#IM_EMPTY_STRUCTURE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME: 
   IM_DOUBLE
       
 PURPOSE: 
   Convert a float to double-precision avoiding roundoff issues. 

 CALLING SEQUENCE: 
   result = IM_DOUBLE(x)

 INPUTS: 
   x - a number

 OUTPUTS: 
   returns x as double-precision number

 COMMENTS: 
   If you convert a non double-precision number to double-precision
   using DOUBLE(), you will get a numerical error (e.g., DOUBLE(0.01)
   --&gt; 0.0099999998).  This routine was written in order to &quot;up the
   precision&quot; of a number without encountering this problem.

 MODIFICATION HISTORY:
    written by A.R.Marble, Steward Obs., December 3, 2003
    modified to accomodate exponential format, ARM, December 5, 2003
    return scalar rather than array of 1 value, ARM, 2004 June 4
    jm11apr25ucsd - ported into IMPRO
</pre>
<p><strong>(See pro/misc/im_double.pro)</strong></p>
<hr />
<h3 id="IM_EMPTY_STRUCTURE_F">IM_EMPTY_STRUCTURE()</h3>
<p><a href="#IM_DOUBLE">[Previous Routine]</a></p>
<p><a href="#IM_EVOLVE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_EMPTY_STRUCTURE()

 PURPOSE:
   Empty a data structure.

 INPUTS: 
   oldstruct - input structure

 OPTIONAL INPUTS: 
   ncopies - number of times to copy the output structure
   empty_value - replace numbers with this value (e.g., -999) 
   empty_string - replace strings with this string (e.g., '...') 

 OUTPUTS: 
   newstruct - emptied structure

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Apr 07, U of A
   jm06aug28uofa - added _extra 
   jm07aug22nyu - added EMPTY_VALUE and EMPTY_STRING optional inputs  

 Copyright (C) 2005-2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_empty_structure.pro)</strong></p>
<hr />
<h3 id="IM_EVOLVE_F">IM_EVOLVE()</h3>
<p><a href="#IM_EMPTY_STRUCTURE_F">[Previous Routine]</a></p>
<p><a href="#IM_F24TOLIR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_EVOLVE()
 PURPOSE:
   Compute a simple evolution model to apply to a measured absolute
   magnitude. 
 INPUTS: 
   z - redshift
   q0, qz0 - parameters of the model of the form:
     absm_evolved = absm + q0*(z-qz0)
 MODIFICATION HISTORY:
   J. Moustakas, 2011 Feb 24, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_evolve.pro)</strong></p>
<hr />
<h3 id="IM_F24TOLIR_F">IM_F24TOLIR()</h3>
<p><a href="#IM_EVOLVE_F">[Previous Routine]</a></p>
<p><a href="#IM_FF_ABUNDANCE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_F24TOLIR()

 PURPOSE:
   Given a redshift and an observed 24-micron flux, compute the total
   infrared luminosity, L(IR)=L(8-1100), based on various infrared
   SED models.

 INPUTS: 
   redshift - redshift for each object [NGAL]
   f24 - observed 24-micron flux [NGAL, mJy]

 OPTIONAL INPUTS: 
   f24_err - 1-sigma uncertainty on F24; mandatory if ERR_LIR or
     ERR_L24 are requested [NGAL, mJy] 
   f24_limit - limiting flux [scalar, mJy]; if provided, then ZMAX is
     computed 

 KEYWORD PARAMETERS: 
   chary - use the Chary &amp; Elbaz (2001) models (default)
   dale - use the Dale &amp; Helou (2002) models
   rieke - use the Rieke et al. (2009) models

 OUTPUTS: 
   lir - infrared luminosity for each object [L_sun, NGAL]

 OPTIONAL OUTPUTS:
   err_lir - statistical uncertainty on LIR [L_sun, NGAL]
   err_l24 - statistical uncertainty on L24 [L_sun, NGAL]
   model_indx - fractional index number of the best-fitting model 
     [NGAL] 
   zmax - if F24_LIMIT is provided, then ZMAX is computed as the
     redshift at which the 24-micron flux equals F24_LIMIT [NGAL]

 COMMENTS:
   By default the code uses the Chary &amp; Elbaz (2001) models, unless
   either /RIEKE or /DALE are set.  The statistical uncertainty on
   ERR_LIR and/or ERR_L24 are derived using a simple Monte Carlo
   method.  This routine should be called using various models to
   estimate the *systematic* errors. 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Feb 17, UCSD 

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_f24tolir.pro)</strong></p>
<hr />
<h3 id="IM_FF_ABUNDANCE_F">IM_FF_ABUNDANCE()</h3>
<p><a href="#IM_F24TOLIR_F">[Previous Routine]</a></p>
<p><a href="#IM_FILE_TEST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_FF_ABUNDANCE()

 PURPOSE:
   Compute abundances using Pilyugin's &quot;ff&quot; method.

 INPUTS:
   line   - iSPEC-style input structure of de-reddened line fluxes 

 OPTIONAL INPUTS:
   snrcut_abundance - require that individual emission lines have
     a signal-to-noise ratio greater than SNRCUT_ABUNDANCE 
   nmonte - number of Monte Carlo realizations for computing the
     errors in particular abundances (default 500)

 KEYWORD PARAMETERS:
   electrondensity - compute the electron density using the sulfur
     line-ratio 
   observed - use the observed rather than the predicted value of R
     (see Pilyugin+06)
   silent - do not print messages to STDOUT

 OUTPUTS:
   abund - output data structure

 COMMENTS:

 MODIFICATION HISTORY:
    J. Moustakas, 2004 Feb 8, U of A, written

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/im_ff_abundance.pro)</strong></p>
<hr />
<h3 id="IM_FILE_TEST_F">IM_FILE_TEST()</h3>
<p><a href="#IM_FF_ABUNDANCE_F">[Previous Routine]</a></p>
<p><a href="#IM_FILTERMAG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_FILE_TEST()
 PURPOSE:
   Check if a file exists before overwriting, unless /CLOBBER. 
 MODIFICATION HISTORY:
   J. Moustakas, 2010 Sep 12, UCSD
</pre>
<p><strong>(See pro/misc/im_file_test.pro)</strong></p>
<hr />
<h3 id="IM_FILTERMAG_F">IM_FILTERMAG()</h3>
<p><a href="#IM_FILE_TEST_F">[Previous Routine]</a></p>
<p><a href="#IM_FILTERSPECS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_FILTERMAG()

 PURPOSE:
   Compute the AB mag of a spectrum in a given filter. 

 INPUTS:
   wave - wavelength array [Angstrom]
   flux_flam - flux array [ergs/s/cm2/A]

 OPTIONAL INPUTS:
   filterlist - filter or list of filters to convolve with the
     spectrum (analogous to KCORRECT)

 KEYWORD PARAMETERS:

 OUTPUTS:
   maggies - flux density in erg/s/cm2/Hz; the AB magnitude is given
     by -2.5*alog10(maggies) 

 OPTIONAL OUTPUTS:

 COMMENTS:
   The spectrum can be on an irregular wavelength grid.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2006 July 14, U of A, stolen from C. Tremonti
      and modified to be more like K_PROJECT_FILTERS()
   jm08mar12nyu - documented 
   jm10feb17ucsd - cleaned up

 Copyright (C) 2006, 2008, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_filtermag.pro)</strong></p>
<hr />
<h3 id="IM_FILTERSPECS_F">IM_FILTERSPECS()</h3>
<p><a href="#IM_FILTERMAG_F">[Previous Routine]</a></p>
<p><a href="#IM_FITCONTINUUM_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_FILTERSPECS()

 PURPOSE:
       Compute and return useful filter specifications. 

 INPUTS:
       None

 OPTIONAL INPUTS:
       filterlist - list of filters (see KCORRECT)
       extra      - extra keywords for K_VEGA2AB()

 KEYWORD PARAMETERS:
       verbose - print the parameters to the screen
       doplot  - show the filter curve

 OUTPUTS:
       specs - output data structure

 OPTIONAL OUTPUTS:
       None

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 Oct 12, U of A
       jm05mar03uofa - added VEGA_FNU, VEGA_FLAM, and VEGA_JY tags;
                       added VERBOSE keyword
       jm05jun01uofa - added _EXTRA keyword for K_VEGA2AB()
       jm05jun07uofa - added DOPLOT keyword
       jm08mar12nyu  - documentation cleanup

 Copyright (C) 2004-2005, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_filterspecs.pro)</strong></p>
<hr />
<h3 id="IM_FITCONTINUUM_F">IM_FITCONTINUUM()</h3>
<p><a href="#IM_FILTERSPECS_F">[Previous Routine]</a></p>
<p><a href="#IM_FITEXY">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_FITCONTINUUM()

 PURPOSE:
   Fit a spectral continuum using a variety of methods.

 CALLING SEQUENCE:


 INPUTS:
   wave   - wavelength vector [NPIX]
   flux   - corresponding spectrum [NPIX]
   ferr   - corresponding error spectrum [NPIX] (not incorporated)

 OPTIONAL INPUTS:
   nfind   - if MASK is set then mask NFIND peaks (default 20) 
   nsmooth - if MASK is set then smooth the mask by NSMOOTH
             pixels (default 20) 
   
   method - 1: b-spline (default)
            2: median box-car smoothing
            3: linear combination of polynomials
            4: Legendre fit (least reliable)

   method 1:
      boxstat - MIN, MAX, MEAN, or MEDIAN (default), see
                DKBOXSTATS(); this parameter should be set to MIN
                for an emission-line spectrum and MAX for an
                absorption-line spectrum; a compromise is MEDIAN
      xwidth  - replace each pixel with the DXBOXSTAT pixel value
                in an array of width XWIDTH (default 30)
      bsorder - order of the b-spline fit (default 15)

   method 2:
      medwidth    - width of the median filter, see DJS_MEDIAN()
                    (default 150 pixels)
      smoothwidth - width of the smoothing window, see SMOOTH()
                    (default 49 pixels)

   method 3:
      npoly   - number of polynomials of increasing order to fit
                (default 4)

   method 4:
      ncoeff  - number of coefficients in the Legendre fit
                (default 4)
   plotthick  - plot thickness (default 2.0)


 KEYWORD PARAMETERS:
   mask     - mask emission or absorption lines and iteratively
              and  reject outlying pixel values before fitting 
   tellmask - only mask telluric features
   doplot   - generate a plot of the fit and the masked pixels 
   debug    - wait for a keystroke after making the plot 
   silent   - suppress messages to STDOUT

 OUTPUTS:
   continuum - the fit to the continuum [NPIX]

 OPTIONAL OUTPUTS:
   nocflux - FLUX divided by the continuum [NPIX]
   sset    - if METHOD=1 then return the b-spline structure

 COMMENTS:
   if MASK is set then use an iterative procedure.  Fit the
   continuum without masking to do a coarse normalization, then
   identify peaks in the spectrum, mask those pixels, and re-fit
   the continuum.

 PROCEDURES USED:
   FIND_NPEAKS(), EMISSION_MASK(), FIND_NPEAKS(), DJS_ITERSTAT,
   GET_ELEMENT, DKBOXSTATS(), BSPLINE_ITERFIT(), DJS_MEDIAN(),
   POLY_ARRAY(), MPFITFUN(), POLY_ARRAY(), MPFITFUN(),
   FUNC_FIT(), POLYLEG(), DJS_PLOT, DJS_OPLOT

 EXAMPLE:

 MODIFICATION HISTORY:
   J. Moustakas, 2002 November 4, U of A
   jm03feb20uofa - rewritten and documented
   jm04jul20uofa - added PLOTTHICK input
   jm04sep12uofa - added TELLMASK keyword
   jm05jun30uofa - bug fix when TELLMASK=1 and no telluric
                   features are within the wavelength range 

 Copyright (C) 2002-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_fitcontinuum.pro)</strong></p>
<hr />
<h3 id="IM_FITEXY">IM_FITEXY</h3>
<p><a href="#IM_FITCONTINUUM_F">[Previous Routine]</a></p>
<p><a href="#IM_FITS_CUBE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_FITEXY

 PURPOSE:
   Calls FITEXY (linear least squares with errors in both axes) with
   iterative outlier rejection. 

 INPUTS:
   x, y - input data [NPTS]

 OPTIONAL INPUTS:
   xerr, yerr - corresponding uncertainties on X,Y [NPTS] 
   nsig - sigma rejection threshold (default 3)
   niter - number of iterations (default 10)

 KEYWORD PARAMETERS:

 OUTPUTS:
   yfit - best-fitting model [NPTS]
   coeff - best-fit linear coefficients [2]
   good - indices of points not rejected
   reject - indices of rejected points

 MODIFICATION HISTORY:
       J. Moustakas, 2006 Jan 19, U of A - based on POLY_ITER 

 Copyright (C) 2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/fitting/im_fitexy_iter.pro)</strong></p>
<hr />
<h3 id="IM_FITS_CUBE_F">IM_FITS_CUBE()</h3>
<p><a href="#IM_FITEXY">[Previous Routine]</a></p>
<p><a href="#IM_GALEX_TO_MAGGIES">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_FITS_CUBE()

 PURPOSE:
	Rad many FITS images into a structure cube.

 CALLING SEQUENCE:
	cube = fits_cube(flist, [path=])

 INPUTS:
	flist - string array of FITS file names

 OPTIONAL INPUTS:
	path  - the data path to the FITS files

 KEYWORD PARAMETERS:

 OUTPUTS:
	cube  - structure cube with an image and header field 

 OPTIONAL OUTPUTS:
	head  - header of the first image

 COMMENTS:
	Extra keywords can be passed to READFITS.  This routine is
	based on DJS_READMANY, but has been expanded to return the
	FITS header as a structure field.

 PROCEDURES USED:
	READFITS()

 MODIFICATION HISTORY:
	J. Moustakas, 2001 Aug 12, U of A, written
       jm02nov1uofa - added additional error checking
       jm02nov27uofa - generalized to read in one-dimensional FITS
                       files
       jm04nov05uofa - updated the HEADER string array from 500 to
                       1000 elements
       jm13may27siena - use GZ_MRDFITS in lieu of READFITS()

 Copyright (C) 2001-2002, 2004, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/im_fits_cube.pro)</strong></p>
<hr />
<h3 id="IM_GALEX_TO_MAGGIES">IM_GALEX_TO_MAGGIES</h3>
<p><a href="#IM_FITS_CUBE_F">[Previous Routine]</a></p>
<p><a href="#IM_GAUSS_BROADEN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_GALEX_TO_MAGGIES

 PURPOSE:
   Convert an input GALEX photometric catalog to Galactic
   extinction-corrected AB maggies. 

 INPUTS: 
   galex - input catalog [NGAL]

 OPTIONAL INPUTS: 

 KEYWORD PARAMETERS: 
   allow_nuv_nondetect - allow photometry of objects not detected in
     the NUV, but with measured FUV photometry (in general objects
     without solid NUV detections should not be used) (has no effect
     if /PSF_FLUX)
   psf_flux - use the PSF flux from the Schiminovich catalogs (default is
     to use the AUTO flux) 

 OUTPUTS: 
   maggies - [2,NGAL] output FUV/NUV maggies 
   ivarmaggies - [2,NGAL] corresponding inverse variance

 OPTIONAL OUTPUTS:
   filterlist - GALEX filterlist names

 COMMENTS:
   A minimum photometric error of [0.052,0.026] for [FUV,NUV] is
   applied, as recommended by Morrissey+07.  Uses the MAG_AUTO
   photometry by default.

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Apr 30, UCSD - based loosely on
     M. Blanton's GALEX_TO_MAGGIES
   jm11aug30ucsd - added ALLOW_NUV_NONDETECT keyword

 Copyright (C) 2010-2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_galex_to_maggies.pro)</strong></p>
<hr />
<h3 id="IM_GAUSS_BROADEN_F">IM_GAUSS_BROADEN()</h3>
<p><a href="#IM_GALEX_TO_MAGGIES">[Previous Routine]</a></p>
<p><a href="#IM_GETMATRIX_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_GAUSS_BROADEN()

 PURPOSE:
       Degrade the spectral resolution of a spectrum. 

 CALLING SEQUENCE:
       broadflux = im_gauss_broaden(wave,flux,oldres,newres)

 INPUTS:
       wave   - wavelength vector (Angstrom) [NPIX]
       flux   - corresponding flux vector (either an [NPIX] vector or
                an [NPIX,NSTAR] array)
       oldres - original spectral resolution that can be either a
                scalar or an [NPIX] vector [Angstrom, FWHM]
       newres - new, output spectral resolution [Angstrom, FWHM]

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:

 OUTPUTS:
       broadflux - FLUX array degraded in spectral resolution

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       GCONVOLVE()

 COMMENTS:
       Note that if either the spectral dispersion, OLDRES, or NEWRES
       are not constant then this routine is quite slow (because we
       have to loop on each pixel in the flux array).

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 November 2, U of A

 Copyright (C) 2003, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_gauss_broaden.pro)</strong></p>
<hr />
<h3 id="IM_GETMATRIX_F">IM_GETMATRIX()</h3>
<p><a href="#IM_GAUSS_BROADEN_F">[Previous Routine]</a></p>
<p><a href="#IM_GETPOSITION_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
     IM_GETMATRIX()

 PURPOSE:
     Returns the energy levels, Einstein A-values, and the matrix
     of collision strengths for the desired N-level atom at the
     desired temperature.

 EXPLANATION:
     This procedure is invoked by the IDL NEBULAR procedure 'NLEVEL'.
     It returns the atomic data necessary to calculate the quasi-static
     N-level atom for the requested ion.  This in turn is used to
     calculate the emission-line spectrum for the ion in an electron
     gas of the requested temperature.

 CALLING SEQUENCE:
     GETMATRIX, IONSTR, TT, QVAL, EN, EINAS

 INPUT:
     IONSTR: string designating the ion for which the atomic data 
               will be used in the matrix.
     TT: electron temperature, in K.


 OUTPUT:
     QVAL: The matrix of rate coefficients between the various N levels.
     EN: A vector containg the N energy levels of the ion, in eV.
     EINAS: Einstein A-values for the N energy levels, in 1/s.


 OPTIONAL INPUT KEYWORD:
     None.

 EXAMPLE:
    To get the matrix of Q-values, energy levels, and Einstein A-values
    of the O++ ion at 10,000 K, the command would be

     GETMATRIX, 'O_III', 1d4, QVAL, EN, EINAS

 NOTES:
     The ions are called by the spectroscopic notation for the ion. The
     underscore is used to separate the atomic symbol from the Roman
     numeral designation, to avoid any ambiguities.  So, for example,
     the S+ ion is called with 'S_II', O++ is called with 'O_III', &amp;c.
     The calling string is not case-sensitive.


 REVISION HISTORY:
       1.0	B.D.Moore	Rice Univ.	September 2003
</pre>
<p><strong>(See pro/hiiregions/im_getmatrix.pro)</strong></p>
<hr />
<h3 id="IM_GETPOSITION_F">IM_GETPOSITION()</h3>
<p><a href="#IM_GETMATRIX_F">[Previous Routine]</a></p>
<p><a href="#IM_HDA_EMCOR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_GETPOSITION()

 PURPOSE:
   Compute the position coordinates of one or more plots (without
   using !p.multi) under various constraints.  

 INPUTS: 
   None required.

 OPTIONAL INPUTS: 
   nx - number of plots from left to right (default=1)
   ny - number of plots from top to bottom (default=1)                  
   xmargin - left/right margin, array of 1 or 2 values (inches,
     default=[1.25,0.75]) 
   ymargin - top/bottom margin, array of 1 or 2 values (inches,
     default=[0.75,0.75]) 
   width - width of each plot, array of 1 or nx values (inches) 
   height - height of each plot, array of 1 or ny values (inches) 
   xspace - horizontal spacing between plots, array of 1 or nx-1
     values, (inches) 
   yspace - vertical spacing between plots, array of 1 or ny-1 values
     (inches) 
   xpage - length of plot area from left to right (inches,
     default=8.5) 
   ypage - length of plot area from top to bottom (inches,
     default=11.0)  

 KEYWORD PARAMETERS: 
   landscape - rotates orientation of each plot 90 degrees

 OUTPUTS: 
   position - an N by (nx x ny) array of plot coordinates
     (normalized), the N elements are [x0,y0,x2,y2] where the plot
     corners are ordered 0-3 counter-clockwise from the lower-left 

 COMMENTS:
   This routine is designed to be used in tandem with IM_PLOTCONFIG. 

 EXAMPLES:
   plot, findgen(10), position=im_getposition()

 MODIFICATION HISTORY:
   J. Moustakas, 2009-Nov-03, UCSD - shamelessly hacked
     version of Andy Marble's ARM_PLOTCONFIG. 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_getposition.pro)</strong></p>
<hr />
<h3 id="IM_HDA_EMCOR_F">IM_HDA_EMCOR()</h3>
<p><a href="#IM_GETPOSITION_F">[Previous Routine]</a></p>
<p><a href="#IM_HEADERFORAGE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_HDA_EMCOR()

 PURPOSE:
   Given an H-alpha flux and a Ha/Hb Balmer decrement, compute the
   appropriate correction to apply to the Lick H-delta_A index to
   account for emission-line filling.

 INPUTS: 
   linenodust - iSPEC-style data structure of reddening-corrected
     emission-line fluxes (specifically, the output of
     IUNRED_LINEDUST)  

 OUTPUTS: 
   hdcor - output data structure with the following tags:
     H_DELTA_DUST_PREDICT - *predicted, reddened* H-delta
       emission-line flux and error
     H_DELTA_NODUST - *predicted, unreddened* H-delta
       emission-line flux and error
     LICK_HD_A_COR - corrected Lick Hd A index 

 COMMENTS:
   Could use better error checking.

 MODIFICATION HISTORY:
   J. Moustakas, 2008 May 20, NYU

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_hda_emcor.pro)</strong></p>
<hr />
<h3 id="IM_HEADERFORAGE_F">IM_HEADERFORAGE()</h3>
<p><a href="#IM_HDA_EMCOR_F">[Previous Routine]</a></p>
<p><a href="#IM_HESSPLOT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_HEADERFORAGE()

 PURPOSE:
   Return the contents of a FITS file header as a structure.

 INPUTS: 
   fitslist - list of FITS files

 OPTIONAL INPUTS: 
   ext - extension number to read

 OUTPUTS: 
   forage - data structure with all the header entries as individual
     structure tags

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Apr 07, U of A
   jm08aug06nyu - removed DATAPATH input; absolute file name now
     assumed; EXT optional input added 

 Copyright (C) 2005, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/im_headerforage.pro)</strong></p>
<hr />
<h3 id="IM_HESSPLOT">IM_HESSPLOT</h3>
<p><a href="#IM_HEADERFORAGE_F">[Previous Routine]</a></p>
<p><a href="#IM_HIST1D">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_HESSPLOT

 PURPOSE:
   Generate a Hess diagram.

 INPUTS:
   x - X-values
   y - Y-values

 OPTIONAL INPUTS:
   logexp    - logarithmic scaling factor [default 1.0; see
               LOGSCL()]
   nxbin2d   - number of X-pixels in the output image
   nybin2d   - number of Y-pixels in the output image
   minpts    - if the number of data points in a pixel is less
               than MINPTS then make the pixel value zero
               (default 1)
   extra     - extra keywords for PLOTIMAGE

 KEYWORD PARAMETERS:
   negative  - generate a negative image (e.g., for postscript
               output) 

 OUTPUTS:
 
 OPTIONAL OUTPUTS:
   image - binned image [NXBIN2D,NYBIN2D]

 COMMENTS:

 EXAMPLES:
   IDL&gt; x = randomn(seed,1E5) &amp; y = randomn(seed,1E5)
   IDL&gt; im_hessplot, x, y, xrange=[-2.5,2.5], yrange=[-4,4], /negative

 MODIFICATION HISTORY:
   J. Moustakas, 2006 July 24, U of A - written
   jm08jun25nyu - allow rectangular images; choose the default
                  dimensions as in HOGG_SCATTERPLOT

 Copyright (C) 2006, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_hessplot.pro)</strong></p>
<hr />
<h3 id="IM_HIST1D">IM_HIST1D</h3>
<p><a href="#IM_HESSPLOT">[Previous Routine]</a></p>
<p><a href="#IM_HOGG_SCATTERPLOT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
        IM_HIST1D

 PURPOSE:
        Returns the weighted histogram of a 1D array.

 CATEGORY:
        Image processing, statistics, probability.

 CALLING SEQUENCE:
        Result = HIST1D( Array [, Weight, OBIN=Obin, ..other HISTOGRAM keywords] )

 INPUTS:
        Array:    1D array which holds the data to be histogrammed.

 OPTIONAL INPUTS:
       Weight:    1D array of the same dimension as Array which holds the
             weighted values associated with each Array element.

 INPUT KEYWORD PARAMETERS:
      BINSIZE:    The size of the bin to use. If this keyword is not specified,
             a bin size of 1 is used.

        INPUT:    1D array to be added to the output of HIST1D.

          HISTMAX:    The maximum value to consider in the histogram.  If this
             keyword is not specified, Array is searched for its largest value.

          HISTMIN:    The minimum value to consider in the histogram.  If this
             keyword is not specified, and Array is of type byte, 0 is used.
             If this keyword is not specified and Array is not of byte type,
             Array is searched for its smallest value.

      BINEDGE:    This keyword specfies the location of the bin values returned
             by OBIN. The values are:

                  0 : Center of each bin, [DEFAULT].
                 -1 : Left  or lower edge of each bin.
                  1 : Right or upper edge of each bin.

 OUTPUTS:
        1D weighted histogram of Array using the Weight array.  If Weight
        is not specified, then the usual 1D histogram or density function
        is returned.

 OUTPUT KEYWORD PARAMETERS:

      DENSITY:    Density function of Array; i.e. the unweighted 1D histogram.

         OBIN:    An array holding the bin values of the histogram.

         OMAX:    A named variable that, upon exit, contains the maximum data
             value used in constructing the histogram.

         OMIN:    A named variable that, upon exit, contains the minimum data
             value used in constructing the histogram.

 REVERSE_INDICES: Set this keyword to a named variable in which the list of
             reverse indices is returned.  This list is returned as a longword
             vector whose number of elements is the sum of the number of elements
             in the histogram, N, and the number of array elements included in
             the histogram.

             The subscripts of the original array elements falling in the
             ith bin, 0 le i lt N, are given by the expression: R(R(i):R(i+1)-1),
             where, R is the reverse index list.  If R(i) is equal to R(i+1),
             no elements are present in the ith bin.

 EXAMPLE:
        Here'a a very simple example of a weighted histogram:

        z = indgen(10)
        w = z
        y = HIST1D( z,w,OBIN=x)
        plot,x,y,psym=10

 MODIFICATION HISTORY:
        Written by:    Han Wen, July, 1994.
        01-AUG-1994    Forced H to be double, H=double(Density) avoids
                       the intermittent bug when H returns as a INTEGER
                       histogram!
        31-JAN-1995    Added the ANONYMOUS_ keyword to avoid a very subtle/
                       rare bug with _EXTRA keyword. (Has no functionality
                       for the USER -&gt; Internal user only.)
        21-FEB-1995    Bugfix: didn't add Input to histogram for 1D,
                       UN-weighted histogram. Also made use of TEMPORARY.
        09-JAN-1995    Bugfix: change for loop index to long instead of fix.
                       Improperly indexed R(R(i)) pointers.
        28-FEB-1996    Added the BINEDGE keyword.
        06-APR-1996    Assume the data type of the Weight parameter if
                       specified. (previously defaulted to double)
        2007-Nov-20    J. Moustakas, NYU: added error output, YLOG
                       optional keyword, and changed MIN/MAX to
                       HISTMIN/HISTMAX to avoid conflicts with PLOT
                       in IM_PLOTHIST

</pre>
<p><strong>(See pro/math/im_hist1d.pro)</strong></p>
<hr />
<h3 id="IM_HOGG_SCATTERPLOT">IM_HOGG_SCATTERPLOT</h3>
<p><a href="#IM_HIST1D">[Previous Routine]</a></p>
<p><a href="#IM_HYPERFIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   im_hogg_scatterplot
 PURPOSE:
   plot greyscale scatterplot with contours
 COMMENTS:
   Doesn't overplot -- only plots.  This is because the IDL tvscl blots
     out any other information on the plot.
   Compares cumulated grid to the *total* weight -- ie, including points
     outside the range (which is what you want; trust me).
 INPUTS:
   x,y         - data values
 OPTIONAL INPUTS:
   weight      - weighting for data points; default unity
   xnpix       - width of greyscale grid in pixels; default 0.3*sqrt(N)
   ynpix       - height of greyscale grid in pixels; same default
   xrange      - x range; default minmax(x)
   yrange      - y range; default minmax(y)
   levels      - contour levels; default in source code
   quantiles   - quantiles to plot on conditional plot; default
                 [0.25,0.5,0.75]
   cthick      - thickness for contours
   exponent    - stretch greyscale at exponent power; default 1.0
   satfrac     - fraction of pixels to saturate in greyscale; default 0
   darkest     - darkest shade at saturation; default 127; lower darker
   outliers_psym    - NEEDS DOCUMENTATION
   outliers_color   - NEEDS DOCUMENTATION
   outliers_symsize - NEEDS DOCUMENTATION
   grid        - input grid for running with &quot;/usegrid&quot;
   [etc]       - extras passed to &quot;plot&quot; command
 KEYWORDS:
   conditional     - normalize each column separately
   labelcont       - label contours with numbers
   internal_weight - use only the points in the image to determine
                     contours
   nocontours      - don't plot the contours
   nogreyscale     - don't plot the greyscale
   adqgreyscale    - do greyscale in the &quot;ADQ&quot; style (only works when
                     conditional is set)
   outliers        - NEEDS DOCUMENTATION
   meanweight      - plot the mean of the weight values that land in
                     that pixel, rather than the total; don't use
                     with /conditional!
   usegrid         - use input grid rather than compute from x,y;
                     over-rules x,y inputs; needs matched
                     xnpix,ynpix; brittle
 OPTIONAL OUTPUTS:
   xvec        - [xnpix] vector of x values of grid pixel centers
   yvec        - [ynpix] vector of y values of grid pixel centers
   grid        - the greyscale grid [xnpix,ynpix] that was plotted
   cumimage    - the cumulated grid [xnpix,ynpix] that was contoured
   outquantiles - the plotted quantiles (when /conditional is set)
   ioutliers   - indices of outlier points
 COMMENTS:
   When output, the grid is in units of unit_weight, not in 
   unit_weight per unit_x per unit_y (as you would want to do if 
   you wanted to directly compare two results using different
   resolution grids); the user will have to convert to that themselves.
 BUGS:
   Doesn't check inputs.
   Ought to specify saturation not as a fraction of pixels, but as a fraction
     of the total weight (ie, saturate inside a particular, specifiable
     confidence region).  This mod is trivial.
   Ought to specify min and max grey levels, and contour colors.
   Contour thicknesses hard-coded to unity.
 DEPENDENCIES:
   hogg_histogram
   plus much, much more
 REVISION HISTORY:
   2002-12-04  written --- Hogg
   J. Moustakas, various personal hacks
</pre>
<p><strong>(See pro/plot/im_hogg_scatterplot.pro)</strong></p>
<hr />
<h3 id="IM_HYPERFIT_F">IM_HYPERFIT()</h3>
<p><a href="#IM_HOGG_SCATTERPLOT">[Previous Routine]</a></p>
<p><a href="#IM_IMAGECOMPARE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_HYPERFIT()

 PURPOSE:
       Fit a hyperbola to data with the option of constraining any of
       the coefficients. 

 CALLING SEQUENCE:
       coeff = im_hyperfit(x,y,yerr=,coeff_guess=,coeff_fixed,$
          coeff_limits=,coeff_limited=,coeff_err=,yfit=,chi2=)

 INPUTS:
       x - data along the x axis [NPTS]
       y - data along the y axis [NPTS]

 OPTIONAL INPUTS:
       yerr          - uncertainty in Y [NPTS]
       coeff_guess   - coefficients to use as the best-guess starting
                       values [2-element vector]
       coeff_fixed   - coefficients to fix (see MPFITFUN) [2-element
                       byte array]; (0B=free, 1B=fixed)
       coeff_limits  - coefficients limits (see MPFITFUN)
                       [2x2-element float array]
       coeff_limited - see MPFITFUN [2x2-element byte array]

 KEYWORD PARAMETERS:
       None.

 OUTPUTS:
       coeff - coefficients of the best-fitting hyperbola; the model
               is  Y = COEFF[0] / (X + COEFF[1]) + COEFF[2]

 OPTIONAL OUTPUTS:
       coeff_err - formal one-sigma uncertainties in COEFF (only
                   meaningful if YERR is given) [2-element vector] 
       yfit      - best-fitting model [NPTS]
       chi2      - reduced chi-squared statistic (only meaningful
                   if YERR is given)

 PROCEDURES USED:
       MPFITFUN()

 COMMENTS:
       It would be nice to be able to pass uncertainties in X as well
       as Y. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 July 18, U of A - written
       jm03aug08uofa - added COEFF_GUESS optional input 
       jm05mar05uofa - documented and cleaned up
       jm06feb11uofa - added COEFF_LIMITED and COEFF_LIMITS inputs 

 Copyright (C) 2002-2003; 2005-2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/fitting/im_hyperfit.pro)</strong></p>
<hr />
<h3 id="IM_IMAGECOMPARE">IM_IMAGECOMPARE</h3>
<p><a href="#IM_HYPERFIT_F">[Previous Routine]</a></p>
<p><a href="#IM_IMGSCL_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_IMAGECOMPARE

 PURPOSE:
	Interactively compare two images in a single graphics window.

 INPUTS:
	image1 : 2D image
	image2 : second 2D image to compare to the first

 KEYWORD PARAMETERS:

 OUTPUTS:

 COMMON BLOCKS:

 RESTRICTIONS:

 PROCEDURE:
	Use any of the mouse buttons to move the second image around,
	and press the first and third mouse buttons together to quit.

 COMMENTS:
	Any sized images can be compared, but the larger image needs
	to be larger in both dimensions.  The images can be of any
	datatype.  

 PROCEDURES USED:
	DATATYPE()	

 MODIFICATION HISTORY:
	John Moustakas, August 2000, UCB/UofA (with contributions by
	  Doug Finkbeiner, UCB) 

 Copyright (C) 2000, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_imagecompare.pro)</strong></p>
<hr />
<h3 id="IM_IMGSCL_F">IM_IMGSCL()</h3>
<p><a href="#IM_IMAGECOMPARE">[Previous Routine]</a></p>
<p><a href="#IM_INTEGRAL_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_IMGSCL()

 PURPOSE:
   Scale/stretch an image for display.

 INPUTS:
   image - input image

 OPTIONAL INPUTS:
   losig - low sigma threshold (default -2)
   hisig - high sigma threshold (default 3)
   boxfrac - fraction of the image in each dimension to use when
     computing statistics (default 0.2)
   topvalue - top image scaling value (default 239) 
   minvalue - bottom image scaling value (default -10)

 KEYWORD PARAMETERS:
   log - take the log of the image
   sqrroot - take the square root of the image
   negative - invert the image

 OUTPUTS:
   img - byte-scaled image

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Mar 22, U of A - written
   jm05jul25uofa - several improvements
   jm11aug08ucsd - documented

 Copyright (C) 2005, 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/im_imgscl.pro)</strong></p>
<hr />
<h3 id="IM_INTEGRAL_F">IM_INTEGRAL()</h3>
<p><a href="#IM_IMGSCL_F">[Previous Routine]</a></p>
<p><a href="#IM_IONSPEC">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_INTEGRAL()

 PURPOSE:
       Routine to perform trapezoidal integration in X,Y between
       limits xmin to xmax. 

 CALLING SEQUENCE:
	result = integral(x,y,xmin,xmax)

 INPUTS:
	x,y - vectors to be integrated
	xmin,xmax - vectors with lower and upper integral limits
 OUTPUTS:
	the integrations between xmin and xmax are returned
	as the function result
 RESTRICTIONS:
	The values in XMIN must be greater than or equal to the minimum
	of X. The values in XMAX must be less than or equal to the 
	maximum of X. X must be in ascending order.

 HISTORY:
	Version 1,  D. Lindler  (a long time ago)
	Version 2,  JKF/ACC	28-jan-1992	- moved to IDL V2.
 	Version 3,  DJL 	17-jun-1992	- FIXED BUG AT ENDPOINTS
	version 4,  DJL		27-Jul-1992	- fixed previous change to
						  work with vector
						  inputs

       J. Moustakas, 2003 November 25, U of A, made double precision,
          added square brackets, and error checking
       jm08apr14nyu - additional error checking; default XMIN,XMAX to
                      min and max of X array

</pre>
<p><strong>(See pro/math/im_integral.pro)</strong></p>
<hr />
<h3 id="IM_IONSPEC">IM_IONSPEC</h3>
<p><a href="#IM_INTEGRAL_F">[Previous Routine]</a></p>
<p><a href="#IM_IS_IN_WINDOW_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
     IM_IONSPEC
 PURPOSE:
     Calculates the emission-line spectrum of an ion from an N-level
     atom, and returns an array containing the wavelengths and
     line emissivities.

 EXPLANATION:
     This procedure calls the IDL NEBULAR procedure 'NLEVEL', and
     extracts the non-zero emissivities.  These are written to a
     2xN array of the wavelengths and emissivities.  Unless otherwise
     specified, the procedure writes to the screen the transition
     in question, the wavelength, the emissivity relative to H-beta,
     and the emissivity in erg/cm^3/s/[N(Ion) N(e)].


 CALLING SEQUENCE:
     IM_IONSPEC, IONSTR, DENS, TEMP, RESULT, HBETA, ANNOT [, /SILENT ]

 INPUT:
      IONSTR: A string containing the name of the ion to be calculated.
           In general the designation is given by [ABBREV]_[ROMAN]; i.e.,
           doubly-ionized oxygen is 'O_III', neutral silicon is 'SI_I', &amp;c.
           See the procedure 'GETMATRIX' for specifics.
      DENS: The electron density for the emission-line region, in 1/cm^3.
      TEMP: The electron temperature for the emission-line region, in K.


 OUTPUT:

      RESULT: A 2xN matrix containing the wavelengths and emmisivities
           of levels with emissivities &gt; 0 *relative* to H-beta
      HBETA: The emissivity of H-beta at the input electron temperature,
                in units of erg/cm^3/s/[ N(H+) N(e) ].
      ANNOT: String array containing the annotation of the transitions
                in terms of the upper level (UL) and lower level (LL),
                written in the form 'UL --&gt; LL'.  The annotation uses
                LL = 1 for the ground state.

 OPTIONAL INPUT KEYWORD:
      SILENT: Setting this keyword suppresses the output to the screen.


 EXAMPLE:

      The wavelengths and line emissivities for the O++ ion    
      at electron density 100/cm^3 and electron temperature 10,000 K       
      is given by
      
      IONSPEC, 'O_III', 1d2, 1d4, RES, HBETA, ANNOT, /SILENT


 NOTES:
     This procedure is a more user-friendly version of 'NLEVEL',
     which it invokes to calculate the spectrum.

      J. Moustakas, 2007-Nov-27, NYU: default 10,000 K and 100 cm^-3
         temperature and density assumed; LEVEL is optionally
         returned from IM_NLEVEL, which also contains the H-BETA
         emissivity at the specific Te and ne

 REVISION HISTORY:
       1.0	B.D.Moore	Rice Univ.	September 2003

       jm07dec04nyu - hacked significantly
</pre>
<p><strong>(See pro/hiiregions/im_ionspec.pro)</strong></p>
<hr />
<h3 id="IM_IS_IN_WINDOW_F">IM_IS_IN_WINDOW()</h3>
<p><a href="#IM_IONSPEC">[Previous Routine]</a></p>
<p><a href="#IM_IZOTOV_TE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_IS_IN_WINDOW()

 PURPOSE:
   Much faster alternative to IS_IN_WINDOW() that relies on the
   mangle 'polyid' command.  

 INPUTS: 
   polyfile - polygon file name
   ra,dec - celestial coordinates (decimal degrees, preferably
     double precision) [NGALS]

 OPTIONAL INPUTS: 
   tolerance - intersection tolerance (default 1D-8 arcsec)
   scheme - pixelization scheme; default is the native SDSS scheme,
     -Pd0,6 
   tmpdir - output directory for temporary, junk files (default /tmp) 

 KEYWORD PARAMETERS: 
   pixelize - pixelize the polygon file before running polyid
     (default is to assume that 'pixelize' has already been run) 

 OUTPUTS: 
   outflag - Boolean flag: 1=in window, 0=not in window [NGALS] 

 OPTIONAL OUTPUTS:

 COMMENTS:
   Given a polygon file name and a list of coordinates (RA,DEC), this
   routine returns a Boolean flag indicating whether or not each
   object in the input list falls within any of the polygons in
   POLYFILE.  Unlike IS_IN_WINDOW(), however, this routine uses
   polyid, which is much fast for large numbers of polygons and/or
   galaxies. 
 
   Loosely based on J. Aird's IS_IN_WIN_PIX. 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Sep 09, UCSD
   jm11mar15ucsd - optionally return the polyid

 Copyright (C) 2010-2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/im_is_in_window.pro)</strong></p>
<hr />
<h3 id="IM_IZOTOV_TE_F">IM_IZOTOV_TE()</h3>
<p><a href="#IM_IS_IN_WINDOW_F">[Previous Routine]</a></p>
<p><a href="#IM_KCORRECT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_IZOTOV_TE()

 PURPOSE:
       Compute the nebular electron temperature from the [O III] flux 
       ratio using the equations in Izotov et al. (2006).

 CALLING SEQUENCE:
       result = im_compute_te(data,snrcut=)

 INPUTS:
       data - linefit data structure

 OPTIONAL INPUTS:
       snrcut - S/N cut on the emission lines (default 3)

 KEYWORD PARAMETERS:

 OUTPUTS:
       result - results

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       SPLOG, IDL_FIVEL(), IM_COMPUTE_ERROR(), IM_PREDICT_TOII() 

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 July 5, U of A - written
       jm06may01uofa - added SNRCUT

 Copyright (C) 2004, 2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_izotov_oh12te.pro)</strong></p>
<hr />
<h3 id="IM_KCORRECT_F">IM_KCORRECT()</h3>
<p><a href="#IM_IZOTOV_TE_F">[Previous Routine]</a></p>
<p><a href="#IM_LEGEND">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_KCORRECT()

 PURPOSE:
   Wrapper on Blanton's KCORRECT to compute K-corrections from
   and to an arbitrary set of bandpasses; this is a (shamelessly
   hacked) generalized version of Blanton's DEEP_KCORRECT.

 INPUTS: 
   redshift       - redshifts [NGAL]
   maggies        - maggies, Galactic-reddening corrected
                    [IN_NBAND,NGAL] 
   ivarmaggies    - inverse variances corresponding to MAGGIES
                    [IN_NBAND,NGAL]  
   in_filterlist  - list of filter functions corresponding to MAGGIES
                    [IN_NBAND] 
   out_filterlist - list of output filters [OUT_NBAND]

 OPTIONAL INPUTS:
   use_coeffs - use *these* coefficients (do not recompute
     K-corrections and therefore COEFFS); 
   band_shift - blueshift of output bandpasses (to get ^{z}b type
     bands) (default 0.0)  
   vname - name of fit to use (defaults to 'default')  
   h100 - Hubble constant divided by 100; the stellar mass estimates
     and absolute magnitudes are scaled to this value (default 0.7) 
   omega0 - Omega_matter (default 0.3) 
   omegal0 - Omega_Lambda (default 0.7)
   extra - additional keywords for KCORRECT

 KEYWORD PARAMETERS: 
   vega - convert the output magnitudes to Vega (default is AB)   
   not_closest - disable the default, which is to compute the
     K-correction using the closest input bandpass to the desired
     output bandpass  
   silent - do not print messages to STDOUT

 OUTPUTS: 
   kcorrect - K-corrections satisfying based on the best fit sum of
     templates: m_R = M_Q + DM(z) + K_QR(z) (all in AB)
     [OUT_NBAND,NGAL]  

 OPTIONAL OUTPUTS:
   chi2 - chi^2 of fit
   coeffs - coefficients of fit [5,NGAL]
   mass - total current stellar mass from model [NGAL]
   mtol - mass-to-light ratios from model in each output band
     [OUT_NBAND,NGAL]  
   obands - which input bands the K-corrections refer to
     [IN_NBAND,NGAL]  
   bestmaggies - synthesized *observed-frame* maggies corresponding
     to IN_FILTERLIST (equivalent to RMAGGIES returned by K-correct)
     [IN_NBAND,NGAL]  
   synth_outmaggies_obs - synthesized *observed-frame* maggies
     corresponding to OUT_FILTERLIST [OUT_NBAND,NGAL]   
   synth_outmaggies_rest - synthesized *rest-frame* maggies
     corresponding to OUT_FILTERLIST [OUT_NBAND,NGAL]    
   absmag - absolute magnitude (for missing data the code uses the
     synthesized rest-frame photometry in each output band
     [OUT_NBAND,NGAL]   
   ivarabsmag - inverse variance of absolute magnitude (for missing
     data = 0) in each output band [OUT_NBAND,NGAL]   
   synth_absmag - absolute magnitudes synthesized from the
     best-fitting model [OUT_NBAND,NGAL]   
   clineflux - continuum flux at the wavelengths of strong emission
     lines: [OII], H-beta, [OIII], and H-alpha [erg/s/cm^2/A]
   uvflux - continuum flux at 1500 and 2800 A from the best-fitting
     model, useful for computing SFRs [erg/s/cm^2/A]

 COMMENTS:
   This routine uses the bandpass that is closest in effective
   wavelength to the desired output bandpass to compute the
   K-correction (identical to always using /CLOSEST in
   Blanton's DEEP_KCORRECT).

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 07, NYU - shamelessly hacked version
     of M. Blanton's DEEP_KCORRECT
   jm08dec21nyu - added NOT_CLOSEST keyword
   jm09apr30nyu - renamed RMAGGIES to SYNTH_INMAGGIES and added
     SYNTH_OUTMAGGIES as an optional output; bug fix having to do
     with OUT_FILTERLIST
   jm09aug18ucsd - lots of tweaks
   jm09nov24ucsd - added UVFLUX output
   jm11aug29ucsd - added SYNTH_ABSMAG optional output 

 Copyright (C) 2008-2009, 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_kcorrect.pro)</strong></p>
<hr />
<h3 id="IM_LEGEND">IM_LEGEND</h3>
<p><a href="#IM_KCORRECT_F">[Previous Routine]</a></p>
<p><a href="#IM_LF_FIT_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_LEGEND
 PURPOSE:
       Create an annotation legend for a plot.
 EXPLANATION:
       This procedure makes a legend for a plot.  The legend can contain
       a mixture of symbols, linestyles, Hershey characters (vectorfont),
       and filled polygons (usersym).  A test procedure, legendtest.pro,
       shows legend's capabilities.  Placement of the legend is controlled
       with keywords like /right, /top, and /center or by using a position
       keyword for exact placement (position=[x,y]) or via mouse (/position).
 CALLING SEQUENCE:
       LEGEND [,items][,keyword options]
 EXAMPLES:
       The call:
               legend,['Plus sign','Asterisk','Period'],psym=[1,2,3]
         produces:
               -----------------
               |               |
               |  + Plus sign  |
               |  * Asterisk   |
               |  . Period     |
               |               |
               -----------------
         Each symbol is drawn with a plots command, so they look OK.
         Other examples are given in optional output keywords.

       lines = indgen(6)                       ; for line styles
       items = 'linestyle '+strtrim(lines,2)   ; annotations
       legend,items,linestyle=lines            ; vertical legend---upper left
       items = ['Plus sign','Asterisk','Period']
       sym = [1,2,3]
       legend,items,psym=sym                   ; ditto except using symbols
       legend,items,psym=sym,/horizontal       ; horizontal format
       legend,items,psym=sym,box=0             ; sans border
       legend,items,psym=sym,delimiter='='     ; embed '=' betw psym &amp; text
       legend,items,psym=sym,margin=2          ; 2-character margin
       legend,items,psym=sym,position=[x,y]    ; upper left in data coords
       legend,items,psym=sym,pos=[x,y],/norm   ; upper left in normal coords
       legend,items,psym=sym,pos=[x,y],/device ; upper left in device coords
       legend,items,psym=sym,/position         ; interactive position
       legend,items,psym=sym,/right            ; at upper right
       legend,items,psym=sym,/bottom           ; at lower left
       legend,items,psym=sym,/center           ; approximately near center
       legend,items,psym=sym,number=2          ; plot two symbols, not one
       legend,items,/fill,psym=[8,8,8],colors=[10,20,30]; 3 filled squares
 INPUTS:
       items = text for the items in the legend, a string array.
               For example, items = ['diamond','asterisk','square'].
               You can omit items if you don't want any text labels.
 OPTIONAL INPUT KEYWORDS:

       linestyle = array of linestyle numbers  If linestyle[i] &lt; 0, then omit
               ith symbol or line to allow a multi-line entry.     If 
               linestyle = -99 then text will be left-justified.  
       psym = array of plot symbol numbers.  If psym[i] is negative, then a
               line connects pts for ith item.  If psym[i] = 8, then the
               procedure usersym is called with vertices define in the
               keyword usersym.   If psym[i] = 88, then use the previously
               defined user symbol
       vectorfont = vector-drawn characters for the sym/line column, e.g.,
               ['!9B!3','!9C!3','!9D!3'] produces an open square, a checkmark,
               and a partial derivative, which might have accompanying items
               ['BOX','CHECK','PARTIAL DERIVATIVE'].
               There is no check that !p.font is set properly, e.g., -1 for
               X and 0 for PostScript.  This can produce an error, e.g., use
               !20 with PostScript and !p.font=0, but allows use of Hershey
               *AND* PostScript fonts together.
       N. B.: Choose any of linestyle, psym, and/or vectorfont.  If none is
               present, only the text is output.  If more than one
               is present, all need the same number of elements, and normal
               plot behaviour occurs.
               By default, if psym is positive, you get one point so there is
               no connecting line.  If vectorfont[i] = '',
               then plots is called to make a symbol or a line, but if
               vectorfont[i] is a non-null string, then xyouts is called.
       /help = flag to print header
       /horizontal = flag to make the legend horizontal
       /vertical = flag to make the legend vertical (D=vertical)
       box = flag to include/omit box around the legend (D=include)
		  outline_color = color of box outline (D = !P.color)
       clear = flag to clear the box area before drawing the legend
       delimiter = embedded character(s) between symbol and text (D=none)
       colors = array of colors for plot symbols/lines (D=!P.color)
       font = scalar font graphics keyword (-1,0 or 1) for text
       textcolors = array of colors for text (D=!P.color)
       margin = margin around text measured in characters and lines
       spacing = line spacing (D=bit more than character height)
       pspacing = psym spacing (D=3 characters) (when number of symbols is
             greater than 1)
       charsize = just like !p.charsize for plot labels
       charthick = just like !p.charthick for plot labels
       thick = array of line thickness numbers (D = !P.thick), if used, then 
               linestyle must also be specified
       position = data coordinates of the /top (D) /left (D) of the legend
       normal = use normal coordinates for position, not data
       device = use device coordinates for position, not data
       number = number of plot symbols to plot or length of line (D=1)
       usersym = 2-D array of vertices, cf. usersym in IDL manual. 
             (/USERSYM =square, default is to use existing USERSYM definition)
       /fill = flag to fill the usersym
       /left_legend = flag to place legend snug against left side of plot
                 window (D)
       /right_legend = flag to place legend snug against right side of plot
               window.    If /right,pos=[x,y], then x is position of RHS and
               text runs right-to-left.
       /top_legend = flag to place legend snug against top of plot window (D)
       /bottom = flag to place legend snug against bottom of plot window
               /top,pos=[x,y] and /bottom,pos=[x,y] produce same positions.

       If LINESTYLE, PSYM, VECTORFONT, THICK, COLORS, or TEXTCOLORS are
       supplied as scalars, then the scalar value is set for every line or
       symbol in the legend.
 Outputs:
       legend to current plot device
 OPTIONAL OUTPUT KEYWORDS:
       corners = 4-element array, like !p.position, of the normalized
         coords for the box (even if box=0): [llx,lly,urx,ury].
         Useful for multi-column or multi-line legends, for example,
         to make a 2-column legend, you might do the following:
           c1_items = ['diamond','asterisk','square']
           c1_psym = [4,2,6]
           c2_items = ['solid','dashed','dotted']
           c2_line = [0,2,1]
           legend,c1_items,psym=c1_psym,corners=c1,box=0
           legend,c2_items,line=c2_line,corners=c2,box=0,pos=[c1[2],c1[3]]
           c = [c1[0]&lt;c2[0],c1[1]&lt;c2[1],c1[2]&gt;c2[2],c1[3]&gt;c2[3]]
           plots,[c[0],c[0],c[2],c[2],c[0]],[c[1],c[3],c[3],c[1],c[1]],/norm
         Useful also to place the legend.  Here's an automatic way to place
         the legend in the lower right corner.  The difficulty is that the
         legend's width is unknown until it is plotted.  In this example,
         the legend is plotted twice: the first time in the upper left, the
         second time in the lower right.
           legend,['1','22','333','4444'],linestyle=indgen(4),corners=corners
                       ; BOGUS LEGEND---FIRST TIME TO REPORT CORNERS
           xydims = [corners[2]-corners[0],corners[3]-corners[1]]
                       ; SAVE WIDTH AND HEIGHT
           chdim=[!d.x_ch_size/float(!d.x_size),!d.y_ch_size/float(!d.y_size)]
                       ; DIMENSIONS OF ONE CHARACTER IN NORMALIZED COORDS
           pos = [!x.window[1]-chdim[0]-xydims[0] $
                       ,!y.window[0]+chdim[1]+xydims[1]]
                       ; CALCULATE POSITION FOR LOWER RIGHT
           plot,findgen(10)    ; SIMPLE PLOT; YOU DO WHATEVER YOU WANT HERE.
           legend,['1','22','333','4444'],linestyle=indgen(4),pos=pos
                       ; REDO THE LEGEND IN LOWER RIGHT CORNER
         You can modify the pos calculation to place the legend where you
         want.  For example to place it in the upper right:
           pos = [!x.window[1]-chdim[0]-xydims[0],!y.window[1]-xydims[1]]
 Common blocks:
       none
 Procedure:
       If keyword help is set, call doc_library to print header.
       See notes in the code.  Much of the code deals with placement of the
       legend.  The main problem with placement is not being
       able to sense the length of a string before it is output.  Some crude
       approximations are used for centering.
 Restrictions:
       Here are some things that aren't implemented.
       - An orientation keyword would allow lines at angles in the legend.
       - An array of usersyms would be nice---simple change.
       - An order option to interchange symbols and text might be nice.
       - Somebody might like double boxes, e.g., with box = 2.
       - Another feature might be a continuous bar with ticks and text.
       - There are no guards to avoid writing outside the plot area.
       - There is no provision for multi-line text, e.g., '1st line!c2nd line'
         Sensing !c would be easy, but !c isn't implemented for PostScript.
         A better way might be to simply output the 2nd line as another item
         but without any accompanying symbol or linestyle.  A flag to omit
         the symbol and linestyle is linestyle[i] = -1.
       - There is no ability to make a title line containing any of titles
         for the legend, for the symbols, or for the text.
 Side Effects:
 Modification history:
       write, 24-25 Aug 92, F K Knight (knight@ll.mit.edu)
       allow omission of items or omission of both psym and linestyle, add
         corners keyword to facilitate multi-column legends, improve place-
         ment of symbols and text, add guards for unequal size, 26 Aug 92, FKK
       add linestyle(i)=-1 to suppress a single symbol/line, 27 Aug 92, FKK
       add keyword vectorfont to allow characters in the sym/line column,
         28 Aug 92, FKK
       add /top, /bottom, /left, /right keywords for automatic placement at
         the four corners of the plot window.  The /right keyword forces
         right-to-left printing of menu. 18 Jun 93, FKK
       change default position to data coords and add normal, data, and
         device keywords, 17 Jan 94, FKK
       add /center keyword for positioning, but it is not precise because
         text string lengths cannot be known in advance, 17 Jan 94, FKK
       add interactive positioning with /position keyword, 17 Jan 94, FKK
       allow a legend with just text, no plotting symbols.  This helps in
         simply describing a plot or writing assumptions done, 4 Feb 94, FKK
       added thick, symsize, and clear keyword Feb 96, W. Landsman HSTX
               David Seed, HR Wallingford, d.seed@hrwallingford.co.uk
       allow scalar specification of keywords, Mar 96, W. Landsman HSTX
       added charthick keyword, June 96, W. Landsman HSTX
       Made keyword names  left,right,top,bottom,center longer,
                                 Aug 16, 2000, Kim Tolbert
       Added ability to have regular text lines in addition to plot legend 
       lines in legend.  If linestyle is -99 that item is left-justified.
       Previously, only option for no sym/line was linestyle=-1, but then text
       was lined up after sym/line column.    10 Oct 2000, Kim Tolbert
       Make default value of thick = !P.thick  W. Landsman  Jan. 2001
       Don't overwrite existing USERSYM definition  W. Landsman Mar. 2002
	     Added outline_color BT 24 MAY 2004
       Pass font keyword to xyouts commands.  M. Fitzgerald, Sep. 2005
       Default spacing, pspacing should be relative to charsize. M. Perrin, July 2007
       Don't modify position keyword  A. Kimball/ W. Landsman Jul 2007
       Small update to Jul 2007 for /NORMAL coords.  W. Landsman Aug 2007

 J. Moustakas, 2008 Aug 21, NYU - use SYMCAT() symbols and IM_COLOR()
 jm08aug25nyu - added symthick optional input
</pre>
<p><strong>(See pro/plot/im_legend.pro)</strong></p>
<hr />
<h3 id="IM_LF_FIT_SCHECHTER_F">IM_LF_FIT_SCHECHTER()</h3>
<p><a href="#IM_LEGEND">[Previous Routine]</a></p>
<p><a href="#IM_LF_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LF_FIT_SCHECHTER()

 PURPOSE:
   Fit a binned luminosity function using a Schechter model. 

 INPUTS: 
   absmag - absolute magnitude at the center of each bin [NGAL] 
   phi - number density, i.e., the luminosity function (Mpc^-3) [NGAL] 
   phierr - 1-sigma uncertainty in PHI [NGAL]

 OPTIONAL INPUTS: 
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   schechter - output structure with
     .PHISTAR - number density at the 'knee' of the LF
     .MSTAR - absolute magnitude at the 'knee' of the LF
     .ALPHA - low-mass slope
     .PHISTAR_ERR
     .MSTAR_ERR
     .ALPHA_ERR
     .CHI2_DOF - reduce chi^2
     .COVAR[3,3] - covariance matrix

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Apr 14, NYU - based largely on
     M. Blanton's LF_FIT_SCHECHTER 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_lf_fit_schechter.pro)</strong></p>
<hr />
<h3 id="IM_LF_SCHECHTER_F">IM_LF_SCHECHTER()</h3>
<p><a href="#IM_LF_FIT_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#IM_LIGHT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LF_SCHECHTER()

 PURPOSE:
   Generate a Schechter model given the relevant parameters.

 INPUTS: 
   absmag - absolute magnitudes at which to evaluate the model 
   phistar - number density at the 'knee' of the LF
   mstar - absolute magnitude at the 'knee' of the LF
   alpha - low-mass slope

 OPTIONAL INPUTS: 
   schechter - IM_FIT_LF_SCHECHTER() style structure with PHISTAR,
     MSTAR,  and ALPHA (takes precedence over PHISTAR, MSTAR, and
     ALPHA)  

 OUTPUTS: 
   model - absolute magnitude (not luminosity) version of the
     Schechter model Phi(M)  
 
 COMMENTS:
   Note that Phi(M) = ln(10)*L*Phi(L) where L is luminosity. 

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Apr 14, NYU - based largely on
     M. Blanton's LF_FIT_SCHECHTER 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_lf_schechter.pro)</strong></p>
<hr />
<h3 id="IM_LIGHT_F">IM_LIGHT()</h3>
<p><a href="#IM_LF_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#IM_LINEAR_REBIN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LIGHT()
 PURPOSE:
   Return the speed of light in various units.
 KEYWORD PARAMETERS:
   meters - 
   cms - 
   micron - 
   angstrom - 
   kms - (default)
 MODIFICATION HISTORY:
   J. Moustakas, 2010 Jan 01, UCSD
</pre>
<p><strong>(See pro/misc/im_light.pro)</strong></p>
<hr />
<h3 id="IM_LINEAR_REBIN_F">IM_LINEAR_REBIN()</h3>
<p><a href="#IM_LIGHT_F">[Previous Routine]</a></p>
<p><a href="#IM_LINEFIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LINEAR_REBIN()

 PURPOSE:
   Rebin a spectrum linearly in wavelength.

 INPUTS: 
   wave - input wavelength vector with arbitrary pixel spacing
     [Angstrom, NPIX]
   flux - corresponding flux vector [NPIX]

 OPTIONAL INPUTS: 
   ferr - corresponding error spectrum [NPIX]
   minwave - minimum output wavelength [Angstrom] (default:
     min(wave)) 
   maxwave - maximum output wavelength [Angstrom] (default:
     max(wave)) 
   dwave - output pixel size [Angstrom] (defaults to the average
     pixel size over the whole spectrum)

 KEYWORD PARAMETERS: 
   conserve_intensity - by default, this routine conserves *flux*;
     use this keyword to account for the change in the size of the 
     pixels in order to conserve intensity

 OUTPUTS: 
   outflux - output flux vector [NOUTPIX] 

 OPTIONAL OUTPUTS:
   outwave - output wavelength vector [Angstrom, NOUTPIX] 
   outferr - output err spectrum [NOUTPIX] 

 COMMENTS:
   Double precision is strongly recommended!

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2009-Nov-30, UCSD - code hacked and adapted from
     original code written by Mina Koleva 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_linear_rebin.pro)</strong></p>
<hr />
<h3 id="IM_LINEFIT_F">IM_LINEFIT()</h3>
<p><a href="#IM_LINEAR_REBIN_F">[Previous Routine]</a></p>
<p><a href="#IM_LINEID_PLOT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LINEFIT()

 PURPOSE:
   Fit a line to data with the option of constraining any of the
   coefficients. 

 CALLING SEQUENCE:
   coeff = im_linefit(x,y,yerr=,coeff_guess=,coeff_fixed,$
      coeff_limits=,coeff_limited=,coeff_err=,yfit=,chi2=)

 INPUTS:
   x - data along the x axis [NPTS]
   y - data along the y axis [NPTS]

 OPTIONAL INPUTS:
   yerr          - uncertainty in Y [NPTS]
   coeff_guess   - coefficients to use as the best-guess starting
                   values [2-element vector]
   coeff_fixed   - coefficients to fix (see MPFITFUN) [2-element
                   byte array]; (0B=free, 1B=fixed)
   coeff_limits  - coefficients limits (see MPFITFUN)
                   [2x2-element float array]
   coeff_limited - see MPFITFUN [2x2-element byte array]

 KEYWORD PARAMETERS:
   None.

 OUTPUTS:
   coeff - coefficients of the best-fitting line; the model is 
           Y = COEFF[0] + COEFF[1]*X

 OPTIONAL OUTPUTS:
   coeff_err - formal one-sigma uncertainties in COEFF (only
               meaningful if YERR is given) [2-element vector] 
   yfit      - best-fitting model [NPTS]
   chi2      - reduced chi-squared statistic (only meaningful
               if YERR is given)

 PROCEDURES USED:
   MPFITFUN()

 COMMENTS:
   It would be nice to be able to pass uncertainties in X as well
   as Y. 

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2002 July 18, U of A - written
   jm03aug08uofa - added COEFF_GUESS optional input 
   jm05mar05uofa - documented and cleaned up
   jm06feb11uofa - added COEFF_LIMITED and COEFF_LIMITS inputs 

 Copyright (C) 2002-2003; 2005-2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/fitting/im_linefit.pro)</strong></p>
<hr />
<h3 id="IM_LINEID_PLOT">IM_LINEID_PLOT</h3>
<p><a href="#IM_LINEFIT_F">[Previous Routine]</a></p>
<p><a href="#IM_LOG_REBIN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_LINEID_PLOT
 PURPOSE:
	 Plot spectrum with specified line identifications annotated at the
	 top of the plot.

 CALLING SEQUENCE:
	lineid_plot, wave, flux, wline, text1, [ text2, 
			LCHARSIZE=, LCHARTHICK=, EXTEND =, ...plotting keywords]

 INPUTS:
	wave - wavelength vector for the plot
	flux - flux vector
	wline - wavelength vector of line identifications.  (only the lines 
		between	the plot limits will be used)
	text1 - string array of text to be used to annotate each line
	text2 - (OPTIONAL) second string array of text to be used for
		line annotation.  Since the text is written with
		proportional spaced characters, TEXT2 can be used if
		you want two sets of annotation to be alinged:

		eg:	Cr IV  1390.009
			Fe V   1390.049
			Ni IV  1390.184
			    instead of
			Cr IV 1390.009
			Fe V 1390.049
			Ni IV 1390.184

 OPTIONAL KEYWORD INPUTS:
	EXTEND - specifies that the annotated lines should have a dotted line 
		extended to the spectrum to indicate the line position.  
		EXTEND can be a scalar (applies to all lines) or a vector with
		a different value for each line.  The value of EXTEND gives 
		the line IDL plot line thickness for the dotted lines.
		If EXTEND is a vector each dotted line can have a different 
		thickness.  A value of 0 indicates that no dotted line is to 
		be drawn. (default = scalar 0)
	LCHARSIZE - the character size of the annotation for each line.
		If can be a vector so that different lines are annotated with 
		different size characters.  LCHARSIZE can be used to make 
		stronger lines have a larger annotation. (default = scalar 1.0).
	LCHARTHICK = the character thickness of the annotation for each line. 
		It can be a vector so that different lines are annotated with 
		characters of varying thickness.   LCHARTHICK can be used to 
		make stronger lines have a bolder annotation. 
		(default = !p.charthick)

	LINEID_PLOT uses the _EXTRA facility to allow the use of any plotting
	keywords (e.g. LINESTYLE, CHARSIZE) to be passed to the plot

 SIDE EFFECTS:
	Program uses SET_VIEWPORT to set the !P.POSITION parameter to allow
	room for the annotation.   This system variable can be reset to the 
	default value by setting !P.POSTION=0 or typing SET_VIEWPORT with no 
	parameters

 OPERATIONAL NOTES:
	Once the program has completed, You can use OPLOT to draw additional
	plots on the display. 

	If your annotated characters are not being rotated properly,
	try setting !P.FONT to a non zero value.
 EXAMPLE:
	Annotate some interstellar lines between 1240 and 1270 A.

	IDL&gt; w = 1240+ indgen(300)*0.1    ;Make a wavelength vector
	IDL&gt; f = randomn(seed,300)        ;Random flux vector
	IDL&gt; id = ['N V','Si II','Si II','Si II']   ;Line IDs
	IDL&gt; wl = [1242.80,1260.42,1264.74,1265.00] ;Line positions
	IDL&gt; lineid_plot,w,f,wl,id,wl,/ext

	Note that LINEID_PLOT is smart enough not to overlap the annotation
	for the two closely spaced lines at 1264.74 and 1265.00	
 HISTORY:
	version 1  D. Lindler Jan, 1992
	Sept 27, 1993  DJL  fixed bug in /extend option
	Apr 19, 1994 DJL corrected bug in sorting of charthick (cthick)
	Sep 1996, W. Landsman,  added _EXTRA keyword, changed keyword names
		CHARTHICK==&gt;LCHARTHICK, CHARSIZE==&gt;LCHARSIZE
	Converted to IDL V5.0   W. Landsman   September 1997
       Work with !P.MULTI   W. Landsman   December 2003
       jm05nov28uofa - added various COLOR inputs to allow colors to be used
                       on the labels; also changed EXTEND keyword to
                       EXTEND_THICK
       jm08aug01nyu - EXTEND_COLOR can be a vector
</pre>
<p><strong>(See pro/plot/im_lineid_plot.pro)</strong></p>
<hr />
<h3 id="IM_LOG_REBIN_F">IM_LOG_REBIN()</h3>
<p><a href="#IM_LINEID_PLOT">[Previous Routine]</a></p>
<p><a href="#IM_LSUN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LOG_REBIN()

 PURPOSE:
   Rebin a spectrum logarithmically (natural log) in wavelength. 

 INPUTS: 
   wave - input wavelength vector with arbitrary pixel spacing
     [Angstrom, NPIX]
   flux - corresponding flux vector [NPIX]

 OPTIONAL INPUTS: 
   vsc - velocity scale, i.e. size of each pixel in the log-rebinned
     spectrum; if not specified, then VSC is computed from the input
     spectrum  [km/s]
   var - corresponding variance spectrum [NPIX]
   minwave - minimum output wavelength [Angstrom] (default:
     min(wave)) 
   maxwave - maximum output wavelength [Angstrom] (default:
     max(wave)) 

 KEYWORD PARAMETERS: 
   conserve_flux - by default, this routine conserves *intensity*
     (flux density), accounting for the change in the size of the 
     pixels; use this keyword to turn this correction off (thereby
     conserving *flux*)
   wavestrict - strictly enforce MINWAVE and MAXWAVE, enabling
     extrapolation (default is to require MINWAVE and MAXWAVE to be
     within range of the input wavelength array)

 OUTPUTS: 
   outflux - output flux vector [NOUTPIX] 

 OPTIONAL OUTPUTS:
   outwave - output wavelength vector [Angstrom, NOUTPIX] 
   outvar - output variance spectrum [NOUTPIX] 

 COMMENTS:
   Double precision is strongly recommended!

   WAVESTRICT can be useful if you're interpolating several
   spectra (separately) onto a common wavelength array.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2009-Nov-30, UCSD - code hacked and adapted from
     original code written by Mina Koleva 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_log_rebin.pro)</strong></p>
<hr />
<h3 id="IM_LSUN_F">IM_LSUN()</h3>
<p><a href="#IM_LOG_REBIN_F">[Previous Routine]</a></p>
<p><a href="#IM_MANYD_SCATTERPLOT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_LSUN()
 PURPOSE:
   Return the solar luminosity in erg/s.
 KEYWORD PARAMETERS:
   watts - 
 MODIFICATION HISTORY:
   J. Moustakas, 2010 Feb 17, UCSD
</pre>
<p><strong>(See pro/misc/im_lsun.pro)</strong></p>
<hr />
<h3 id="IM_MANYD_SCATTERPLOT">IM_MANYD_SCATTERPLOT</h3>
<p><a href="#IM_LSUN_F">[Previous Routine]</a></p>
<p><a href="#IM_MAX_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   im_manyd_scatterplot
 PURPOSE:
   plot N-dimensional data sets
 INPUTS:
   weight       [N] array of data-point weights
   point        [d,N] array of data points - N vectors of dimension d
   psfilename   name for PostScript file; if no filename is given, then the
                  plots will simply be sent to the currently active device
 OPTIONAL INPUTS:
   nsig         number of sigma for half-width of each plot; default 5
   label        [d] array of axis labels; default 'x_i'
   range        [2,d] array of plotting ranges
   xdims,ydims  indices of data dimensions to use on each x and y axis
   axis_char_scale size of characters on labels
   default_font font command to send to set font for plotting
   extrafun     name of procedure to call after each plot for overplotting
                (procedure takes two inputs: d1 and d2 indicating
                x and y dimensions of the current plot)
   title        puts string title on top of page
 KEYWORDS:
   nodata       don't plot anything at all, just axes!
   meanweight      - plot the mean of the weight values that land in
                     that pixel, rather than the total; don't use
                     with /conditional!
   [etc]        [options for hogg_scatterplot, see documentation]
 OUTPUTS:
 OPTIONAL OUTPUTS:
   manyd        [nx,ny,NX,NY] data
 BUGS:
   Can get infinite plot ranges.
 COMMENTS:
   XDIMS and YDIMS can either be:
     (a) [N] arrays, yielding an NxN set of plots of xdims[0] vs
         ydims[0], xdims[0] vs ydims[1], etc up to xdims[n-1] vs
         ydims[n-1]; OR
     (b) [N,M] arrays, yielding an NxM set of plots of xdims[0,0] vs
         ydims[0,0], xdims[0,1] vs ydims[0,1] etc.
 DEPENDENCIES:
   hogg_plot_defaults
   hogg_scatterplot
   plus much, much more
 REVISION HISTORY:
   2002-12-14  re-constructed from ex_max_plot -- Hogg
   Moustakas - hacked version of hogg_manyd_scatterplot
</pre>
<p><strong>(See pro/plot/im_manyd_scatterplot.pro)</strong></p>
<hr />
<h3 id="IM_MAX_F">IM_MAX()</h3>
<p><a href="#IM_MANYD_SCATTERPLOT">[Previous Routine]</a></p>
<p><a href="#IM_MEAN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MAX()
 PURPOSE:
   Simple wrapper on DJS_ITERSTAT to compute a maximum value. 
 INPUTS:
   x1 - input array
 OPTIONAL INPUTS:
   sigrej - rejection threshold
   maxiter - maximum number of iterations
 KEYWORD PARAMETERS:
   nan - ignore NAN's
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Jul 13, NYU
   jm08aug01nyu - added NAN keyword
</pre>
<p><strong>(See pro/math/im_max.pro)</strong></p>
<hr />
<h3 id="IM_MEAN_F">IM_MEAN()</h3>
<p><a href="#IM_MAX_F">[Previous Routine]</a></p>
<p><a href="#IM_MEASURE_PEG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MEAN()
 PURPOSE:
   Simple wrapper on DJS_ITERSTAT to compute the mean value. 
 INPUTS:
   x - input array
 OPTIONAL INPUTS:
   sigrej - rejection threshold
   maxiter - maximum number of iterations
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Feb 15, NYU
</pre>
<p><strong>(See pro/math/im_mean.pro)</strong></p>
<hr />
<h3 id="IM_MEASURE_PEG_F">IM_MEASURE_PEG()</h3>
<p><a href="#IM_MEAN_F">[Previous Routine]</a></p>
<p><a href="#IM_MEDIAN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MEASURE_PEG()

 PURPOSE:
   Given a Pegase data structure (read by IM_READ_PEG), measure some
   broadband and spectroscopic properties of interest. 

 INPUTS:
   peg - input structure from IM_READ_PEG

 OPTIONAL INPUTS:
   age  - desired output ages [Myr]
   mass - scale to this total mass

 KEYWORD PARAMETERS:
   silent - suppress messages to STDOUT 

 OUTPUTS:

 OPTIONAL OUTPUTS:

 COMMENTS:
   A disaster beyond your imagination will occur if MASS is
   passed to IM_READ_PEG() *and* to this routine!

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Oct 18, U of A
   jm06apr27uofa - added MASS optional input
   jm08mar28nyu - consolidated the photometry into arrays; improved
     the speed a bit, and cleaned up the documentation 
   jm10mar13ucsd - some of the spectroscopic measurements (e.g.,
     H-delta_A, and other EWs have been commented out)

 Copyright (C) 2005-2006, 2008, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_measure_peg.pro)</strong></p>
<hr />
<h3 id="IM_MEDIAN_F">IM_MEDIAN()</h3>
<p><a href="#IM_MEASURE_PEG_F">[Previous Routine]</a></p>
<p><a href="#IM_MEDXBIN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MEDIAN()
 PURPOSE:
   Simple wrapper on DJS_ITERSTAT to compute the median value. 
 INPUTS:
   x - input array
 OPTIONAL INPUTS:
   sigrej - rejection threshold
   maxiter - maximum number of iterations
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Feb 15, NYU
</pre>
<p><strong>(See pro/math/im_median.pro)</strong></p>
<hr />
<h3 id="IM_MEDXBIN_F">IM_MEDXBIN()</h3>
<p><a href="#IM_MEDIAN_F">[Previous Routine]</a></p>
<p><a href="#IM_MF_VMAX_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MEDXBIN()

 PURPOSE:
   Compute various statistical quantities in bins of fixed width.

 INPUTS:
   x - independent variable [NDATA]
   y - dependent variable [NDATA]
   binsize - scalar bin size in units of X

 OPTIONAL INPUTS:
   weight - statistical weight for each point (default 1) [NDATA] 
   minx - minimum value of X to consider [default: min(x)]
   maxx - maximum value of X to consider [default: max(x)]  
   minpts - minimum number of points in each bin (default 3) 
   nbins - number of bins to use (default is to calculate the number
     of bins from MINX, MAXX, and BINSIZE)

 KEYWORD PARAMETERS:
   verbose - print some of the statistics to STDOUT
   keepall - keep all bins, even if no statistics have been measured 

 OUTPUTS:
   result - statistical quantities, in each bin [NBINS]
     xbin -  bin center
     npts -  number of points
     medx -  median of x
     medy -  median of y
     meanx -  mean of x
     sigx -  standard deviation of x
     meany -  mean of y
     sigy -  standard deviation of y
     sigymean-  error in MEANY
     quant05 -   5% quantile
     quant25 -  25% quantile
     quant75 -  75% quantile
     quant95 -  95% quantile

 COMMENTS:
   Only bins containing more than MINPTS are returned (and therefore
   the x-binning may be some factor of BINSIZE for some x).

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Jan 01, U of A - roughly based on
      C. Tremonti's code of the similar name
   jm05jun14uofa - added VERBOSE keyword
   jm07sep13nyu - use Blanton's weighted_quartile() and
     allow optional weights
   jm08mar05nyu - cleaned up the documentation
   jm10aug06ucsd - medium-level rewrite to be smarter and faster 
   jm11sep02ucsd - added /KEEPALL keyword

 Copyright (C) 2005, 2007-2008, 2010-2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/im_medxbin.pro)</strong></p>
<hr />
<h3 id="IM_MF_VMAX_F">IM_MF_VMAX()</h3>
<p><a href="#IM_MEDXBIN_F">[Previous Routine]</a></p>
<p><a href="#IM_MIN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MF_VMAX()

 PURPOSE:
   Compute a 1/Vmax-weighted mass *or* luminosity function.

 INPUTS: 
   mass - stellar mass or absolute magnitude for each galaxy [NGAL]
   oneovervmax - 1/Vmax for each object (h^3 Mpc^-3) [NGAL] 

 OPTIONAL INPUTS: 
   binsize - logarithmic width of each stellar mass bin 
     (default 0.1 dex)
   masslimit - stellar mass above which the sample is complete;
     affects LIMIT output (default min(mass)); can also be an NGAL
     vector, which is useful when combining fields
   minmass - minimum stellar mass
   maxmass - maximum stellar mass
   noutbins - number of bins in the output data structure; allows
     different output structures from this routine to be 'stacked'  

 KEYWORD PARAMETERS: 
   lf - construct the 1/Vmax-weighted luminosity function 
   debug - make a simple plot and wait for a keystroke

 OUTPUTS: 
   mf_data - the results
     ngal - total number of galaxies
     nbins - number of mass bins
     number - number of objects in each bin [NBINS]
     neff - effective number of objects in each bin [NBINS]
     neff_err - approximate 1-sigma error in NEFF [NBINS]
     weff - effective weight (see Zhu+09, eq 3)
     mass - stellar mass at the center of each mass bin [NBINS]
     phi - number density (h^3 Mpc^-3) [NBINS] 
     phierr_poisson - simple Poisson error on PHI (h^3 Mpc^-3) [NBINS]
     phierr_lower - lower 1-sigma error on PHI (h^3 Mpc^-3) [NBINS]
     phierr_upper - upper 1-sigma error on PHI (h^3 Mpc^-3) [NBINS]
     phierr - average of PHIERR_LOWER and PHIERR_UPPER (h^3 Mpc^-3) [NBINS]
     phierr_cv - uncertainty due to cosmic variance (not computed!)
     limit - 0=lower limit or no galaxies in the bin; 1=all points
       have MASS&gt;MASSLIMIT 

 COMMENTS:
   Basically a glorified wrapper on IM_HIST1D().

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Aug 25, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_mf_vmax.pro)</strong></p>
<hr />
<h3 id="IM_MIN_F">IM_MIN()</h3>
<p><a href="#IM_MF_VMAX_F">[Previous Routine]</a></p>
<p><a href="#IM_MWRFITS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MIN()
 PURPOSE:
   Simple wrapper on DJS_ITERSTAT to compute the minimum value. 
 INPUTS:
   x1 - input array
 OPTIONAL INPUTS:
   sigrej - rejection threshold
   maxiter - maximum number of iterations
 KEYWORD PARAMETERS:
   ignorezero - exclude zero from the calculation
   nan - ignore NAN's
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Jul 13, NYU
   jm08aug01nyu - added NAN keyword
</pre>
<p><strong>(See pro/math/im_min.pro)</strong></p>
<hr />
<h3 id="IM_MWRFITS">IM_MWRFITS</h3>
<p><a href="#IM_MIN_F">[Previous Routine]</a></p>
<p><a href="#IM_NLEVEL">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_MWRFITS

 PURPOSE:
   Simple wrapper on MWRFITS with some bells and whistles.

 INPUTS: 
   outstruct - output structure of image to write out
   outfile - output file name

 OPTIONAL INPUTS: 
   hdr - output FITS-style header

 KEYWORD PARAMETERS: 
   silent - suppress messages to STDOUT
   append - append to an existing structure (default is to use
     /CREATE) 
   gzip - compress the output file (only needed after using /APPEND) 
   nogzip - do not compress the output file (default *is* to
     compress unless /APPEND)
   clobber - overwrite existing output file, otherwise exit

 OUTPUTS: 
   Writes out a FITS file.

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Mar 18, NYU
   jm09nov10ucsd - added /CLOBBER keyword

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_mwrfits.pro)</strong></p>
<hr />
<h3 id="IM_NLEVEL">IM_NLEVEL</h3>
<p><a href="#IM_MWRFITS">[Previous Routine]</a></p>
<p><a href="#IM_NORMALIZE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
     IM_NLEVEL

 PURPOSE:
     Calculates the relative populations and emissivities for the lines
     of a desired ion at a given density and temperature.  

 EXPLANATION:
     The emission line strengths are calculated from an N-level
     atom at a given density and temperature.  The atomic data
     for each ion is stored in the procedure 'GETMATRIX.PRO'.

 CALLING SEQUENCE:
      NLEVEL, IONSTR, DENS, TEMP, WAVE, EMIS [, HBETA]

 INPUT:
      IONSTR: A string containing the name of the ion to be calculated.
           In general the designation is given by [ABBREV]_[ROMAN]; i.e.,
           doubly-ionized oxygen is 'O_III', neutral silicon is 'SI_I', &amp;c.
           See the procedure 'GETMATRIX' for specifics.
      DENS: The electron density for the emission-line region, in 1/cm^3.
      TEMP: The electron temperature for the emission-line region, in K.

 OUTPUT:

      WAVE: The NxN matrix containing the wavelengths of the relevant
            transitions.  The transition from level U to level L is
            in the array element WAVE[U,L].
      EMIS: The array of line emissivities per ion per electron relative to
            H-beta at the corresponding wavelengths.

 OPTIONAL INPUT KEYWORD:

      HBETA: The H-beta emissivity at the given density and temperature.
             The emissivity is given in units of erg/cm^3/s/[N(p) N(e)]

 EXAMPLE:

      The matrix of wavelengths and line emissivities for the O++ ion
      at electron density 100/cm^3 and electron temperature 10,000 K
      is given by
     
      NLEVEL, 'O_III', 1d2, 1d4, WAVE, EMIS


 NOTES:

      Note that it is the emissivities per ion per electron that is
      given.  Thus, for the emissivity EMIS[U,L], the line strength
      in a given spectrum relative to H-beta 4861 is given by
      EMIS[U,L] x N(Ion)/N(H+).

      Note also that a few ions require a bit more work -- namely,
      [Ar III], [Ne III], and [S III].  These ions are problematic
      when compared to the CLOUDY outputs. The N-level atomic data
      has been tailored to maximize agreement, requiring the use
      of branching ratios to recast those results into those expected
      from the output.  That part of the code will only execute
      if N &lt; 5 for the ions in question.


 REVISION HISTORY:
       1.0	B.D.Moore	Rice Univ.	September 2003
</pre>
<p><strong>(See pro/hiiregions/im_nlevel.pro)</strong></p>
<hr />
<h3 id="IM_NORMALIZE_F">IM_NORMALIZE()</h3>
<p><a href="#IM_NLEVEL">[Previous Routine]</a></p>
<p><a href="#IM_OFFSET_AND_ROTATE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_NORMALIZE()

 PURPOSE:
       Normalize a spectrum or data array.

 CALLING SEQUENCE:
       normspec = im_normalize(spec,wave,[normwave=,binsize=], $
          /mean,/median,/max,[const=])

 INPUTS:
       spec - one-dimensional spectrum or flux array
       wave - corresponding wavelength vector or index number

 OPTIONAL INPUTS:
       normwave - normalize by the median flux in the interval 
                  NORMWAVE +/- BINSIZE/2.0 (default mean wavelength) 
       binsize  - see NORMWAVE (default 50.0)

 KEYWORD PARAMETERS:
       mean   - normalize to the mean value in SPEC
       median - normalize to the median value in SPEC
       max    - normalize to the max value in SPEC

 OUTPUTS:
       normspec - normalized SPEC

 OPTIONAL OUTPUTS:
       const    - normalization constant

 PROCEDURES USED:
       DJS_MEAN(), DJS_MEDIAN(), GET_ELEMENT

 EXAMPLE:


 MODIFICATION HISTORY:
       J. Moustakas, 2003 Feb 20, U of A, written
       jm03dec30uofa - if NORMWAVE is specified then compute the
                       mean, median, or max within the specified 
                       wavelength interval

 Copyright (C) 2003, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_normalize.pro)</strong></p>
<hr />
<h3 id="IM_OFFSET_AND_ROTATE_F">IM_OFFSET_AND_ROTATE()</h3>
<p><a href="#IM_NORMALIZE_F">[Previous Routine]</a></p>
<p><a href="#IM_OPENCLOSE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_OFFSET_AND_ROTATE()

 PURPOSE:
       Apply an arbitrary offset and rotation to a position.  

 CALLING SEQUENCE:
       xynew = im_offset_and_rotate(xy,pa,xoffset=,yoffset=)

 INPUTS:
       xy - [XPOSITION,YPOSITION] to rotate and offset; can also be a
            [2,*] element array
       pa - rotation angle measured counter-clockwise from the y axis 
            (identical to astronomical position angles) [degrees] 

 OPTIONAL INPUTS:
       xoffset - shift each X position by XOFFSET (scalar, default 0)
                 (perpendicular to the slit)
       yoffset - shift each Y position by YOFFSET (scalar, default 0)
                 (along the slit)

 OUTPUTS:
       xynew   - offset and rotated XY positions

 COMMENTS &amp; EXAMPLE:
       The input XY is a position in the rotated (primed) coordinate
       axis PA relative to an un-rotated (cardinal) coordinate axis.
       For example, if your position is [-1,0] in a coordinate axis
       that is rotated by PA=45 degrees, then your position in the
       un-rotated frame is  

       IDL&gt; print, im_offset_and_rotate([-1.0,0],45)
            -0.707107    -0.707107

       Also see IM_OPLOT_BOX for another application of this
       routine.  

 MODIFICATION HISTORY:
       J. Moustakas, 2003 May 22, U of A
       jm04mar16uofa - bug fix when using offsets
</pre>
<p><strong>(See pro/sky/im_offset_and_rotate.pro)</strong></p>
<hr />
<h3 id="IM_OPENCLOSE">IM_OPENCLOSE</h3>
<p><a href="#IM_OFFSET_AND_ROTATE_F">[Previous Routine]</a></p>
<p><a href="#IM_OPLOT_BOX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_OPENCLOSE

 PURPOSE:
       Simple wrapper for opening and closing a postscript file
       (calls DFPSPLOT/DFPSCLOSE), or for waiting for a keystroke. 

 INPUTS:
       psname - postscript file name (without .ps or .eps extension)

 OPTIONAL INPUTS:
       extra - keywords for DFPSPLOT

 KEYWORD PARAMETERS:
       square       - square postscript output
       postscript   - open or close the postscript file 
       encapsulated - generate an encapsulated postscript file and
                      append a .eps suffix, otherwise the output
                      suffix is set to .ps
       png          - NOT SUPPORTED YET
       close        - close the postscript file
       silent       - do not print to STDOUT

 OUTPUTS:

 OPTIONAL OUTPUTS:

 COMMENTS:
       The PNG keyword is stronger than the postscript keyword. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, longtimeago, U of A - written
       jm04mar10uofa - do not ISOLATIN1 fonts; remove !p.font calls 
       jm05mar30uofa - added ENCAPSULATED keyword; figure out the
                       postscript file extension automatically
       jm05may18uofa - added PNG keyword

 Copyright (C) 2004-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_openclose.pro)</strong></p>
<hr />
<h3 id="IM_OPLOT_BOX">IM_OPLOT_BOX</h3>
<p><a href="#IM_OPENCLOSE">[Previous Routine]</a></p>
<p><a href="#IM_PLANEFIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_OPLOT_BOX

 PURPOSE:
   Overplot an arbitrarily positioned (and rotated) box on an
   existing plot.  

 INPUTS:
   xsize - length of the box along the X axis
   ysize - length of the box along the Y axis 
   pa    - rotation angle measured counter-clockwise from the y
           axis  (identical to astronomical position angles)
           [degrees] 

 OPTIONAL INPUTS:
   xoffset - see IM_OFFSET_AND_ROTATE()
   yoffset - see IM_OFFSET_AND_ROTATE()
   extra   - keywords for DJS_OPLOT

 KEYWORD PARAMETERS:
   noplot  - do not make the plot

 OUTPUTS:
   A box with the specified properties is plotted.

 OPTIONAL OUTPUTS:
   corners - data coordinates of the box corners

 PROCEDURES USED:
   IM_OFFSET_AND_ROTATE(), DJS_OPLOT

 COMMENTS:
   Y is &quot;along&quot; the slit, X is perpendicular to the slit. 

 EXAMPLE:
   Try drawing a box around an existing plot of a galaxy.  The
   major and minor axes are 60&quot; and 30&quot; respectively.  An image
   of the galaxy with coordinate axes in arcsec has already been
   displayed.  The position angle of the galaxy is 30 degrees.

   IDL&gt; pa = 30.0
   IDL&gt; im_oplot_box, 30.0, 60.0, 30.0, line=0, thick=3.0

   To display a simple rotated box try.

   IDL&gt; plot, [0], [0], /nodata, xrange=[-2,2], yrange=[-2,2], xsty=3, ysty=3
   IDL&gt; im_oplot_box, 1.0, 3.0, 30, line=0, thick=3.0

 MODIFICATION HISTORY:
   J. Moustakas, 2003 May 22, U of A
   jm03july10uofa - added NOPLOT keyword

 Copyright (C) 2003, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_oplot_box.pro)</strong></p>
<hr />
<h3 id="IM_PLANEFIT_F">IM_PLANEFIT()</h3>
<p><a href="#IM_OPLOT_BOX">[Previous Routine]</a></p>
<p><a href="#IM_PLOTCONFIG">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PLANEFIT()

 PURPOSE:
   Fit a plane to data with the option of constraining any of the
   coefficients. 

 CALLING SEQUENCE:
   coeff = im_planefit(x,y,z,zerr=,coeff_guess=,coeff_fixed,$
      coeff_err=,zfit=,chi2=)

 INPUTS:
   x - data along the x axis [NPTS]
   y - data along the y axis [NPTS]
   z - data along the z axis [NPTS]

 OPTIONAL INPUTS:
   zerr        - uncertainty in Z [NPTS]
   coeff_guess - coefficients to use as the best-guess starting
                 values [3-element vector]
   coeff_fixed - coefficients to fix (see MPFITFUN) [3-element
                 byte array]; (0B=free, 1B=fixed)

 KEYWORD PARAMETERS:
   None.

 OUTPUTS:
   coeff - coefficients of the best-fitting plane; the model is 
           Z = COEFF[0] + COEFF[1]*X + COEFF[2]*Y

 OPTIONAL OUTPUTS:
   coeff_err - formal one-sigma uncertainties in COEFF (only
               meaningful if ZERR is given) [3-element vector] 
   zfit      - best-fitting model [NPTS]
   chi2      - reduced chi-squared statistic (only meaningful
               if ZERR is given)

 PROCEDURES USED:
   MPFITFUN()

 COMMENTS:
   It would be nice to be able to pass uncertainties in X and Y
   as well as Z.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Mar 04, U of A - written

 Copyright (C) 2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/fitting/im_planefit.pro)</strong></p>
<hr />
<h3 id="IM_PLOTCONFIG">IM_PLOTCONFIG</h3>
<p><a href="#IM_PLANEFIT_F">[Previous Routine]</a></p>
<p><a href="#IM_PLOTFAVES">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PLOTCONFIG

 PURPOSE:
   High-level wrapper on IM_GETPOSITION() for generating multi-panel
   postscript output.

 INPUTS: 
   plotnum - preset plotting number, specifying the number and
     orientation of the panels (see COMMENTS)

 OPTIONAL INPUTS: 
   psfile - output postscript file name (should be a .ps file unless
     encapsulated postscript output is needed, in which case use .eps)  
   [x,y]margin - x and y margins
   [x,y]space - space between plots in the x and y dimension
   [x,y]page - page size in the x and y dimension
   width - plot(s) width
   height - plot(s) height
   extra - optional inputs for IM_PLOTFAVES and DEVICE 

 KEYWORD PARAMETERS: 
   psclose - close the postscript file
   keynote - generate a keynote-style plot
   blackwhite - no color
   gzip - compress the output
   pdf - convert the output postscript file to PDF, deleting the .PS
     file 
   pskeep - when using /PDF do not delete the postscript file 
   silent - do not print messages to the screen
   landscape - 

 OUTPUTS: 
   position - position vector to pass to PLOT

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 21, NYU
   jm09mar20nyu - postscript output gets generated if PSFILE is passed,
     and depending on its extension (.PS vs .EPS), either regular or
     encapsulated postscript is built 
   jm09may25nyu - added GZIP and PDF keywords; if /PDF *and* /GZIP
     are set then /PDF wins; note that both keywords require PSFILE

 Copyright (C) 2008-2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_plotconfig.pro)</strong></p>
<hr />
<h3 id="IM_PLOTFAVES">IM_PLOTFAVES</h3>
<p><a href="#IM_PLOTCONFIG">[Previous Routine]</a></p>
<p><a href="#IM_PLOTHIST">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PLOTFAVES

 PURPOSE:
   Load &quot;favorite&quot; settings for generating plots.

 OPTIONAL INPUTS:
   xticklen : tick length of the x-axis (default 0.03)
   yticklen : tick length of the y-axis (default 0.03)
   pthick   : thickness of the lines connecting points (default 2.0)
   charsize : character size (default 1.8)
   charthick: character thickness (default 2.0)
   xthick   : thickness of the x-axis (default 2.0)
   ythick   : thickness of the y-axis (default 2.0)
	
 KEYWORD PARAMETERS:
   postscript: 
   pdf       : 
   restore   : restore the plot fields to their IDL default values
   extras    : load some additional handy plotting variables
   help      : print the code syntax to the screen and return

 COMMENTS:
   This routine was written to be placed at the beginning of a
   code which intends to make nice plots which will perhaps be
   written to postscript.  Note:  this routine should be called
   again at the end of the code with the /restore keyword set.

 MODIFICATION HISTORY:
   John Moustakas, 2000 September 15, U of A
   jm08aug21nyu - some tweaks; use CLEANPLOT for restoring; added
     POSTSCRIPT keyword
   jm08nov03nyu - added PDF optional input
   jm09feb10nyu - bug fix when passing optional inputs
   jm09mar29nyu - added KEYNOTE keyword

 Copyright (C) 2000, 2008-2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_plotfaves.pro)</strong></p>
<hr />
<h3 id="IM_PLOTHIST">IM_PLOTHIST</h3>
<p><a href="#IM_PLOTFAVES">[Previous Routine]</a></p>
<p><a href="#IM_PNG2HTML">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PLOTHIST

 PURPOSE:
   Generate a histogram plot with optional weights.

 INPUTS: 
   arr - input array [NPTS]

 OPTIONAL INPUTS: 
   weight - weight for each input point [NPTS]
   bin - histogram binsize
   edge - desired centering: 0=center, -1=left, +1=right (default 0)
   psym - plot symbol (default 10)
   normfactor - normalize the histogram by this factor
   fcolor - fill color (see PLOTHIST)
   fline - fill linestyle (see PLOTHIST)
   fspacing - fill line spacing (see PLOTHIST)
   fpattern - (see PLOTHIST)
   forientation - line orientation anlge(see PLOTHIST)
   extra - inputs for IM_HIST1D)

 KEYWORD PARAMETERS: 
    cumulative - generate the cumulative distribution function
    overplot - render on an existing plot
    fill - use polyfill to fill in the histogram
    noplot - just build the histograms; do not plot
    fraction - normalize the histogram by the total area

 OUTPUTS: 
   xhist - binned x-axis
   yhist - binned y-axis

 COMMENTS:
   Combines the best of HOGG_PLOTHIST and PLOTHIST (in my opinion!) 

 EXAMPLES:

 MODIFICATION HISTORY:
    J. Moustakas, 2007 Apr 02, NYU

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_plothist.pro)</strong></p>
<hr />
<h3 id="IM_PNG2HTML">IM_PNG2HTML</h3>
<p><a href="#IM_PLOTHIST">[Previous Routine]</a></p>
<p><a href="#IM_POISSON_LIMITS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PNG2HTML

 PURPOSE:
   Render a web page from a list of PNG (or JPG) files.

 INPUTS:
   htmlbase - base name for the HTML page and the subdirectory
              (relative to HTML_PATH) where the PNG files have been
              written

 OPTIONAL INPUTS:
   pnglist   - input list of PNG files **including the full path
               name**; default it to search for all PNG files in
               HTMLBASE 
   npngcols  - number of columns in the HTML page (default 3)
   html_path - files must exist in the path HTML_PATH+HTMLBASE and
               the web page is written to HTML_PATH 
   title     - title of the HTML page

 KEYWORD PARAMETERS:
   silent    - suppress messages to STDOUT 

 OUTPUTS:
   An html file called HTML_PATH+HTMLBASE+'.html'.  

 COMMENTS:
   Uses spawn to run the UNIX command CONVERT.

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Jan 26, NYU - based entirely on IM_PS2HTML 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_png2html.pro)</strong></p>
<hr />
<h3 id="IM_POISSON_LIMITS_F">IM_POISSON_LIMITS()</h3>
<p><a href="#IM_PNG2HTML">[Previous Routine]</a></p>
<p><a href="#IM_POLYFIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_POISSON_LIMITS()

 PURPOSE:
   For a given number of events, calculate the Poisson upper and
   lower limits for a given 1-sided confidence interval. 

 INPUTS: 
   n_i  - number of (counting) events or samples
   conf - desired confidence interval; for example, 0.8413, 0.9772,
     and 0.9987 correspond to the usual 1-sided intervals for 1-, 2-, 
     and 3-sigma Gaussian probabilities (must be a scalar)

 OPTIONAL INPUTS: 

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   limit - two-element array corresponding to the lower- and
     upper- confidence limit

 OPTIONAL OUTPUTS:

 COMMENTS:
   Formulae taken from Gehrels (1986).

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Oct 17, NYU - written based on a Perl script
     kindly provided by G. Rudnick 
   jm09mar18nyu - use a default value (0.8413) for CONF
   jm11mar31ucsd - updated to use the more accurate eq (9) for
     computing upper limits
   jm11jul13ucsd - deal with vector inputs

 Copyright (C) 2008-2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/im_poisson_limits.pro)</strong></p>
<hr />
<h3 id="IM_POLYFIT_F">IM_POLYFIT()</h3>
<p><a href="#IM_POISSON_LIMITS_F">[Previous Routine]</a></p>
<p><a href="#IM_POLY_ITER">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_POLYFIT()

 PURPOSE:
       Fit a polynomial to data with the option of constraining any
       of the coefficients. 

 CALLING SEQUENCE:
       coeff = im_polyfit(x,y,order,yerr=,coeff_guess=,$
          coeff_fixed,coeff_limited,coeff_limits=,$
          coeff_err=,yfit=,chi2=)

 INPUTS:
       x     - data along the x axis [NPTS]
       y     - data along the y axis [NPTS]
       order - order of the polynomial

 OPTIONAL INPUTS:
       yerr          - uncertainty in Y [NPTS] 
       coeff_guess   - coefficients to use as the best-guess starting 
                       values [(ORDER+1)-element vector]
       coeff_fixed   - coefficients to fix (see MPFITFUN)
                       [(ORDER+1)-element byte array]; (0B=free, 
                       1B=fixed) 
       coeff_limited - coefficients limited (see MPFITFUN)
       coeff_limits  - coefficient limits (see MPFITFUN)

 KEYWORD PARAMETERS:
       None.

 OUTPUTS:
       coeff - coefficients of the best-fitting polynomial 

 OPTIONAL OUTPUTS:
       coeff_err - formal one-sigma uncertainties in COEFF (only
                   meaningful if YERR is given) [(ORDER+1)-element
                   vector]  
       yfit      - best-fitting model [NPTS]
       chi2      - reduced chi-squared statistic (only meaningful
                   if YERR is given)

 PROCEDURES USED:
       MPFITFUN()

 COMMENTS:
       It would be nice to be able to pass uncertainties in X as well
       as Y. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 March 24, U of A, written, based entirely
          on IM_LINEFIT()
       jm05mar24uofa - added COEFF_LIMITED and COEFF_LIMITS inputs 

 Copyright (C) 2004-2005, John Moustakas 
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/fitting/im_polyfit.pro)</strong></p>
<hr />
<h3 id="IM_POLY_ITER">IM_POLY_ITER</h3>
<p><a href="#IM_POLYFIT_F">[Previous Routine]</a></p>
<p><a href="#IM_PREDICT_TNII_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   im_poly_iter

 PURPOSE:
   Calls IDL poly_fit iteratively with outlier rejection

 CALLING SEQUENCE:
   im_poly_iter, x, y, ndeg, nsig, yfit, coeff=coeff

 INPUTS:
   x, y    - indep, dep variables
   ndeg    - degree of polynomial 
   yfit    - fit y at given x values

 OUTPUTS:
   coeff   - array of coefficients

 COMMENTS:

 EXAMPLES:

 BUGS:

 PROCEDURES CALLED:
   poly_fit

 REVISION HISTORY:
   moved from hoggpt 10-Jan-2002
   jm03mar16uofa - added GOOD and REJECT output
   jm06jan19uofa - added YERR optional input
   jm07jun19nyu  - if all the points have been rejected then return
                   without crashing; also the rejection criterion has
                   been changed to take into account machine
                   precision (e.g., if you try to fit an array
                   of 1's) 

</pre>
<p><strong>(See pro/fitting/im_poly_iter.pro)</strong></p>
<hr />
<h3 id="IM_PREDICT_TNII_F">IM_PREDICT_TNII()</h3>
<p><a href="#IM_POLY_ITER">[Previous Routine]</a></p>
<p><a href="#IM_PREDICT_TOII_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_PREDICT_TNII()

 PURPOSE:
       Predict T(N+) given T(O+).

 INPUTS:
       toii - temperature of the T(O+) zone: [K, see IM_TEMDEN()]

 OUTPUTS:
       tnii - T(N+) [K]

 OPTIONAL OUTPUTS:
       tnii_err - error in TNII_OUT, if TOII_ERR is given 

 COMMENTS:
       The (trivial!) relation T(N+) and T(O+) is given by Garnett
       (1992), but see Nava et al. 2006 for an alternative argument. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Dec 07, NYU, written

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_predict_tnii.pro)</strong></p>
<hr />
<h3 id="IM_PREDICT_TOII_F">IM_PREDICT_TOII()</h3>
<p><a href="#IM_PREDICT_TNII_F">[Previous Routine]</a></p>
<p><a href="#IM_PREDICT_TSIII_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_PREDICT_TOII()

 PURPOSE:
       Predict T(O+) given T(O++).

 INPUTS:
       toiii - temperature of the T(O++) zone: [K, see IM_TEMDEN()] 

 OUTPUTS:
       toii - T(O+) [K]

 OPTIONAL OUTPUTS:
       toii_err - error in TOII, if TOIII_ERR is given [K]

 COMMENTS:
       The relation T(O+) and T(O++) used here was originally derived
       by Campbell et al. (1986), based on a fit to the Stasinska
       (1982) photoionization models, but was popularized by Garnett
       (1992). 

       Izotov et al. (1994) also give a relation between T(O+) and
       T(O++), based on the Stasinska (1990) photoionization models,
       given by T(O+) = 2E4/(1E4/T(O++)+0.8).  However, Bresolin et
       al. 2004 note that if the Stasinska models are limited to
       T_eff&lt;40,000 K stars, then there is good agreement with the
       Garnett (1992) relation.

       Pagel et al. (1992) have also published a relation.

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 July 5, U of A, written
       jm07dec06nyu - removed STASINSKA relation and improved the
                      documentation 

 Copyright (C) 2004, 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_predict_toii.pro)</strong></p>
<hr />
<h3 id="IM_PREDICT_TSIII_F">IM_PREDICT_TSIII()</h3>
<p><a href="#IM_PREDICT_TOII_F">[Previous Routine]</a></p>
<p><a href="#IM_PS2HTML">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_PREDICT_TSIII()

 PURPOSE:
       Predict T(S++) given T(O++).

 INPUTS:
       toiii - temperature of the T(O++) zone: [K, see IM_TEMDEN()]

 OUTPUTS:
       siii - T(S++) [K]

 OPTIONAL OUTPUTS:
       siii_err - error in SIII_OUT, if TOIII_ERR is given [K]

 COMMENTS:
       The relation T(S++) and T(O++) is given by Garnett (1992).
       Note, however, that Perez-Montero &amp; Diaz (2003) argue that
       because of updates to the [S III] collisional excitation rates
       (Tayal &amp; Gupta 1999) a better relation would be: T(O++) = 
       9500*T(S++)+800.

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Dec 07, NYU, written

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_predict_tsiii.pro)</strong></p>
<hr />
<h3 id="IM_PS2HTML">IM_PS2HTML</h3>
<p><a href="#IM_PREDICT_TSIII_F">[Previous Routine]</a></p>
<p><a href="#IM_PSFEX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PS2HTML

 PURPOSE:
   Convert all PS and EPS files in a directory to PNG files and
   render a web page.

 INPUTS:
   htmlbase - base name for the HTML page and the subdirectory
              (relative to HTML_PATH) where the postscript files
              have been written

 OPTIONAL INPUTS:
   pslist    - input list of PS files; default it to search for
               all EPS files in HTMLBASE (or all PS files if
               PSFIND=1) 
   npscols   - number of columns in the HTML page (default 3)
   html_path - postscript files must exist in the path
               HTML_PATH+HTMLBASE and the web page is written to
               HTML_PATH 

 KEYWORD PARAMETERS:
   psfind    - search for PS files; default is to only search for
               EPS files
   pngfind   - search for PNG files; default is to only search for
               EPS files (this keyword is stronger than PSFIND); if
               set, then force: ONLY_HTML=1, ONLY_PNG=0, CLEANPNG=0 
   only_html - do not generate PNG files, just re-render the html 
   only_png  - do not render the html, just generate PNG files 
   cleanpng  - remove all PNG files from HTML_PATH+HTMLBASE 
   silent    - suppress messages to STDOUT 

 OUTPUTS:
   An html file called HTML_PATH+HTMLBASE+'.html'.  PNG files are
   also generated from the EPS or PS files found in
   HTML_PATH+HTMLBASE. 

 COMMENTS:
   Uses spawn to run the UNIX command CONVERT.

 MODIFICATION HISTORY:
   J. Moustakas, 2004 Jan 08, U of A - written
   jm04nov16uofa - added menu at the top of the web page 
   jm05jan18uofa - added image captions and better
                   cross-referencing information
   jm05jan21uofa - added support for .EPS files 
   jm05mar31uofa - fixed image centering 
   jm05nov25uofa - added PSFIND keyword; default is to only look
                   for EPS files 
   jm09jan22nyu  - added PNGFIND keyword; default is to only look 
                   for EPS files 

 Copyright (C) 2004-2005, 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_ps2html.pro)</strong></p>
<hr />
<h3 id="IM_PSFEX">IM_PSFEX</h3>
<p><a href="#IM_PS2HTML">[Previous Routine]</a></p>
<p><a href="#IM_READ_BASTI_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_PSFEX

 PURPOSE:
   Run PSFEx on a suitably prepared SExtractor catalog.

 INPUTS: 
   sexcatalog - name of input SE catalog

 OPTIONAL INPUTS: 
   config - PSFEx configuration structure (see INIT_PSFEX_CONFIG); if
     none is provided then a default configuration file is used
   configfile - optional output configuration file name for
     WRITE_DUMMY_CONFIG 

 KEYWORD PARAMETERS: 
   silent - suppress messages to STDOUT

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2013 May 24, Siena

 Copyright (C) 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/im_psfex.pro)</strong></p>
<hr />
<h3 id="IM_READ_BASTI_F">IM_READ_BASTI()</h3>
<p><a href="#IM_PSFEX">[Previous Routine]</a></p>
<p><a href="#IM_READ_BC03_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_BASTI()

 PURPOSE:
   Read a BaSTI SSP into a structure.

 INPUTS:
   None required.

 OPTIONAL INPUTS:
   metallicity - stellar metallicity (default 'zsun')
     z104 -&gt; Z = 0.0001
     z304 -&gt; Z = 0.0003
     z604 -&gt; Z = 0.0006
     z103 -&gt; Z = 0.001
     z203 -&gt; Z = 0.002
     z403 -&gt; Z = 0.004
     z803 -&gt; Z = 0.008
     z102 -&gt; Z = 0.01
     zsun -&gt; Z = 0.0198 (default)
     z302 -&gt; Z = 0.03
     z402 -&gt; Z = 0.04

   eta - mass loss rate, either '04' (eta=0.4; normal), or '02'
     (eta=0.2; low)

 KEYWORD PARAMETERS:
   hires - read the theoretical high-resolution models (default is to
     read the low-resolution models, which have greater wavelength
     coverage)  
   enhanced - read the alpha-enhanced models (default is to use the
     solar-scaled models)

 OUTPUTS:
   basti - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
   See http://albione.oa-teramo.inaf.it for additional relevant
   details. 
 
   Only the Kroupa+01 IMF is available. 

 File name key:
   solar scaled models:
     eta=0.4
       sso - scaled solar, eta=0.4, with overshooting (for t&lt;11 Gyr)
       sss - scaled solar, eta=0.4, without overshooting (for t&gt;11 Gyr)
     eta=0.2
       so2 - scaled solar, eta=0.2, with overshooting (for t&lt;11 Gyr)
       ss2 - scaled solar, eta=0.2, without overshooting (for t&gt;11 Gyr)

   alpha-enhanced models:
     eta=0.4
       aeo - alpha enhanced, eta=0.4, with overshooting (for t&lt;14 Gyr)
       aes - elpha enhanced, eta=0.4, without overshooting (for t&gt;14 Gyr)
     eta=0.2
       ao2 - alpha enhanced, eta=0.2, with overshooting (for t&lt;14 Gyr)
       ae2 - elpha enhanced, eta=0.2, without overshooting (for t&gt;14 Gyr)

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 23, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_basti.pro)</strong></p>
<hr />
<h3 id="IM_READ_BC03_F">IM_READ_BC03()</h3>
<p><a href="#IM_READ_BASTI_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_FSPS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_BC03()

 PURPOSE:
   Read the Bruzual &amp; Charlot (2003) binary format population
   synthesis models into a convenient data structure.

 CALLING SEQUENCE:
   bc03 = im_read_bc03(isedfile=,isedpath,metallicity=,$
      age=,minwave=,maxwave=,endian=,bc03_extras=,$
      /salpeter,/lr,/readzero,/silent,/array_extras,/float)

 INPUTS:
   None required.  By default this routine reads the high
   resolution (hr), solar metallicity (m62), Chabrier SSP
   models. 

 OPTIONAL INPUTS:
   isedfile - read this binary SED rather than the default SSP
              models 
   isedpath - full data path (with trailing slash) to ISEDFILE
   metallicity - SSP metallicity
      0 - Z=0.0001 (m22)
      1 - Z=0.0004 (m32)
      2 - Z=0.004  (m42)
      3 - Z=0.008  (m52)
      4 - Z=0.02   (m62) [Solar, default]
      5 - Z=0.05   (m72)
   age - return the SSP(s) corresponding to this scalar or vector
         age(s) [Gyr]
   minwave - crop the SSP spectra to this minimum wavelength
             [Angstrom] 
   maxwave - crop the SSP spectra to this maximum wavelength
             [Angstrom]
   endian  - byte ordering for the binary file; see documentation
             for READ_BINARY(); usually, if the binary files have
             been created on a Linux box then endian='little',
             which is the default; on a SUN, endian='big' is
             appropriate (for example, if you use 'bin_ised'
             provided with BC03 to create binary-format SSP's) 

 KEYWORD PARAMETERS:
   salpeter - read the Salpeter IMF models (default is to read
              the Chabrier models)
   lr       - read the low resolution models (default is to read
              the high resolution models)
   readzero - read the zeroth age SSP (has not been tested with
              convolved star-formation histories!)
   silent   - do not print any messages to STDOUT
   array_extras - return the BC03_EXTRAS structure in a slightly
                  different format
   float    - read the AGE, WAVE, and FLUX arrays in single (not 
              double) precision
   abmag - convert the output spectra to AB mag at 10 pc

 OUTPUTS:
   bc03 - data structure with the following fields:
      age  - vector of SSP ages [NAGE] [yr]
      wave - wavelength array [NPIX] [Angstrom]
      flux - SSP models [NPIX,NAGE] [L_sun/M_sun/A]

 OPTIONAL OUTPUTS:
   bc03_extras - data structure containing the extra parameters
                 associated with each SSP (see the BC03
                 documentation) 

 COMMENTS:
   N.B.  The environment variable ${bc03_dir} must be defined in
   your '.cshrc' indicating the *root* directory of the BC03
   models.  For example, in my '.cshrc' I have

          setenv bc03_dir ${HOME}/synthesis/bc03

   Note that this routine only works with the Padova (1994)
   binary isochrones and not the Pickles isochrones.
   Alternatively, you can use the ISEDFILE and ISEDPATH optional
   inputs to read in an arbitrary BC03 SED.

 BUGS:

 INTERNAL SUPPORT ROUTINES:
   READ_EXTRAS(), GET_ELEMENT

 PROCEDURES USED:
   READFAST, STRUCT_TRIMTAGS(), STRUCT_ADDTAGS(), MATCH,
   MRD_STRUCT() 

 EXAMPLES:
   [1] Read the high-resolution, Salpeter IMF, Solar metallicity
       (Z=0.02) SSP models:

      IDL&gt; bc03 = im_read_bc03()
      IDL&gt; help, bc03, /str

   [2] Read the low-resolution, Salpeter IMF, LMC metallicity
       (Z=0.004) SSP models:

      IDL&gt; bc03 = im_read_bc03(metallicity=2,/lr,/salpeter)

   [3] Read the high-resolution, Chabrier IMF, twice-solar
       metallicity (Z=0.05) SSP models and plot the 10 Gyr model: 

      IDL&gt; bc03 = im_read_bc03(metallicity=5)
      IDL&gt; indx = where(bc03.age eq 1E10)
      IDL&gt; plot, bc03.wave, bc03.flux[*,indx], /xlog, /ylog

   [4] Read the high-resolution, Chabrier IMF, solar metallicity
       (Z=0.02) SSP models and extras and plot D4000 versus
       H-delta_A:  

      IDL&gt; bc03 = im_read_bc03(bc03_extras=bce)
      IDL&gt; plot, bce.d_4000_, bce.h_delta_a, xsty=3, ysty=3

   [5] Read a non-SSP SED in my temp subdirectory:

      IDL&gt; bc03 = im_read_bc03(isedfile='mysed.ised',isedpath='temp/')

   [6] Retrieve the 12 Gyr Salpeter IMF, high-resolution SSP
       between 3000 and 10000 Angstroms.

      IDL&gt; bc03 = im_read_bc03(/salpeter,age=12.0,minwave=3000,maxwave=1E4)

 MODIFICATION HISTORY:
   J. Moustakas, 2003 October 29, U of A, based in small part on
      IDL code originally written by C. Papovich
   jm03nov12uofa - added ISEDFILE and ISEDPATH optional inputs
                   and various bug fixes
   jm04mar01uofa - added AGE, MINWAVE, and MAXWAVE optional
                   inputs; changed wave, flux, and age to double
                   precision 
   jm04sep05uofa - generalized to read non-SSP models; NAGE is no
                   longer fixed to be 221 age bins; improved
                   error checking when reading the &quot;extras&quot;
                   files; do not read AGE=0
   jm04oct31uofa - added ENDIAN optional keyword (thanks to
                   M. Blanton) 
   jm05jul26uofa - added READZERO optional input
   jm06feb19uofa - added ARRAY_EXTRAS and FLOAT keywords 

 Copyright (C) 2003-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_bc03.pro)</strong></p>
<hr />
<h3 id="IM_READ_FSPS_F">IM_READ_FSPS()</h3>
<p><a href="#IM_READ_BC03_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_MARASTON05_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_FSPS()

 PURPOSE:
   Read an FSPS SSP into a structure.

 INPUTS:
   None required.

 OPTIONAL INPUTS:
   metallicity - stellar metallicity to read; the choices depends on
     the stellar library and isochrones desired; to see the full list
     just call this routine with

     IDL&gt; ssp = im_read_fsps(metallicity='Z')

 KEYWORD PARAMETERS:
   basti - read the BaSTI isochrones (default is to use Padova) (not
     supported as of v2.3 of FSPS!)
   miles - read the MILES stellar library (available just in the
     optical) (default is to use just the low-resolution BaSeL
     stellar library, which has much broader wavelength coverage) 
   kroupa - read the Kroupa+01 IMF files (default is to read the 
     Salpeter ones)
   chabrier - read the Chabrier+03 IMF files
   abmag - convert the output spectra to AB mag at 10 pc
   flambda - convert the output spectra to F_lambda units (erg/s/cm^2/A) at 10 pc
   fnu - convert the output spectra to F_nu units (erg/s/cm^2/Hz) at 10 pc 

 OUTPUTS:
   fsps - output data structure
     Z - metallicity
     age - age vector [NAGE]
     mstar - mass in stars [NAGE]
     lbol - bolometric luminosity [NAGE]
     wave - wavelength vector [NPIX] (Angstrom)
     flux - flux vector [NPIX,NAGE] (erg/s/A)

 OPTIONAL OUTPUTS:

 COMMENTS:
   See https://www.cfa.harvard.edu/~cconroy/FSPS.html for additional
   relevant details. 

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 30, UCSD
   jm11mar14ucsd - updated to the latest SSPs
   jm11mar28ucsd - read the BaSeL library by default 

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_fsps.pro)</strong></p>
<hr />
<h3 id="IM_READ_MARASTON05_F">IM_READ_MARASTON05()</h3>
<p><a href="#IM_READ_FSPS_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_MARASTON11_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_MARASTON05()

 PURPOSE:
   Read a Maraston+05 SSP into a structure.

 INPUTS:
   None required.

 OPTIONAL INPUTS:
   metallicity - stellar metallicity (default 'z002')
     z007  =&gt; [Z/H] = +0.67 (corresponding to Z=3.5 Zsun)
     z004  =&gt; [Z/H] = +0.35 (corresponding to Z=2.0 Zsun)
     z002  =&gt; [Z/H] = +0.00 (corresponding to Z=1.0 Zsun)
     z001  =&gt; [Z/H] = -0.33 (corresponding to Z=0.5 Zsun)
     z0001 =&gt; [Z/H] = -1.35 (corresponding to Z=1/50 Zsun)
     z10m4 =&gt; [Z/H] = -2.25 (corresponding to Z=1/200 Zsun)
 
   hbmorph - horizontal branch morphology, either blue ('bhb') or red
     ('rhb', default)

 KEYWORD PARAMETERS:
   kroupa - read the Kroupa IMF files (default is to read the
     Salpeter ones)
   abmag - convert the output spectra to AB mag at 10 pc
   flambda - convert the output spectra to F_lambda units (erg/s/cm^2/A) at 10 pc
   fnu - convert the output spectra to F_nu units (erg/s/cm^2/Hz) at 10 pc 

 OUTPUTS:
   mara - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
   See http://www.icg.port.ac.uk/~maraston/Claudia's_Stellar_Population_Model.html
   for additional relevant details.

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 23, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_maraston05.pro)</strong></p>
<hr />
<h3 id="IM_READ_MARASTON11_F">IM_READ_MARASTON11()</h3>
<p><a href="#IM_READ_MARASTON05_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_PEG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_MARASTON11()

 PURPOSE:
   Read a Maraston &amp; Stromback (2011) SSPs into a structure. 

 INPUTS:
   None required.

 OPTIONAL INPUTS:
   metallicity - stellar metallicity (default 'z002')
     z007  =&gt; [Z/H] = +0.67 (corresponding to Z=3.5 Zsun)
     z004  =&gt; [Z/H] = +0.35 (corresponding to Z=2.0 Zsun)
     z002  =&gt; [Z/H] = +0.00 (corresponding to Z=1.0 Zsun)
     z001  =&gt; [Z/H] = -0.33 (corresponding to Z=0.5 Zsun)
     z0001 =&gt; [Z/H] = -1.35 (corresponding to Z=1/50 Zsun)
     z10m4 =&gt; [Z/H] = -2.25 (corresponding to Z=1/200 Zsun)
 
   hbmorph - horizontal branch morphology, either blue ('bhb') or red
     ('rhb', default)

 KEYWORD PARAMETERS:
   kroupa - read the Kroupa IMF files (default is to read the
     Salpeter ones)
   abmag - convert the output spectra to AB mag at 10 pc

 OUTPUTS:
   mara - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
   See http://www.icg.port.ac.uk/~maraston/M11 for additional
   relevant details. 

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Oct 05, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_maraston11.pro)</strong></p>
<hr />
<h3 id="IM_READ_PEG_F">IM_READ_PEG()</h3>
<p><a href="#IM_READ_MARASTON11_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_PEGASE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_PEG()

 PURPOSE:
   Read PEGASE.2 or PEGASE-HR style SSPs into a structure. 

 INPUTS:
   pegfile  - name of the Pegase data file

 OPTIONAL INPUTS:
   mass     - mass normalization

 KEYWORD PARAMETERS:

 OUTPUTS:
   peg - output data structure

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
   IM_PEG_STRUCT

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Oct 18, U of A - based on K_READ_PEG,
     originally written by A. Quintero
   jm05nov19uofa - added optional mass normalization
   jm10nov04ucsd - MSTAR should be defined as *all* stars, including
     remnants, not just *live* stars  

 Copyright (C) 2005, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_peg.pro)</strong></p>
<hr />
<h3 id="IM_READ_PEGASE_F">IM_READ_PEGASE()</h3>
<p><a href="#IM_READ_PEG_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_SOLAR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_PEGASE()

 PURPOSE:
   Read the output of CREATE_PEGASE_SSPs into a structure. 

 INPUTS:
   None required.

 OPTIONAL INPUTS:
   metallicity - stellar metallicity to read; to see the full list 
     just call this routine with

     IDL&gt; ssp = im_read_pegase(metallicity='Z')

 KEYWORD PARAMETERS:
   kroupa - read the Kroupa+01 IMF files (default is to read the 
     Salpeter ones)
   abmag - convert the output spectra to AB mag at 10 pc
   flambda - convert the output spectra to F_lambda units (erg/s/cm^2/A) at 10 pc
   fnu - convert the output spectra to F_nu units (erg/s/cm^2/Hz) at 10 pc 

 OUTPUTS:
   pegase - output data structure
     Z - metallicity
     age - age vector [NAGE]
     mstar - mass in stars [NAGE]
     wave - wavelength vector [NPIX] (Angstrom)
     flux - flux vector [NPIX,NAGE] (erg/s/A)
     ... - and many other goodies

 OPTIONAL OUTPUTS:

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Oct 05, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_pegase.pro)</strong></p>
<hr />
<h3 id="IM_READ_SOLAR_F">IM_READ_SOLAR()</h3>
<p><a href="#IM_READ_PEGASE_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_STARBURST99_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_READ_SOLAR()

 PURPOSE:
       Read the solar spectrum provided by the CALSPEC database. 

 CALLING SEQUENCE:
       solar = im_read_solar()

 INPUTS:
       None

 OPTIONAL INPUTS:
       None

 KEYWORD PARAMETERS:
       None

 OUTPUTS:
       solar
          wave - wavelength [A]
          flux - flux density [erg/s/cm2/A]

 OPTIONAL OUTPUTS:
       None

 COMMON BLOCKS:
       None

 PROCEDURES USED:
       READCOL

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 Mar 21, U of A

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_read_solar.pro)</strong></p>
<hr />
<h3 id="IM_READ_STARBURST99_F">IM_READ_STARBURST99()</h3>
<p><a href="#IM_READ_SOLAR_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_TBL_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_READ_STARBURST99()

 PURPOSE:
   Read the Starburst99 spectra and data files into a structure. 

 INPUTS:
   rootname - root name of all the output files generated by SB99
     (this is the 'model designation' parameter)

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:

 OUTPUTS:
   sb99 - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
   See http://www.stsci.edu/science/starburst99/docs/run.html for a
   description of the various output files.
 
   Currently only reads the SPECTRUM (7), QUANTA (1), EWIDTH (10),
   YIELD (6), and POWER (4) files.

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Mar 12, UCSD
   jm13aug03siena - more clever I/O

 Copyright (C) 2010, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/im_read_starburst99.pro)</strong></p>
<hr />
<h3 id="IM_READ_TBL_F">IM_READ_TBL()</h3>
<p><a href="#IM_READ_STARBURST99_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_VEGA_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   im_read_tbl()
 PURPOSE:
   Read 2MASS style table into IDL structure
 CALLING SEQUENCE:
   tbl= im_read_tbl(filename,chunksize=,/silent)
 INPUTS:
   filename - file name
 BUGS:
   not well commented
 REVISION HISTORY:
   Spring 2003, Written Malcolm Britton
   J. Moustakas, ??? - better error checking
</pre>
<p><strong>(See pro/misc/im_read_tbl.pro)</strong></p>
<hr />
<h3 id="IM_READ_VEGA_F">IM_READ_VEGA()</h3>
<p><a href="#IM_READ_TBL_F">[Previous Routine]</a></p>
<p><a href="#IM_READ_VIZIER_TSV_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_READ_VEGA()

 PURPOSE:
       Read the Kurucz (1995) model of Vega (alpha-Lyrae) included
       with the Bruzual &amp; Charlot (2003) population synthesis
       models and normalize according to Hayes (1985). 

 CALLING SEQUENCE:
       vega = im_read_vega()

 INPUTS:
       None

 OPTIONAL INPUTS:
       None

 KEYWORD PARAMETERS:
       None

 OUTPUTS:
       vega
          wave - wavelength [A]
          flux - flux density [erg/s/cm2/A]

 OPTIONAL OUTPUTS:
       None

 COMMON BLOCKS:
       None

 PROCEDURES USED:
       READCOL

 COMMENTS:
       We use the Hayes (1985) normalization for Vega, as done in
       Fukigita et al. (1995): at 5556AA, flam(vega) = 3.44 pm
       0.05D-9 erg/s/cm2/A.  Note:  GISSEL99 uses 3.92E-9
       erg/s/cm2/A.  
       
       Assorted notes:
       
       rssgf uses const double VEGA_NORM = 3.98E-11; //rescale vega
       absolute normalization //from kuruz to hayes 85 (which is used
       in fukugita et al) const double RESCALE_VEGA =
       3.44E-09/3.29937E-09; //also Mpc^2 -&gt; cm^2 (3.826E33
       erg/s/L_sun / (3.086E24 cm/Mpc)^2) const double
       FLUX_CONVERSION = 4.017E-16; const double SOLAR_LUM =
       3.826E33; //solar lum in erg/s

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 October 29, U of A
       jm03oct29uofa - incorporated L. Moustakas' GVEGA() routine
       jm04mar20uofa - do not use BC03's vega spectrum

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_read_vega.pro)</strong></p>
<hr />
<h3 id="IM_READ_VIZIER_TSV_F">IM_READ_VIZIER_TSV()</h3>
<p><a href="#IM_READ_VEGA_F">[Previous Routine]</a></p>
<p><a href="#IM_ROBUST_SIGMA">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_READ_VIZIER_TSV()

 PURPOSE:
       Read &quot;|&quot; separated ASCII files downloaded from Vizier and
       outputs a data structure. 

 INPUTS:
       filename - see READ_FMR()

 OPTIONAL INPUTS:
       prefix - string to prepend to each tag in the output data
                structure 

 OUTPUTS:
       data - parsed data structure

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Nov 02, NYU, written

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_read_vizier_tsv.pro)</strong></p>
<hr />
<h3 id="IM_ROBUST_SIGMA">IM_ROBUST_SIGMA</h3>
<p><a href="#IM_READ_VIZIER_TSV_F">[Previous Routine]</a></p>
<p><a href="#IM_SCAMP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_ROBUST_SIGMA  

 PURPOSE:
	Calculate a resistant estimate of the dispersion of a distribution.
 EXPLANATION:
	For an uncontaminated distribution, this is identical to the standard
	deviation.

 CALLING SEQUENCE:
	result = ROBUST_SIGMA( Y, [ /ZERO, GOODVEC = ] )

 INPUT: 
	Y = Vector of quantity for which the dispersion is to be calculated

 OPTIONAL INPUT KEYWORD:
	/ZERO - if set, the dispersion is calculated w.r.t. 0.0 rather than the
		central value of the vector. If Y is a vector of residuals, this
		should be set.

 OPTIONAL OUPTUT KEYWORD:
       GOODVEC = Vector of non-trimmed indices of the input vector
 OUTPUT:
	ROBUST_SIGMA returns the dispersion. In case of failure, returns 
	value of -1.0

 PROCEDURE:
	Use the median absolute deviation as the initial estimate, then weight 
	points using Tukey's Biweight. See, for example, &quot;Understanding Robust
	and Exploratory Data Analysis,&quot; by Hoaglin, Mosteller and Tukey, John
	Wiley &amp; Sons, 1983, or equation 9 in Beers et al. (1990, AJ, 100, 32)

 REVSION HISTORY: 
	H. Freudenreich, STX, 8/90
       Replace MED() call with MEDIAN(/EVEN)  W. Landsman   December 2001
       Don't count NaN values  W.Landsman  June 2010
       J. Moustakas - crash if the distribution is too weird
</pre>
<p><strong>(See pro/math/im_robust_sigma.pro)</strong></p>
<hr />
<h3 id="IM_SCAMP">IM_SCAMP</h3>
<p><a href="#IM_ROBUST_SIGMA">[Previous Routine]</a></p>
<p><a href="#IM_SEX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_SCAMP

 PURPOSE:
       Run SCAMP given a list of SE catalogs.

 INPUTS: 
       catlist - list of SE FITS_LDAC format catalog file names 
       config - SCAMP configuration structure (see
         INIT_SCAMP_CONFIG); must be a scalar structure 

 OPTIONAL INPUTS: 
       configfile - optional output configuration file name for
         WRITE_DUMMY_CONFIG 

 KEYWORD PARAMETERS: 
       silent - suppress messages to STDOUT

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2008 Aug 06, NYU - written

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/im_scamp.pro)</strong></p>
<hr />
<h3 id="IM_SEX">IM_SEX</h3>
<p><a href="#IM_SCAMP">[Previous Routine]</a></p>
<p><a href="#IM_SIGFIGS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_SEX

 PURPOSE:
   Run SExtractor on one or more images (also optionally in
   double-image mode). 

 INPUTS: 
   imagelist - list of FITS file names

 OPTIONAL INPUTS: 
   config - SE configuration structure (see INIT_SEX_CONFIG); if none
     is provided then a default configuration file is used
   configfile - optional output configuration file name for
     WRITE_DUMMY_CONFIG 
   detect_imagelist - image(s) to use for detection (double-image 
     mode); can be a vector or a scalar

 KEYWORD PARAMETERS: 
   silent - suppress messages to STDOUT

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Aug 30, U of A - written
   jm08aug06nyu - major overhaul

 Copyright (C) 2001, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/im_sex.pro)</strong></p>
<hr />
<h3 id="IM_SIGFIGS_F">IM_SIGFIGS()</h3>
<p><a href="#IM_SEX">[Previous Routine]</a></p>
<p><a href="#IM_SIMPLE_KCORRECT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_SIGFIGS()
 PURPOSE:
	Convert a number to a string with a fixed number of significant digits.
 EXPLANATION:
	Similar to strn(), this function converts a number to a string, but,
	unlike strn(), with a fixed number of significant digits.

 CALLING SEQEUNCE:
	tmp = IM_SIGFIGS( number, digits )

 INPUT:
	NUMBER   This is the input number to be converted to a string.

 OUTPUT:
	tmp       The formatted string

 EXAMPLES:
	IDL&gt; print,strnsignif(12345.6789,3)  
	12300
	IDL&gt; print,strnsignif(1.23456789,3)
	1.23
	IDL&gt; print,strnsignif(.00123456789,3)
	0.00123

 HISTORY:
	1999-03-29 Version 1 written by Eric W. Deutsch &amp; Brooke
	Skelton
   J. Moustakas, 2012 Oct 12, UCSD - renamed im_sigfigs and vectorized
</pre>
<p><strong>(See pro/math/im_sigfigs.pro)</strong></p>
<hr />
<h3 id="IM_SIMPLE_KCORRECT_F">IM_SIMPLE_KCORRECT()</h3>
<p><a href="#IM_SIGFIGS_F">[Previous Routine]</a></p>
<p><a href="#IM_SNR_SPEC_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_SIMPLE_KCORRECT()

 PURPOSE:
   Compute K-corrections from and to an arbitrary set of bandpasses,
   but using a given SED for each object (see also IM_KCORRECT).

 INPUTS: 
   redshift      - redshifts [NGAL]
   maggies       - maggies, Galactic-reddening corrected
                   [IN_NBAND,NGAL] 
   ivarmaggies   - inverse variances corresponding to MAGGIES
                   [IN_NBAND,NGAL]  
   in_filterlist - list of filter functions corresponding to MAGGIES
                   [IN_NBAND] 
   sedwave       - rest-frame wavelength vector
   sedflux       - rest-frame spectral energy distribution

 OPTIONAL INPUTS: 
   band_shift - blueshift of output bandpasses (to get ^{z}b type
                bands) (default 0.0) 
   vname      - name of fit to use (defaults to 'default.nolines') 
   omega0     - Omega_matter (default 0.3)
   omegal0    - Omega_Lambda (default 0.7)
   h100       - Hubble constant divided by 100; the stellar mass
                estimates and absolute magnitudes are scaled to this
                value (default 0.7)

 KEYWORD PARAMETERS: 
   sdss   - see OUT_FILTERLIST
   vega   - convert the output magnitudes to Vega (default is AB)  
   silent - do not print messages to STDOUT

 OUTPUTS: 
   kcorrect   - K-corrections satisfying based on the best fit sum of
                templates: m_R = M_Q + DM(z) + K_QR(z) (all in AB)
                [OUT_NBAND,NGAL] 

 OPTIONAL OUTPUTS:
   out_filterlist - list of output filters; default UBVRI (Bessell),
                    unless /SDSS, in which case the 'ugriz' filters
                    are used [OUT_NBAND]
   chi2       - chi^2 of fit
   rmaggies   - reconstructed maggies from the fit [IN_NBAND,NGAL] 
   obands     - which input bands the K-corrections refer to
                [IN_NBAND,NGAL] 
   scale      - derived normalization factor used to scale the input
                SED to the observed photometry; note that if the
                input SED is normalized per unit mass, then SCALE is
                trivially related to the stellar mass 
   absmag     - absolute magnitude (for missing data, substitutes 
                model fit) in each output band [OUT_NBAND,NGAL] 
   ivarabsmag - inverse variance of absolute magnitude (for
                missing data = 0) in each output band
                [OUT_NBAND,NGAL]  
   synth_absmag - absolute magnitudes synthesized from the
     best-fitting model [OUT_NBAND,NGAL]   
   clineflux  - continuum flux at the wavelengths of strong emission 
                lines: [OII], H-beta, [OIII], and H-alpha [erg/s/cm2/A] 
   uvflux - continuum flux at 1500 and 2800 A from the best-fitting
     model, useful for computing SFRs [erg/s/cm^2/A]

 COMMENTS:
   This routine uses the bandpass that is closest in effective
   wavelength to the desired output bandpass to compute the
   K-correction (identical to always using /CLOSEST in
   Blanton's DEEP_KCORRECT).

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Jan 29, NYU - simplified version of
     IM_KCORRECT() 
   jm09aug18ucsd - lots of tweaks
   jm10jan07ucsd - added UVFLUX output
   jm11aug29ucsd - added SYNTH_ABSMAG optional output 

 Copyright (C) 2009-2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_simple_kcorrect.pro)</strong></p>
<hr />
<h3 id="IM_SNR_SPEC_F">IM_SNR_SPEC()</h3>
<p><a href="#IM_SIMPLE_KCORRECT_F">[Previous Routine]</a></p>
<p><a href="#IM_SPECRES_LAMP_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_SNR_SPEC()

 PURPOSE:
       Compute the exposure time to achieve a given S/N for
       spectroscopic observations.

 CALLING SEQUENCE:
       result = im_snr_spec(paramfile,f_obj,pars,_extra=extra,/silent)

 INPUTS:
       paramfile - parameter file describing the characteristics of
                   the detector, the wavelength of observation,
                   etc. (see for example
                   $IMPRO_DIR/etc/snr_params_template.txt) 
       f_obj     - scalar or vector target flux density [erg/s/cm2/A] 

 OPTIONAL INPUTS:
       lambda    - override the LAMBDA parameter (can be a vector)
       extra     - override any parameters in PARAMFILE

 KEYWORD PARAMETERS:
       silent    - suppress messages to STDOUT

 OUTPUTS:
       result - output data structure
          f_obj   - input F_OBJ (unmodified)
          snr     - input desired S/N (unmodified)
          time    - exposure time required to achieve desired S/N [minutes]
          e_obj   - total number of object electrons in the aperture 
          e_sky   - total number of sky electrons in the aperture 
          e_dark  - total number of dark current electrons in the aperture 
          e_noise - total number of read noise electrons in the aperture 

 OPTIONAL OUTPUTS:
       pars - data structure of the parameters in PARAMFILE

 PROCEDURES USED:
       READCOL, IM_READ_VEGA(), TABINV, SPLOG

 COMMENTS:
       Remember, to convert from surface brightness to flux density,
       subtract 2.5*alog10(omega) where omega is the area [arcsec2]
       subtended by the aperture.

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 Mar 05, U of A - written
</pre>
<p><strong>(See pro/sky/im_snr_spec.pro)</strong></p>
<hr />
<h3 id="IM_SPECRES_LAMP_F">IM_SPECRES_LAMP()</h3>
<p><a href="#IM_SNR_SPEC_F">[Previous Routine]</a></p>
<p><a href="#IM_SPHEREMATCH_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_SPECRES_LAMP()

 PURPOSE:
       Measure the instrumental resolution from a 2D arc lamp image. 

 CALLING SEQUENCE:


 INPUTS:
      arcfile  - arc lamp FITS file name

 OPTIONAL INPUTS:
      datapath - I/O path
      nmed_arc - median filter NMED rows centered on the middle row
                 of the arc lamp spectrum (default 10)
      nline    - identify and fit NLINE emission lines in the
                 spectrum (default 50)
      nback    - number of background polynomial terms to include in
                 the fit (default 2)
      npoly    - fit an NPOLY order polynomial to the resolution as a
                 function of wavelength (default linear)
      psname   - name of the postscript file (default lampres.ps)

 KEYWORD PARAMETERS:
      postscript - generate postscript output
      write      - write out the results

 OUTPUTS:
      resinfo  - structure with the results of the fitting

 OPTIONAL OUTPUTS:


 PROCEDURES USED:
       CWD(), RD2DSPEC(), MAKE_WAVE(), DJS_MEDIAN(), IM_NORMALIZE(), 
       FIND_NPEAKS(), POLY_ARRAY(), ILINEBACKFIT(), DFPSPLOT,
       DJS_PLOT, DJS_OPLOT, POLY_ITER()

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 February 20, U of A
       jm04may09uofa - generalized, substantial updates, error
                       catching, WRITE keyword added

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_specres_lamp.pro)</strong></p>
<hr />
<h3 id="IM_SPHEREMATCH_F">IM_SPHEREMATCH()</h3>
<p><a href="#IM_SPECRES_LAMP_F">[Previous Routine]</a></p>
<p><a href="#IM_SPLOTEW_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_SPHEREMATCH()

 PURPOSE:
   Simple iterative wrapper on spherematch. 

 INPUTS: 
   cat1 - first catalog
   cat2 - second catalog

 OPTIONAL INPUTS: 
   ratagname1 - structure tag name containing the right ascension (in
     decimal degrees) in the first catalog (default 'RA')
   dectagname1 - structure tag name containing the declination (in
     decimal degrees) in the first catalog (default 'DEC') 
   ratagname2 - structure tag name containing the right ascension (in
     decimal degrees) in the second catalog (default 'RA')
   dectagname2 - structure tag name containing the declination (in
     decimal degrees) in the second catalog (default 'DEC')
   radius - spherematching radius in arcseconds (default 1 arcsec) 

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   match1 - index array of matching objects in CAT1
   match2 - index array of matching objects in CAT2

 OPTIONAL OUTPUTS:
   raoff - median offset in right ascension (decimal degrees) 
   decoff - median offset in declination (decimal degrees) 

 COMMENTS:

 MODIFICATION HISTORY:
   2010-Jan-16, UCSD - J. Moustakas, UCSD

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/im_spherematch.pro)</strong></p>
<hr />
<h3 id="IM_SPLOTEW_F">IM_SPLOTEW()</h3>
<p><a href="#IM_SPHEREMATCH_F">[Previous Routine]</a></p>
<p><a href="#IM_STATS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_SPLOTEW()

 PURPOSE:
       Measure the equivalent width of emission or absorption lines
       in the spirit of IRAF's SPLOT task (fit the continuum locally,
       but estimate the error in the continuum using Monte Carlo).  

 CALLING SEQUENCE:
       result = im_splotew(wave,flux,ivar,linewave,linename=,$
          nmonte=, boxwidth=, /absorption, /doplot, /silent)

 INPUTS:
       wave     - spectrum wavelength in Angstroms [NPIX]
       flux     - data spectrum in erg/s/cm2/A [NPIX]
       ivar     - inverse variance spectrum in erg/s/cm2/A [NPIX]
       linewave - emission- or absorption-line wavelength [NLINE] 

 OPTIONAL INPUTS:
       linename - optional name for each line in LINEWAVE [NLINE]  
       nmonte   - number of Monte Carlo iterations (default 50)
       boxwidth - derive the EW within LINEWAVE+/-BOXWIDTH Angstroms
                  (default 35)

 KEYWORD PARAMETERS:
       absorption - set if fitting absorption lines
       doplot     - generate a diagnostic plot of the fit and wait
                    for a keystroke
       silent     - suppress messages to STDOUT 

 OUTPUTS:
       result - output data structure (see LINEEW_INIT for the
                structure fields) 

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       LINEEW_INIT(), MPFITPEAK(), DJS_PLOT, DJS_OPLOT

 COMMENTS:
       This routine assumes that the dispersion in Angstroms per
       pixel is constant. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 Jul 09, U of A - written
       jm05jan06uofa - documented, updated, and streamlined 

 Copyright (C) 2002, 2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_splotew.pro)</strong></p>
<hr />
<h3 id="IM_STATS_F">IM_STATS()</h3>
<p><a href="#IM_SPLOTEW_F">[Previous Routine]</a></p>
<p><a href="#IM_STRING_STATS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_STATS()

 PURPOSE:
   Compute some basic statistics and pack into a structure.

 INPUTS: 
   array - input vector

 OPTIONAL INPUTS: 
   sigrej - rejection threshold (default 4)
   extra - extra keywords for DJS_ITERSTAT

 KEYWORD PARAMETERS: 
   verbose - print to the screen
   baremin - only print the bare minimum statistics 

 OUTPUTS: 
   stats - output data structure with lots of goodies

 OPTIONAL OUTPUTS:
   mask - bit mask of rejected values

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2003 Jun 02, U of A
   jm04sep07uofa - added mask output
   jm05jan20uofa - added MAD output, removed VARIANCE, SKEWNESS, and
     KURTOSIS  
   jm05jun14uofa - added /BAREMIN
   jm05aug31uofa - added SIGREJ optional input    

 Copyright (C) 2003-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/im_stats.pro)</strong></p>
<hr />
<h3 id="IM_STRING_STATS_F">IM_STRING_STATS()</h3>
<p><a href="#IM_STATS_F">[Previous Routine]</a></p>
<p><a href="#IM_STRSPLIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_STRING_STATS()

 PURPOSE:
   Compute statistics on an array and build a string that looks nice
   as a legend label. 

 INPUTS: 
   arr - input array of any dimension

 OPTIONAL INPUTS: 
   type - type of string array to build:
     1 - median (mean+/-sigma)
     2 - median+/-sigma
     3 - like TYPE=1 but with rejection
   ndecimal - number of decimal points to allow (default 2)
   extra - extra keywords for IM_STATS()

 OUTPUTS: 
   str - string array for use with, e.g., LEGEND

 COMMENTS:
   For example, in most cases ARR will be residuals of some type. 

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Mar 07, NYU

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_string_stats.pro)</strong></p>
<hr />
<h3 id="IM_STRSPLIT_F">IM_STRSPLIT()</h3>
<p><a href="#IM_STRING_STATS_F">[Previous Routine]</a></p>
<p><a href="#IM_STRUCT_ASSIGN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_STRSPLIT()

 PURPOSE:
   Simple vectorized version of STRSPLIT().

 INPUTS: 
   str - input string (vector) array
   key - scalar pattern on which to do the splitting

 OPTIONAL INPUTS: 
   _extra - extra keywords for STRSPLIT()

 OUTPUTS: 
   split - parsed string

 COMMENTS:
   This is a pretty dumb piece of code and highly susceptible to
   breaking.  

 EXAMPLES:
   IDL&gt; str = ['2006-Jan-10','2009-Feb-10']
   IDL&gt; key = '-' then: 
   IDL&gt; split = im_strsplit(str,key,/extract)
   IDL&gt; help, split  
   SPLIT           STRING    = Array[3, 2]
   IDL&gt; print, split
   2006 Jan 10
   2009 Feb 10

 MODIFICATION HISTORY:
   J. Moustakas, 2009 May 21, NYU

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_strsplit.pro)</strong></p>
<hr />
<h3 id="IM_STRUCT_ASSIGN_F">IM_STRUCT_ASSIGN()</h3>
<p><a href="#IM_STRSPLIT_F">[Previous Routine]</a></p>
<p><a href="#IM_STRUCT_TRIMTAGS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_STRUCT_ASSIGN()

 PURPOSE:
   Simple wrapper on struct_assign to get around the
   pass-by-reference pain-in-the-neck.

 INPUTS: 
   in - assign data *from* this input structure
   out - assign data *to* this output structure

 KEYWORD PARAMETERS: 
   nozero - do not zero out data in OUT that does not exist in IN
     (see STRUCT_ASSIGN)

 OUTPUTS: 
   out - (modified)

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Mar 01, NYU

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/im_struct_assign.pro)</strong></p>
<hr />
<h3 id="IM_STRUCT_TRIMTAGS">IM_STRUCT_TRIMTAGS</h3>
<p><a href="#IM_STRUCT_ASSIGN_F">[Previous Routine]</a></p>
<p><a href="#IM_SWARP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   im_struct_trimtags

 PURPOSE:
   Trim a structure to a list of selected and/or excluded tags

 CALLING SEQUENCE:
   outstruct = im_struct_trimtags(instruct, [ select_tags=, except_tags=, $
    format= ]

 INPUTS:
   instruct   - Input structure, which can be an array

 OPTIONAL INPUTS:
   select_tags- List of tag names to include; this can use wildcards.
   except_tags- List of tag names to exclude; this can use wildcards.
   format     - If set, then convert all tags to strings using this
                array of format codes (one per output tag).  These format
                codes should not include parentheses.  For example,
                they could be ['f7.2','a'].

 OUTPUTS:
   outstruct  - Ouput structure array

 OPTIONAL OUTPUTS:

 COMMENTS:
   The selection based upon SELECT_TAGS is performed before excluding
   tags based upon EXCEPT_TAGS.  The order of the tags in the output
   structure is the same as the order set by SELECT_TAGS, which allows
   one to re-order the tags in a structure.

 EXAMPLES:

 BUGS:
   No checks are done to assure that tags are not selected multiple
   times (which will crash this code).
   No checks are done that FORMAT has the correct number of elements,
   which could also crash this code.

 PROCEDURES CALLED:
   copy_struct
   copy_struct_inx

 REVISION HISTORY:
   05-Jun-2002  Written by D. Schlegel, Princeton
   jm04jun28uofa - added NEWTAGS input
 -

unction im_struct_trimtags, instruct, select_tags=select_tags, $
except_tags=except_tags, format=format, newtags=newtags

  nout = n_elements(instruct)
  if (nout EQ 0) then return, 0
  if (NOT keyword_set(select_tags) AND NOT keyword_set(except_tags)) then $
   return, instruct

  tags = tag_names(instruct)
  ntag = n_elements(tags)

  ;----------
  ; Select which tags are wanted according to SELECT_TAGS.

  indx = -1L
  if (keyword_set(select_tags)) then begin
     for jtag=0, n_elements(select_tags)-1 do begin
        jj = where(strmatch(tags, strupcase(select_tags[jtag])))
        if (jj[0] NE -1) then begin
           if (indx[0] EQ -1) then indx = jj $
            else indx = [indx, jj]
        endif
     endfor
  endif else begin
     indx = lindgen(ntag)
  endelse

  if (indx[0] EQ -1) then return, 0

  ;----------
  ; De-select which tags are excluded according to EXCEPT_TAGS.

  if (keyword_set(except_tags)) then begin
     qkeep = bytarr(n_elements(indx)) + 1B
     for ktag=0, n_elements(except_tags)-1 do begin
        iexc = where(strmatch(tags[indx], strupcase(except_tags[ktag])), nexc)
        if (nexc GT 0) then qkeep[iexc] = 0B
     endfor
     ikeep = where(qkeep, nkeep)
     if (nkeep EQ 0) then return, 0
     indx = indx[ikeep]
  endif else begin
     nkeep = n_elements(indx)
  endelse
  
 jm04jun28uofa   
  nnew = n_elements(newtags)
  if (nnew eq 0L) then newtags = tags[indx] else begin
     if (nnew ne nkeep) then begin
        splog, 'Dimension of NEWTAGS and selected tags do not agree1'
        return, -1L
     endif
  endelse
  
  ;----------
  ; Create the output structure

  if (keyword_set(format)) then begin
     outstruct = create_struct(newtags[0], strarr(n_elements(instruct[0].(indx[0]))))
     for ii=1, nkeep-1 do outstruct = create_struct(outstruct, newtags[ii], $
       strarr(n_elements(instruct[0].(indx[ii]))))
     outstruct = create_struct(tags[indx[0]], strarr(n_elements(instruct[0].(indx[0]))))
     for ii=1, nkeep-1 do outstruct = create_struct(outstruct, tags[indx[ii]], $
       strarr(n_elements(instruct[0].(indx[ii]))))
  endif else begin
     outstruct = create_struct(newtags[0], instruct[0].(indx[0]))
     for ii=1, nkeep-1 do outstruct = create_struct(outstruct, newtags[ii], $
       instruct[0].(indx[ii]))
     outstruct = create_struct(tags[indx[0]], instruct[0].(indx[0]))
     for ii=1, nkeep-1 do outstruct = create_struct(outstruct, tags[indx[ii]], $
       instruct[0].(indx[ii]))
  endelse

  ;----------
  ; Copy the requested tags

  struct_assign, {junk:0}, outstruct ; Zero-out all elements
  outstruct = replicate(outstruct, nout)
  if (keyword_set(format)) then begin
     for ii=0, nkeep-1 do begin
         outstruct[*].(ii) = string(instruct.(indx[ii]), $
          format='('+format[ii]+')')
 The STRING() function will drop from its output any elements that
 are simply blank strings.  I consider this a bug, but one that can
 be avoided by looping through one element (structure row) at a time.
        for irow=0, nout-1 do outstruct[irow].(ii) = string(instruct[irow].(indx[ii]), $
          format='('+format[ii]+')')
     endfor
  endif else begin
     for ii = 0L, nkeep-1L do outstruct.(ii) = instruct.(indx[ii])
     struct_assign, instruct, outstruct ; jm04jun28uofa
  endelse

  return, outstruct
nd
</pre>
<p><strong>(See pro/misc/im_struct_trimtags.pro)</strong></p>
<hr />
<h3 id="IM_SWARP">IM_SWARP</h3>
<p><a href="#IM_STRUCT_TRIMTAGS">[Previous Routine]</a></p>
<p><a href="#IM_SYMBOLS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_SWARP

 PURPOSE:
       Run SWARP given a list of images.

 INPUTS: 
       imagelist - list of FITS file names
       config - SWARP configuration structure (see
         INIT_SWARP_CONFIG); must be a scalar structure 

 OPTIONAL INPUTS: 
       configfile - optional output configuration file name for
         WRITE_DUMMY_CONFIG 

 KEYWORD PARAMETERS: 
       silent - suppress messages to STDOUT

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2008 Aug 06, NYU - written

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/im_swarp.pro)</strong></p>
<hr />
<h3 id="IM_SYMBOLS">IM_SYMBOLS</h3>
<p><a href="#IM_SWARP">[Previous Routine]</a></p>
<p><a href="#IM_TEMDEN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_SYMBOLS

 PURPOSE:
       Define a variety of user plot symbols.

 CALLING SEQUENCE:


 INPUTS:
       psym  - plot symbol number

 OPTIONAL INPUTS:
       psize - symbol size (default 1.0)
       thick - symbol thickness (default 1.0)
       color - symbol color as defined in DJS_ICOLOR() (default none)  

 KEYWORD PARAMETERS:
       fill - fill the user symbol
       help - list and plot all the available symbols 

 OUTPUTS:
       The appropriate plot symbol is stored in PSYM=8 (see the 
       documentation for PLOTSYM).

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       USERSYM, DJS_ICOLOR()

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 October 14, U of A - written 
       jm05jun21uofa - documented

 Copyright (C) 2002, 2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 

</pre>
<p><strong>(See pro/plot/im_symbols.pro)</strong></p>
<hr />
<h3 id="IM_TEMDEN_F">IM_TEMDEN()</h3>
<p><a href="#IM_SYMBOLS">[Previous Routine]</a></p>
<p><a href="#IM_TODAY_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_TEMDEN()

 PURPOSE:
   Given one or more appropriate line-ratios, compute the
   nebular electron temperature and/or density.

 INPUTS:
   ionlist   - string array of density- and temperature-sensitive 
               ion names corresponding to RATIO
   ratio - density- and/or temperature-sensitive line-ratios

 OPTIONAL INPUTS:
   ratio_err - uncertainty on RATIO
   frac_tol  - minimum fractional tolerance to consider a good
               measurement (see below)
   nmonte    - number of Monte Carlo iterations (if RATIO_ERR is
               passed); if NMONTE=0 then don't do the Monte
               Carlo part
   temp_guess - initial guess at the temperature
   max_temp   - maximum temperature to consider (default 25,000 K)
   min_temp   - minimum temperature to consider (default 5,000 K)
   step_temp  - temperature step size
   max_dens   - maximum density to consider (default 10,000 cm^-3)
   min_dens   - minimum density to consider (default 1 cm^-3)
   step_dens  - density step size

 KEYWORD PARAMETERS:
   noiter - in the special case that [O III] is passed as the
            temperature diagnostic and [S II] is passed as the
            density diagnostic, the default is to iterate the
            solution so that the values converge

 OUTPUTS:
   result - data structure with lots of goodies

 COMMENTS:
   Temperature-sensitive line-ratios:
      O_III = (4959+5007)/4363
 
   Density-sensitive line-ratios:
      S_II = 6716/6731

 MODIFICATION HISTORY:
   J. Moustakas, 2007 Nov 25, NYU - written

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/im_temden.pro)</strong></p>
<hr />
<h3 id="IM_TODAY_F">IM_TODAY()</h3>
<p><a href="#IM_TEMDEN_F">[Previous Routine]</a></p>
<p><a href="#IM_TOTAL_FIR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_TODAY()
 PURPOSE:
   Return today's date
 KEYWORD PARAMETERS:
   justdate - just return the date, not the time, too
 MODIFICATION HISTORY:
   J. Moustakas, 2001 Oct 08, U of A
   jm05apr08uofa - remove blank spaces
</pre>
<p><strong>(See pro/misc/im_today.pro)</strong></p>
<hr />
<h3 id="IM_TOTAL_FIR_F">IM_TOTAL_FIR()</h3>
<p><a href="#IM_TODAY_F">[Previous Routine]</a></p>
<p><a href="#IM_TOTAL_IR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_TOTAL_FIR()

 PURPOSE:
       Compute the FAR-infrared luminosity given the IRAS fluxes at
       12, 25, 60, and 100 microns. 

 INPUTS:
       iras_flux - IRAS flux densities at 12, 25, 60, and 100 microns
                   in Jansky [4,NGALAXY]

 OPTIONAL INPUTS:
       iras_ferr - errors corresponding to IRAS_FLUX in Jansky
                   [4,NGALAXY] 
       alpha     - extend the data beyond 100 microns assuming a
                   lambda^(-alpha) modified blackbody curve 

 KEYWORD PARAMETERS:

 OUTPUTS:
       result - output data structure (see documentation below)

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       DJS_PLANCK(), QPINT1D()

 COMMENTS:
       L(FIR) is defined between 40 and 500 microns.  Upper limits are not treated.

       DJS_PLANCK() is available in David Schlegel's IDLUTILS library
       and QPINT1D() is Craig Markwardt's very robust numerical
       integration routine. 

 EXAMPLES:

 MODIFICATION HISTORY:
       S. Juneau, 2008, U of A, modified from im_total_ir.pro to get
       FIR flux instead of IR flux.

       J. Moustakas, 2004 Feb 25, U of A, based in large part on code  
          originally written by Karl Gordon

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_total_fir.pro)</strong></p>
<hr />
<h3 id="IM_TOTAL_IR_F">IM_TOTAL_IR()</h3>
<p><a href="#IM_TOTAL_FIR_F">[Previous Routine]</a></p>
<p><a href="#IM_WEIGHTED_MEAN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_TOTAL_IR()

 PURPOSE:
       Compute the total infrared luminosity given the IRAS fluxes at
       12, 25, 60, and 100 microns. 

 INPUTS:
       iras_flux - IRAS flux densities at 12, 25, 60, and 100 microns
                   in Jansky [4,NGALAXY]

 OPTIONAL INPUTS:
       iras_ferr - errors corresponding to IRAS_FLUX in Jansky
                   [4,NGALAXY] 
       alpha     - extend the data beyond 100 microns assuming a
                   lambda^(-alpha) modified blackbody curve 

 KEYWORD PARAMETERS:

 OUTPUTS:
       result - output data structure (see documentation below)

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       DJS_PLANCK(), QPINT1D()

 COMMENTS:
       L(IR) is defined between 8 and 1000 microns.  Assume that the
       flux density at 8 microns is equal to the flux density at 12
       microns.  Upper limits are not treated.

       DJS_PLANCK() is available in David Schlegel's IDLUTILS library
       and QPINT1D() is Craig Markwardt's very robust numerical
       integration routine. 

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 Feb 25, U of A, based in large part on code  
          originally written by Karl Gordon

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_total_ir.pro)</strong></p>
<hr />
<h3 id="IM_WEIGHTED_MEAN_F">IM_WEIGHTED_MEAN()</h3>
<p><a href="#IM_TOTAL_IR_F">[Previous Routine]</a></p>
<p><a href="#IM_WINDOW">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_WEIGHTED_MEAN()

 PURPOSE:
   Compute the weighted mean, standard deviations, and error in the
   mean, given an array of values and statistical uncertainties.

 INPUTS: 
   values - input array of values [NPTS]

 OPTIONAL INPUTS: 
   errors - uncertainty for each element of VALUES [NPTS]
   weights - statistical weight for each element of VALUES [NPTS]; if
     both ERRORS and WEIGHTS are passed then ERRORS takes precedence 
   quant - see Blanton's WEIGHTED_QUANTILE() (only used if
     WQUANTILE is desired)

 KEYWORD PARAMETERS: 
   nongauss - assume non-Gaussian errors; see COMMENTS, below; if
   using /NONGAUSS then you should pass WEIGHTS, not ERRORS

 OUTPUTS: 
   wmean - weighted mean

 OPTIONAL OUTPUTS:
   wsigma - weighted standard deviation
   wmean_err - weighted error in mean
   wquantile - weighted quantiles for each value of QUANT (see 
     WEIGHTED_QUANTILE) 

 COMMENTS:
   This routine can do several different things and is loosely based
   on E. Sheldon's WMOM routine.  The default use would be to
   pass VALUES and the 1-sigma ERRORS; the routine would then return
   the weighted mean and, optionally, the weighted error in the mean
   and weighted standard deviation.  If the errors are not
   Gaussian-distributed, however, then you should also set /NONGAUSS,
   in which case the weighted error in the mean is computed from the
   distribution itself (talk to E. Sheldon for details and also see
   various wiki math pages).  

   The second behavior is to pass WEIGHTS *instead* of ERRORS.  For
   Gaussian errors WEIGHTS=1/ERRORS^2 (i.e., the inverse variance),
   but nevertheless this optional input can be very useful.  If both
   ERRORS *and* WEIGHTS are passed then ERRORS takes precedence.

   Note that if both ERRORS *and* WEIGHTS are missing then uniform
   weights are assumed and the unweighted mean, unweighted error in
   the mean, and unweighted standard deviation are returned.

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Mar 28, NYU - streamlined version of
     E. Sheldon's WMOM.PRO routine
   jm10jul11ucsd - some small updates
   jm10aug06ucsd - substantial rewrite and expanded documentation 

 Copyright (C) 2008, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/im_weighted_mean.pro)</strong></p>
<hr />
<h3 id="IM_WINDOW">IM_WINDOW</h3>
<p><a href="#IM_WEIGHTED_MEAN_F">[Previous Routine]</a></p>
<p><a href="#IM_WISE2LIR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IM_WINDOW

 PURPOSE:
	Open up an IDL window appropriate to the user's screen size.  

 INPUTS:
	windx  - the index number of the window to open (default is to
	         open the next available window)

 OPTIONAL INPUTS:
	xratio - the ratio of the x-size of the window relative to the
		 x-size of the monitor, which should be less than 1;
		 default to 0.5
	yratio - as xratio above but for the y-size (default is xratio)
	xpos   - x-position of the window in device coordinates
	         (default is the upper-right hand corner)
	ypos   - y-position of the window in device coordinates

 KEYWORDS USED:
       square - force YSIZE=XSIZE

 PROCEDURES USED:
	WINDOW, GET_SCREEN_SIZE()

 MODIFICATION HISTORY:
	John Moustakas, 2000 September 15, UofA
       jm05jan21uofa - added SQUARE keyword; removed TITLE optional
                       input 

 Copyright (C) 2000, 2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_window.pro)</strong></p>
<hr />
<h3 id="IM_WISE2LIR_F">IM_WISE2LIR()[1]</h3>
<p><a href="#IM_WINDOW">[Previous Routine]</a></p>
<p><a href="#IM_WISE2LIR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_WISE2LIR()

 PURPOSE:
   Given a redshift and 24-, 70-, and 160-micron *observed*
   Spitzer/MIPS photometry, compute the total infrared luminosity,
   L(IR)=L(8-1100), based on various infrared SED models. 

 INPUTS: 
   redshift - redshift for each object [NGAL]
   maggies - observed 24, 70, and 160 micron fluxes [3,NGAL] 
   ivarmaggies - corresponding inverse variances [3,NGAL] 

 OPTIONAL INPUTS: 

 KEYWORD PARAMETERS: 
   chary - use the Chary &amp; Elbaz (2001) models (default)
   dale - use the Dale &amp; Helou (2002) models
   rieke - use the Rieke et al. (2009) models

 OUTPUTS: 
   lir - infrared luminosity for each object [L_sun, NGAL]

 OPTIONAL OUTPUTS:
   err_lir - *statistical* uncertainty on LIR [L_sun, NGAL]
   model_indx - fractional index number of the best-fitting model 
     [NGAL] 
   nuLnu - rest-frame (K-corrected) luminosities in the Spitzer 24-,
     70-, and 160-micron bands [erg/s, NGAL]
   ivar_nulnu - statistical uncertainty on nuLnu [erg/s, NGAL] 
   modelmab - observed-frame best-fitting IR SED for each galaxy in
     AB magnitudes [NPIX,NGAL]
   modelwave - observed-frame wavelength array corresponding to
     MODELMAB [Angstrom]

 COMMENTS:
   By default the code uses the Chary &amp; Elbaz (2001) models, unless
   either /RIEKE or /DALE are set.  The statistical uncertainty on
   ERR_LIR are derived using a simple Monte Carlo method.  This
   routine should be called using various models to estimate the
   *systematic* errors.  

 MODIFICATION HISTORY:
   J. Moustakas, 2013 Feb 15, Siena - based on IM_WISE2LIR()

 Copyright (C) 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_mips2lir.pro)</strong></p>
<hr />
<h3 id="IM_WISE2LIR_F">IM_WISE2LIR()[2]</h3>
<p><a href="#IM_WISE2LIR_F">[Previous Routine]</a></p>
<p><a href="#IM_WPARSE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_WISE2LIR()

 PURPOSE:
   Given a redshift and 12- and 22-micron *observed* WISE photometry,
   compute the total infrared luminosity, L(IR)=L(8-1100), based on
   various infrared SED models.

 INPUTS: 
   redshift - redshift for each object [NGAL]
   maggies - observed 12, and 22 micron fluxes, as output
     by WISE_TO_MAGGIES [2,NGAL]
   ivarmaggies - corresponding inverse variances [4,NGAL]

 OPTIONAL INPUTS: 

 KEYWORD PARAMETERS: 
   chary - use the Chary &amp; Elbaz (2001) models (default)
   dale - use the Dale &amp; Helou (2002) models
   rieke - use the Rieke et al. (2009) models

 OUTPUTS: 
   lir - infrared luminosity for each object [L_sun, NGAL]

 OPTIONAL OUTPUTS:
   err_lir - *statistical* uncertainty on LIR [L_sun, NGAL]
   model_indx - fractional index number of the best-fitting model 
     [NGAL] 
   nuLnu - rest-frame (K-corrected) luminosities in the WISE 12- and
     22-micron bands and the Spitzer 24-micron band [erg/s, NGAL]
   ivar_nulnu - statistical uncertainty on nuLnu [erg/s, NGAL] 
   modelmab - observed-frame best-fitting IR SED for each galaxy in
     AB magnitudes [NPIX,NGAL]
   modelwave - observed-frame wavelength array corresponding to
     MODELMAB [Angstrom]

 COMMENTS:
   By default the code uses the Chary &amp; Elbaz (2001) models, unless
   either /RIEKE or /DALE are set.  The statistical uncertainty on
   ERR_LIR are derived using a simple Monte Carlo method.  This
   routine should be called using various models to estimate the
   *systematic* errors.  

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Apr 19, UCSD
   jm13jan14siena - added NULNU, IVAR_NULNU, MODELMAB, and MODELWAVE
     optional outputs 

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_wise2lir.pro)</strong></p>
<hr />
<h3 id="IM_WPARSE_F">IM_WPARSE()</h3>
<p><a href="#IM_WISE2LIR_F">[Previous Routine]</a></p>
<p><a href="#IM_XYOUTS_TITLE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
     IM_WPARSE()

 PURPOSE:
  reads the files with input spectra into the structure used in
  the IDL NEBULAR package.
 
 EXPLANATION:
  Parses input spectra by assigning the fluxes for a particular
  wavelength into the corresponding tag in a structure.  The
  resulting structure is returned by the function.


 CALLING SEQUENCE:

   spec_structure = IM_WPARSE(infiles [, outfiles, LLIST = ])

 INPUT:  
     INFILES  - list of strings containing the names of the input
                 spectral files.


 OUTPUT:
     SPEC - array of structure containing the line fluxes of each
             matched transition of interest and the name of the
             associated infile and outfile.

 OPTIONAL INPUT KEYWORD:
     OUTFILES - list of strings containing the names of the output
                 spectral files.  Any relevant data for a given element
                 of 'SPEC' can be written to these files in this and 
                 other procedures in NEBULAR.  If 'OUTFILES' not given,
                 the string defaults to that set in 'struc_init.pro',
                 usually a null string.  For elements of 'OUTFILES'
                 with a length of zero, the data will be written to the
                 screen.

     LLIST - the file 'linelist' contains the user-defined database
             of wavelengths corresponding to a given transition.
             Alternately, the user can use another file with
             'LLIST = foo_list'.
        
 KEYWORDS:
     VERBOSE - turns on the print commands, writing either to the screen
               or to each file in the variable 'outfiles'.  The printout
               consists of the wavelength from the spectrum file along
               with an annotation declaring the ion and transition the
               program assumes it represents.

 EXAMPLE:

   Read in the spectra listed in the variable 'infiles', assign it to the
   appropriate transition in 'spec' as outlined in 'llist', assign
   to each spectrum an output file according to the variable 'outfiles',
   line fluxes, and print the relevant information to the outfiles by
   setting the keyword /VERBOSE:

   spec_structure = WPARSE(infiles, outfiles, LLIST = llist, /VERBOSE )

 NOTES:


 REVISION HISTORY:
       1.0	B.D.Moore	Rice Univ.	September 2003
</pre>
<p><strong>(See pro/hiiregions/im_wparse.pro)</strong></p>
<hr />
<h3 id="IM_XYOUTS_TITLE">IM_XYOUTS_TITLE</h3>
<p><a href="#IM_WPARSE_F">[Previous Routine]</a></p>
<p><a href="#IM_ZMINZMAX_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_XYOUTS_TITLE

 PURPOSE:
   Flexibly render a plot title on an existing plot using XYOUTS. 

 INPUTS: 

 OPTIONAL INPUTS: 
   xtitle - x-title to use
   ytitle - y-title to use
   title - title to use
   charsize - character size (default !p.charsize&gt;1)
   xspacing - multiplicative scale factor for YTITLE
   yspacing - multiplicative scale factor for XTITLE
   tspacing - multiplicative scale factor for TITLE
   extra - extra keywords for XYOUTS

 KEYWORD PARAMETERS: 
   xlog - existing plot is logarithmically spaced in x
   ylog - existing plot is logarithmically spaced in y
   
 OUTPUTS: 
   Flexibly adds a title to an existing plot. 

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Apr 21, U of A
   jm07mar15nyu - added [X,Y]LOG keywords
   jm11sep05ucsd - TITLE optional input added

 Copyright (C) 2005, 2007, 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/plot/im_xyouts_title.pro)</strong></p>
<hr />
<h3 id="IM_ZMINZMAX_F">IM_ZMINZMAX()</h3>
<p><a href="#IM_XYOUTS_TITLE">[Previous Routine]</a></p>
<p><a href="#IM_ZTWEAK_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IM_ZMINZMAX()

 PURPOSE:
   Compute the minimum and maximum redshift at which an object
   could have been observed in a survey of specified flux limits,
   given precomputed K-corrections.

 INPUTS: 
   redshift - galaxy redshift [NGAL]
   mag - apparent magnitude in the selection band [NGAL]
   coeffs - coefficients calculated by KCORRECT [5,NGAL]
   bright - bright magnitude cut-off of the survey
   faint - faint magnitude cut-off of the survey
   filter - filter function name corresponding to MAG

 OPTIONAL INPUTS: 
   vname - basis set used to calculate K-corrections
   q0, q1, qz0 - see K_EVOLVE()
   h100, omega0, omegalambda - desired cosmology for RED; default to
     h100=0.7, omega0=0.3, omegalambda=0.7
   sample_zmin - absolute minimum redshift of the sample under
     consideration (default 1E-3; see COMMENTS)
   sample_zmax - absolute maximum redshift of the sample under
     consideration (default 7.0; see COMMENTS)

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   Data structure with the following quantities:
     REDSHIFT - input redshift
     MAG - input apparent magnitude
     ZMIN - redshift at which each object's brightness equals BRIGHT 
     ZMAX - redshift at which each object's brightness equals FAINT 

 OPTIONAL OUTPUTS:
   offset - magnitude offset applied to the model magnitudes to match
     MAG at the redshift of the galaxy, presumably caused by
     scatter/zeropoint differences between the selection magnitude
     and the magnitude(s) used for K-corrections

 COMMENTS:
   The apparent magnitude of a source at redshift, ztrue, is:
     (1) m(obs) = M + DM(ztrue) + K(ztrue) - E(ztrue)
   
   where M is the absolute magnitude, DM(z) is the distance modulus,
   K(z) is the K-correction, and E(z) is the evolutionary
   correction (which is positive for q0&gt;0).
 
   Similarly, the hypothetical apparent magnitude of the same source
   at a different redshift would be:
     (2) m(z) = M + DM(z) + K(z) - E(z)

   By definition, BRIGHT and FAINT are the apparent magnitude at ZMIN
   and ZMAX, respectively.  Therefore, subtracting equation (2) from
   (1) we get: 
     BRIGHT-m(obs) = [DM(zmin)-DM(ztrue)]+[K(zmin)-K(ztrue)]-[E(zmin)-E(ztrue)]
     FAINT -m(obs) = [DM(zmax)-DM(ztrue)]+[K(zmax)-K(ztrue)]-[E(zmax)-E(ztrue)]

   So we just need to compute DM(z), K(z), and E(z) on a grid of
   redshifts and at the true redshift of each galaxy and then
   interpolate to get ZMIN and ZMAX.  Note that one nice thing about
   these equations is that all the zeropoints drop out as long as
   BRIGHT, FAINT, and m(obs) are defined the same way (e.g., Vega,
   uncorrected for reddening, etc.).  

   Note that if evolution is allowed, then the delta-mag vs redshift
   relationship may not be monotonic, and therefore ZMIN and ZMAX are
   not defined.  In this case, try setting SAMPLE_ZMAX to a redshift
   that is much smaller than the default (7.0), closer to the
   absolute maximum redshift of the sample under consideration. 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Feb 07, UCSD
   jm10sep09ucsd - SAMPLE_ZMAX optional input added

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/im_zminzmax.pro)</strong></p>
<hr />
<h3 id="IM_ZTWEAK_F">IM_ZTWEAK()</h3>
<p><a href="#IM_ZMINZMAX_F">[Previous Routine]</a></p>
<p><a href="#INIT_ISEDFIT_SSP_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IM_ZTWEAK()

 PURPOSE:
       Compute a small radial velocity shift via cross-correlation
       between a spectrum and a reference spectrum.

 CALLING SEQUENCE:
       zans = im_ztweak(spec,wave,refspec,refwave,specivar=,mask=, $
          vmin=,vmax=,nsamp=,minwave=,maxwave=,snrmin=,/doplot,/silent)

 INPUTS:
       spec      - input spectrum [NPIX]
       wave      - corresponding wavelength vector [NPIX]
       refspec   - reference spectrum [NREFPIX]
       refwave   - corresponding wavelength vector [NREFPIX]

 OPTIONAL INPUTS:
       specivar  - inverse variance for SPEC [NPIX]
       mask      - pixel mask (0 = ignore, 1 = keep) [NPIX] (not
                   supported) 
       vmin      - minimum velocity shift allowed (default -400 km/s) 
       vmax      - maximum velocity shift allowed (default +400 km/s) 
       nsamp     - oversample the data by NSAMP before
                   cross-correlating (default 10) 
       minwave   - only cross-correlate the data between MINWAVE and
                   MAXWAVE (default WAVE[0])
       maxwave   - see MINWAVE (default WAVE[NPIX-1]) 
       snrmin    - minimum S/N in the data spectrum (not supported) 

 KEYWORD PARAMETERS:
       doplot    - generate a plot of the chi2 array
       silent    - do not print the results to STDOUT

 OUTPUTS:
       zans      - output data structure
          pshift     - pixel shift
          pshift_err - pixel shift error
          zshift     - redshift
          zshift_err - redshift error
          vshift     - velocity shift
          vshift_err - velocity shift error
          errflag    - error flag 
             0 - success
             1 - S/N &lt; SNRMIN
             2 - no minimum found (edge chi2 solution)
             3 - PSHIFT/PSHIFT_ERR &lt; 3

 OPTIONAL OUTPUTS:

 COMMENTS: 
       Talk about SPECIVAR.

 PROCEDURES USED:
       COMBINE1FIBER, FINDCHI2MIN, DJS_PLOT, DJS_OPLOT, IM_BINSPEC(), 
       DJS_MEDIAN(), GET_ELEMENT, LEGEND, DJS_ICOLOR(), TEXTOIDL(),
       SPLOG 

 EXAMPLE:
       IDL&gt; zans = im_ztweak(spec,wave,refspec,refwave,vmin=-100.0,/doplot)

 MODIFICATION HISTORY:
       J. Moustakas, 2003 May 13, U of A - written
       jm03july2uofa - added MASK and SNRMIN keywords
       jm04mar09uofa - use ZFIND() instead of my crummy
                       cross-correlation code; major cleanup and
                       better diagnostic plots 

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/im_ztweak.pro)</strong></p>
<hr />
<h3 id="INIT_ISEDFIT_SSP_F">INIT_ISEDFIT_SSP()</h3>
<p><a href="#IM_ZTWEAK_F">[Previous Routine]</a></p>
<p><a href="#INIT_PSFEX_CONFIG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INIT_ISEDFIT_SSP()
 PURPOSE:
   Initialize a structure for the various BUILD_*_SSP routines.
 MODIFICATION HISTORY:
   J. Moustakas, 2010 Jan 22, UCSD
</pre>
<p><strong>(See pro/isedfit/init_isedfit_ssp.pro)</strong></p>
<hr />
<h3 id="INIT_PSFEX_CONFIG_F">INIT_PSFEX_CONFIG()</h3>
<p><a href="#INIT_ISEDFIT_SSP_F">[Previous Routine]</a></p>
<p><a href="#INIT_SCAMP_CONFIG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INIT_PSFEX_CONFIG()
 PURPOSE:
   Initialize a PSFEx configuration structure.
 OUTPUTS: 
   config - configuration structure with all the data needed to
     run PSFEx using IM_PSFEX
 MODIFICATION HISTORY:
   J. Moustakas, 2013 May 24, Siena
</pre>
<p><strong>(See pro/sextractor/init_psfex_config.pro)</strong></p>
<hr />
<h3 id="INIT_SCAMP_CONFIG_F">INIT_SCAMP_CONFIG()</h3>
<p><a href="#INIT_PSFEX_CONFIG_F">[Previous Routine]</a></p>
<p><a href="#INIT_SEX_CONFIG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INIT_SCAMP_CONFIG()
 PURPOSE:
   Initialize a scamp configuration structure.
 OPTIONAL INPUTS: 
   ncopies - number of times to copy the data structure
 OUTPUTS: 
   config - scamp configuration structure with all the data needed to
     run scamp using IM_SCAMP
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 06, NYU
</pre>
<p><strong>(See pro/sextractor/init_scamp_config.pro)</strong></p>
<hr />
<h3 id="INIT_SEX_CONFIG_F">INIT_SEX_CONFIG()</h3>
<p><a href="#INIT_SCAMP_CONFIG_F">[Previous Routine]</a></p>
<p><a href="#INIT_SWARP_CONFIG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INIT_SEX_CONFIG()
 PURPOSE:
   Initialize a sex configuration structure.
 OPTIONAL INPUTS: 
   ncopies - number of times to copy the data structure
 OUTPUTS: 
   config - sex configuration structure with all the data needed to
     run sex using IM_SEX
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 06, NYU
   jm09mar05nyu - added default path to PARAMETERS, FILTER, and NNW
     files  
   jm11mar02ucsd - updated to SExtractor 2.8.6
</pre>
<p><strong>(See pro/sextractor/init_sex_config.pro)</strong></p>
<hr />
<h3 id="INIT_SWARP_CONFIG_F">INIT_SWARP_CONFIG()</h3>
<p><a href="#INIT_SEX_CONFIG_F">[Previous Routine]</a></p>
<p><a href="#INTEGRATE_LF_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INIT_SWARP_CONFIG()
 PURPOSE:
   Initialize a swarp configuration structure.
 OPTIONAL INPUTS: 
   ncopies - number of times to copy the data structure
 OUTPUTS: 
   config - swarp configuration structure with all the data needed to
     run swarp using IM_SWARP
 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 06, NYU
</pre>
<p><strong>(See pro/sextractor/init_swarp_config.pro)</strong></p>
<hr />
<h3 id="INTEGRATE_LF_F">INTEGRATE_LF()</h3>
<p><a href="#INIT_SWARP_CONFIG_F">[Previous Routine]</a></p>
<p><a href="#INTEGRATE_MF_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INTEGRATE_LF()

 PURPOSE:
   Integrate a 1/Vmax-weighted luminosity function and, optionally,
   the best-fitting Schechter model. 

 INPUTS: 
   lf_vmax - 1/Vmax weighted luminosity function in the style of
     IM_MF_VMAX() 

 OPTIONAL INPUTS: 
   schechter - input IM_LF_SCHECHTER-style data structure

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   result - output data structure with lots of goodies

 COMMENTS:
   Error checking isn't great.

   Here are the analytic formulae for some of the integrals: 
     rhotot = Phistar*Mstar*Gamma(alpha+2)
     numtot = Phistar*Gamma(alpha+1)
     rho(&gt;M) = Phistar*Mstar*IGamma(alpha+2,M/Mstar)
     num(&gt;M) = Phistar*IGamma(alpha+1,M/Mstar)

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Aug 15, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/integrate_lf.pro)</strong></p>
<hr />
<h3 id="INTEGRATE_MF_F">INTEGRATE_MF()</h3>
<p><a href="#INTEGRATE_LF_F">[Previous Routine]</a></p>
<p><a href="#INVCT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   INTEGRATE_MF()

 PURPOSE:
   Integrate a 1/Vmax-weighted stellar mass function and, optionally,
   the best-fitting Schechter model.

 INPUTS: 
   mf_vmax - 1/Vmax weighted stellar mass function in the style of
     IM_MF_VMAX()

 OPTIONAL INPUTS: 
   schechter - input MF_SCHECHTER-style data structure

 KEYWORD PARAMETERS: 
   double - assume that SCHECHTER describes the double Schechter
     function used by MF_DOUBLE_SCHECHTER
   plus - assume that SCHECHTER describes the modified Schechter
     function used by MF_SCHECHTER_PLUS

 OUTPUTS: 
   result - output data structure with lots of goodies

 COMMENTS:
   Error checking isn't great.

   Here are the analytic formulae for some of the integrals: 
     rhotot = Phistar*Mstar*Gamma(alpha+2)
     numtot = Phistar*Gamma(alpha+1)
     rho(&gt;M) = Phistar*Mstar*IGamma(alpha+2,M/Mstar)
     num(&gt;M) = Phistar*IGamma(alpha+1,M/Mstar)

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Aug 15, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/integrate_mf.pro)</strong></p>
<hr />
<h3 id="INVCT">INVCT</h3>
<p><a href="#INTEGRATE_MF_F">[Previous Routine]</a></p>
<p><a href="#IRAC_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	INVCT

 PURPOSE:
	Invert the current and original color tables.

 CATEGORY:
	Image display.

 CALLING SEQUENCE:
	INVCT

 KEYWORD PARAMETERS:
	/QUIET:	Set this switch to suppress printing of a confirming message.

 COMMON BLOCKS:
	Colors:	Common block that contains current and original R, G, and B
		colors.  Used by LOADCT, HSV, and HLS routines.

 SIDE EFFECTS:
	Image display color tables are altered.
	Original color table in common block is inverted.

 RESTRICTIONS:
	The current color table is read from the device and not from the
	common block.

 PROCEDURE:
	Straight forward.  :-)

 EXAMPLE:
	LOADCT, 0		;load a black to white color table
	INVCT			;make it a white to back color table (better for
				;  PostScript
	image = DIST(200,200)	;make an image
	TVSCL, image		;display the image

 MODIFICATION HISTORY:
 	Written by:	Fen Tamanaha, July 10, 1993.  Revision 1.1
</pre>
<p><strong>(See pro/image/invct.pro)</strong></p>
<hr />
<h3 id="IRAC_FILTERLIST_F">IRAC_FILTERLIST()</h3>
<p><a href="#INVCT">[Previous Routine]</a></p>
<p><a href="#IREDSHIFT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   IRAC_FILTERLIST()
 PURPOSE:
   Return the IRAC filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Nov 13, UCSD
</pre>
<p><strong>(See pro/galaxy/irac_filterlist.pro)</strong></p>
<hr />
<h3 id="IREDSHIFT_F">IREDSHIFT()</h3>
<p><a href="#IRAC_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	IREDSHIFT()

 PURPOSE:
       Derive the redshift of a galaxy using PCA eigentemplates and
       chi-squared fitting.

 CALLING SEQUENCE:
       zans = iredshift(speclist,datapath=,zmin=,zmax=$
          npoly=,obsname=,eigendir=,eigenfile=,_extra=extra,$
          /update,/heliocor,/doplot,)

 INPUTS:
	speclist - FITS list of spectra

 OPTIONAL INPUTS:
	datapath  - I/O data path
	zmin      - minimum redshift to consider (can be negative for 
                   blushifts) [default -0.01] 
	zmax      - maximum redshift to consider [default 0.05]
	npoly     - number of polynomial &quot;eigenspectra&quot; to append to 
                   the PCA eigentemplates (default 2)
	obsname   - name of the observatory when HELIOCOR=1 (default 
                   KPNO)
       eigenfile - fitting eigentemplates (default to the most recent
                   &quot;spEigenGal-*&quot;) 
       eigendir  - path name to EIGENFILE (default to
                   &quot;${IDLSPEC2D_DIR}/templates&quot;) 
	extra     - extra inputs for ZFIND()
	
 KEYWORD PARAMETERS:
	update   - updated header corresponding to each object in
                  SPECLIST with the redshift information
	heliocr  - modify the derived redshift to a heliocentric frame
                  of reference using the RA, DEC, EPOCH, and JD
                  header information
	doplot   - generate a plot of the spectrum and best-fitting
                  linear combination of eigentemplates

 OUTPUTS:
	zans     - redshift computation output from ZFIND()

 OPTIONAL OUTPUTS:

 COMMENTS:
	The heliocentric correction to the redshift is placed in the
	header, but not returned to the user.

 EXAMPLE:

 PROCEDURES USED:
	CWD(), SPLOG, DJS_FILEPATH(), READFITS(), SXPAR(),
	POLY_ARRAY(), RD1DSPEC(), SXADDPAR, COMBINE1FIBER, DJS_MEAN(),
	ZFIND(), IM_HMS2DEC(), OBSERVATORY, HELIOCENTRIC(), DJS_MODFITS,
	ICLEANUP, DJS_PLOT, DJS_OPLOT

 MODIFICATION HISTORY:
	J. Moustakas, 2002 January 20, U of A
       jm03jan6uofa - minor updates and modifications

 Copyright (C) 2002-2003, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/iredshift.pro)</strong></p>
<hr />
<h3 id="ISEDFIT">ISEDFIT</h3>
<p><a href="#IREDSHIFT_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_AGEGRID_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT

 PURPOSE:
   Infer the physical properties of galaxies (probabalistically) by
   modeling their observed spectral energy distributions.

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file
   maggies - input galaxy photometry [NFILT,NGAL]
   ivarmaggies - inverse variance array for MAGGIES [NFILT,NGAL]  
   z - input galaxy redshifts [NGAL] 

 OPTIONAL INPUTS:
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where the results should be
     written (default PWD=present working directory)  

   outprefix - optionally write out files with a different prefix
     from that specified in ISEDFIT_PARAMFILE (or PARAMS) (very
     useful for fitting various subsets of the input sample with
     different assumptions)
   index - use this optional input to fit a zero-indexed subset of
     the full sample (default is to fit everything)

   ra,dec - galaxy right ascension and declination which will be
     copied to the output structure for the user's convenience
     [NGAL] (decimal degrees)

 KEYWORD PARAMETERS:
   allages - allow solutions with ages that are older than the age of
     the universe at the redshift of the object 
   silent - suppress messages to STDOUT
   nowrite - do not write out any of the output files (generally not
     recommended but can be useful in certain situations) 
   clobber - overwrite existing files of the same name (the default
     is to check for existing files and if they exist to exit
     gracefully)  

 OUTPUTS:
   Binary FITS tables containing the fitting results are written
   to ISEDFIT_DIR. 

 OPTIONAL OUTPUTS:
   isedfit_results - output data structure containing all the
     results; see the iSEDfit documentation for a detailed breakdown
     and explanation of all the outputs
   isedfit_post - output data structure containing the random draws
     from the posterior distribution function, which can be used to
     rebuild the posterior distributions of any of the output
     parameters (using ISEDFIT_RECONSTRUCT_POSTERIOR) 
   isedfit_outfile - output file name of the iSEDfit results

 COMMENTS:
   Better documentation of the output data structures would be
   helpful here.

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Sep 01, UCSD - I began writing iSEDfit in 2005
     while at the U of A, adding updates off-and-on through 2007;
     however, the code has evolved so much that the old modification
     history became obsolete!  Future changes to the officially
     released code will be documented here.
   jm13jan13siena - documentation rewritten and updated to reflect
     many major changes
   jm13aug09siena - updated to conform to a new and much simpler data
     model; documentation updated

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_AGEGRID_F">ISEDFIT_AGEGRID()</h3>
<p><a href="#ISEDFIT">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_CHI2_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_AGEGRID()

 PURPOSE:
   Build an age (time) grid that deals with bursts correctly. 

 INPUTS: 
   sfhinfo - iSEDfit-style star formation history structure (see
     ISEDFIT_SFH for more details)
      .TAU - characteristic e-folding time [Gyr]
      .NBURST - number of bursts
      .TBURST - time each burst begins [Gyr]
      .DTBURST - burst duration [Gyr]
      .FBURST - mass fraction of each burst
      .TRUNCTAU - construct an age vector for a truncated burst (only
        used for NBURST&gt;0)
   tau - see ISEDFIT_SFH documentation [Gyr]

 OPTIONAL INPUTS: 
   inage - input age vector to use as a starting point [Gyr]; note
     that you either have to pass INAGE *or* NAGE, MINAGE, MAXAGE
     (with INAGE dominating) 
   nage - number of elements in OUTAGE (default 100)
   minage - minimum age [Gyr] (default 0.05)
   maxage - maximum age [Gyr] (default 13.0)

 KEYWORD PARAMETERS: 
   delayed - construct a &quot;delayed&quot; rather a &quot;simple&quot; tau model (see
     iSEDfit documentation) (recommended)
   bursttype - type of burst (see iSEDfit documentation)
     0 - step function
     1 - Gaussian (default)
     2 - step function with exponential wings
   lookback - convert OUTAGE to a lookback time
   debug - make a simple debugging plot and wait for a keystroke 

 OUTPUTS: 
   outage - output age vector [Gyr]

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 01, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_agegrid.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_CHI2_F">ISEDFIT_CHI2()</h3>
<p><a href="#ISEDFIT_AGEGRID_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_CONVOLVE_SFH_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_CHI2()
 PURPOSE:
   Compute chi^2 and the best-fitting scale factor given a grid of
   observed and synthetic photometry.  This routine is an ISEDFIT
   support routine and in general should not be called on its own. 
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Feb 10, NYU - developed
   jm13aug09siena - updated to the latest data model 
</pre>
<p><strong>(See pro/isedfit/isedfit_chi2.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_CONVOLVE_SFH_F">ISEDFIT_CONVOLVE_SFH()</h3>
<p><a href="#ISEDFIT_CHI2_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_FILEPATHS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_CONVOLVE_SFH()

 PURPOSE:
   iSEDfit-specific convolution code (see IM_CONVOLVE_SFH for a
   generalized version).

 INPUTS: 
   flux - input SSP spectra [NPIX,NAGE]
   age  - age vector corresponding to each spectrum in FLUX [NAGE, years] 

   sfhinfo - iSEDfit-style star formation history structure (see
     ISEDFIT_SFH for more details)
      .TAU - characteristic e-folding time [Gyr]
      .NBURST - number of bursts
      .TBURST - time each burst begins [Gyr]
      .DTBURST - burst duration [Gyr]
      .FBURST - mass fraction of each burst
      .TRUNCTAU - construct an age vector for a truncated burst (only
        used for NBURST&gt;0)
   tau - see ISEDFIT_SFH documentation [Gyr]

 OPTIONAL INPUTS:
   time - desired output age vector (Gyr)
   mstar - stellar mass of the SSP with time [NAGE]
   nlyc - SSP evolution in the number of Ly-continuum photons [NAGE] 
   nsamp - time oversampling factor (default 2)

 OPTIONAL OUTPUTS:
   sfh - star formation rate at each TIME [NSFH]
   cspmstar - stellar mass of the CSP with time [NSFH]
   cspnlyc - CSP evolution in the number of Ly-continuum photons [NSFH]

 KEYWORD PARAMETERS:
   delayed, bursttype - additional keywords for ISEDFIT_SFH (see that
     routine for details)   

 OUTPUTS: 
   cspflux - time-dependent spectra of the composite stellar
     population (CSP) [NPIX,NSFH]

 COMMENTS:
   Most inputs, especially TIME, should be double-precision for best
   results. 

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Jan 27, UCSD
   jm11mar07ucsd - better age resolution; various other bug fixes
   jm13aug01siena - added support for the number of Lyman-continuum
     photons 

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_convolve_sfh.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_FILEPATHS_F">ISEDFIT_FILEPATHS()</h3>
<p><a href="#ISEDFIT_CONVOLVE_SFH_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_KCORRECT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_FILEPATHS()
 PURPOSE:
   Given a parameters structure (see READ_ISEDFIT_PARAMFILE), pack
   all the requisite paths and filenames into a structure.  This
   routine is a support routine and in general should not be called
   on its own.
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Feb 11, NYU
   jm13aug09siena - updated to the latest data model 
</pre>
<p><strong>(See pro/isedfit/isedfit_filepaths.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_KCORRECT">ISEDFIT_KCORRECT</h3>
<p><a href="#ISEDFIT_FILEPATHS_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_MODELS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_KCORRECT

 PURPOSE:
   Compute K-corrections from the best-fitting iSEDfit model.

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file

 OPTIONAL INPUTS:
   params - iSEDfit parameter data structure (over-rides PARAMFILE) 
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where all the ISEDFIT output
     files can be found; should match the directory passed to ISEDFIT
     (default PWD=present working directory)  
   montegrids_dir - full directory path where the Monte Carlo grids
     written by ISEDFIT_MONTEGRIDS can be found (default 'montegrids'
     subdirectory of the PWD=present working directory)
   index - zero-indexed list of objects to analyze (default is to
     compute K-corrections for everything)
   outprefix - optional output prefix string (see ISEDFIT) 

   absmag_filterlist - list of output filters in which K-corrected
     absolute magnitudes are desired (default SDSS ugriz) [NFILT] 
   band_shift - use band-shifted rest-frame bandpasses (default 0.0) 

 KEYWORD PARAMETERS:
   vega - convert the output absolute magnitudes to Vega (default is
     to keep them as AB magnitudes)
   nowrite - do not write out any of the output files (generally not
     recommended but can be useful in certain situations) 
   clobber - overwrite existing files of the same name (the default
     is to check for existing files and if they exist to exit
     gracefully)  

 OUTPUTS:
   kcorrect_results - [NGAL] data structure with the following tags
     in addition to some handy info culled from the ISEDFIT data
     structure: 
      .kcorrect - derived K-corrections [NFILT]
      .absmag - absolute (rest-frame) magnitudes [NFILT]
      .ivarabsmag - corresponding inverse variance [NFILT]
      .synth_absmag - like ABSMAG, but as synthesized from the
        best-fitting model [NFILT] 

 OPTIONAL OUTPUTS:

 COMMENTS:
   This routine is a glorified wrapper on IM_SIMPLE_KCORRECT. 

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Aug 30, UCSD
   jm13aug09siena - updated to conform to the latest data model;
     documentation updated 

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_kcorrect.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_MODELS">ISEDFIT_MODELS</h3>
<p><a href="#ISEDFIT_KCORRECT">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_MONTEGRIDS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_MODELS

 PURPOSE:
   Synthesize photometry on a grid of redshift for all the
   models generated by ISEDFIT_MONTEGRIDS.

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file

 OPTIONAL INPUTS:
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where the iSEDfit models and
     output files should be written (default PWD=present working
     directory) 
   montegrids_dir - full directory path where the Monte Carlo grids
     written by ISEDFIT_MONTEGRIDS can be found (default 'montegrids'
     subdirectory of the PWD=present working directory)

 KEYWORD PARAMETERS:
   clobber - overwrite existing files of the same name (the default
     is to check for existing files and if they exist to exit
     gracefully)  

 OUTPUTS:
   Binary FITS tables containing the convolved photometry are written
   to the appropriate subdirectory of ISEDFIT_DIR, but these should
   be transparent to most users. 

 OPTIONAL OUTPUTS:

 COMMENTS:
   Should include a bit more info about the output data tables. 

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Sep 01, UCSD - I began writing iSEDfit in 2005
     while at the U of A, adding updates off-and-on through 2007;
     however, the code has evolved so much that the old modification
     history became obsolete!  Future changes to the officially
     released code will be documented here.
   jm13jan13siena - documentation rewritten and updated to reflect
     many major changes
   jm13aug09siena - updated to conform to a new and much simpler data
     model; documentation updated

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_models.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_MONTEGRIDS">ISEDFIT_MONTEGRIDS</h3>
<p><a href="#ISEDFIT_MODELS">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_NEBULAR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_MONTEGRIDS

 PURPOSE:
   Build the Monte Carlo star formation history grids.

 INPUTS: 
   isedfit_paramfile - iSEDfit parameter file

 OPTIONAL INPUTS: 
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where the iSEDfit models and
     output files will be written (default PWD=present working
     directory) 
   montegrids_dir - full directory path where the Monte Carlo grids
     should be written (default 'montegrids' subdirectory of the
     PWD=present working directory) 

   modelchunksize, minichunksize - to deal with disk space issues
     this routine splits the full set of models (NMODEL) into
     MODELCHUNKSIZE sized chunks (as specified in the
     ISEDFIT_PARAMFILE parameter file); furthemore, to circumvent
     additional possible memory issues, each chunk is further divided
     into MINICHUNKSIZE (default 500) sized chunks; all these tricks 
     *should be* transparent to the user and are only documented here
     for completeness 

 KEYWORD PARAMETERS: 
   clobber - delete old files from a previous call to this routine,
     including all the Monte Carlo distributions of parameter values
     (the user is prompted to confirm the clobber to avoid
     inadvertently deleting a large grid!)
   debug - make some debugging plots and wait for a keystroke
     (currently not a very useful switch)

 OUTPUTS: 
   The grids (spectra, parameters, etc.) are written out in a data
   model that iSEDfit understands, and which should be transparent to
   the user.  However, this routine also generates a QAplot (written
   to the ISEDFIT_DIR directory) which should be inspected to ensure
   that proper parameter priors have been chosen.  

 COMMENTS:
   Some ToDo items:
     * output the UV slope (beta) and maybe D(4000)
     * better debugging diagnostic plots 
     * Speed the routine up?

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Feb 20, NYU - written
   jm09may22nyu - generalized how the reddening curves are treated 
   jm10jul11ucsd - include SFR measures on various timescales and the
     birthrate parameter at each age
   jm10nov12ucsd - streamlined and parameter file adopted
   jm11aug24ucsd - documentation updated
   jm13jan13siena - semi-major changes in preparation for public
     release 
   jm13aug09siena - significant update and rewrite to conform to a
     new and much simpler data model

 Copyright (C) 2009-2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_montegrids.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_NEBULAR_F">ISEDFIT_NEBULAR()</h3>
<p><a href="#ISEDFIT_MONTEGRIDS">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_POSTERIOR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_NEBULAR()

 PURPOSE:
   Compute the nebular continuum and emission-line spectrum given the
   number of Lyman-continuum photons and the forbidden line-ratios
   calibrated using ISEDFIT_CALIBRATE_LINERATIOS.

 INPUTS:
   nlyc - number of Lyman-continuum photons (sec^-1) [NSPEC]

 OPTIONAL INPUTS:
   wave - input/output rest-frame wavelength vector [NPIX, Angstrom];
     if WAVE is given then you need to ensure adequate sampling
     around the wavelengths of the lines!
   inst_vsigma - instrumental velocity dispersion (default 0 km/s)
   vsigma - intrinsic (kinematic) velocity dispersion (default 100 km/s) 
   oiiihb - the forbidden emission-line strengths are calibrated
     empirically (see ISEDFIT_CALIBRATE_LINERATIOS) to the
     [OIII]/H-beta line-ratio; the default value is 10.0^(-0.4
     dex)=0.398, which is typical of a galaxy with a ~solar
     (gas-phase) metallicity [scalar or NSPEC vector]

 KEYWORD PARAMETERS:
   nospectrum - do not return the spectrum (used by
     ISEDFIT_BUILD_MONTEGRIDS to generate an emission-line friendly
     wavelength array)

 OUTPUTS:
   flam_neb - nebular continuum spectrum in units of erg/s/cm^2/A
     placed at a fiducial distance of 10 pc [NPIX,NSPEC]

 OPTIONAL OUTPUTS:
   line - data structure containing all the details of the
     emission-line spectrum [NLINE]
   flam_line - pure nebular emission-line spectrum
     [NPIX,NSPEC,erg/s/cm^2/A] 
   flam_cont - pure nebular continuum spectrum
     [NPIX,NSPEC,erg/s/cm^2/A]  

 COMMENTS:
   If NLYC is a vector corresponding to different desired output
   spectra then this routine calls itself recursively.  In that case,
   OIIIHB can be a scalar or a vector.

   Note that FLAM_NEB = FLAM_LINE + FLAM_CONT

 MODIFICATION HISTORY:
   J. Moustakas, 2013 Aug 01, Siena

 Copyright (C) 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_nebular.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_POSTERIOR_F">ISEDFIT_POSTERIOR()</h3>
<p><a href="#ISEDFIT_NEBULAR_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_QAPLOT_MODELS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_POSTERIOR()
 PURPOSE:
   Compute the posterior probability distribution.  This routine is
   an ISEDFIT support routine and in general should not be called on
   its own.  
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Feb 10, NYU - developed
</pre>
<p><strong>(See pro/isedfit/isedfit_posterior.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_QAPLOT_MODELS">ISEDFIT_QAPLOT_MODELS</h3>
<p><a href="#ISEDFIT_POSTERIOR_F">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_QAPLOT_SED">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_QAPLOT_MODELS

 PURPOSE:
   Generate color-color and redshift-color QAplots to help assess the
   choice of iSEDfit model parameters/priors. 

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file
   maggies - input galaxy photometry [NFILT,NGAL]
   ivarmaggies - inverse variance array for MAGGIES [NFILT,NGAL]  
   z - input galaxy redshifts [NGAL] 

 OPTIONAL INPUTS:
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where the QAplots should be
     written; must match the directory passed to ISEDFIT_MODELS
     (default PWD=present working directory) 
   thesefilters - build the QAplots from this subset of the available
     filters; default is to use all the filters, which is *not*
     recommended if you have more than 4-5 filters (see COMMENTS)!
     the (string) filter names can be missing the '.par' suffix
   outprefix - optional output prefix string (see ISEDFIT) 

   colorcolor_pdffile - overwrite the default name of the output
     color-color PDF file (not typically necessary since the file
     name matches the ISEDFIT output files); must end with a '.PDF'
     suffix 
   zcolor_pdffile - same as above but for the redshift-color PDF file

 KEYWORD PARAMETERS:
   clobber - overwrite existing files of the same name (the default
     is to check for existing files and if they exist to exit
     gracefully)  

 OUTPUTS:
   This routine generates two sets of QAplots--color-color diagrams
   and color-redshift diagrams---which show how well (or poorly!) the
   models overlap the data.  

 OPTIONAL OUTPUTS:

 COMMENTS:
   Left to its own devices, this routine will generate *all*
   combinations of color-redshift and color-color diagrams.
   Therefore if you have more than a handful of filters you should
   use the THESEFILTERS optional input parameter.  For example,
   consider your full list of filters consists of:
       filterlist = [$
         'galex_FUV.par',$
         'galex_NUV.par',$
         'sdss_u0.par',$
         'sdss_g0.par',$
         'sdss_r0.par',$
         'sdss_i0.par',$
         'sdss_z0.par',$
         'wise_w1.par',$
         'wise_w2.par']

   You might call this routine with the following (intelligently
   chosen) subset of filters:
     IDL&gt; thesefilters = ['galex_NUV','sdss_g0','sdss_r0','sdss_i0','wise_w1']
     IDL&gt; isedfit_qaplot_models, isedfit_paramfile, maggies, $
     IDL&gt;  ivarmaggies, z, thesefilters=thesefilters

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2013 Aug 19, Siena 

 Copyright (C) 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_qaplot_models.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_QAPLOT_SED">ISEDFIT_QAPLOT_SED</h3>
<p><a href="#ISEDFIT_QAPLOT_MODELS">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_RECONSTRUCT_POSTERIOR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_QAPLOT_SED

 PURPOSE:
   Generate spectral energy distribution (SED) quality-assurance (QA)
   plots from the iSEDfit output.

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file

 OPTIONAL INPUTS:
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where the QAplots should be
     written; must match the directory passed to ISEDFIT (default
     PWD=present working directory) 
   montegrids_dir - full directory path where the Monte Carlo grids
     written by ISEDFIT_MONTEGRIDS can be found (default 'montegrids'
     subdirectory of the PWD=present working directory)
   index - use this optional input to plot a zero-indexed subset of
     the full sample (default is to plot everything, although see
     COMMENTS)
   galaxy - string array of galaxy names to include in the legend on
     each page of the QAplot
   outprefix - optional output prefix string (see ISEDFIT) 
   pdffile - overwrite the default name of the output PDF file (not
     typically necessary since the file name matches the ISEDFIT
     output files); must end with a '.PDF' suffix

   nrandom - build a QAplot for NRANDOM randomly selected galaxies
     (ignored if INDEX is passed)
   nsigma - plot photometry detected at less than NSIGMA-sigma as
     upper limits (default 2.0)
   xrange, yrange - x- and y-range limits of the plot (useful when
     you want all the plots to have the same plot limits)
   xlog - logarithmic wavelength spacing (default linear) 

 KEYWORD PARAMETERS:
   clobber - overwrite existing files of the same name (the default
     is to check for existing files and if they exist to exit
     gracefully)  
   maxold - see ISEDFIT

 OUTPUTS:
   This routine generates a handy QAplot showing the input
   photometry, the best-fit (maximum likelihood) SED, and the
   posterior distributions on several of the key parameters. 

 OPTIONAL OUTPUTS:
   isedfit_results - output data structure containing all the
     results; see the iSEDfit documentation for a detailed breakdown
     and explanation of all the outputs  

 COMMENTS:
   This routine should be not be used to plot too many objects,
   otherwise memory problems may occur; use INDEX or NRANDOM.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2005 Feb 12, U of A
   jm05aug04uofa - some small changes incorporated
   jm06mar06uofa - documented; major changes to support the latest
     version of ISEDFIT 
   jm06mar23uofa - added FNU, FLAMBDA, MEDIANPLOT, and MAXOLD
     keywords   
   jm07jun27nyu  - significantly streamlined; the best-fitting SED
     models are now read by READ_ISEDFIT()  
   jm13aug09siena - updated to conform to the latest data model;
     documentation updated 

 Copyright (C) 2005-2007, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_qaplot_sed.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_RECONSTRUCT_POSTERIOR_F">ISEDFIT_RECONSTRUCT_POSTERIOR()</h3>
<p><a href="#ISEDFIT_QAPLOT_SED">[Previous Routine]</a></p>
<p><a href="#ISEDFIT_SFH_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_RECONSTRUCT_POSTERIOR()

 PURPOSE:
   Reconstruct the posterior distribution(s) of the output
   parameters.  This routine is used by READ_ISEDFIT() among other
   routines but it can also be called independently. 

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file

 OPTIONAL INPUTS:
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where the iSEDfit models and
     output files should be written (default PWD=present working
     directory) 
   montegrids_dir - full directory path where the Monte Carlo grids
     written by ISEDFIT_MONTEGRIDS can be found (default 'montegrids'
     subdirectory of the PWD=present working directory)
   index - use this optional input to restore a zero-indexed subset
     of the full sample (default is to restore everything)
   outprefix - optional output prefix string (see ISEDFIT) 

 KEYWORD PARAMETERS:

 OUTPUTS:
   result - data structure array containing lots of goodies 

 OPTIONAL OUTPUTS:

 COMMENTS:
   Memory problems may be encountered if this routine is used to
   reconstruct too many models/results.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2007 Jun 27, NYU - largely excised from
     ISEDFIT_SED_QAPLOT and ISEDFIT_MEASURE
   jm13aug09siena - updated to conform to the latest version of
     iSEDfit 

 Copyright (C) 2007, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_reconstruct_posterior.pro)</strong></p>
<hr />
<h3 id="ISEDFIT_SFH_F">ISEDFIT_SFH()</h3>
<p><a href="#ISEDFIT_RECONSTRUCT_POSTERIOR_F">[Previous Routine]</a></p>
<p><a href="#IUNRED_LINEDUST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ISEDFIT_SFH()

 PURPOSE:
   Generate an iSEDfit-compatible star formation history including
   allowing for multiple bursts.

 INPUTS: 
   sfhinfo - iSEDfit-style star formation history structure with the
     following tags (note, only .TAU is mandatory, but see also the
     TAU and MGAL optional inputs):
       .TAU - characteristic e-folding time [Gyr]
       .TRUNCTAU - characteristic e-folding time over which the last
         burst should be truncated [Gyr]
       .NBURST - number of bursts
       .TBURST - time/age at which each burst begins [Gyr]
       .DTBURST - burst duration (exact meaning depends on BURSTTTYPE) [Gyr]
       .FBURST - total stellar mass fraction formed in each burst
       .TOTALMASS - if this tag is present, then normalize everything
         (SFH, SFR100, MGALAXY, etc.) to this value at the final
         age/time bin (i.e., the last element of OUTAGE); this
         parameter corresponds to the total (time-integrated) stellar
         mass formed (ignoring mass lost through winds, SNe, etc.)
         over the age of the &quot;galaxy&quot; (the default is to normalize to
         the  value of MGALAXY at the last time/age bin) 
   tau - in lieu of passing SFHINFO, a basic star-formation history
     (no bursts, truncated or otherwise) be constructed by simply
     passing the characteristic e-folding time through this variable
     [Gyr] 
   totalmass - drop-in replacement for SFHINFO.TOTALMASS
 
 OPTIONAL INPUTS: 
   nagemax - maximum number of age/time points to use internally
     (default 250); probably shouldn't change this!
   dage - minimum time resolution at which the SFH should be sampled
     internally (default 20 Myr); probably shouldn't change
     this! [Gyr]
   maxage - compute the SFH between 0 and MAXAGE [Gyr] (this optional
     input is trumped by OUTAGE)
   outage - time/age corresponding to SFH [Gyr, NOUTAGE]
   useage - optionally force this routine to internally use this
     age/time vector [NAGE, GYR]; not generally recommended!
   mtau - normalization of the TAU model after infinite time (default
     1.0) [Msun]  
   
 KEYWORD PARAMETERS:
   delayed - construct a &quot;delayed&quot; rather a &quot;simple&quot; tau model (see
     iSEDfit documentation) (recommended)
   bursttype - type of burst (see iSEDfit documentation)
     0 - step function
     1 - Gaussian (default)
     2 - step function with exponential wings
   notruncate - override any truncated bursts specified in SFHINFO
   linear - use a linearly spaced age/time vector in ISEDFIT_AGEGRID
     (default is to use logarithmic spacing) (not generally
     recommended!) 
   debug - make a very simple debugging plot
   _extra - additional plotting keywords (only for /DEBUG) 
 
 OUTPUTS: 
   sfh - star formation rate as a function of time/age [Msun/yr, NOUTAGE] 

 OPTIONAL OUTPUTS:
   sfhtau - underlying smooth star formation history (i.e., just the
     TAU component of SFH) [Msun/yr, NOUTAGE]
   sfhburst - bursty star formation history (i.e., just the bursty
     parts of SFH) [Msun/yr, NOUTAGE]
   aburst - burst amplitude [Msun/yr, NBURST]
   mburst - total mass formed in each burst [Msun, NBURST]
   mgalaxy - total mass in stars formed (i.e., galaxy mass, ignoring
     mass loss) [Msun, NOUTAGE]
   sfr100 - SFR averaged over the previous 100 Myr [Msun/yr, NOUTAGE] 
   b100 - birthrate parameter averaged over the previous 100 Myr [NOUTAGE] 
   b_1000 - birthrate parameter averaged over the previous 1000 Myr
     (note the underscore, needed to circumvent IDL's keyword
     rules!) [NOUTAGE]  
   sfrage - SFR-weighted age [Gyr, NOUTAGE]

 COMMENTS:
   If a truncated burst is requested then the SFHTAU and SFHBURST
   outputs are not modified.

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Dec 22, UCSD - developed
   jm13aug12siena - updated to the latest data model; fully
     documented 

 Copyright (C) 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/isedfit_sfh.pro)</strong></p>
<hr />
<h3 id="IUNRED_LINEDUST_F">IUNRED_LINEDUST()</h3>
<p><a href="#ISEDFIT_SFH_F">[Previous Routine]</a></p>
<p><a href="#JD2FITSDATE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       IUNRED_LINEDUST()

 PURPOSE:
       Correct emission-line fluxes for dust extinction using the
       observed Balmer decrement.

 INPUTS:
       linedust - input data structure

 OPTIONAL INPUTS:
       snrcut_linedust - minimum S/N on H-alpha and H-beta (default 5)
       use_HaHb        - intrinsic Ha/Hb ratio to use (default 2.86)
       cutsig          - number of standard deviations that the
                         observed Ha/Hb ratio can deviate from the
                         minimum physical intrinsic ratio (default 1;
                         see COMMENTS)
       extra           - keywords specifying the attenuation curve in
                         GET_EBV() (default O'Donnell 1994)

 KEYWORD PARAMETERS:
       nopropagate - do not propagate the error in the reddening
                     correction to the unreddened fluxes (not
                     recommended!) 
       allow_r_min - use the minimum physically plausible Balmer
                     decrement, rather than the mean (T=10^4 K) value 
       silent      - suppress messages to STDOUT

 OUTPUTS:
       linenodust - output data structure in which all the
                    line-fluxes have been reddening-corrected, and
                    the reddening information is stored in additional
                    tags 

 OPTIONAL OUTPUTS:

 COMMENTS:
       Upper limits on the Balmer lines are not treated. 

       Do not compute E(B-V) for objects with unphysically low Balmer
       decrements; they must be within CUTSIG sigma of the
       adopted/minimum decrement; there is no upper limit on the
       Balmer decrement (dusty!); note, however, that objects can
       have negative E(Hb-Ha) that is zero within the errors;
       however, for these objects keep the measured Balmer decrements
       (ie, in general they will be less than 2.86); jm04jul22uofa:
       for objects with E(B-V)&lt;0 set E(B-V)=0 and flag them;
       jm05feb03uofa: new conservative policy: require the decrement
       to be within CUTSIG of the **adopted** intrinsic decrement,
       **not** the minimum possible decrement; jm08feb06nyu: use a
       keyword to allow the smallest possible decrement 

       Note that the code *could* take into account the error in the
       intrinsic HaHb ratio (due to, e.g., ignorance of the
       appropriate electron temperature/density), but for now we
       assume the uncertainty is negligible.

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2008 Mar 07, NYU - simplified considerably and
          made much, much faster; errors now computed correctly,
          accounting for the covariance between the error in the
          Balmer decrement and the reddening-corrected H-alpha and
          H-beta line-fluxes

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/iunred_linedust.pro)</strong></p>
<hr />
<h3 id="JD2FITSDATE_F">JD2FITSDATE()</h3>
<p><a href="#IUNRED_LINEDUST_F">[Previous Routine]</a></p>
<p><a href="#KCORRECT_QAPLOT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   JD2FITSDATE()

 PURPOSE:
   Convert a Julian date to a FITS format date.

 INPUTS: 
   jd - input Julian date

 KEYWORD PARAMETERS: 
   noyear - exclude the year from the output date

 OUTPUTS: 
   date - FITS-format date (YYYY-MM-DD)

 MODIFICATION HISTORY:
   J. Moustakas, 2002 Oct 17, U of A

 Copyright (C) 2002, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/jd2fitsdate.pro)</strong></p>
<hr />
<h3 id="KCORRECT_QAPLOT">KCORRECT_QAPLOT</h3>
<p><a href="#JD2FITSDATE_F">[Previous Routine]</a></p>
<p><a href="#KEWLEY_BTP_LINES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   KCORRECT_QAPLOT

 PURPOSE:
   Build a QAplot of the K-correct SED fitting.

 INPUTS: 

 KEYWORD PARAMETERS: 

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:
   This routine is generally called from within IM_KCORRECT, but it
   can also be called indepedently.  See IM_KCORRECT for an example
   of the input syntax.

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Jul 06, NYU
   jm10jan24ucsd - documented and generalized

 Copyright (C) 2009-2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/kcorrect_qaplot.pro)</strong></p>
<hr />
<h3 id="KEWLEY_BTP_LINES_F">KEWLEY_BTP_LINES()</h3>
<p><a href="#KCORRECT_QAPLOT">[Previous Routine]</a></p>
<p><a href="#K_LAMBDA_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       KEWLEY_BTP_LINES()

 PURPOSE:
       Return the Kewley et al 2001 theoretical starburst
       classification lines corresponding to the BPT diagrams.  

 INPUTS:
       None.

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:
       kauffmann - use the Kauffmann et al. (2003) dividing line for
                   AGN

 OUTPUTS:
       models - output data structure

 COMMENTS:
       See p. 184 of L. Kewley's thesis or Eqs. (5-7) in Kewley et al
       2001, ApJS, 132, 37.

 PROCEDURES USED:

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 April 19, U of A, written
       jm03jun14uofa - added upper and lower bounds
       jm04jul26uofa - to prevent the second hyperbola from being
                       drawn require NII/Ha &lt; 0.4
       jm04jul29uofa - added KAUFFMANN keyword

 Copyright (C) 2002-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/kewley_bpt_lines.pro)</strong></p>
<hr />
<h3 id="K_LAMBDA_F">K_LAMBDA()</h3>
<p><a href="#KEWLEY_BTP_LINES_F">[Previous Routine]</a></p>
<p><a href="#L">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   K_LAMBDA()

 PURPOSE:
   Return a variety of extinction curves.

 INPUTS:
   wave  - wavelength vector [Angstroms]

 OPTIONAL INPUTS:
   r_v   - total to selective extinction ratio (default 3.1, but
           poorly known for the LMC and SMC, and inappropriate
           for the Calzetti attenuation curve); also hard-wired
           to be 3.1 for Li &amp; Draine (2001) since it was only
           calibrated for the diffuse MW ISM

 KEYWORD PARAMETERS:
   calzetti - Calzetti (2000) continuum attenuation curve for IUE
              starburst galaxies
   charlot  - Charlot &amp; Fall (2000) attenuation curve
   ccm      - Cardelli, Clayton, &amp; Mathis (1989) [Milky Way]
   odonnell - CCM with O'Donnell (1994) coefficients [Milky Way]
   fm       - Fitzpatrick (1999) [Milky Way]
   avglmc   - average Large Magellanic Cloud from Gordon et
              al. 2003, ApJ, 594, 279; R_V = 3.41+/-0.06
   lmc2     - Large Magellanic Cloud Supershell (LMC2) field,
              including 30 Dor from Gordon et al. 2003, ApJ, 594,
              279; R_V = 2.76+/-0.09
   smc      - Small Magellanic Cloud Bar region from Gordon et
              al. 2003, ApJ, 594, 279; R_V = 2.74+/-0.13
   li       - Li &amp; Draine (2001) Milky Way extinction curve
   silent   - suppress warning messages
 OUTPUTS:
   k_lambda - defined as A(lambda)/E(B-V)

 OPTIONAL OUTPUTS:

 COMMENTS:
   Much of the code for this routine has been excised from the
   Goddard routines CCM_UNRED(), FM_UNRED(), and CALZ_UNRED() for
   my own nefarious purposes.  

 PROCEDURES USED:
   READ_SMC()

 EXAMPLE:
   Plot the Calzetti and the CCM extinction curves in the
   optical and UV.

   IDL&gt; wave = findgen(6000)+1000.0 ; Angstrom
   IDL&gt; plot, wave, k_lambda(wave,/calzetti), xsty=3, ysty=3
   IDL&gt; oplot, wave, k_lambda(wave,/ccm)

 MODIFICATION HISTORY:
   J. Moustakas, 2002 September 19, U of A
   jm03mar2uofa - added the Charlot &amp; Fall (2000) curve
   jm03sep2uofa - general updates
   jm03sep28uofa - added Seaton (1979) extinction curve
   jm04jan26uofa - updated SMC, LMC2, and AVGLMC curves from
                   Gordon et al. (2003)
   jm04apr26uofa - the Charlot &amp; Fall R_V=5.9, not 3.1 
   jm06feb24uofa - added SILENT keyword
   jm07feb19nyu  - added Li &amp; Draine (2001) extinction curve 
   jm09aug19ucsd - ensure that the Calzetti, O'Donnell and
     SMC extinction curves behave properly at very long and short 
     wavelengths  
   jm11aug05ucsd - made READ_GORDON_2003() an internal support
     routine 

 Copyright (C) 2002-2004, 2006-2007, 2009, 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/k_lambda.pro)</strong></p>
<hr />
<h3 id="L">L</h3>
<p><a href="#K_LAMBDA_F">[Previous Routine]</a></p>
<p><a href="#LF_DOUBLE_POWERLAW_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   L
 PURPOSE:
   Spawn the unix command 'ls -l | more'.
 MODIFICATION HISTORY:
   J. Moustakas, 2000 Sep 14, U of A
</pre>
<p><strong>(See pro/misc/l.pro)</strong></p>
<hr />
<h3 id="LF_DOUBLE_POWERLAW_F">LF_DOUBLE_POWERLAW()</h3>
<p><a href="#L">[Previous Routine]</a></p>
<p><a href="#LF_FIT_DOUBLE_POWERLAW_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   LF_DOUBLE_POWERLAW()

 PURPOSE:
   Generate a double power-law luminosity function given the relevant
   parameters. 

 INPUTS: 
   loglum - log-base-10 luminosity at which to evaluate the model
     [NLUM] 
   phistar - number density at the inflection point of the LF 
   loglstar - luminosity at the inflection point of the LF
   alpha - first power law slope
   beta - second power law slope

 OPTIONAL INPUTS: 
   powerlaw - LF_FIT_DOUBLE_POWERLAW() style structure with PHISTAR, 
     LOGLSTAR, ALPHA, and BETA (takes precedence over PHISTAR,
     LOGLSTAR, ALPHA, and BETA)

 OUTPUTS: 
   model - output model [NLUM]
 
 COMMENTS:
   This type of model is frequently used to fit the X-ray or mid-IR
   luminosity function; see, for example, Yahil+91; Aird+08; or
   Rujopakarn+10.

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Apr 14, NYU

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/lf_double_powerlaw.pro)</strong></p>
<hr />
<h3 id="LF_FIT_DOUBLE_POWERLAW_F">LF_FIT_DOUBLE_POWERLAW()</h3>
<p><a href="#LF_DOUBLE_POWERLAW_F">[Previous Routine]</a></p>
<p><a href="#LINERATIO">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   LF_FIT_DOUBLE_POWERLAW()

 PURPOSE:
   Fit a binned luminosity function using a double power-law model. 

 INPUTS: 
   loglum - log-base-10 luminosity at the center of each bin [NGAL] 
   phi - number density, i.e., the luminosity function (Mpc^-3) [NGAL] 
   phierr - 1-sigma uncertainty in PHI [NGAL]

 OPTIONAL INPUTS: 
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   powerlaw - output structure with
     .PHISTAR - number density at the inflection point of the LF 
     .LOGLSTAR - luminosity at the inflection point of the LF 
     .ALPHA - first power law slope
     .BETA - second power law slope
     .PHISTAR_ERR
     .LOGLSTAR_ERR
     .ALPHA_ERR
     .BETA_ERR
     .CHI2_DOF - reduced chi^2
     .COVAR[4,4] - covariance matrix

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Apr 14, NYU

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/lf_fit_double_powerlaw.pro)</strong></p>
<hr />
<h3 id="LINERATIO">LINERATIO</h3>
<p><a href="#LF_FIT_DOUBLE_POWERLAW_F">[Previous Routine]</a></p>
<p><a href="#LM_IGMTAU_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       LINERATIO

 PURPOSE:
       Compute emission-line ratios.

 CALLING SEQUENCE:

 INPUTS:

 OPTIONAL INPUTS:
       xsyserr - systematic error in X [%]
       ysyserr - systematic error in Y [%]

 KEYWORD PARAMETERS:

 OUTPUTS:

 OPTIONAL OUTPUTS:

 INTERNAL SUPPORT ROUTINES:
       DOSUMS()

 PROCEDURES USED:
       CMSET_OP(), IM_COMPUTE_ERROR(), SPLOG

 COMMENTS:
       NB:  If NOSUBSCRIPT is set then the galaxies with poorly
       measured line fluxes will return gibberish.  

 TODO:  
       [1] Properly treat upper limits. 

 EXAMPLES:
       The following call would return x = alog10(OIII_3727/H_ALPHA),
       y = alog10(OIII_5007/H_BETA) and the associated errors:

          IDL&gt; lineratio, 'OII_3727', 'H_ALPHA', 'OIII_5007', $
          IDL&gt; 'H_BETA', x, xerr, y, yerr 

 MODIFICATION HISTORY:
       J. Moustakas, 2002 Nov 07, U of A - written
       jm04nov03uofa - added NOXLOG and NOYLOG keywords
       jm05aug04uofa - added XSYSERR and YSYSERR optional inputs 

 Copyright (C) 2002, 2004-2005, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/lineratio.pro)</strong></p>
<hr />
<h3 id="LM_IGMTAU_F">LM_IGMTAU()</h3>
<p><a href="#LINERATIO">[Previous Routine]</a></p>
<p><a href="#LM_IGMTAUDA_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   LM_IGMTAU()

 PURPOSE:
   For a given wavelength and redshift, compute the effective 
   optical depth due to the IGM from the Lyman-series opacity
   and the photoelectric absorption past the Lyman-limit. 

 CALLING SEQUENCE:
   taueff = lm_igmtau(ww,z)

 INPUTS:
   ww - wavelength (Angstroms) [NWW]
   z  - redshift

 KEYWORD PARAMETERS:

 OUTPUTS:
   taueff - effective optical depth [NWW]

 MODIFICATION HISTORY:
   Leonidas A. Moustakas, 2003 March - written
   J. Moustakas, 2005 Mar 22, U of A, documented, error checking
      added 
</pre>
<p><strong>(See pro/dust/lm_igmtau.pro)</strong></p>
<hr />
<h3 id="LM_IGMTAUDA_F">LM_IGMTAUDA()</h3>
<p><a href="#LM_IGMTAU_F">[Previous Routine]</a></p>
<p><a href="#LM_IGMTAUDB_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   LM_IGMTAUDA()

 PURPOSE:
   Compute IGM depression in the Lyman alpha forest at 1050-1170. 

 INPUTS:
   z  - redshift

 KEYWORD PARAMETERS:

 OUTPUTS:
   DA = lm_igmtauda(z)

 MODIFICATION HISTORY:
   Leonidas A. Moustakas, 2003 March
</pre>
<p><strong>(See pro/dust/lm_igmtauDa.pro)</strong></p>
<hr />
<h3 id="LM_IGMTAUDB_F">LM_IGMTAUDB()</h3>
<p><a href="#LM_IGMTAUDA_F">[Previous Routine]</a></p>
<p><a href="#LOGLEVELS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   LM_IGMTAUDB()

 PURPOSE:
   Compute IGM depression in the Lyman beta forest at 920-1015. 

 INPUTS:
   z  - redshift

 KEYWORD PARAMETERS:

 OUTPUTS:
   DB = lm_igmtauda(z)

 MODIFICATION HISTORY:
   Leonidas A. Moustakas, 2003 March
</pre>
<p><strong>(See pro/dust/lm_igmtauDb.pro)</strong></p>
<hr />
<h3 id="LOGLEVELS_F">LOGLEVELS()</h3>
<p><a href="#LM_IGMTAUDB_F">[Previous Routine]</a></p>
<p><a href="#MAG2MAGGIES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
        LOGLEVELS()

 PURPOSE:
        Compute default values for logarithmic axis labeling
        or contour levels. For a range from 1 to 100 these
        would be 1., 2., 5., 10., 20., 50., 100.
        If the range spans more than (usually) 3 decades, only
        decadal values will be returned unless the /FINE keyword
        is set.

 CATEGORY:
        Tools

 CALLING SEQUENCE:
        result = LOGLEVELS([range | MIN=min,MAX=max] [,/FINE], [COARSE=dec])

 INPUTS:
        RANGE -&gt; A 2-element vector with the minimum and maximum
            value to be returned. Only levels _within_ this range
            will be returned. If RANGE contains only one element,
            this is interpreted as MAX and MIN will be assumed as
            3 decades smaller. RANGE superseeds the MIN and MAX
            keywords. Note that RANGE must be positive definite
            but can be given in descending order in which case
            the labels will be reversed.

 KEYWORD PARAMETERS:
        MIN, MAX -&gt; alternative way of specifying a RANGE. If only
            one keyword is given, the other one is computed as
            3 decades smaller/larger than the given parameter.
            RANGE superseeds MIN and MAX.

        /FINE -&gt; always return finer levels (1,2,5,...)

        COARSE -&gt; the maximum number of decades for which LOGLEVELS
            shall return fine labels. Default is 3. (non-integer
            values are possible).

 OUTPUTS:
        A vector with &quot;round&quot; logarithmic values within the given
        range. The original (or modified) RANGE will be returned
        unchanged if RANGE does not span at least one label interval.
        The result will always contain at least two elements.


 SUBROUTINES:
        none

 REQUIREMENTS:
        none

 NOTES:
        If COARSE is lt 0, the nearest decades will be returned
        instead. The result will always have at least two elements.
        If COARSE forces decades, the result values may be out-of-
        range if RANGE spans less than a decade.

        Caution with type conversion from FLOAT to DOUBLE !!

 EXAMPLE:
        range = [ min(data), max(data) ]
        c_level = LOGLEVELS(range)
        contour,...,c_level=c_level


 MODIFICATION HISTORY:
        mgs, 17 Mar 1999: VERSION 1.00

 Copyright (C) 1999, Martin Schultz, Harvard University
 This software is provided as is without any warranty
 whatsoever. It may be freely used, copied or distributed
 for non-commercial purposes. This copyright notice must be
 kept with any copy of this software. If this software shall
 be used commercially or sold as part of a larger package,
 please contact the author to arrange payment.
 Bugs and comments should be directed to mgs@io.harvard.edu
 with subject &quot;IDL routine loglevels&quot;
</pre>
<p><strong>(See pro/plot/loglevels.pro)</strong></p>
<hr />
<h3 id="MAG2MAGGIES_F">MAG2MAGGIES()</h3>
<p><a href="#LOGLEVELS_F">[Previous Routine]</a></p>
<p><a href="#MAGGIES2MAG_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MAG2MAGGIES()

 PURPOSE:
   Convert from magnitudes to maggies.

 INPUTS: 
   mag - input magnitudes [NBAND,NOBJ]

 OPTIONAL INPUTS: 
   magerr - corresponding 1-sigma error [NBAND,NOBJ]
   vega2ab - conversion from Vega to AB magnitudes (default 0.0)
     [NBAND] 

 OUTPUTS: 
   maggies - output maggies [NBAND,NOBJ]

 OPTIONAL OUTPUTS:
   ivarmaggies - corresponding inverse variance maggies [NBAND,NOBJ]  

 MODIFICATION HISTORY:
   J. Moustakas, 2009 May 24, NYU

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mag2maggies.pro)</strong></p>
<hr />
<h3 id="MAGGIES2MAG_F">MAGGIES2MAG()</h3>
<p><a href="#MAG2MAGGIES_F">[Previous Routine]</a></p>
<p><a href="#MAKE_BOK_CATALOG">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MAGGIES2MAG()

 PURPOSE:
   Convert from maggies to AB magnitude.

 INPUTS: 
   maggies - input maggies [NBAND,NOBJ]

 OPTIONAL INPUTS: 
   ivarmaggies - corresponding inverse variance maggies [NBAND,NOBJ] 
   nsigma - NSIGMA upper limit for measurements measured at &lt;NSIGMA
     significance (default 2)

 OUTPUTS: 
   mag - output AB magnitudes [NBAND,NOBJ]

 OPTIONAL OUTPUTS:
   magerr - approximate 1-sigma error (assumes the error is symmetric
     in magnitude) [NBAND,NOBJ] 
   lomagerr - &quot;lower&quot; magnitude error [NBAND,NOBJ] 
   himagerr - &quot;upper&quot; magnitude error [NBAND,NOBJ] 
   magnsigma - NSIGMA magnitude limit

 COMMENTS:
   
 MODIFICATION HISTORY:
   J. Moustakas, 2009 May 24, NYU
   jm12feb28ucsd - added upper limits and asymmetric error bars 

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/maggies2mag.pro)</strong></p>
<hr />
<h3 id="MAKE_BOK_CATALOG">MAKE_BOK_CATALOG</h3>
<p><a href="#MAGGIES2MAG_F">[Previous Routine]</a></p>
<p><a href="#MAKE_IMPRO_HELP">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MAKE_BOK_CATALOG

 PURPOSE:
   Generate a catalog that for the Bok/90-inch.

 INPUTS: 
   ra, dec - input celestial coordinates
   mag - magnitude
   object - object name
   epoch - coordinate epoch

 OPTIONAL INPUTS: 
   catname - output catalog name (default 'catalog')

 OUTPUTS: 
   Writes out an appropriately formated catalog.

 MODIFICATION HISTORY:
   J. Moustakas, 2002 Jun 24, U of A

 Copyright (C) 2002, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/make_bok_catalog.pro)</strong></p>
<hr />
<h3 id="MAKE_IMPRO_HELP">MAKE_IMPRO_HELP</h3>
<p><a href="#MAKE_BOK_CATALOG">[Previous Routine]</a></p>
<p><a href="#MAKE_LNWAVE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MAKE_IMPRO_HELP

 PURPOSE:
   Build the help HTML code for impro.

 INPUTS: 


 OPTIONAL INPUTS: 


 KEYWORD PARAMETERS: 


 OUTPUTS: 


 OPTIONAL OUTPUTS:


 COMMENTS:


 EXAMPLES:


 MODIFICATION HISTORY:
   J. Moustakas, 2011 Aug 29, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/make_impro_help.pro)</strong></p>
<hr />
<h3 id="MAKE_LNWAVE_F">MAKE_LNWAVE()</h3>
<p><a href="#MAKE_IMPRO_HELP">[Previous Routine]</a></p>
<p><a href="#MAKE_WAVE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MAKE_LNWAVE()

 PURPOSE:
   Calculate a natural-log wavelength vector of a one-dimensional
   spectrum using the header parameters.

 INPUTS:
   header - FITS header

 OUTPUTS:
   wave - output alog(wavelength) vector

 OPTIONAL OUTPUTS:
   cd1_1  - dispersion [ln-Angstrom/pixel]
   crval1 - starting wavelength [ln-Angstrom]

 MODIFICATION HISTORY:
   J. Moustakas, 2009-Nov-10, UCSD - based on MAKE_WAVE()

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/make_lnwave.pro)</strong></p>
<hr />
<h3 id="MAKE_WAVE_F">MAKE_WAVE()</h3>
<p><a href="#MAKE_LNWAVE_F">[Previous Routine]</a></p>
<p><a href="#MATCH_STRING_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MAKE_WAVE()

 PURPOSE:
   Calculate a wavelength vector of a one-dimensional spectrum
   using the header parameters.

 INPUTS:
   header - FITS header

 OUTPUTS:
   wave - output wavelength vector

 OPTIONAL OUTPUTS:
   cd1_1  - dispersion [Angstrom/pixel]
   crval1 - starting wavelength [Angstrom]

 PROCEDURES USED:
   SXPAR()

 MODIFICATION HISTORY:
   J. Moustakas, 1999 August 10, UCB, written
   jm01jul11uofa - documented and made a function
   jm01oct19uofa - simplified
   jm02mar12uofa - added CD1_1 and CRVAL1 as optional outputs 
   jm03apr12uofa - added error checking
   jm05apr18uofa - check if CDELT1 is present instead of CD1_1 
   jm10apr28ucsd - double precision, by default

 Copyright (C) 1999, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/make_wave.pro)</strong></p>
<hr />
<h3 id="MATCH_STRING_F">MATCH_STRING()</h3>
<p><a href="#MAKE_WAVE_F">[Previous Routine]</a></p>
<p><a href="#MF_DOUBLE_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MATCH_STRING()

 PURPOSE:
   Matches strings one letter at a time.

 INPUTS: 
   instring - input string (can be a vector)
   allstrings - list of strings againsts which to match INSTRING 

 KEYWORD PARAMETERS: 
   exact - match the string exactly 
   silent - suppress messages to STDOUT

 OUTPUTS: 
   matchstring - nearest match of INSTRING in ALLSTRINGS

 OPTIONAL OUTPUTS: 
   findex - index of the first match
   index - indices of all matches

 COMMENTS:
   This routine is pretty dumb and could be done trivially with
   regular expression matching with existing routines.

 EXAMPLES:
   IDL&gt; print, match_string('bob',['bobo','jimbob','bobobo'],findex=ff,index=ii)
     bobo
   IDL&gt; print, ff
     0
   IDL&gt; print, ii
     0           2

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Oct 18, U of A
   jm02jun25uofa - added exact keyword
   jm02nov12uofa - added FINDEX keyword (first match)    
   jm03may22uofa - fixed case if NAME is ''
   jm06jan19uofa - check for STRMATCH wildcard characters    

 Copyright (C) 2001-2003, 2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/match_string.pro)</strong></p>
<hr />
<h3 id="MF_DOUBLE_SCHECHTER_F">MF_DOUBLE_SCHECHTER()</h3>
<p><a href="#MATCH_STRING_F">[Previous Routine]</a></p>
<p><a href="#MF_FIT_DOUBLE_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_DOUBLE_SCHECHTER()

 PURPOSE:
   Generate a double Schechter model given the relevant parameters.

 INPUTS: 
   logmass - log-base-10 stellar masses (in the same units as MSTAR,
     presumably Msun) at which to evaluate the model
   phistar - number density at the 'knee' of the first Schechter
     model 
   logmstar - log-base-10 stellar mass at the 'knee' of the first
     Schechter model 
   alpha - low-mass slope of the first Schechter model
   phistar2 - number density at the 'knee' of the second Schechter
     model 
   logmstar2 - log-base-10 stellar mass at the 'knee' of the second
     Schechter model  
   alpha2 - low-mass slope of the second Schechter model 

 OPTIONAL INPUTS: 
   schechter - structure with PHISTAR, LOGMSTAR, ALPHA, PHISTAR2,
     LOGMSTAR2, and ALPHA2 (takes precedence over PHISTAR, LOGMSTAR, 
     ALPHA, PHISTAR2, LOGMSTAR2, and ALPHA)  

 OUTPUTS: 
   model - logarithmic model Phi(log M) 
 
 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M)

 MODIFICATION HISTORY:
   J. Moustakas, 201 Aug 23, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_double_schechter.pro)</strong></p>
<hr />
<h3 id="MF_FIT_DOUBLE_SCHECHTER_F">MF_FIT_DOUBLE_SCHECHTER()</h3>
<p><a href="#MF_DOUBLE_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_FIT_MODIFIED_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_FIT_DOUBLE_SCHECHTER()

 PURPOSE:
   Fit a binned stellar mass function using a double Schechter model.  

 INPUTS: 
   logmass - log-base-10 stellar mass at the center of each bin
     (presumably in units of Msun) [NGAL] 
   phi - number density, i.e., the mass function (Mpc^-3) [NGAL] 
   phierr - 1-sigma uncertainty in PHI in the same units [NGAL]

 OPTIONAL INPUTS: 
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters.

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   double_schechter - output structure with
     .PHISTAR - number density at the 'knee' of the first Schechter
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the first Schechter
     .ALPHA - low-mass slope of the first Schechter model

     .PHISTAR2 - number density at the 'knee' of the second Schechter
     .LOGMSTAR2 - log-base-10 stellar mass at the 'knee' of the second Schechter
     .ALPHA2 - low-mass slope of the second Schechter

     .PHISTAR_ERR
     .LOGMSTAR_ERR
     .ALPHA_ERR

     .PHISTAR2_ERR
     .LOGMSTAR2_ERR
     .ALPHA2_ERR

     .CHI2_DOF - reduce chi^2
     .COVAR[6,6] - covariance matrix

 COMMENTS:
   The model is the sum of two independent Schecter functions. 

   MPFIT() has difficulty getting the errors right if MSTAR
   isn't logarithmic. 

 MODIFICATION HISTORY:
   J. Moustakas, 2012 Mar 15, UCSD

 Copyright (C) 2012, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_fit_double_schechter.pro)</strong></p>
<hr />
<h3 id="MF_FIT_MODIFIED_SCHECHTER_F">MF_FIT_MODIFIED_SCHECHTER()</h3>
<p><a href="#MF_FIT_DOUBLE_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_FIT_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_FIT_MODIFIED_SCHECHTER()

 PURPOSE:
   Fit a binned stellar mass function using a modified Schechter
   model.

 INPUTS: 
   logmass - log-base-10 stellar mass at the center of each bin
     (presumably in units of Msun) [NGAL] 
   phi - number density, i.e., the mass function (Mpc^-3) [NGAL] 
   phierr - 1-sigma uncertainty in PHI in the same units [NGAL]

 OPTIONAL INPUTS: 
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters.

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   modified_schechter - output structure with
     .PHISTAR - number density at the 'knee' of the MF
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the MF
     .ALPHA - low-mass slope
     .BETA - second power-law parameter
     .PHISTAR_ERR
     .LOGMSTAR_ERR
     .ALPHA_ERR
     .BETA_ERR
     .CHI2_DOF - reduce chi^2
     .COVAR[3,3] - covariance matrix

 COMMENTS:
   The model is the sum of two Schecter functions with the same
   exponential cutoff but different normalizations and faint-end slopes.

   MPFIT() has difficulty getting the errors right if MSTAR
   isn't logarithmic. 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Feb 11, UCSD - based largely on
     M. Blanton's LF_FIT_MODIFIED_SCHECHTER

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_fit_modified_schechter.pro)</strong></p>
<hr />
<h3 id="MF_FIT_SCHECHTER_F">MF_FIT_SCHECHTER()</h3>
<p><a href="#MF_FIT_MODIFIED_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_FIT_SCHECHTER_PLUS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_FIT_SCHECHTER()

 PURPOSE:
   Fit a binned stellar mass function using a Schechter model. 

 INPUTS: 
   logmass - log-base-10 stellar mass at the center of each bin
     (presumably in units of Msun) [NGAL] 
   phi - number density, i.e., the mass function (Mpc^-3) [NGAL] 

 OPTIONAL INPUTS: 
   phierr - 1-sigma uncertainty in PHI in the same units [NGAL]
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   schechter - output structure with
     .PHISTAR - number density at the 'knee' of the MF
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the MF
     .ALPHA - low-mass slope
     .PHISTAR_ERR
     .LOGMSTAR_ERR
     .ALPHA_ERR
     .CHI2_DOF - reduce chi^2
     .COVAR[3,3] - covariance matrix

 COMMENTS:
   MPFIT() has difficulty getting the errors right if MSTAR
   isn't logarithmic, hence the convention adopted here.  Also
   note that PHIERR is optional, but in that case the formal MPFIT
   errors will not be correct.

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Apr 14, NYU - based largely on
     M. Blanton's LF_FIT_SCHECHTER 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_fit_schechter.pro)</strong></p>
<hr />
<h3 id="MF_FIT_SCHECHTER_PLUS_F">MF_FIT_SCHECHTER_PLUS()</h3>
<p><a href="#MF_FIT_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_FIT_TRIPLE_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_FIT_SCHECHTER_PLUS()

 PURPOSE:
   Fit a binned stellar mass function using a double Schechter model.  

 INPUTS: 
   logmass - log-base-10 stellar mass at the center of each bin
     (presumably in units of Msun) [NGAL] 
   phi - number density, i.e., the mass function (Mpc^-3) [NGAL] 
   phierr - 1-sigma uncertainty in PHI in the same units [NGAL]

 OPTIONAL INPUTS: 
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters; the default is to require
     ALPHAPLUS&lt;ALPHA and PHIPLUS&lt;PHI

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   schechter_plus - output structure with
     .PHISTAR - number density at the 'knee' of the MF
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the MF
     .ALPHA - low-mass slope
     .PHIPLUS - second normalization at low mass
     .ALPHAPLUS - second slope at low mass
     .PHISTAR_ERR
     .LOGMSTAR_ERR
     .ALPHA_ERR
     .PHIPLUS_ERR
     .ALPHAPLUS_ERR
     .CHI2_DOF - reduce chi^2
     .COVAR[3,3] - covariance matrix

 COMMENTS:
   The model is the sum of two Schecter functions with the same
   exponential cutoff but different normalizations and faint-end slopes.

   MPFIT() has difficulty getting the errors right if MSTAR
   isn't logarithmic. 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Feb 11, UCSD - based largely on
     M. Blanton's LF_FIT_SCHECHTER_PLUS

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_fit_schechter_plus.pro)</strong></p>
<hr />
<h3 id="MF_FIT_TRIPLE_SCHECHTER_F">MF_FIT_TRIPLE_SCHECHTER()</h3>
<p><a href="#MF_FIT_SCHECHTER_PLUS_F">[Previous Routine]</a></p>
<p><a href="#MF_MODIFIED_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_FIT_TRIPLE_SCHECHTER()

 PURPOSE:
   Fit a binned stellar mass function using a triple Schechter model.  

 INPUTS: 
   logmass - log-base-10 stellar mass at the center of each bin
     (presumably in units of Msun) [NGAL] 
   phi - number density, i.e., the mass function (Mpc^-3) [NGAL] 
   phierr - 1-sigma uncertainty in PHI in the same units [NGAL]

 OPTIONAL INPUTS: 
   parinfo - MPFIT() parameter structure; can be used to constrain or
     fix any of the model parameters.

 KEYWORD PARAMETERS: 
   quiet - suppress MPFIT() messages

 OUTPUTS: 
   triple_schechter - output structure with
     .PHISTAR - number density at the 'knee' of the first Schechter
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the first Schechter
     .ALPHA - low-mass slope of the first Schechter model

     .PHISTAR2 - number density at the 'knee' of the second Schechter
     .LOGMSTAR2 - log-base-10 stellar mass at the 'knee' of the second Schechter
     .ALPHA2 - low-mass slope of the second Schechter

     .PHISTAR3 - number density at the 'knee' of the third Schechter
     .LOGMSTAR3 - log-base-10 stellar mass at the 'knee' of the third Schechter
     .ALPHA3 - low-mass slope of the third Schechter

     .PHISTAR_ERR
     .LOGMSTAR_ERR
     .ALPHA_ERR

     .PHISTAR2_ERR
     .LOGMSTAR2_ERR
     .ALPHA2_ERR

     .PHISTAR3_ERR
     .LOGMSTAR3_ERR
     .ALPHA3_ERR

     .CHI2_DOF - reduce chi^2
     .COVAR[9,9] - covariance matrix

 COMMENTS:
   The model is the sum of two independent Schecter functions. 

   MPFIT() has difficulty getting the errors right if MSTAR
   isn't logarithmic. 

 MODIFICATION HISTORY:
   J. Moustakas, 2012 Mar 15, UCSD

 Copyright (C) 2012, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_fit_triple_schechter.pro)</strong></p>
<hr />
<h3 id="MF_MODIFIED_SCHECHTER_F">MF_MODIFIED_SCHECHTER()</h3>
<p><a href="#MF_FIT_TRIPLE_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_MODIFIED_SCHECHTER()

 PURPOSE:
   Generate a modified Schechter model given the relevant parameters.

 INPUTS: 
   logmass - log-base-10 stellar masses (in the same units as MSTAR,
     presumably Msun) at which to evaluate the model
   phistar - number density at the 'knee' of the MF
   logmstar - log-base-10 stellar mass at the 'knee' of the MF 
   alpha - low-mass slope
   beta - second power-law parameter

 OPTIONAL INPUTS: 
   modified_schechter - MF_SCHECHTER() style structure with PHISTAR,
     LOGMSTAR, ALPHA, and BETA (takes precedence over PHISTAR,
     LOGMSTAR, ALPHA, and BETA)

 OUTPUTS: 
   model - logarithmic double Schechter model Phi(log M) 
 
 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M).  This model is used by
   Bernardi+10, MNRAS.

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Aug 26, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_modified_schechter.pro)</strong></p>
<hr />
<h3 id="MF_SCHECHTER_F">MF_SCHECHTER()</h3>
<p><a href="#MF_MODIFIED_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_SCHECHTER_PLUS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_SCHECHTER()

 PURPOSE:
   Generate a Schechter model given the relevant parameters.

 INPUTS: 
   logmass - log-base-10 stellar masses (in the same units as MSTAR,
     presumably Msun) at which to evaluate the model
   phistar - number density at the 'knee' of the MF
   logmstar - log-base-10 stellar mass at the 'knee' of the MF 
   alpha - low-mass slope

 OPTIONAL INPUTS: 
   schechter - FIT_MF_SCHECHTER() style structure with PHISTAR,
     LOGMSTAR, and ALPHA (takes precedence over PHISTAR, LOGMSTAR,
     and ALPHA)  

 OUTPUTS: 
   model - logarithmic Schechter model Phi(log M) 
 
 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M)

 MODIFICATION HISTORY:
   J. Moustakas, 2009 Apr 14, NYU - based largely on
     M. Blanton's LF_FIT_SCHECHTER 

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_schechter.pro)</strong></p>
<hr />
<h3 id="MF_SCHECHTER_PLUS_F">MF_SCHECHTER_PLUS()</h3>
<p><a href="#MF_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MF_SCHECHTER_PLUS_RANDOM_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_SCHECHTER_PLUS()

 PURPOSE:
   Generate a Schechter plus additional low-mass component model
   given the relevant parameters. 

 INPUTS: 
   logmass - log-base-10 stellar masses (in the same units as MSTAR,
     presumably Msun) at which to evaluate the model
   phistar - number density at the 'knee' of the MF
   logmstar - log-base-10 stellar mass at the 'knee' of the MF 
   alpha - low-mass slope
   phiplus - second normalization at low mass
   alphaplus - second slope at low mass

 OPTIONAL INPUTS: 
   schechter_plus - MF_SCHECHTER() style structure with PHISTAR,
     LOGMSTAR, ALPHA, PHIPLUS, and ALPHAPLUS (takes precedence over
     PHISTAR, LOGMSTAR, ALPHA, PHIPLUS, and ALPHAPLUS) 

 OUTPUTS: 
   model - logarithmic double Schechter model Phi(log M) 
 
 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M)

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Feb 11, UCSD - based largely on
     M. Blanton's LF_FIT_SCHECHTER_PLUS

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_schechter_plus.pro)</strong></p>
<hr />
<h3 id="MF_SCHECHTER_PLUS_RANDOM_F">MF_SCHECHTER_PLUS_RANDOM()</h3>
<p><a href="#MF_SCHECHTER_PLUS_F">[Previous Routine]</a></p>
<p><a href="#MF_SCHECHTER_RANDOM_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_SCHECHTER_PLUS_RANDOM()

 PURPOSE:
   Draw random numbers from a (specified) double Schechter function.  

 INPUTS: 
   schechter - MF_SCHECHTER_PLUS() style structure:
     .PHISTAR - number density at the 'knee' of the MF
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the MF
     .ALPHA - low-mass slope
     .PHIPLUS - second normalization at low mass
     .ALPHAPLUS - second slope at low mass

 OPTIONAL INPUTS: 
   minmass - minimum stellar mass to simulate, log-base-10 in units
     of Msun (default 8)
   maxmass - maximum stellar mass to simulate (default 12)
   nrand - number of random numbers to return (default 1000)

 KEYWORD PARAMETERS: 
   sortit - sort the output by mass

 OUTPUTS: 
   phi - Phi(log M) mass function values corresponding to MASS
     [NRAND] 

 OPTIONAL OUTPUTS:
   mass - random stellar masses [NRAND]

 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M)

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Apr 01, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/mf_schechter_plus_random.pro)</strong></p>
<hr />
<h3 id="MF_SCHECHTER_RANDOM_F">MF_SCHECHTER_RANDOM()</h3>
<p><a href="#MF_SCHECHTER_PLUS_RANDOM_F">[Previous Routine]</a></p>
<p><a href="#MF_TRIPLE_SCHECHTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_SCHECHTER_RANDOM()

 PURPOSE:
   Draw random numbers from a (specified) Schechter function. 

 INPUTS: 
   schechter - MF_SCHECHTER() style structure:
     .PHISTAR - number density at the 'knee' of the MF
     .LOGMSTAR - log-base-10 stellar mass at the 'knee' of the MF
     .ALPHA - low-mass slope

 OPTIONAL INPUTS: 
   minmass - minimum stellar mass to simulate, log-base-10 in units
     of Msun (default 8)
   maxmass - maximum stellar mass to simulate (default 12)
   nrand - number of random numbers to return (default 1000)

 KEYWORD PARAMETERS: 
   sortit - sort the output by mass

 OUTPUTS: 
   phi - Phi(log M) mass function values corresponding to MASS
     [NRAND] 

 OPTIONAL OUTPUTS:
   mass - random stellar masses [NRAND]

 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M)

 EXAMPLES:
   IDL&gt; sch = {alpha: -1.5, logmstar: alog10(3D10), phistar: 1D-2}
   IDL&gt; phi = mf_schechter_random(sch,nrand=500,mass=mass)
   IDL&gt; plot, mass, phi, xsty=3, ysty=3, /ylog, psym=6

 MODIFICATION HISTORY:
   J. Moustakas, 2011 Apr 01, UCSD

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/math/mf_schechter_random.pro)</strong></p>
<hr />
<h3 id="MF_TRIPLE_SCHECHTER_F">MF_TRIPLE_SCHECHTER()</h3>
<p><a href="#MF_SCHECHTER_RANDOM_F">[Previous Routine]</a></p>
<p><a href="#MIPS_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MF_TRIPLE_SCHECHTER()

 PURPOSE:
   Generate a triple Schechter model given the relevant parameters.

 INPUTS: 
   logmass - log-base-10 stellar masses (in the same units as MSTAR,
     presumably Msun) at which to evaluate the model
   phistar - number density at the 'knee' of the first Schechter
     model 
   logmstar - log-base-10 stellar mass at the 'knee' of the first
     Schechter model 
   alpha - low-mass slope of the first Schechter model

   phistar2 - number density at the 'knee' of the second Schechter
     model 
   logmstar2 - log-base-10 stellar mass at the 'knee' of the second
     Schechter model  
   alpha2 - low-mass slope of the second Schechter model 

   phistar3 - number density at the 'knee' of the third Schechter
     model 
   logmstar3 - log-base-10 stellar mass at the 'knee' of the third
     Schechter model  
   alpha3 - low-mass slope of the third Schechter model 

 OPTIONAL INPUTS: 
   schechter - structure with PHISTAR, LOGMSTAR, ALPHA, PHISTAR2,
     LOGMSTAR2, ALPHA2, PHISTAR3, LOGMSTAR3, and ALPHA3 (takes
     precedence over the corresponding optional inputs)

 OUTPUTS: 
   model - logarithmic model Phi(log M) 
 
 COMMENTS:
   Note that Phi(log M) = ln(10)*M*Phi(M)

 MODIFICATION HISTORY:
   J. Moustakas, 2012 Mar 19, UCSD

 Copyright (C) 2012, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mf_triple_schechter.pro)</strong></p>
<hr />
<h3 id="MIPS_FILTERLIST_F">MIPS_FILTERLIST()</h3>
<p><a href="#MF_TRIPLE_SCHECHTER_F">[Previous Routine]</a></p>
<p><a href="#MONOTONIC_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MIPS_FILTERLIST()
 PURPOSE:
   Return the MIPS filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2013 Feb 15, Siena
</pre>
<p><strong>(See pro/galaxy/mips_filterlist.pro)</strong></p>
<hr />
<h3 id="MONOTONIC_F">MONOTONIC()</h3>
<p><a href="#MIPS_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#MONTE_LOG12OH_KK04">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MONOTONIC()

 PURPOSE:
   Determine whether a vector is monotonically increasing or
   decreasing. 

 INPUTS:
   x - one-dimensional vector of any datatype

 OUTPUTS:
   Returns 1 if the vector is monotonically increasing or
   decreasing, and 0 otherwise.

 COMMENTS:
   Does not distinguish between increasing and decreasing
   vectors.  Could be extended to two-dimensional vectors
   easily. 

 MODIFICATION HISTORY:
   J. Moustakas, 2001 July 23, U of A, written
   jm08jan11nyu - check for uniqueness
   jm13sep17siena - code replaced with FINDEX() algorithm which is
     much more stable; also optionally returns whether the array is
     monotonically increasing or decreasing

 Copyright (C) 2001, 2008, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/monotonic.pro)</strong></p>
<hr />
<h3 id="MONTE_LOG12OH_KK04">MONTE_LOG12OH_KK04</h3>
<p><a href="#MONOTONIC_F">[Previous Routine]</a></p>
<p><a href="#MONTE_LOG12OH_M91">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MONTE_LOG12OH_KK04

 PURPOSE:
   Compute oxygen abundances using the KK04 calibration, with
   proper Monte Carlo of the errors.

 INPUTS: 
   r23, o32 - if you don't know what these are you probably shouldn't
     be using this routine [NOBJ]

 OPTIONAL INPUTS: 
   nmonte - number of Monte Carlo realizations; note that if
     NMONTE=0 then LOG12OH_AVG as well as the errors will not be
     computed (default 250)
   maxiter - maximum number of iterations (default 50)
   seed - random number seed
   line - emission-line structure containing the fluxes and errors of
     the [OII], [OIII] 4959+5007, and H-beta emission lines from which
     R23 and O32 were derived [NOBJ]:

     IDL&gt; help, line, /str
     ** Structure &lt;1544078&gt;, 3 tags, length=24, data length=24, refs=1:
        OII         FLOAT     Array[2]
        OIII        FLOAT     Array[2]
        HBETA       FLOAT     Array[2]

 KEYWORD PARAMETERS: 
   log - indicates that R23 and O32 are in the log, i.e., log(R23),
     log(O32) 
   debug - render a QAplot and wait for a keystroke

 OUTPUTS: 
   result - output data structure (mostly self-explanatory)

 OPTIONAL OUTPUTS:
   result_monte - RESULT, for each Monte Carlo realization 

 COMMENTS:
   Note that LINE is only required if NMONTE&gt;0.

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Feb 06, NYU, written
   jm08mar21nyu - allow NMONTE=0
   jm09sep25ucsd - added SEED optional inpu
   jm10jul31ucsd - near-complete rewrite of uncertainties and
     convergence testing; slower, but correct!

 Copyright (C) 2008-2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/monte_log12oh_kk04.pro)</strong></p>
<hr />
<h3 id="MONTE_LOG12OH_M91">MONTE_LOG12OH_M91</h3>
<p><a href="#MONTE_LOG12OH_KK04">[Previous Routine]</a></p>
<p><a href="#MONTE_LOG12OH_PT05">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MONTE_LOG12OH_M91

 PURPOSE:
   Compute oxygen abundances using the M91 calibration, with
   proper Monte Carlo of the errors.

 INPUTS: 
   r23, o32 - if you don't know what these are you probably shouldn't
     be using this routine [NOBJ]

 OPTIONAL INPUTS: 
   nmonte - number of Monte Carlo realizations; note that if
     NMONTE=0 then LOG12OH_AVG as well as the errors will not be
     computed (default 250)
   line - emission-line structure containing the fluxes and errors of
     the [OII], [OIII] 4959+5007, and H-beta emission lines from which
     R23 and O32 were derived [NOBJ]:

     IDL&gt; help, line, /str
     ** Structure &lt;1544078&gt;, 3 tags, length=24, data length=24, refs=1:
        OII         FLOAT     Array[2]
        OIII        FLOAT     Array[2]
        HBETA       FLOAT     Array[2]

 KEYWORD PARAMETERS: 
   log - indicates that R23 and O32 are in the log, i.e., log(R23),
     log(O32) 

 OUTPUTS: 
   result - output data structure (mostly self-explanatory)

 OPTIONAL OUTPUTS:
   result_monte - RESULT, for each Monte Carlo realization 

 COMMENTS:
   Note that LINE is only required if NMONTE&gt;0.

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Feb 06, NYU, written
   jm08mar21nyu - allow NMONTE=0
   jm10jul31ucsd - better Monte Carlo errors

 Copyright (C) 2008, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/monte_log12oh_m91.pro)</strong></p>
<hr />
<h3 id="MONTE_LOG12OH_PT05">MONTE_LOG12OH_PT05</h3>
<p><a href="#MONTE_LOG12OH_M91">[Previous Routine]</a></p>
<p><a href="#MONTE_LOG12OH_T04">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MONTE_LOG12OH_PT05

 PURPOSE:
   Compute oxygen abundances using the PT05 calibration, with
   proper Monte Carlo of the errors.

 INPUTS: 
   r23, p - if you don't know what these are you probably shouldn't
     be using this routine 

 OPTIONAL INPUTS: 
   nmonte - number of Monte Carlo realizations; note that if
     NMONTE=0 then LOG12OH_AVG as well as the errors will not be
     computed  

 KEYWORD PARAMETERS: 
   log - indicates that R23 is in the log, i.e., log(R23); note that
     P should *always* be linear

 OUTPUTS: 
   result - output data structure (mostly self-explanatory)

 OPTIONAL OUTPUTS:
   result_monte - RESULT, for each Monte Carlo realization 

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Feb 06, NYU, written
   jm08mar21nyu - allow NMONTE=0
   jm10jul31ucsd - better Monte Carlo errors

 Copyright (C) 2008, 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/monte_log12oh_pt05.pro)</strong></p>
<hr />
<h3 id="MONTE_LOG12OH_T04">MONTE_LOG12OH_T04</h3>
<p><a href="#MONTE_LOG12OH_PT05">[Previous Routine]</a></p>
<p><a href="#MONTE_LOG12OH_ZHK94">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MONTE_LOG12OH_T04

 PURPOSE:
   Compute oxygen abundances using the T04 calibration, with
   proper Monte Carlo of the errors.

 INPUTS: 
   r23 - if you don't know what this is you probably shouldn't be
     using this routine [NOBJ]

 OPTIONAL INPUTS: 
   nmonte - number of Monte Carlo realizations; note that if
     NMONTE=0 then the errors will not be computed (default 250) 
   line - emission-line structure containing the fluxes and errors of
     the [OII], [OIII] 4959+5007, and H-beta emission lines from which
     R23 and O32 were derived [NOBJ]:

     IDL&gt; help, line, /str
     ** Structure &lt;1544078&gt;, 3 tags, length=24, data length=24, refs=1:
        OII         FLOAT     Array[2]
        OIII        FLOAT     Array[2]
        HBETA       FLOAT     Array[2]

 KEYWORD PARAMETERS: 
   log - indicates that R23 is in the log, i.e., log(R23)

 OUTPUTS: 
   result - output data structure (mostly self-explanatory)

 OPTIONAL OUTPUTS:
   result_monte - RESULT, for each Monte Carlo realization 

 COMMENTS:
   Only upper-branch metallicity is computed.  Also note that LINE is
   only required if NMONTE&gt;0. 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Aug 04, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/monte_log12oh_t04.pro)</strong></p>
<hr />
<h3 id="MONTE_LOG12OH_ZHK94">MONTE_LOG12OH_ZHK94</h3>
<p><a href="#MONTE_LOG12OH_T04">[Previous Routine]</a></p>
<p><a href="#MOULD_DISTANCE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MONTE_LOG12OH_ZHK94

 PURPOSE:
   Compute oxygen abundances using the ZHK94 calibration, with
   proper Monte Carlo of the errors.

 INPUTS: 
   r23 - if you don't know what this is you probably shouldn't be
     using this routine 

 OPTIONAL INPUTS: 
   nmonte - number of Monte Carlo realizations; note that if
     NMONTE=0 then the errors will not be computed (default 250) 
   line - input emission-line structure (see IM_ABUNDANCE for an
     example); required if NMONTE&gt;0

 KEYWORD PARAMETERS: 
   log - indicates that R23 is in the log, i.e., log(R23)

 OUTPUTS: 
   result - output data structure (mostly self-explanatory)

 OPTIONAL OUTPUTS:
   result_monte - RESULT, for each Monte Carlo realization 

 COMMENTS:
   Only upper-branch metallicity is computed.

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Aug 04, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/metallicity/monte_log12oh_zkh94.pro)</strong></p>
<hr />
<h3 id="MOULD_DISTANCE_F">MOULD_DISTANCE()</h3>
<p><a href="#MONTE_LOG12OH_ZHK94">[Previous Routine]</a></p>
<p><a href="#MULTI_AIRMASS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       MOULD_DISTANCE()

 PURPOSE:
       Compute the Hubble-flow velocity and luminosity distance of an
       object corrected for infall onto Virgo, the Great Attractor,
       and the Shapley concentration using the methodology described
       in Mould et al. (2000).

 CALLING SEQUENCE:
       mould = mould_distance(ra,dec,cz,object=,H0=,$
          omega0=,omega_lambda=,/proper)

 INPUTS:
       ra  - right ascension (J2000) [HMS]
       dec - declination (J2000) [DMS]
       cz  - heliocentric radial velocity [km/s]

 OPTIONAL INPUTS:
       object       - optional object name
       H0           - Hubble constant (default 70 km/s/Mpc)
       omega0       - matter density (default 0.3)
       omega_lambda - cosmological constant density (default 0.7)

 KEYWORD PARAMETERS:
       proper - return the proper distance (rather than the
                luminosity distance)

 OUTPUTS:
       mould - output data structure with the following fields: 
          object   - object name
          ra       - input declination
          dec      - input right ascension
          z        - input heliocentric redshift
          cz       - input heliocentric velocity distance
          v_LG     - Local Group velocity [km/s]
          v_infall - infall velocity [km/s] (three components)
          v_cosmic - Hubble-flow velocity [km/s]
          distance - luminosity distance [Mpc]
          flag     - flag [0=good, 1=Virgo, 2=GA, 3=Shapley]

 OPTIONAL OUTPUTS:

 COMMENTS:
       See Mould et al. 2000, ApJ, 529, 786 for the formalism. 

 PROCEDURES USED:
       GLACTC, DJS_DIFF_ANGLE(), IM_HMS2DEC()

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 October 13, U of A - written 
       jm04apr12uofa - minor bug fixes; properly zero the velocity to
                       the attractor center
       jm04may19uofa - updated and cleaned up documentation 

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/mould_distance.pro)</strong></p>
<hr />
<h3 id="MULTI_AIRMASS_F">MULTI_AIRMASS()</h3>
<p><a href="#MOULD_DISTANCE_F">[Previous Routine]</a></p>
<p><a href="#NED_WEBGET_BASIC">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   MULTI_AIRMASS()

 PURPOSE:
   Generate a multi-page plot of airmass and PA versus time. 

 INPUTS: 
   date - date of the observation in FITS format [YYYY,MM,DD] (e.g.,
     '2002-02-10') 
   ra, dec - celestial coordinates of object(s)

 OPTIONAL INPUTS: 
   object - object name
   obsname - observatory name (default KPNO)
   psname - postscript file name 

 KEYWORD PARAMETERS: 

 OUTPUTS: 

 MODIFICATION HISTORY:
   J. Moustakas ???

 Copyright (C) 20??, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/multi_airmass.pro)</strong></p>
<hr />
<h3 id="NED_WEBGET_BASIC">NED_WEBGET_BASIC</h3>
<p><a href="#MULTI_AIRMASS_F">[Previous Routine]</a></p>
<p><a href="#NED_WEBGET_DIAMETERS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       NED_WEBGET_BASIC

 PURPOSE:
       Collects basic data from NED.

 INPUTS:
       galaxy - NED-compatible list of galaxies [NGALAXY]

 OPTIONAL INPUTS:
       outfile - output file name if WRITE=1

 KEYWORD PARAMETERS:
       write - write the basic data as a binary FITS table 

 OUTPUTS:
       basic - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
       This routine is a more convenient drop-in replacement routine
       for NED's batch-retrieval system.  See also
       PARSE_NED_BYNAME. 

 EXAMPLES:
       IDL&gt; ned_webget_basic, 'ngc5194', b
       IDL&gt; struct_print, b

 TODO:
       Parse the list of alternate galaxy names.

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Nov 30, NYU - written based on
          NED_WEBGET_DIAMETERS 

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/ned_webget_basic.pro)</strong></p>
<hr />
<h3 id="NED_WEBGET_DIAMETERS">NED_WEBGET_DIAMETERS</h3>
<p><a href="#NED_WEBGET_BASIC">[Previous Routine]</a></p>
<p><a href="#NED_WEBGET_PHOTOMETRY">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       NED_WEBGET_DIAMETERS

 PURPOSE:
       Collect size and position angle information from NED.

 INPUTS:
       galaxy - NED-compatible list of galaxies [NGALAXY]

 OPTIONAL INPUTS:
       outfile - output file name if WRITE=1

 KEYWORD PARAMETERS:
       write - write DIAMETERS as a binary FITS table

 OUTPUTS:
       diameters - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
       This routine is a work-around to the fact that NED does not
       return diameters in batch mode.

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2005 Jul 22, U of A
       jm06jan19uofa - if multiple outer MCG diameters, select the
                       first one 
       jm06feb09uofa - also return the 2MASS K20 isophotal diameters

 Copyright (C) 2005-2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/ned_webget_diameters.pro)</strong></p>
<hr />
<h3 id="NED_WEBGET_PHOTOMETRY">NED_WEBGET_PHOTOMETRY</h3>
<p><a href="#NED_WEBGET_DIAMETERS">[Previous Routine]</a></p>
<p><a href="#NEW_IMATCH_TEMPLATES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       NED_WEBGET_PHOTOMETRY

 PURPOSE:
       Collects photometry data from NED.

 INPUTS:
       galaxy - NED-compatible list of galaxies [NGALAXY]

 OPTIONAL INPUTS:
       outfile - output file name if WRITE=1

 KEYWORD PARAMETERS:
       write - write PHOTOMETRY as a binary FITS table

 OUTPUTS:
       photo - output data structure

 OPTIONAL OUTPUTS:

 COMMENTS:
       This routine is a more convenient drop-in replacement routine
       for NED's batch-retrieval system.  See also
       PARSE_NED_PHOTOMETRY. 

 EXAMPLES:
       IDL&gt; ned_webget_photometry, 'ngc5194', p
       IDL&gt; struct_print, p

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Dec 01, NYU - written based on
          NED_WEBGET_DIAMETERS 

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/ned_webget_photometry.pro)</strong></p>
<hr />
<h3 id="NEW_IMATCH_TEMPLATES_F">NEW_IMATCH_TEMPLATES()</h3>
<p><a href="#NED_WEBGET_PHOTOMETRY">[Previous Routine]</a></p>
<p><a href="#NICEPRINT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       NEW_IMATCH_TEMPLATES()

 PURPOSE:
       Match a set of templates to a galaxy spectrum in terms of
       wavelength spacing, instrumental resolution, and velocity
       dispersion.

 CALLING SEQUENCE:
          new_templateflux = new_imatch_templates(templateflux,$
             templatewave,galaxywave,templateres=,galaxyres=,$
             galaxyvdisp=)

 INPUTS:
       templateflux - template flux [NTEMPLATEPIX,NTEMPLATE] 
       templatewave - corresponding rest wavelength [Angstrom, 
                      NTEMPLATEPIX]; assume *constant* pixel size in
                      A/pixel 
       galaxywave   - galaxy rest wavelength [Angstrom, NPIX]

 OPTIONAL INPUTS:
       templateres  - *scalar* FWHM spectral resolution of
                      TEMPLATEFLUX [Angstrom]
       galaxyres    - desired output, *scalar*, rest FWHM
                      instrumental resolution of NEWFLUX [Angstrom],
                      which must be larger than TEMPLATERES
       galaxyvdisp  - *scalar*, rest-frame galaxy velocity dispersion 
                      [km/s]

 KEYWORD PARAMETERS:

 OUTPUTS:
       new_templateflux - resampled and broadened TEMPLATEFLUX
                          [NPIX,NTEMPLATE] 

 OPTIONAL OUTPUTS:

 COMMENTS:
       The templates will be padded with zeros where there is no
       wavelength overlap.  

       This routine is optimized/written for the following
       circumstances: scalar template resolution, scalar galaxy
       instrumental resolution, scalar galaxy velocity
       dispersion, and constant template pixel size.  First we
       degrade the templates to the instrumental resolution of the
       data in wavelength space, and then resample to constant
       log-lambda and ... 

 PROCEDURES USED:
       COMBINE1FIBER

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2004 May 09, U of A - re-written version of
          IMATCH_TEMPLATES() 

 Copyright (C) 2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/new_imatch_templates.pro)</strong></p>
<hr />
<h3 id="NICEPRINT">NICEPRINT</h3>
<p><a href="#NEW_IMATCH_TEMPLATES_F">[Previous Routine]</a></p>
<p><a href="#NICEPRINTF">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   NICEPRINT
 PURPOSE:
   Write out an arrays of numbers in a nice column format.
 MODIFICATION HISTORY:
   Leonidas Moustakas, ???
</pre>
<p><strong>(See pro/misc/niceprint.pro)</strong></p>
<hr />
<h3 id="NICEPRINTF">NICEPRINTF</h3>
<p><a href="#NICEPRINT">[Previous Routine]</a></p>
<p><a href="#NINTERPOLATE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   NICEPRINTF
 PURPOSE:
   Write to an existing LUN arrays of numbers in a nice column
   format. 
 MODIFICATION HISTORY:
   Leonidas Moustakas, ???
</pre>
<p><strong>(See pro/misc/niceprintf.pro)</strong></p>
<hr />
<h3 id="NINTERPOLATE">NINTERPOLATE</h3>
<p><a href="#NICEPRINTF">[Previous Routine]</a></p>
<p><a href="#ODD_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
    NINTERPOLATE

 PURPOSE:
    Perform n-dimensional linear interpolation on arrays of
    arbitrary dimensionality (ala the bilinear and trilinear
    interpolation of INTERPOLATE).

 CALLING SEQUENCE:
    value=ninterpolate(data,point)

 INPUTS:
    DATA: The n-dimensional array to interpolate.
 
    POINT: A vector of length n specifying the (single) point for
       which the interpolated value is desired.

 OUTPUTS:
    The interpolated value at the specified point.

 RESTRICTIONS:
    Unlike the INTERPOLATE command, only one point can be
    interpolated at a time.  Ill-behaved on points outside the array
    boundary.  Requires IDL &gt;v5.6.

 EXAMPLE:
  r=randomu(sd,40,50,60,70)
  v=ninterpolate(r,[22.4,18.6,52.2,60.4])

 MODIFICATION HISTORY:

    Mon Jul 21 12:33:30 2003, J.D. Smith &lt;jdsmith@as.arizona.edu&gt;
		Written.
==========================================================================
 Copyright (C) 2003, J.D. Smith
</pre>
<p><strong>(See pro/math/ninterpolate.pro)</strong></p>
<hr />
<h3 id="ODD_F">ODD()</h3>
<p><a href="#NINTERPOLATE">[Previous Routine]</a></p>
<p><a href="#OII_SFR_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ODD()
 PURPOSE:
   Returns 0 if number if even, 1 if odd.
 MODIFICATION HISTORY:
   8/1/95 MCL
</pre>
<p><strong>(See pro/misc/odd.pro)</strong></p>
<hr />
<h3 id="OII_SFR_F">OII_SFR()</h3>
<p><a href="#ODD_F">[Previous Routine]</a></p>
<p><a href="#ONEDCENTER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       OII_SFR()

 PURPOSE:
       Estimate the star-formation rate (SFR) from the B-band
       luminosity and the observed [O II] luminosity according to 
       Moustakas, Kennicutt, &amp; Tremonti (2006).

 INPUTS:
       loglb   - B-band luminosity [L(B)_sun]
       logloii - observed (not reddening-corrected) [O II] 3727
                 luminosity [erg/s]

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:
       log - return the log-base-10 SFR and error

 OUTPUTS:
       sfr - star-formation rate [M_sun/yr]

 OPTIONAL OUTPUTS:
       sfr_err - uncertainty in SFR based on the standard-deviation
                 of the empirical calibration [M_sun/yr]

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2005 Aug 26, U of A - written
       jm06apr10uofa - also return SFR_ERR; documented

 Copyright (C) 2005-2006, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/oii_sfr.pro)</strong></p>
<hr />
<h3 id="ONEDCENTER_F">ONEDCENTER()</h3>
<p><a href="#OII_SFR_F">[Previous Routine]</a></p>
<p><a href="#PAD_EXTRAPOLATE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   ONEDCENTER()

 PURPOSE:
   Find the intensity-weighted (partial-pixel) center of a 1D array.  

 INPUTS: 
   x - independent input vector (e.g., wavelength) [NPTS]
   y - dependent input vector (e.g., flux) [NPTS]

 OPTIONAL INPUTS: 
   dx - tolerance; maximum fractional shift in the x-center for
     convergence 

 KEYWORD PARAMETERS: 
   verbose - print messages to STDOUT

 OUTPUTS: 
   xcen - partial-pixel center of X
   ycen - interpolated value of Y at XCEN

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Jul 13, U of A

 Copyright (C) 2001, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/onedcenter.pro)</strong></p>
<hr />
<h3 id="PAD_EXTRAPOLATE_F">PAD_EXTRAPOLATE()</h3>
<p><a href="#ONEDCENTER_F">[Previous Routine]</a></p>
<p><a href="#PAGEMAKER">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       PAD_EXTRAPOLATE()

 PURPOSE:
       Pad and extrapolate a two-dimensional spectrum in the spatial
       dimension using a low-order Legendre polynomial fit.

 CALLING SEQUENCE:

 INPUTS:
       image  - two dimensional input image
       npad   - number of spatial rows to pad

 OPTIONAL INPUTS:
       ncoeff - number of Legendre coefficients to fit; default is 3
                (order 2) 
       ny     - number of rows to fit for the extrapolation

 KEYWORD PARAMETERS:

 OUTPUTS:
       padim  - padded and extrapolated image

 OPTIONAL OUTPUTS:

 COMMENTS:
       This routine is useful for preparing an image for a distortion
       correction or registration.

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2002 Feb 20, U of A

 Copyright (C) 2002, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/pad_extrapolate.pro)</strong></p>
<hr />
<h3 id="PAGEMAKER">PAGEMAKER</h3>
<p><a href="#PAD_EXTRAPOLATE_F">[Previous Routine]</a></p>
<p><a href="#PARSE_NED_BYNAME">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>

  NAME:  
    PAGEMAKER

  PURPOSE:
    Returns plotting positions for desired page specifications,
    pagemaker can be run with no inputs (all defaults) or as much
    specification can be given as desired

  OPTIONAL INPUT:  

     XPAGE   - horizontal dimension of page in inches (default=8.5)
     YPAGE   - vertical dimension of page in inches (default=11.0)
     XMARGIN - left/right margin size in inches, can be an array (default=1.0)
     YMARGIN - top/bottom margin size in inches, can be an array (default=1.0)
     NX      - number of horizontal boxes across page (default=1)
     NY      - number of vertical boxes across page (default=2)
     WIDTH   - width of plot box(es) in inches, can be an array 
               for left to right
     HEIGHT  - height of plot box(es) in inches, can be an array
               for top to bottom
     XSPACE  - horizontal spacing between boxes in inches, can be
               an array for left to right (default=0.1*WIDTH)
     YSPACE  - vertical spacing between boxes in inches, can be
               an array for top to bottom (default=0.1*HEIGHT)

  OUTPUT: position - a 4 x (NX*NY) array, position coords for each
                     plot box - [x0,y0,x1,y1]

  KEYWORDS: 

     landscape - switches from portrait mode to landscape mode
     normal    - returns normalized coordinates

   EXAMPLE: IDL&gt; pagemaker, nx=3, ny=5, xspace=0., yspace=0., $
                   position=pos, /normal
            IDL&gt; window, xsize=500, ysize=647
            IDL&gt; for i=0,14 do plot,findgen(10),position=pos[*,i],/noerase

  HISTORY: written by Andy Marble (ARM), Steward Observatory,  Jan 2002
           overhauled by ARM, Jan 2003 - currently still under revision
</pre>
<p><strong>(See pro/plot/pagemaker.pro)</strong></p>
<hr />
<h3 id="PARSE_NED_BYNAME">PARSE_NED_BYNAME</h3>
<p><a href="#PAGEMAKER">[Previous Routine]</a></p>
<p><a href="#PARSE_NED_LITERATURE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
      PARSE_NED_BYNAME

 PURPOSE:
       Parse basic galaxy properties from a NED batch request.

 INPUTS:
       nedfile      - basic data text file from NED

 OPTIONAL INPUTS:
       inputnedfile - input text file sent to NED with a list of
                      objects, one per line (spaces and funny
                      characters are okay)
       nedpath      - path name to NEDFILE and INPUTNEDFILE
       outfile      - output file name (either OUTFILE.FITS or
                      OUTFILE.TXT, depending on whether TEXTFILE=1)
       outpath      - output path name for OUTFILE

 KEYWORD PARAMETERS:
       sortra       - sort the output data structure by RA
       textfile     - write a columnular text file rather than a
                      binary FITS file

 OUTPUTS:
       data         - output photometry data structure
          GALAXY        - input galaxy name from INPUTNEDFILE
          NEDGALAXY     - NED galaxy name from NEDFILE
          RA            - right ascenscion (J2000)
          DEC           - declination (J2000)
          Z             - redshift (dimensionless)
          Z_ERR         - redshift error (dimensionless)
          MORPH         - NED morphology
          MAG           - &quot;optical&quot; magnitude (not reliable)
          DMAJ          - major axis length at 25 mag/arcsec2 (arcmin)
          DMIN          - minor axis length at 25 mag/arcsec2 (arcmin)

 OPTIONAL OUTPUTS:

 COMMENTS:
      Any existing binary fits table of the same name is
      overwritten.  

 EXAMPLE:
       IDL&gt; parse_ned_byname, 'ned.dat', outfile='ned.fits'
       IDL&gt; parse_ned_byname, 'ned.dat', /textfile, /sortra, outfile='ned.txt'

 MODIFICATION HISTORY:
      J. Moustakas, 2001 November 7, U of A
      jm03apr3uofa, cleaned up and documented
      jm03sep17uofa, added error checking if the object does not
         exist in NED
      jm06jan24uofa - added UNIQUE keyword
      jm07nov28nyu - check whether the NED redshift is dimensionless
                     or in km/s, and convert as appropriate

 Copyright (C) 2001, 2003, 2006-2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/parse_ned_byname.pro)</strong></p>
<hr />
<h3 id="PARSE_NED_LITERATURE">PARSE_NED_LITERATURE</h3>
<p><a href="#PARSE_NED_BYNAME">[Previous Routine]</a></p>
<p><a href="#PARSE_NED_PHOTOMETRY">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   PARSE_NED_LITERATURE

 PURPOSE:
   Parse the output of a NED literature search.

 INPUTS: 
   nedfile - literature results file from NED

 OPTIONAL INPUTS: 
   outfile - output file name (default 'outfile.fits' or
     'outfile.txt'; see /TEXTFILE)

 KEYWORD PARAMETERS: 
   textfile - write out an ASCII file (default is to write a binary
     FITS table)
   kms - convert redshifts to km/s (fragile!)

 OUTPUTS: 
   Writes out a FITS or ASCII file with the derived literature
   results. 

 COMMENTS:
   Sorts the output by RA.

 MODIFICATION HISTORY:
   J. Moustakas, 2001 Nov 07, U of A
   jm02mar22uofa - modified to output a binary fits table; any
     existing binary fits table of the same name is overwritten 

 Copyright (C) 2001-2002, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/parse_ned_literature.pro)</strong></p>
<hr />
<h3 id="PARSE_NED_PHOTOMETRY">PARSE_NED_PHOTOMETRY</h3>
<p><a href="#PARSE_NED_LITERATURE">[Previous Routine]</a></p>
<p><a href="#PEG2ISEDFIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       PARSE_NED_PHOTOMETRY

 PURPOSE:
       Parse galaxy photometry from a NED batch request.

 INPUTS:
       nedfile      - photometry text file from NED

 OPTIONAL INPUTS:
       inputnedfile - input text file sent to NED with a list of
                      objects, one per line (spaces and funny
                      characters are okay), for which to get
                      photometry
       nedpath      - path name to NEDFILE and INPUTNEDFILE
       outfile      - output file name (either OUTFILE.FITS or
                      OUTFILE.TXT, depending on whether TEXTFILE=1)
       outpath      - output path name for OUTFILE

 KEYWORD PARAMETERS:
       textfile     - write a columnular text file rather than a
                      binary FITS file

 OUTPUTS:
       data         - output photometry data structure
          GALAXY        - input galaxy name from INPUTNEDFILE
          NEDGALAXY     - NED galaxy name from NEDFILE
          U_RC3         - U-band RC3 magnitude
          U_RC3_ERR     - U-band RC3 magnitude error
          U_FLAG        - U-band magnitude flag (U_T or U_T^0)
          B_RC3         - B-band RC3 magnitude
          B_RC3_ERR     - B-band RC3 magnitude error
          B_FLAG        - B-band magnitude flag (B_T, m_B, or m_B^0)
          V_RC3         - V-band RC3 magnitude
          V_RC3_ERR     - V-band RC3 magnitude error
          V_FLAG        - V-band magnitude flag (V_T or V_T^0)
          J_2MASS       - J-band 2MASS magnitude
          J_2MASS_ERR   - J-band 2MASS magnitude error
          J_2MASS_FLAG  - J-band 2MASS flag [not used]
          H_2MASS       - H-band 2MASS magnitude
          H_2MASS_ERR   - H-band 2MASS magnitude error
          H_2MASS_FLAG  - H-band 2MASS flag [not used]
          K_2MASS       - K-band 2MASS magnitude
          K_2MASS_ERR   - K-band 2MASS magnitude error
          K_2MASS_FLAG  - K-band 2MASS flag [not used]
          IRAS_12       - IRAS 12 micron flux density [Jy]
          IRAS_12_ERR   - IRAS 12 micron flux density error [Jy]
          IRAS_12_FLAG  - IRAS 12 micron reference
          IRAS_25       - IRAS 25 micron flux density [Jy]
          IRAS_25_ERR   - IRAS 25 micron flux density error [Jy]
          IRAS_25_FLAG  - IRAS 25 micron reference
          IRAS_60       - IRAS 60 micron flux density [Jy]
          IRAS_60_ERR   - IRAS 60 micron flux density error [Jy]
          IRAS_60_FLAG  - IRAS 60 micron reference
          IRAS_100      - IRAS 100 micron flux density [Jy]
          IRAS_100_ERR  - IRAS 100 micron flux density error [Jy]
          IRAS_100_FLAG - IRAS 100 micron reference
          UV_1650       - UV(1650) flux [erg/s/cm2/A]
          UV_1650_ERR   - UV(1650) flux error [erg/s/cm2/A]
          UV_1650_REF   - UV(1650) reference
          UV_2500       - UV(2500) flux [erg/s/cm2/A]
          UV_2500_ERR   - UV(2500) flux error [erg/s/cm2/A]
          UV_2500_REF   - UV(2500) reference
          UV_3150       - UV(3150) flux [erg/s/cm2/A]
          UV_3150_ERR   - UV(3150) flux error [erg/s/cm2/A]
          UV_3150_REF   - UV(3150) reference

 OPTIONAL OUTPUTS:

 COMMENTS:
       Upper limits on IRAS fluxes are negative.  The UV data are
       from Rifatto, Longo, &amp; Capaciol 1995, A&amp;AS, 114, 527 (see also
       Rifatto et al. 1995, A&amp;AS, 109, 341).  We exclude upper limits
       on the UV fluxes.
 
       Sometimes the 2MASS data appears twice.  According to NED, the
       brighter of the two should be used:
       
          Date: Mon, 29 Nov 2004 15:38:11 -0800 (PST)
          From: Harold Corwin &lt;hgcjr@ipac.caltech.edu&gt;
          To: jmoustakas@as.arizona.edu
          Cc: jarrett@ipac.caltech.edu, zb4ms@ipac.caltech.edu
          Subject: 2MASS photometry
          
          Hi, John,
          
           &gt; I am using the NED batch photometry retrieval system to compile 2MASS
           &gt; photometry for my galaxy sample.  I have discovered that several objects
           &gt; in my sample have *two* measurements corresponding to the &quot;total&quot;  
           &gt; magnitudes in JHKs from the Extended Source Catalog.  These magnitudes are
           &gt; similar in some objects but very different in others.  Below is the list
           &gt; of objects in my sample with the two measurements.  If you can help me
           &gt; resolve which measurement I should be using I would appreciate the help.
          
          In all of these cases, there are two 2MASS XSC names attached to 
          the NED object; these &quot;interloper&quot; XSC names pulled in the 
          additional magnitudes your NED searches returned.
          
          I've checked the images for each of these and have found that the 
          brighter of the two sets of magnitudes is the appropriate one to 
          use in all of these cases (some of these, however, will need to 
          be revised by Tom Jarrett using his Large Galaxy Atlas software; 
          NGC 4138 in particular is affected).  I've also appended a note 
          briefly explaining the source of each problem.

       NED provides 2MASS photometry for some objects from the Large
       Galaxy Atlas (LGA).  This catalog includes total photometry
       that is &quot;better&quot; than the XSC.  It also provides isophotal
       photometry (at 20 mag/arcsec2) in each of the three bands
       (JHKs), whereas the XSC provides isophotal photometry at the
       K20 radius.  For uniformity we only take the XSC isophotal
       photometry.

       IRAS fluxes exist from three sources: Rice et al. 1988, ApJS,
       68, 91 for large optical galaxies; Soifer et al. 1989, AJ, 98,
       766 for the Bright Galaxy Sample; and Moshir et al. 1990 for
       the IRAS Faint Source Catalog.  All three of these fluxes are
       stored.  Problems are sometimes encountered whereby the fluxes
       are very different, or one source has a flux, but no flux
       error, etc..  

 EXAMPLE:
       IDL&gt; parse_ned_photometry, 'ned.phot.dat', outfile='ned.phot.fits'
       IDL&gt; parse_ned_photometry, 'ned.phot.dat', /textfile, outfile='ned.phot.txt'

 MODIFICATION HISTORY:
       J. Moustakas, 2002 May 14, U of A
       jm03feb10uofa - documented and streamlined
       jm03mar15uofa - grabbed IRAS errors and distinguished upper
                       limits; more error checking
       jm03apr30uofa - parse 2MASS photometry newly added to NED 
       jm03dec29uofa - added error checking for multiple 2MASS
                       measurements 
       jm04nov29uofa - smarter reading of the 2MASS magnitudes;
                       account for total magnitudes from the Large
                       Galaxy Atlas; also read both the 20th
                       isophotal radius magnitudes and the &quot;total&quot;
                       magnitudes 
       jm04dec07uofa - generalized the IRAS photometry to return all
                       three of the RICE, SOIFER, and MOSHIR
                       photometry 
       jm07jun25nyu  - parse GALEX and MIPS photometry

 Copyright (C) 2002-2004, 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/ned/parse_ned_photometry.pro)</strong></p>
<hr />
<h3 id="PEG2ISEDFIT_F">PEG2ISEDFIT()</h3>
<p><a href="#PARSE_NED_PHOTOMETRY">[Previous Routine]</a></p>
<p><a href="#PWD_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   PEG2ISEDFIT()

 PURPOSE:
   Convert the output from IM_READ_PEG() to an iSEDfit compatible
   format. 

 INPUTS: 
   peg - data structure from IM_READ_PEG()

 OPTIONAL INPUTS: 
   sfr_const - scale by the continuous SFR back to 1 M_sun/yr, if
     necessary  

 OUTPUTS: 
   ised - iSEDfit-compatible data structure

 MODIFICATION HISTORY:
   J. Moustakas, 2011, ???

 Copyright (C) 2011, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/peg2isedfit.pro)</strong></p>
<hr />
<h3 id="PWD_F">PWD()</h3>
<p><a href="#PEG2ISEDFIT_F">[Previous Routine]</a></p>
<p><a href="#RANDOM_INDICES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   PWD()
 PURPOSE:
   Return the present working directory.
 MODIFICATION HISTORY:
   J. Moustakas, 2002 Jan 21, U of A
</pre>
<p><strong>(See pro/misc/pwd.pro)</strong></p>
<hr />
<h3 id="RANDOM_INDICES_F">RANDOM_INDICES()</h3>
<p><a href="#PWD_F">[Previous Routine]</a></p>
<p><a href="#RANGE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   RANDOM_INDICES()
 PURPOSE:
   Return a random index array.
 INPUTS: 
   len - maximum index number
   n_in - number of indices
 OUTPUTS: 
   inds - the random indices
 COMMENTS:
   See http://www.dfanning.com/code_tips/randomindex.html
 MODIFICATION HISTORY:
   J. D. Smith via http://www.dfanning.com/code_tips/randomindex.html
</pre>
<p><strong>(See pro/misc/random_indices.pro)</strong></p>
<hr />
<h3 id="RANGE">RANGE</h3>
<p><a href="#RANDOM_INDICES_F">[Previous Routine]</a></p>
<p><a href="#READFAST">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   RANGE

 PURPOSE:
   RANGE(x1,x2) = x1,x1+1,...,x2. In this case x1, x2 should be integers.
   RANGE(x1,x2,n) = x1,x1+dx,...,x2 with N integer the result has length N.
   The result will have the type of x1, but if three parameters are used
   the result will be at least of type float.

 CALLING SEQUENCE:
   a = RANGE(x1,x2,n,/OPEN,/LOG,/ASINH,SOFT=soft)
 
 KEYWORDS:
   OPEN: Set this keyword to exclude the extremes of the interval.
   LOG: Set this keyword to have the values logarithmically spaced
   ASINH: Set this keyword to have the values spaced according to an
     inverse hyperbolic sine function (Lupton et al. 1999, AJ, 118, 1406).
   SOFT: When using the /ASINH keyword, the optional keyword 
     0 &lt; SOFT &lt; 1 (default SOFT=0.3) can be assigned to the fractional 
     value which defines the transition between a nearly linear spacing 
     (x &lt; soft) and a nearly logarithmic spacing (x &gt; soft).

 EXAMPLES:
   IDL&gt; print, range(0,1,5)
       0.000000  0.250000  0.500000  0.750000  1.00000
   IDL&gt; print, range(0,1,5,/OPEN)
       0.100000  0.300000  0.500000  0.700000  0.90000
   IDL&gt; print, range(1,1e4,5,/LOG)
       1.00000   10.0000   100.000   1000.00   10000.0
   IDL&gt; print, range(1,1e4,5,/LOG)

 MODIFICATION HISTORY:
   V1.0: Michele Cappellari, Leiden, 16 October 2001
   V1.1: added /OPEN keyword, MC, Leiden, 9 March 2003
   V1.2: added /LOG keyword, MC, Oxford, 28 November 2008
   V1.3: added /ASINH and SOFT keywords. Updeted documentation.
     MC, Oxford, 28 September 2009
</pre>
<p><strong>(See pro/misc/range.pro)</strong></p>
<hr />
<h3 id="READFAST">READFAST</h3>
<p><a href="#RANGE">[Previous Routine]</a></p>
<p><a href="#READ_ISEDFIT_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	READFAST

 PURPOSE:
	Routine to read in column-formated data very quickly.

 INPUTS:
	filename - name of the file to be read

 OPTIONAL INPUTS:
	skipline - number of lines to skip at the top of the file
	
 KEYWORD PARAMETERS:
	double - optionally read the data in as double precision

 OUTPUTS:
	data - floating point 2D array containing the columns and rows
              in the data file

 OPTIONAL OUTPUTS:
	header - string array containing the lines skipped at the
                beginning of the file
	ncols  - number of columns read
	nlines - number of lines read

 COMMON BLOCKS:
	None.

 COMMENTS: 
	This program will only read floating (or double) precision
	data, and the file must be column-formated.  It will read in
	hundreds of thousands of lines in a matter of seconds after
	determining how many lines and columns there are in the file.
	Note that the program will not skip blank lines nor comment
	lines unless explicitly told to do so with the skipline
	option.  The idea is speed over flexibility. 

 MODIFICATION HISTORY:
	John Moustakas, 2000 May 24, UC Berkeley
	jm01jan16uofa - added nlines keyword to optionally return the
                       number of lines in the file; added error
                       checking 
	jm01jan25uofa - routine figures out how many columns there are
                       in the file; added double keyword; documented,
                       cleaned up, and optimized

 Copyright (C) 2000-2001, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/misc/readfast.pro)</strong></p>
<hr />
<h3 id="READ_ISEDFIT_F">READ_ISEDFIT()</h3>
<p><a href="#READFAST">[Previous Routine]</a></p>
<p><a href="#READ_ISEDFIT_PARAMFILE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   READ_ISEDFIT()

 PURPOSE:
   Restore the ISEDFIT fitting results and, optionally, the posterior
   parameter distributions, and the best-fitting models. 

 INPUTS:
   isedfit_paramfile - iSEDfit parameter file

 OPTIONAL INPUTS:
   params - data structure with the same information contained in
     ISEDFIT_PARAMFILE (over-rides ISEDFIT_PARAMFILE)
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     build this SFHgrid (may be a vector)
   isedfit_dir - full directory path where all the ISEDFIT output
     files can be found; should match the directory passed to ISEDFIT
     (default PWD=present working directory)  
   montegrids_dir - full directory path where the Monte Carlo grids
     written by ISEDFIT_MONTEGRIDS can be found (default 'montegrids'
     subdirectory of the PWD=present working directory)
   index - use this optional input to restore a zero-indexed subset
     of the full sample (default is to restore everything, although
     see COMMENTS)
   outprefix - optional output prefix string (see ISEDFIT) 
   in_isedfit - use this input data structure in lieu of the ISEDFIT
     output structure read based on the contents of
     ISEDFIT_PARAMFILE; this input facilitates some of the
     fancy plotting I've done for papers  

 KEYWORD PARAMETERS:
   flambda - convert to F(lambda) (erg/s/cm^2/A) (default is AB mag)
   fnu - convert to F(nu) (erg/s/cm^2/Hz) (default is AB mag) 
   getmodels - restore the ISEDFIT output structure *and* the model
     spectra 
   noigm - do not convolve with the IGM, over-riding the content of
     ISEDFIT_PARAMFILE; this can be useful for testing but should not
     in general be used
   silent - suppress messages to STDOUT

 OUTPUTS:
   model - output data structure array containing all the ISEDFIT
     outputs plus the following tags if /GETMODELS [NGAL]
     .WAVE - observed-frame wavelength array (Angstrom)
     .FLUX - observed-frame flux array (AB mag)

 OPTIONAL OUTPUTS:
   isedfit_post - iSEDfit result structure (see ISEDFIT) [NGAL] 

 COMMENTS:
   This routine should be not be used to restore too many galaxy
   spectra (if /GETMODELS) or posteriors (if ISEDFIT_POST is
   requested), otherwise memory problems may occur; use INDEX. 

 MODIFICATION HISTORY:
   J. Moustakas, 2007 Jun 27, NYU - largely excised from
     ISEDFIT_SED_QAPLOT and ISEDFIT_MEASURE
   jm11oct01ucsd - documentation cleaned up and updated
   jm13aug09siena - updated to conform to the latest data model;
     documentation updated 

 Copyright (C) 2007, 2011, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/read_isedfit.pro)</strong></p>
<hr />
<h3 id="READ_ISEDFIT_PARAMFILE_F">READ_ISEDFIT_PARAMFILE()</h3>
<p><a href="#READ_ISEDFIT_F">[Previous Routine]</a></p>
<p><a href="#READ_WITT_DUSTMODELS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   READ_ISEDFIT_PARAMFILE() 

 PURPOSE:
   Read the iSEDFIT parameter file.

 INPUTS: 
   isedfit_paramfile - parameter file to read

 OPTIONAL INPUTS: 
   thissfhgrid - if ISEDFIT_PARAMFILE contains multiple grids then
     read this SFHgrid (may be a vector)

 OUTPUTS: 
   params - data structure with all the parameters 

 COMMENTS:

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Nov 12, UCSD
   jm13jan13siena - ISEDFIT_PARAMFILE now required input
   jm13aug05siena - updated to latest data model

 Copyright (C) 2010, 2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/read_isedfit_paramfile.pro)</strong></p>
<hr />
<h3 id="READ_WITT_DUSTMODELS_F">READ_WITT_DUSTMODELS()</h3>
<p><a href="#READ_ISEDFIT_PARAMFILE_F">[Previous Routine]</a></p>
<p><a href="#REBINW">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   READ_WITT_DUSTMODELS()

 PURPOSE:
   Read the Witt &amp; Gordon (2000) dust models.

 INPUTS: 

 OPTIONAL INPUTS: 
   geometry - 'dusty', 'cloudy' or 'shell' (default 'shell')
   dust_type - 'SMC' or 'MW' (default 'MW')
   structure - 'c' (clumpy) or 'h' (homogeneous) (default 'h') 

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   Structure containing all the relevant data.

 COMMENTS:

 MODIFICATION HISTORY:

 Copyright (C) 2010, John Moustakas
   J. Moustakas, 2010 Mar 17, UCSD - largely based on
     M. Blanton's WITT_EXT()  
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/read_witt_dustmodels.pro)</strong></p>
<hr />
<h3 id="REBINW">REBINW</h3>
<p><a href="#READ_WITT_DUSTMODELS_F">[Previous Routine]</a></p>
<p><a href="#REFRACTION_PLOT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
 	rebinw
 PURPOSE:
	rebins the input array on a new grid and returns the output array.
	this routine is preferred over simple INTERPOL or SPLINE because
	this is guaranteed to e.g., conserve flux while rebinning spectra.

syntax
	ff=rebinw(f,x,y,/perbin,numbins=numbins,nbin=nbin,wrange=wrange,$
	/slowok,verbose=verbose)

parameters
	f	[INPUT; required] array values
	x	[INPUT; required] absissae for F
		1: if size matches that of F, assumed to be mid-bin values
		2: if size is size(F)+1, assumed to be bin boundaries
		   (i.e., all the bin-beginners and a final bin-ender)
		3: if neither of the above, this is assumed to be the
		   desired *output* grid, and the absissae of the input
		   are assumed to span the linear range 1..N(F)
		   * Y is ignored on input, but will be overwritten on output
	y	[I/O] the new absissa values, taken from NUMBINS if it is set.
		1: if scalar or 1-element vector on input, assumed to be
		   number of bins in output
		   * linear binning if +ve, log binning if -ve
		2: if &gt;1-element vector on input, assumed to be the desired
		   output grid of bin boundaries, with the last element
		   defining the final bin-ending value.
		3: if not defined, takes value from NBIN
		NOTE: F extrapolates as zeros.

keywords
	perbin	[INPUT] if set, assumes that units of F(X) are [.../bin]
	nbin	[I/O] number of bins in output
		* overwritten if defined via X or Y
		* linear binning if +ve, log binning if -ve
		* default: 1
	numbins	[INPUT] same as NBINS, except that if set, it
		overrides NBIN _and_ Y
		* so, just to reiterate:
		  if NUMBINS is _not_ defined, then
		  -- if Y is a scalar, say = NN, then
			output will be rebinned to have NN elements, and
			Y will be overwritten to contain the new grid, and
			NBIN will be reset to NN
		  -- if Y is a vector, then
			output will be rebinned using Y as bin boundaries, and
			NBIN will be reset to N(Y)-1
		  -- if Y is not defined, but NBIN is defined, then
			output will be rebinned to have NBIN elements, and
			Y will on output contain the new grid
		  if NUMBINS is defined, then
		  -- output will be rebinned to have NUMBINS elements, and
		     Y will contain the new grid on output, and
		     NBIN will be reset to NUMBINS
	wrange	[INPUT] output grid range
		* ignored if defined via array Y (or X -- case 3)
		* overrides if determined via X and CASE 1 of Y
		* default: [1.,500.]
	slowok	[INPUT] if set, skips call to FINDEX and does it the
		slow IDL way
	verbose	[INPUT] controls chatter
	_extra	[JUNK] here only to prevent crashing the program

restrictions
	beware that if Y is not sorted in ascending order, on output
	it will be!
	requires external procedure FINDEX.PRO

history
	vinay kashyap (Jan98)
	forced x to be required inputs (Jun98)
	changed call to INTERPOL to combo call to INTERPOLATE/FINDEX (VK;99Jul)
	corrected long-standing &quot;feature&quot; of NBIN being useless, changed
	  default behavior of Y=UNDEFINED, NBIN, and X=/=F (VK; MarMM)
	added keyword SLOWOK (VK; Jul01)
	added keyword NUMBINS (VK; Dec'02)
	added keyword VERBOSE; now uses /CUMULATIVE in TOTAL() (VK; Feb'03)
	beware of /CUMULATIVE in TOTAL(), which returns an array of same
	  size as input, and does _not_ begin with 0 (VK; Apr'03)
	added warning if Y gets resorted (VK; Mar04)
	cleaned up behavior in the case of non-unique/non-monotonic inputs
	  (VK; Mar05)
</pre>
<p><strong>(See pro/spec1d/rebinw.pro)</strong></p>
<hr />
<h3 id="REFRACTION_PLOT">REFRACTION_PLOT</h3>
<p><a href="#REBINW">[Previous Routine]</a></p>
<p><a href="#RETURN_TBALMER_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   REFRACTION_PLOT
 PURPOSE:
   Generate a plot of atmospheric refraction with respect to 5000 a
   as a function of wavelength and zenith angle.
 KEYWORD PARAMETERS: 
   postscript - write out a postscript file
 COMMENTS:
   See Filippenko 1982, PASP, 94, 715.
 MODIFICATION HISTORY:
   J. Moustakas, 2002 Feb 15, U of A
</pre>
<p><strong>(See pro/sky/refraction_plot.pro)</strong></p>
<hr />
<h3 id="RETURN_TBALMER_F">RETURN_TBALMER()</h3>
<p><a href="#REFRACTION_PLOT">[Previous Routine]</a></p>
<p><a href="#RSEX_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       RETURN_TBALMER()

 PURPOSE:
       Return the Balmer decrement corresponding to a particular
       electron temperature. 

 CALLING SEQUENCE:
       balmer = return_tbalmer(temperature,/HaHb,/HaHg,$
          /HbHg,/HaHd,/HdHb,/HgHb)

 INPUTS:

 OPTIONAL INPUTS:
       temperature - electron temperature [K] (default 10000) 

 KEYWORD PARAMETERS:
       HaHb - return then H-alpha/H-beta decrement (default) 
       HaHg - return then H-alpha/H-gamma decrement
       HbHg - return then H-beta/H-gamma decrement
       HaHd - return then H-alpha/H-delta decrement
       HdHb - return then H-delta/H-beta decrement
       HgHb - return then H-gamma/H-beta decrement

 OUTPUTS:
       tbalmer - the Balmer decrement at TEMPERATURE 

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       BALMER_TEMPERATURE()

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 Aug 08 - written
       jm04jan22uofa - modified to accept the output from
                       BALMER_TEMPERATURE(); linearly interpolate the
                       local temperature based on the theoretical
                       line ratios 
       jm04nov03uofa - documented and cleaned up

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/dust/return_tbalmer.pro)</strong></p>
<hr />
<h3 id="RSEX_F">RSEX()</h3>
<p><a href="#RETURN_TBALMER_F">[Previous Routine]</a></p>
<p><a href="#SCAN_RATES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       RSEX()

 PURPOSE:
       Read in arbitrary SExtractor format catalogs, using native
       header information &amp; data themselves.  Correctly reads longs,
       strings, and doubles.  

 INPUTS:
       A SExtractor-format catalog

 OPTIONAL INPUTS:
       use_row - use this row of the catalog to determine the format
                 of the output data structure (zero-indexed; default
                 0); this is necessary because occasionally a column
                 in the first row is a different format (e.g., LONG)
                 than the rest of the rows (e.g., DOUBLE)

 KEYWORD PARAMETERS:

 OUTPUTS:
       Returns a structure with all catalog entries, using field
       names for tagnames. 

 COMMON BLOCKS:
       None.

 RESTRICTIONS:
       None.

 PROCEDURE:
       Use syntax
       cs = rsex('catalog.cat')

 COMMENTS:

 PROCEDURES USED:
       FINDFILE
       CREATE_STRUCT
       VALID_NUM
       VALID_NUM_ARR

 MODIFICATION HISTORY:
 LAM = L. Moustakas
 JM  = J. Moustakas
       LAM '04may02 - fixed problem case of there being an array of
                      values based on the last header tag position.
                      will now work with that case after special
                      check. 
       LAM '04feb04 - converted from the old lrsex.pro; adapted to
                      detect and read longs, strings, and doubles.  
       JM  '04sep22 - skip comment lines in the header designated
                      with a double-hash (##)
       JM  '07aug18 - added USE_ROW optional input
       JM  '08jul25 - use a variable logical unit number
       LAM+JM '08dec11 - vetted - no changes made
</pre>
<p><strong>(See pro/sextractor/rsex.pro)</strong></p>
<hr />
<h3 id="SCAN_RATES_F">SCAN_RATES()</h3>
<p><a href="#RSEX_F">[Previous Routine]</a></p>
<p><a href="#SDSS_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	SCAN_RATES()

 PURPOSE:
	Compute drift scan rates and offsets for integrated long-slit
	spectroscopy.  

 CALLING SEQUENCE:
       scan = scan_rates(pa,dec,scanlen,exptime,object=,$
          offset_along_slit=,offset_perp_slit=,nscan=,$
          /verbose,/doplot)

 INPUTS:
	pa      - slit position angle (measured from North to East,
                 where North is up and East is to the left)
                 [degrees].  nominally PA should correspond to the
                 major axis of the galaxy
	dec     - object declination [string degrees-minutes-seconds);
                 used to compute the correction to the RA scan rate 
	scanlen - total scan length perpendicular to the slit [arcsec] 
	exptime - total exposure time [s]

 OPTIONAL INPUTS:
       object      - object name
	offset_along_slit - offset the scan *along* the slit by OFFSET_ALONG_SLIT
                     [arcsec] (default 0.0) 
       nscan       - number of scans (&quot;passes&quot;) of the slit over the
                     galaxy (default 10) equal to EXPTIME / SCANTIME

 KEYWORD PARAMETERS:
	verbose     - print the SCAN data structure to STDOUT 

 OUTPUTS:
	scan        - output data structure with the following fields
          object     - input
          ra_offset  - slit offset in RA (East is positive) [arcsec]
          dec_offset - slit offset in DEC (North is positive) [arcsec]
          ra_rate    - scan rate in RA (East is positive) [arcsec/s]
          dec_rate   - scan rate in DEC (North is positive) [arcsec/s]
          scantime   - duration of one scan (&quot;pass&quot;) [s]
          pa         - input
          exptime    - input
          scanlen    - input
          scanlen    - input
          nscan      - input

 OPTIONAL OUTPUTS:

 COMMENTS:
       The cardinal directions are given by (N,E) such that North is
       up and positive (y axis) and East is measured positive **along
       the x axis**.  The coordinate system of the galaxy is (x',y')
       such that y' always coincides with the galaxy's major axis.  

       The scan length is the length of the scan *perpendicular* to
       the slit (and, presumably, the galaxy's major axis).  The slit
       offset is *along* the slit (along the galaxy major axis).  

 EXAMPLE:
	Compute the drift rates and offsets for an object at 12 hours
	declination, requiring a slit position angle of 135 degrees,
	and an offset along the slit of 80 arcsec EAST.  Compute for
	an exposure time of 1200 seconds and 20 drift scan passes.
	
	IDL&gt; scan = scan_rates(135,'12:00:00',55.0,1200.0,$
       IDL&gt;    offset_along_slit=80.0,nscan=20,/verbose)

 PROCEDURES USED:
	IM_OFFSET_AND_ROTATE(), IM_HMS2DEC(), PRINT_STRUCT

 MODIFICATION HISTORY:
	J. Moustakas, 2002 February 9, U of A
       jm03may22uofa - rewritten completely and more transparently 
       jm03may27uofa - added OBJECT optional input
       jm05mar09uofa - added DOPLOT keyword; changed OFFSET_ALONG_SLIT to
                       OFFSET_ALONG_SLIT; added OFFSET_PERP_SLIT
                       optional input 
</pre>
<p><strong>(See pro/sky/scan_rates.pro)</strong></p>
<hr />
<h3 id="SDSS_FILTERLIST_F">SDSS_FILTERLIST()</h3>
<p><a href="#SCAN_RATES_F">[Previous Routine]</a></p>
<p><a href="#SEEING_WAVELENGTH">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   SDSS_FILTERLIST()
 PURPOSE:
   Return the SDSS filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Aug 14, UCSD
</pre>
<p><strong>(See pro/galaxy/sdss_filterlist.pro)</strong></p>
<hr />
<h3 id="SEEING_WAVELENGTH">SEEING_WAVELENGTH</h3>
<p><a href="#SDSS_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#SFR_09RIEKE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   SEEING_WAVELENGTH
 PURPOSE:
   Plot the variation of the seeing disk with wavelength.  
 KEYWORD PARAMETERS: 
   postscript - write out a postscript file
 COMMENTS:
   Based on notes on Adaptive Optics from L. Close.
 MODIFICATION HISTORY:
   J. Moustakas, 2002 Feb 15, U of A
</pre>
<p><strong>(See pro/sky/seeing_wavelength.pro)</strong></p>
<hr />
<h3 id="SFR_09RIEKE_F">SFR_09RIEKE()</h3>
<p><a href="#SEEING_WAVELENGTH">[Previous Routine]</a></p>
<p><a href="#SFR_UNITS_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   SFR_09RIEKE()

 PURPOSE:
   Compute the SFR from the observed 24-micron *flux* density. 

 INPUTS: 
   z - redshift
   f24 - observed 24-micron flux [Jy]

 OUTPUTS: 
   sfr - star formation rate based on Table 1 and equation 14 in
     Rieke et al. 2009.

 COMMENTS:
   Accounts for the 24-micron K-correction, for various SED types,
   from 0&lt;z&lt;3. 
 
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Nov 23, UCSD

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/sfr_09rieke.pro)</strong></p>
<hr />
<h3 id="SFR_UNITS_F">SFR_UNITS()</h3>
<p><a href="#SFR_09RIEKE_F">[Previous Routine]</a></p>
<p><a href="#SIGFIG">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   SFR_UNITS()
 PURPOSE:
   Return a clean title for star formation rate.
 MODIFICATION HISTORY:
   J. Moustakas ???
</pre>
<p><strong>(See pro/plot/sfr_units.pro)</strong></p>
<hr />
<h3 id="SIGFIG">SIGFIG</h3>
<p><a href="#SFR_UNITS_F">[Previous Routine]</a></p>
<p><a href="#SIM_RVSHIFT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
  SIGFIG
 PURPOSE:
	SIGFIG is a function which returns an input value (INFIG) as
	a string rounded to the appropriate number of significant
	figures (NFIGS), as taught by Bonnie Kelly, my high school 
 	physics teacher.  


 CALLING SEQUENCE:
   result = SIGFIG(input, n_figures)

 INPUTS:
   INPUT -- Vector of floats or whatever (they become floats)
   N_FIGURES -- Number of figures to round to.
 KEYWORD PARAMETERS:
   None.

 OUTPUTS:
   RESULT -- A well rounded string array.

 MODIFICATION HISTORY:
      Documented.
       Wed Nov 21 12:25:29 2001, Erik Rosolowsky &lt;eros@cosmic&gt;
</pre>
<p><strong>(See pro/math/sigfig.pro)</strong></p>
<hr />
<h3 id="SIM_RVSHIFT">SIM_RVSHIFT</h3>
<p><a href="#SIGFIG">[Previous Routine]</a></p>
<p><a href="#SINT">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       SIM_RVSHIFT

 PURPOSE:
       A simulation to test the accuracy of solving for a velocity
       shift as a function of input spectrum S/N.

 CALLING SEQUENCE:
       sim_rvshift, vtrue=, snmin=, snmax=, dsn=, minwave=, $
          maxwave=, zans=, template=, /debug, /doplot, /silent

 INPUTS:
       
 OPTIONAL INPUTS:
       vtrue    - radial velocity shift to apply [km/s]
       snmin    - minimum S/N (default 5)
       snmin    - maximum S/N (default 100)
       dsn      - S/N spacing (default 10)
       minwave  - see IM_ZTWEAK()
       maxwave  - see IM_ZTWEAK()
       template - scalar template number to use
          0L: Age = 25 Myr (BA star spectrum)
          1L: Age = 1.4 Gyr (AF star spectrum)
          2L: Age = 11 Gyr (GK star spectrum)
          3L: Exp SFR, 12 Gyr, tau=5 (not supported)

 KEYWORD PARAMETERS:
       debug  - debugging plot
       doplot - generate a plot of residuals
       silent - do not print the results to STDOUT

 OUTPUTS:

 OPTIONAL OUTPUTS:

 PROCEDURES USED:
       IM_ZTWEAK(), IM_READ_BC03(), GET_ELEMENT

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 May 14, U of A
       jm04mar09uofa - general updates; use IM_READ_BC03() 

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/sim_rvshift.pro)</strong></p>
<hr />
<h3 id="SINT">SINT</h3>
<p><a href="#SIM_RVSHIFT">[Previous Routine]</a></p>
<p><a href="#SKYVIEW_BATCH">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
    sint
 PURPOSE:
    Sinc interpolation of a 1-D vector of data.
 DESCRIPTION:

 CATEGORY:
    Numerical
 CALLING SEQUENCE:
    result = sint( x, f )
 INPUTS:
    x  : Independent variable values for which f is to be interpolated.
         Note: The implied independent variable values for f are the indicies
         of the vector f.
    f  : Vector of function values (dependent variable).

 OPTIONAL INPUT PARAMETERS:

 KEYWORD PARAMETERS:

 OUTPUTS:
    Interpolated value(s).
 COMMON BLOCKS:

 SIDE EFFECTS:

 RESTRICTIONS:

 PROCEDURE:

 MODIFICATION HISTORY:
    Written by Doug Loucks, Lowell Observatory, September, 1993.
    Adapted from the IDL function sshift.pro written by Marc Buie.
    01/14/94, DWL, Documentation update.
</pre>
<p><strong>(See pro/math/sint.pro)</strong></p>
<hr />
<h3 id="SKYVIEW_BATCH">SKYVIEW_BATCH</h3>
<p><a href="#SINT">[Previous Routine]</a></p>
<p><a href="#SORT_ND">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	SKYVIEW_BATCH

 PURPOSE:
	Retrieve images and data from SKYVIEW.

 CALLING SEQUENCE:

 INPUTS:
	filename - output FITS file name for the retrieved image
	vcoord   - [name/value] coordinate position or name of the
                  object (see below for format)

 OPTIONAL INPUTS:
	survey   - [name] survey name [default: Digitized Sky Survey]
	perlpath - full path name to the perl scripts SKVBATCH and
                  WEBQUERY [default: ${SKYVIEW_DIR}]
	datapath - full path name to output the data [default: PWD]
	scoord   - coordinate system [Equatorial,Galactic,Ecliptic]
	equinx   - equinox
	maproj   - map projection
	sfactr   - image size [degrees]
	pixelx   - x image size [pixels]
	pixely   - y image size [pixels]
	nameres  - name resolver method
	
 KEYWORD PARAMETERS:
	silent   - do not print web query message

 OUTPUTS:
	

 OPTIONAL OUTPUTS:

 COMMENTS:
	See http://skyview.gsfc.nasa.gov/docs/batchpage.html for much
	more detailed documentation.  This IDL script does not have
	the full flexibility of the PERL script.

	The PERL scripts called by this routine should be located in a
	directory defined in your .idlenv or .cshrc file (e.g., setenv
	SKYVIEW_PATH ${HOME}/idl/impro/skyview).  

 EXAMPLE:

 PROCEDURES USED:

 MODIFICATION HISTORY:
	J. Moustakas, 2002 Feb 18, U of A
	jm02jun14uofa - vectorized and added more keywords
</pre>
<p><strong>(See pro/sky/skyview_batch.pro)</strong></p>
<hr />
<h3 id="SORT_ND">SORT_ND</h3>
<p><a href="#SKYVIEW_BATCH">[Previous Routine]</a></p>
<p><a href="#SPECTRAL_INDICES_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       SORT_ND

 PURPOSE:
       Efficiently perform an N-dimensional sort along any dimension
       of an array.

 CALLING SEQUENCE:

       inds=sort_nd(array,dimension)

 INPUTS:

       array: An array of at least 2 dimensions to sort.

       dimension: The dimension along which to sort, starting at 1
          (1:rows, 2:columns, ...).

 OUTPUTS:

       inds: An index array with the same dimensions as the input
          array, containing the (1D) sorted indices.  Can be used
          directly to index the arary (ala SORT).

 EXAMPLE:
       
       a=randomu(sd,5,4,3,2)
       sorted=a[sort_nd(a,2)]

 SEE ALSO:

       HISTOGRAM

 MODIFICATION HISTORY:

       Tue Aug 22 15:51:12 2006, J.D. Smith &lt;jdsmith@as.arizona.edu&gt;

		Written, based on discussion on c.l.i-p, 08/2006.

</pre>
<p><strong>(See pro/misc/sort_nd.pro)</strong></p>
<hr />
<h3 id="SPECTRAL_INDICES_F">SPECTRAL_INDICES()</h3>
<p><a href="#SORT_ND">[Previous Routine]</a></p>
<p><a href="#SSTRETCH">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   SPECTRAL_INDICES()

 PURPOSE:
   Measure a variety of spectral indices from a composite stellar
   population spectrum.

 INPUTS:
   wave     - wavelength vector in Angstrom [NPIX]
   flux     - flux density in erg/s/cm2/Angstrom [NPIX]

 OPTIONAL INPUTS:
   ivar      - corresponding inverse variance spectrum [NPIX] (set
     IVAR=0 for crummy pixels)
   indexfile - full path name of the file listing the indices
               (default '${ISPEC_DIR}/etc/indexlist.dat') 

 KEYWORD PARAMETERS:
   nobreaks - do not measure any of the spectral breaks like D(4000) 
   nolick   - do not measure any of the Lick indices
   debug    - generate a plot of the index measurements and wait
              for a keystroke
   silent   - suppress messages to STDOUT

 OUTPUTS:
   indices   - data structure with all the results and errors

 OPTIONAL OUTPUTS:

 COMMENTS:
   We measure D4000 (Bruzual 1983, ApJ, 273, 105), D4000_narrow
   (Balogh et al. 1999, ApJ, 527, 54), the 41-50 color index
   (Kennicutt 1992, ApJS, 79, 255), the Balmer break (Leonardi &amp;
   Rose 2003, AJ, 126, 1811), all the continuum indices defined
   in INDEXFILE, and several composite indices (see below for the
   references). 

 EXAMPLE:

 MODIFICATION HISTORY:
   J. Moustakas, 2002 October 31, U of A
   jm03oct30uofa - major overhaul and updates
   jm03nov25uofa - incorporated IABSLINEEW() and cleaned up the
                   code and documentation
   jm04mar10uofa - bug fix in call to IABSLINEEW() (was not
                   passing the line limits); added SILENT keyword 
   jm05jan28uofa - bug fix when computing c41-50 to avoid NaN
   jm07mar13nyu  - additional error checking when computing
                   extended Lick indices
   jm08aug14nyu  - when computing MgFe, Mg1Fe, and Mg2Fe check to
                   make sure everything is positive!
   jm08aug22nyu  - removed INDEXPATH variable; now INDEXLIST must
                   include the full path name
   jm08nov24nyu  - added NOBREAKS keyword
   jm09aug20ucsd - added NOLICK keyword
   jm09dec08ucsd - changed FERR optional input to IVAR (inverse
     variance), so that bad pixels could be tracked (IVAR=0)

 Copyright (C) 2002-2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/spec1d/spectral_indices.pro)</strong></p>
<hr />
<h3 id="SSTRETCH">SSTRETCH</h3>
<p><a href="#SPECTRAL_INDICES_F">[Previous Routine]</a></p>
<p><a href="#STARLIGHTLOSS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	SSTRETCH

 PURPOSE:
	To return the median, standard deviation, minimum and maximum
	of an image (but see COMMENTS below) for computing a general
	image stretch based on a subset of the pixels.  

 INPUTS:
	im - two-dimensional image or an array

 OPTIONAL INPUTS:
	npix - number of image pixels to use for computing the stretch
              (default = 500)
	
 KEYWORD PARAMETERS:
	silent - suppress printing image statistics to the screen

 OUTPUTS:
	sstats - structure containing the calculated stretch values

 COMMENTS:
	This routine can also return statistics of a one- or
       multi-dimensional array.  This routine was inspired by a
       section of Marc Buie's CCDPHOT
       (http://www.lowell.edu/users/buie/idl/idl.html#categ12). 
 
       SSTRETCH =  &quot;smart stretch&quot;

 EXAMPLE:
	Given an image, im, try the following:

	IDL&gt; iminfo = sstretch(im)
	IDL&gt; tv, bytscl(im,min=iminfo.min,max=iminfo.max)

 PROCEDURES USED:
	STRN(), STDEV()

 MODIFICATION HISTORY:
	John Moustakas, 2001 April 28, U of A

 Copyright (C) 2001, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/sstretch.pro)</strong></p>
<hr />
<h3 id="STARLIGHTLOSS">STARLIGHTLOSS</h3>
<p><a href="#SSTRETCH">[Previous Routine]</a></p>
<p><a href="#STERN_IRAC_AGN_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   starlightloss
 
 PURPOSE: 
   Compute light losses from slit spectra as a function of seeing, 
     slit width, wavelength, paralactic angle, airmass.

 CALLING SEQUENCE: 
   starlightloss, seeing_fwhm, slit_width, theta=, airmass=, 
       wave0=, max_arcsec=, pixels_per_arcsec=, noplot=

 INPUTS:
   seeing_fwhm  - FWHM of seeing in arcseconds at the wavelength of interest
   slit_width   - Width of slit in arcseconds

 OPTIONAL KEYWORDS:

   theta        - Paralactic angle  (angle of slit relative to the horizon)
                  Defaults to 90 degrees  (perpendicual to the horizon)
   airmass      - airmass of observation, defaults to 1.2 
   wave0        - central wavelength in Angstroms, defaults to 5500 A.
                  Atmospheric dispersion is computed relative to 5500 A.
   max_arcsec   - maximum distance in arcseconds over which the calculation
                  is computed.  Defaults to 10 arcsec.
   pixels_per_arcsec - pixels per arcsecond, defaults to 20
   noplot       - toggles plotting, defalt is to plot

  OUTPUTS:
    Returns fraction of light lost from the slit
  
  EXAMPLES:  
    lost = starlightloss(2.0, 4.5, theta = 70, airmass=1.3, wave0 = 3800)

  BUGS: 
    Probably a slight dependence on the resolution (arcsec/pix)

  PROCEDURES CALLED:
    compute_refraction

  REVISION HISTORY:
    20-April-2003  Written by C. Tremonti, Steward Observatory
</pre>
<p><strong>(See pro/sky/starlightloss.pro)</strong></p>
<hr />
<h3 id="STERN_IRAC_AGN_F">STERN_IRAC_AGN()</h3>
<p><a href="#STARLIGHTLOSS">[Previous Routine]</a></p>
<p><a href="#TELLURIC_MASK_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   STERN_IRAC_AGN()

 PURPOSE:
   Identify AGN using the Stern wedge.

 INPUTS: 
   ch1_ab, ch2_ab, ch3_ab, ch4_ab - IRAC ch1-4 photometry (AB mag) 

 OUTPUTS: 
   isagn - Boolean array (1=AGN)

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Mar 16, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/galaxy/stern_irac_agn.pro)</strong></p>
<hr />
<h3 id="TELLURIC_MASK_F">TELLURIC_MASK()</h3>
<p><a href="#STERN_IRAC_AGN_F">[Previous Routine]</a></p>
<p><a href="#TEXSTRINGS">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       TELLURIC_MASK()

 PURPOSE:
       Mask telluric absorption features and flag wavelengths that
       are uncontaminated by the absorption features.

 CALLING SEQUENCE:
       mask = telluric_mask(wave,good=,bad=)

 INPUTS:
       wave  - wavelength vector [Angstrom]

 OPTIONAL INPUTS:

 KEYWORD PARAMETERS:

 OUTPUTS:
       mask  - pixel mask for WAVE (1B is good and 0B is bad)  

 OPTIONAL OUTPUTS:
       good      - indices in WAVE that have not been masked
       bad       - indices in WAVE that have been masked

 COMMENTS:
       See Figure 1 in Bessell (1999) for the strongest telluric
       feature wavelengths.  Also see
       http://www2.keck.hawaii.edu/inst/hires/makeewww/Atmosphere.

 PROCEDURES USED:

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 November 27, U of A
       jm03dec24uofa, added [B,A,T]BAND and [B,A,T]FREEBAND keywords 
       jm04sep10uofa - removed [B,A,T]BAND and [B,A,T]FREEBAND
                       keywords; updated and generalized the telluric
                       masking to match ICONSTRUCT_TELLURIC

 Copyright (C) 2003-2004, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sky/telluric_mask.pro)</strong></p>
<hr />
<h3 id="TEXSTRINGS">TEXSTRINGS</h3>
<p><a href="#TELLURIC_MASK_F">[Previous Routine]</a></p>
<p><a href="#TWOMASS_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	TEXSTRINGS

 PURPOSE:
	Returns a structure of string fields containing simplified
	names of the Tex to IDL strings generated by TEXTOIDL.

 OUTPUTS:
	s : a structure as described above

 RESTRICTIONS:
	Make sure you have the most recent version of TEXTOIDL with
	all the bugs fixed by D. Finkbeiner!

 COMMENTS:
	Try:
		s = texstrings()
	then:
		help, s, /structure

 EXAMPLE:
	Imagine wanting to generate a plot whose x-axis has the units
	of frequency times the differential frequency.  Normally, the
	lable for the x-title would look like this: 

		plot, x, y, xtitle=textoidl('\nu')+'d'+textoidl('\nu')

	This routine simplifies the above convention by creating short
	string names for each of the possible TEXTOIDL outputs.  After
	returning the structure this program creates, the above
	example would become:

		plot, x, y, xtitle=s.nu+'d'+s.nu

	Note: the structure field name for capital Greek letters
	are simply preceeded by the letter 'c' to distinguish them
	from the lowercase letters.
    
 PROCEDURES USED:
	TEXTOIDL() and associated routines, ANGSTROM(), SUNSYMBOL()

 MODIFICATION HISTORY:
	John Moustakas, 2000 September 15, U of A
</pre>
<p><strong>(See pro/plot/texstrings.pro)</strong></p>
<hr />
<h3 id="TWOMASS_FILTERLIST_F">TWOMASS_FILTERLIST()</h3>
<p><a href="#TEXSTRINGS">[Previous Routine]</a></p>
<p><a href="#VERIFY_SPECTRAL_INDICES">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   TWOMASS_FILTERLIST()
 PURPOSE:
   Return the 2MASS filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2009 Aug 14, UCSD
</pre>
<p><strong>(See pro/galaxy/twomass_filterlist.pro)</strong></p>
<hr />
<h3 id="VERIFY_SPECTRAL_INDICES">VERIFY_SPECTRAL_INDICES</h3>
<p><a href="#TWOMASS_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#WISE_FILTERLIST_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   VERIFY_SPECTRAL_INDICES
 PURPOSE:
   Compare the output of SPECTRAL_INDICES() against BC03. 
 OUTPUTS: 
   Generates a QAplot.
 MODIFICATION HISTORY:
   J. Moustakas, 2003 Oct 3, U of A
</pre>
<p><strong>(See pro/spec1d/verify_spectral_indices.pro)</strong></p>
<hr />
<h3 id="WISE_FILTERLIST_F">WISE_FILTERLIST()</h3>
<p><a href="#VERIFY_SPECTRAL_INDICES">[Previous Routine]</a></p>
<p><a href="#WKILL">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WISE_FILTERLIST()
 PURPOSE:
   Return the WISE filters.
 MODIFICATION HISTORY:
   J. Moustakas, 2011 Apr 19, UCSD
</pre>
<p><strong>(See pro/galaxy/wise_filterlist.pro)</strong></p>
<hr />
<h3 id="WKILL">WKILL</h3>
<p><a href="#WISE_FILTERLIST_F">[Previous Routine]</a></p>
<p><a href="#WRITE_BC03_TEMPLATES">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WKILL
 PURPOSE:
   Delete all open windows.
 MODIFICATION HISTORY:
   J. Moustakas, 2000 Sep 08, U of A
</pre>
<p><strong>(See pro/misc/wkill.pro)</strong></p>
<hr />
<h3 id="WRITE_BC03_TEMPLATES">WRITE_BC03_TEMPLATES</h3>
<p><a href="#WKILL">[Previous Routine]</a></p>
<p><a href="#WRITE_DS9_REGIONFILE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       WRITE_BC03_TEMPLATES

 PURPOSE:
       Write the BC03 spectra as galaxy templates.

 INPUTS:

 OPTIONAL INPUTS:
       dlogage - use this input to specify AGEGRID as an argument to
                 LOGARITHMIC_AGES(); values of 0.1-0.4 are reasonable 
       agegrid - manually define the ages of the templates [Myr]
                 (which will be interpolated to the closest matching
                 SSP age); this keyword is stronger than DLOGAGE
       suffix  - suffix to append to TFILE, the output template file
                 name (useful for not overwriting previous templates) 
       tpath   - output data path for the templates (the default is 
                 getenv('ISPEC_DIR')+'templates') 
       minwave - minimum output wavelength (default 1000 A)
       maxwave - maximum output wavelength (default 25,000 A)
       dwave   - output wavelength spacing (default 1 A/pixel)

 KEYWORD PARAMETERS:
       salpeter   - read the Salpeter IMF BC03 SSPs (default is the
                    Chabrier IMF)
       write      - write out

 OUTPUTS:
       bc   - floating array of all the template [NPIX,NTEMPLATE] 
       wave - corresponding wavelength vector [NPIX]

 EXAMPLE:

 MODIFICATION HISTORY:
       J. Moustakas, 2003 May 7, U of A - written
       jm03sepuofa   - major updates and revisions
       jm03nov04uofa - more major updates, incorporated IM_READ_BC03() 
       jm03dec04uofa - added DLOGAGE, AGEGRID, SUFFIX, and TPATH
                       optional inputs
       jm04mar03uofa - remove TREMONTI keyword; do not normalize the
                       templates; added SALPETER keyword; compute M/L
                       ratios in a large number of bands
       jm04oct12uofa - use KCORRECT filter routines; use filter
                       specifications from IM_FILTERSPECS()
       jm05jul25uofa - output changed to floating-point precision 
       jm08feb11nyu  - changed default AGEGRID
       jm08mar13nyu  - added MINWAVE, MAXWAVE, DWAVE optional inputs;
                       proper calculation of M/L values (now
                       correctly normalize by the stellar mass at a
                       given age)
       jm08aug12nyu  - changed FWHMRES from 3.0 to 3.5 Angstrom

 Copyright (C) 2003-2005, 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/write_bc03_templates.pro)</strong></p>
<hr />
<h3 id="WRITE_DS9_REGIONFILE">WRITE_DS9_REGIONFILE</h3>
<p><a href="#WRITE_BC03_TEMPLATES">[Previous Routine]</a></p>
<p><a href="#WRITE_DUMMY_CONFIG">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WRITE_DS9_REGIONFILE

 PURPOSE:
   Write out a DS9 region file.

 INPUTS: 
   ra  - right ascension
   dec - declination 

 OPTIONAL INPUTS: 
   filename - output file name (default 'ds9.reg')
   symbol   - symbol to draw; supported symbols are: 'box',
              'diamond', 'cross', 'x', 'arrow', and 'boxcircle'
              (default 'circle') 
   color    - region color; supported colors are 'white',
              'black', 'red', 'green', 'blue', 'cyan', 'magenta',
              and 'yellow' (default 'green')

 KEYWORD PARAMETERS: 

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:
   
 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2007 Jun 18, NYU - written
   jm08jun09nyu - added SYMBOL optional input

 Copyright (C) 2007-2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/write_ds9_regionfile.pro)</strong></p>
<hr />
<h3 id="WRITE_DUMMY_CONFIG">WRITE_DUMMY_CONFIG</h3>
<p><a href="#WRITE_DS9_REGIONFILE">[Previous Routine]</a></p>
<p><a href="#WRITE_ISEDFIT_PARAMFILE_F">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WRITE_DUMMY_CONFIG

 PURPOSE:
   Write a dummy (temporary) configuration file (for use with
   IM_SEX, IM_SCAMP, and IM_SWARP).

 INPUTS: 
   config - configuration structure

 OPTIONAL INPUTS: 
   configfile - output file name (default is to create a dummy
   file in '/tmp/')

 KEYWORD PARAMETERS: 

 OUTPUTS: 

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2008 Aug 06, NYU - written

 Copyright (C) 2008, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/write_dummy_config.pro)</strong></p>
<hr />
<h3 id="WRITE_ISEDFIT_PARAMFILE_F">WRITE_ISEDFIT_PARAMFILE()</h3>
<p><a href="#WRITE_DUMMY_CONFIG">[Previous Routine]</a></p>
<p><a href="#WRITE_PEGASE_IMF">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WRITE_ISEDFIT_PARAMFILE()

 PURPOSE:
   Build the global parameter file for iSEDfit.

 INPUTS: 
   isedfit_dir - full path specifying where all the I/O iSEDfit files
     should be written, including this parameter file (default
     PWD=present working directory)   
   prefix - prefix to assign to output files generated by iSEDfit,
     including this parameter file (e.g., 'mysample')
   filterlist - string array list of filters (K-correct compatible
     .par files) [NFILT]

   zminmax - two-element array specifying the minimum and maximum
     redshift range to consider in the calculations; ZMINMAX should
     span the range of redshifts of the sample, as the code will not
     extrapolate (ignored if USE_REDSHIFT is used)
   zbin - redshift bin spacing between ZMINMAX[0] and ZMINMAX[1]
     (you probably don't want the spacing to be much bigger
     than 0.1 in Delta-z); parameter ignored if /ZLOG
   zlog - set this keyword to distribute NZZ redshifts
     logarithmically in the range (ZMINMAX[0],ZMINMAX[1]) [0=no,
     1=yes] (default 0; ignored if USE_REDSHIFT is used); this is
     only really necessary if your sample extends all the way down to
     z~0 (e.g., if z ranges between 1E-3 and 0.1 you'll want
     to use /ZLOG) 
   nzz - number of *logarithmic* redshifts in the range
     (ZMINMAX[0],ZMINMAX[1]); only used if /ZLOG
   use_redshift - in lieu of ZMINMAX and ZBIN (or ZLOG and NZZ), the
     user can instead pass the desired model redshift array directly
     using this parameter; this is useful if you have a small number
     of objects in the sample spanning a wide range of redshifts (see
     COMMENTS!)

 OPTIONAL INPUTS: 
   h100 - Hubble constant relative to 100 km/s/Mpc (default 0.7)
   omega0 - matter density (default 0.3)
   omegal - vacuum energy density (default 0.7)

   spsmodels - stellar population synthesis models to use (default
     'fsps_v2.4_miles'); see the documentation for an up-to-date list
     of available models
   imf - initial mass function to adopt (default 'chab'=Chabrier);
     which IMF is available depends on which SPSMODELS are adopted;
     see the documentation for an up-to-date list of available IMFs
   redcurve - reddening curve (default 'charlot'=Charlot &amp; Fall); see
     the documentation for an up-to-date list of available
     reddening/attenuation curves  
   igm - include IGM attenuation? [0=no, 1=yes] (default 1); 

   sfhgrid - unique star formation history (SFHgrid) number (default 1)
   nmodel - number of Monte Carlo realizations of the model
     parameters (default 10,000)
   ndraw - random number of random points to draw from the posterior
     (default 2000)
   nminphot - require at least NMINPHOT bandpasses with well-measured
     photometry (i.e., excluding upper limits) in order to fit
     (default 3)
   modelchunksize - split the Monte Carlo model grids into
     MODELCHUNKSIZE sized chunks (see ISEDFIT_MONTEGRIDS for details;
     default is 5000L) 
   galchunksize - split the sample into GALCHUNKSIZE sized chunks,
     which is necessary if the sample is very large (default 2500) 

   age - minimum and maximum galaxy age (default [0.1,13]) [Gyr] 
   tau - minimum and maximum tau value (default [0.01,1.0]) [Gyr or
     Gyr^-1 if /ONEOVERTAU]
   Zmetal - minimum and maximum stellar metallicity (default
     [0.004,0.04]) 
   AV - Gamma distribution mean and width (default [0.35,2.0]) or
     minimum and maximum V-band extinction/attenuation if /FLATAV
     [mag] 
   mu - Gamma distribution mean and width (default [0.1,4.0]) or
     minimum and maximum values if /FLATMU
 
   pburst - cumulative probability of a burst occurring during each
     INTERVAL_PBURST time interval between TBURST[0] and TBURST[1]
     (default 0.0); note that all the subsequent burst parameters are
     ignored if PBURST&lt;=0!
   interval_pburst - time interval during which a burst can occur
     with probability PBURST (default 2.0 Gyr) 
   tburst - minimum and maximum time for a burst to occur (default
     [0.1,13]) (Gyr)
   fburst - minimum and maximum burst mass fraction (default
     [0.03,4.0]) 
   dtburst - minimum and maximum burst duration (default [0.03,0.3])
     (Gyr) 
   trunctau - minimum and maximum truncation timescale (default
     [-1.0,-1.0], i.e., no truncated bursts)
   fractrunc - fraction of models with truncated bursts (default 0) 
 
   oiiihb - if /NEBULAR then include draw the [OIII]/H-beta emission
     line ratios from a uniform distribution
  
   bursttype - type of burst (see iSEDfit documentation)
     0 - step function
     1 - Gaussian (default)
     2 - step function with exponential wings

 KEYWORD PARAMETERS:
   nebular - include nebular emission lines
   oneovertau - interpret TAU to be 1/TAU (i.e., &quot;gamma&quot; in the
     parlance of Salim+07); in other words, we draw uniformly from
     the range [1/max(TAU),1/min(TAU)]
   delayed - use a delayed &quot;tau&quot; model (see Appendix A of
     J. Moustakas et al. 2013) 
   flatAV - draw A(V) from a uniform/flat distribution rather than
     the default Gamma distribution
   flatmu - draw mu from a uniform/flat distribution rather than the
     default Gamma distribution 
   flatfburst - draw FBURST from a uniform/flat distribution rather
     than the default uniform *logarithmic* distribution 
   flatdtburst - draw DTBURST from a uniform/flat distribution rather 
     than the default uniform *logarithmic* distribution 
 
   append - append a new set of parameters to an existing parameter file
   help - print the documentation to STDOUT
   clobber - overwrite an existing parameter file
 
 OUTPUTS: 
   This code writes a parameter file called
   ISEDFIT_DIR+PREFIX+'_PARAMETER.PAR' and will also optionally
   return the PARAMS structure.  
 
 COMMENTS:
   Note that USE_REDSHIFT *must* be monotonic (increasing or
   decreasing), otherwise the interpolations fail. 

   If /APPEND then neither the number of elements in the redshift
   array nor the number of filters can change, otherwise the
   structures can't be stacked.

   See J. Moustakas et al. (2013, ApJ, 767, 50) for many details. 

 MODIFICATION HISTORY:
   J. Moustakas, 2012 Sep 19, Siena
   jm13aug05siena - major update and rewrite; all parameters
     controlling iSEDfit are now specified here

 Copyright (C) 2012-2013, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/isedfit/write_isedfit_paramfile.pro)</strong></p>
<hr />
<h3 id="WRITE_PEGASE_IMF">WRITE_PEGASE_IMF</h3>
<p><a href="#WRITE_ISEDFIT_PARAMFILE_F">[Previous Routine]</a></p>
<p><a href="#WRITE_SCAMP_CATALOG">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WRITE_PEGASE_IMF

 PURPOSE:
   Write a Pegase-compatible IMF file.

 INPUTS: 
   mass - stellar mass boundaries of the desired IMF [NPIECE+1] 
   slope - logarithmic slope between each mass interval [NPIECE] 

 OPTIONAL INPUTS: 
   outfile - output file name (default 'IMF_custom.dat')

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   The appropriate output file

 OPTIONAL OUTPUTS:

 EXAMPLES:
   First try the Salpeter IMF:
      IDL&gt; write_pegase_imf, [0.1,100.0], 1.0-2.35, $
      IDL&gt;   outfile='IMF_mySalpeter.dat'

   Alternatively, try the &quot;cosmic IMF&quot; of Wilkins+08 (eq. 2):
      IDL&gt; write_pegase_imf, [0.01,0.08,0.5,150.0], $
      IDL&gt;   1.0-[0.3,1.3,2.35], outfile='IMF_wilkins.dat'

 COMMENTS:
   See pg. 15 of the Pegase manual for details.  In particular, note
   that Pegase defines the *logarithmic* slope (i.e., the Salpeter
   slope is 1.35 in this case, not 2.35 as in the linear definition
   of the IMF).  Also remember that the IMF filename must be added to
   the 'list_IMFs.dat' file in order to be recognized! 

 MODIFICATION HISTORY:
   J. Moustakas, 2010 Mar 12, UCSD

 Copyright (C) 2010, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/synthesis/write_pegase_imf.pro)</strong></p>
<hr />
<h3 id="WRITE_SCAMP_CATALOG">WRITE_SCAMP_CATALOG</h3>
<p><a href="#WRITE_PEGASE_IMF">[Previous Routine]</a></p>
<p><a href="#WRITE_TEMDEN_LOOKUP_TABLE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
   WRITE_SCAMP_CATALOG

 PURPOSE:
   Write a SCAMP-compatible (in FITS_LDAC format) astrometric
   reference catalog. 

 INPUTS: 
   ra - right ascension (double-precision, decimal degrees)
   dec - declination (double-precision, decimal degrees)
   mag - photometric magnitude (arbitrary bandpass)

 OPTIONAL INPUTS: 
   ra_err - error in RA (default: 50 mas)
   dec_err - error in DEC (default: 50 mas)
   mag_err - error in MAG (default: 0.1 mag); note that MAG_ERR not
     seem to be used by the current version (1.4.6) of SCAMP
   outfile - output file name

 KEYWORD PARAMETERS: 

 OUTPUTS: 
   Writes a FITS_LDAC file to OUTFILE, which can then be passed to
   SCAMP using the following SCAMP parameters:
     ASTREF_CATALOG = 'FILE'
     ASTREFCAT_NAME = 'OUTFILE' [where OUTFILE is defined above]
     ASTREFCENT_KEYS = 'RA,DEC'
     ASTREFERR_KEYS = 'ERR_A,ERR_B'
     ASTREFMAG_KEY = 'MAG'

 OPTIONAL OUTPUTS:

 COMMENTS:

 EXAMPLES:

 MODIFICATION HISTORY:
   J. Moustakas, 2009 May 04, NYU - written, based in large part on a
     piece of C code (and documentation) written by D. Lang (Toronto)

 Copyright (C) 2009, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/sextractor/write_scamp_catalog.pro)</strong></p>
<hr />
<h3 id="WRITE_TEMDEN_LOOKUP_TABLE">WRITE_TEMDEN_LOOKUP_TABLE</h3>
<p><a href="#WRITE_SCAMP_CATALOG">[Previous Routine]</a></p>
<p><a href="#WSEX">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       WRITE_TEMDEN_LOOKUP_TABLE

 PURPOSE:
       Write a look-up table for use with IM_TEMDEN().

 INPUTS:

 OPTIONAL INPUTS:
       max_temp   - maximum temperature to consider (default 25,000 K)
       min_temp   - minimum temperature to consider (default 5,000 K)
       step_temp  - temperature step size
       max_dens   - maximum density to consider (default 10,000 cm^-3)
       min_dens   - minimum density to consider (default 1 cm^-3)
       step_dens  - density step size

 KEYWORD PARAMETERS:

 OUTPUTS:
       Binary FITS lookup table.

 COMMENTS:
       Currently only the following ratios are written out.

       Temperature-sensitive line-ratios:
          O_III = (4959+5007)/4363
          S_III = (9069+9532)/6312
          O_II  = (3726+3729)/7325
          N_II  = (6548+6584)/5755
 
       Density-sensitive line-ratios:
          O_II = 3726/3729
          S_II = 6716/6731

 MODIFICATION HISTORY:
       J. Moustakas, 2007 Nov 27, NYU - written

 Copyright (C) 2007, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/hiiregions/write_temden_lookup_table.pro)</strong></p>
<hr />
<h3 id="WSEX">WSEX</h3>
<p><a href="#WRITE_TEMDEN_LOOKUP_TABLE">[Previous Routine]</a></p>
<p><a href="#XREBIN">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
       WSEX

 PURPOSE:
       Write out arbitrary SExtractor format catalogs, using native
       header information &amp; data themselves.  Correctly reads longs,
       strings, and doubles.  

 INPUTS:
       A SExtractor-format catalog

 OUTPUTS:
       Prints out a catalog file for the given structure

 COMMON BLOCKS:
       None.

 RESTRICTIONS:
       None.

 PROCEDURE:
       Use syntax
       wset,catalog,outfile='catalog.cat'

 COMMENTS:
       To do -- 
       . better error checking, e.g. for existing output filename,
       etc. 

 PROCEDURES USED:
       VALID_NUM

 MODIFICATION HISTORY:
       L. Moustakas '04feb11 - created
       J. Moustakas, 09jul08, UCSD - check for arrays in the input
         structure 
</pre>
<p><strong>(See pro/sextractor/wsex.pro)</strong></p>
<hr />
<h3 id="XREBIN">XREBIN</h3>
<p><a href="#WSEX">[Previous Routine]</a></p>
<p><a href="#XY2IMAGE">[Next Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:              
   XREBIN

 PURPOSE:           
   Rebin a vector.

 USAGE:
         yout = xrebin(xin, yin, xout [,/SPLINE] [,/LSQUADRATIC] 
                       [,/QUADRATIC], [/SPLINF], [/CUBIC]
 ARGUMENTS:
         XIN         (N+1) points of the borders of each input bin
         YIN         values (N) of input bins (1 or 2D)
         XOUT        points of the borders of output bins
 KEYWORDS:
         SPLINE      add this keyword for spline interpolation (default -
                     linear) 
         LSQUADRATIC for least square quadratic interpolation
         QUADRATIC   for quadratic
         SPLINF      Other version of spline interpolation
                     3-4 times faster than SPLINE, the results are
                     slightly different, but seemingly better.
         CUBIC       Use the function INTERPOLATE with CUBIC=-05
                     Cubic convolution is an interpolation method that  
                     closely approximates the theoretically optimum sinc  
                     interpolation function using cubic polynomials.
 OUTPUT
         YOUT        output 1 or 2D array, rebined at the borders
                     reqested by XOUT 

 DESCRIPTION:   
    This function rebins a vector or a n-dimensional array into
    different bins along the first axis.

    The rebining is made as integrating the signal, interpolating and
    differentiating the result. The integrated signal is preserved.

    Different interpolating algorithms are proposed, and only one of
    the keywords SPLINE LSQUADRATIC QUADRATIC SPLINF CUBIC must be given.
    If not of them is specified, the routine INTERPOL will make a linear
    interpolation. This latter routin also handle the SPLINE LSQUADRATIC
    QUADRATIC cases. The difference between SPLINF and SPLINE is
    the the Spline representation is computed on the whole vector
    instead of on 4-points blocks (this is faster and often our preferred
    option). CUBIC is using the function INTERPOLATE with CUBIC=-0.5 (sinc).

    No check is performed to prevent extrapolation (beware to give
    proper input).

 AUTHOR: Mina Koleva (2007/03/01)
</pre>
<p><strong>(See pro/spec1d/xrebin.pro)</strong></p>
<hr />
<h3 id="XY2IMAGE">XY2IMAGE</h3>
<p><a href="#XREBIN">[Previous Routine]</a></p>
<p><a href="#ROUTINELIST">[List of Routines]</a></p>
<pre>
 NAME:
	XY2IMAGE

 PURPOSE:
	Populate an image with the coordinates given by (x,[y]).

 CALLING SEQUENCE:
	xy2image, x, y=y, image, binsize=binsize, weights=weights

 INPUTS:
	x	: x coordinates(s)

 OPTIONALS INPUTS:
	y	: y coordinate(s)
	weights	: weight(s) to add at each (x,[y]) position
	binsize	: resolution of each image pixel

 KEYWORD PARAMETERS:
	float   : will return a float scaled image (default is byte)
    
 OUTPUTS:

 COMMON BLOCKS:

 SIDE EFFECTS:

 RESTRICTIONS:

 COMMENTS:
	The binsize should reflect the decimal accuracy of x and y.
	For example, if the x,y coordinates are known to 0.01 units,
	then the binsize should be set to 0.01.  

 MODIFICATION HISTORY:
	John Moustakas, 22 August 2000, UofA
	jm01may30uofa - allowed image to be passed with defined dimensions

 Copyright (C) 2000-2001, John Moustakas
 
 This program is free software; you can redistribute it and/or modify 
 it under the terms of the GNU General Public License as published by 
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version. 
 
 This program is distributed in the hope that it will be useful, but 
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 General Public License for more details. 
</pre>
<p><strong>(See pro/image/xy2image.pro)</strong></p>
<hr />
</body>
</html>
